const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./maplibre-gl-SrYoxfTy.js","./index-DVzoLhiV.js","./index-BXO0V4HD.css"])))=>i.map(i=>d[i]);
import{r as i,j as e,_ as mn,p as an,a as ln,b as dn,u as St}from"./index-DVzoLhiV.js";function cn(t){return typeof t=="object"&&t!==null}function bn(t){return!(!cn(t)||typeof t.key!="string"||t.userType!=="guest"&&t.userType!=="registered"&&t.userType!=="subscriber"||typeof t.lat!="number"||!Number.isFinite(t.lat)||typeof t.lng!="number"||!Number.isFinite(t.lng)||typeof t.updatedAtMs!="number"||!Number.isFinite(t.updatedAtMs)||t.status!==void 0&&typeof t.status!="string")}function un(t){const[n,r]=i.useState(()=>new Map),[g,a]=i.useState(null),f=i.useRef(null),k=i.useRef(null);return i.useEffect(()=>{if(t.disabled===!0||t.wsUrl.trim()===""){r(new Map),a(null),k.current!==null&&(window.clearTimeout(k.current),k.current=null);return}let N=!1,z=0,_=null;const G=()=>{_!==null&&(window.clearInterval(_),_=null)},E=()=>{if(N)return;const c=Math.min(8e3,500*2**Math.min(z,4));k.current=window.setTimeout(()=>{k.current=null,A()},c)},A=()=>{if(N)return;let c;try{c=new WebSocket(t.wsUrl)}catch{z+=1,a("Realtime unavailable in this mode."),E();return}f.current=c;let M=!1;c.onopen=()=>{M=!0,z=0,a(null);const P={};t.sessionToken&&(P.sessionToken=t.sessionToken),t.jwt&&(P.jwt=t.jwt),c.send(JSON.stringify({type:"auth",payload:P})),_=window.setInterval(()=>{c.readyState===c.OPEN&&c.send(JSON.stringify({type:"heartbeat",payload:{}}))},15e3)},c.onmessage=P=>{const p=(()=>{try{return JSON.parse(String(P.data))}catch{return null}})();if(!p||typeof p.type!="string"){a("Invalid server message.");return}if(p.type==="error"&&cn(p.payload)&&typeof p.payload.message=="string"){a(p.payload.message);return}if(p.type==="presence_update"){const h=p.payload;if(!bn(h)){a("Invalid presence payload.");return}r(F=>{const $=new Map(F);return $.set(h.key,h),$})}},c.onerror=()=>{},c.onclose=P=>{if(G(),!N&&P.code!==1e3){z+=1;const p=typeof P.reason=="string"&&P.reason.trim()!==""?` Reason: ${P.reason}`:"";(z>=2||M)&&a(`Realtime ${M?"disconnected":"failed to connect"} (code ${P.code}). Reconnecting...${p}`),E()}}};return A(),()=>{var c;N=!0,G(),k.current!==null&&(window.clearTimeout(k.current),k.current=null),(c=f.current)==null||c.close(1e3,"Client cleanup"),f.current=null}},[t.disabled,t.jwt,t.sessionToken,t.wsUrl]),{state:i.useMemo(()=>({byKey:n}),[n]),lastErrorMessage:g}}async function vn(){const t=await mn(()=>import("./maplibre-gl-SrYoxfTy.js").then(r=>r.m),__vite__mapDeps([0,1,2]),import.meta.url);return t.default??t}function xn(t){return t.replace(/[&<>"']/g,n=>{switch(n){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return n}})}function jn(){return{version:8,sources:{basemap:{type:"raster",tiles:["https://a.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png","https://b.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png","https://c.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png"],tileSize:256,attribution:"Â© OpenStreetMap contributors Â© CARTO"}},layers:[{id:"basemap",type:"raster",source:"basemap"}]}}function Sn(t){const n=document.createElement("button");return n.type="button",n.setAttribute("aria-label",t.label??"Presence marker"),n.style.width="40px",n.style.height="40px",n.style.borderRadius="999px",n.style.border=`2px solid ${t.color}`,n.style.touchAction="manipulation",n.style.userSelect="none",t.markerType==="spot"?(n.style.background="radial-gradient(circle at 30% 30%, #ff4f60, #a70013)",n.style.display="grid",n.style.placeItems="center",n.style.color="#ffffff",n.style.fontWeight="700",n.style.fontSize="13px",n.textContent=typeof t.markerGlyph=="string"&&t.markerGlyph.trim()?t.markerGlyph.trim().slice(0,2):"SP"):typeof t.imageUrl=="string"&&t.imageUrl.trim()!==""?(n.style.backgroundImage=`url("${t.imageUrl}")`,n.style.backgroundSize="cover",n.style.backgroundPosition="center"):n.style.background="#000000",n.style.padding="0",n.style.cursor=typeof t.onClick=="function"?"pointer":"default",n.style.pointerEvents="auto",n}function wn({initialView:t,markers:n,interactive:r,visible:g}){const a=i.useRef(null),f=i.useRef(null),k=i.useRef(null),T=i.useRef([]),[N,z]=i.useState({kind:"ready"}),_=i.useMemo(()=>t.center,[t.center]),G=r!==!1,E=g!==!1;return i.useEffect(()=>{let A=!1,c=null,M=null,P=null;async function p(){if(a.current&&!k.current)try{f.current||(f.current=await vn());const h=f.current,F=new h.Map({container:a.current,style:jn(),center:[_.lng,_.lat],zoom:t.zoom,interactive:G});F.addControl(new h.NavigationControl({showCompass:!1}),"top-right"),k.current=F;const $=()=>{F.resize()};M=$,P=window.requestAnimationFrame($),window.addEventListener("resize",$),c=new ResizeObserver(()=>$()),c.observe(a.current),F.on("error",K=>{var ye;const ue=((ye=K.error)==null?void 0:ye.message)??"Map error.";A||ue.toLowerCase().includes("failed to fetch")||ue.toLowerCase().includes("network")||z({kind:"error",message:ue})}),F.once("load",()=>{A||z({kind:"ready"})})}catch(h){if(A)return;z({kind:"error",message:h instanceof Error?h.message:"Map error."})}}return p(),()=>{var h;A=!0,P!==null&&window.cancelAnimationFrame(P),M&&window.removeEventListener("resize",M),c==null||c.disconnect();for(const F of T.current)F.remove();T.current=[],(h=k.current)==null||h.remove(),k.current=null}},[G]),i.useEffect(()=>{const A=k.current;if(!A||!E)return;A.resize();const c=window.setTimeout(()=>{A.resize(),A.setCenter([t.center.lng,t.center.lat]),A.setZoom(t.zoom)},80);return()=>window.clearTimeout(c)},[t.center.lat,t.center.lng,t.zoom,E]),i.useEffect(()=>{const A=k.current;if(!A||!E)return;A.resize();const c=window.setTimeout(()=>A.resize(),120);return()=>window.clearTimeout(c)},[E]),i.useEffect(()=>{const A=k.current,c=f.current;if(!(!A||!c)){for(const M of T.current)M.remove();T.current=[];for(const M of n){const P=typeof M.label=="string"&&M.label.trim()!==""?new c.Popup({closeButton:!1,closeOnClick:!0}).setHTML(`<div style="font-family: var(--ui); font-size: 12px; line-height: 1.35;">
                 <div style="font-weight: 600;">${xn(M.label)}</div>
               </div>`):void 0,p=Sn(M);if(typeof M.onClick=="function"){const F=$=>{var K;$.preventDefault(),$.stopPropagation(),(K=M.onClick)==null||K.call(M)};p.addEventListener("click",F),p.addEventListener("touchend",F,{passive:!1}),p.addEventListener("pointerup",F)}const h=new c.Marker({element:p}).setLngLat([M.position.lng,M.position.lat]);P&&h.setPopup(P),h.addTo(A),T.current.push(h)}}},[n]),N.kind==="error"?e.jsxs("div",{style:{background:"#000000",color:"#F22F2F",border:"2px solid #C00000",borderRadius:8,padding:12,fontFamily:"var(--ui)",fontSize:14,lineHeight:1.4},role:"alert","aria-live":"polite",children:["Map error: ",N.message]}):e.jsx("div",{ref:a,className:"rd-maplibre",style:{width:"100%",height:"100%",background:"#000000",borderRadius:8,overflow:"hidden"},"aria-label":"Cruise map"})}const Qt=[an,ln,dn];function In(t){let n=0;for(let r=0;r<t.length;r+=1)n=n*31+t.charCodeAt(r)|0;return Math.abs(n)}function kn(t){return Qt[In(t)%Qt.length]}function Cn(t,n,r){return t.map(g=>({id:g.key,position:{lat:g.lat,lng:g.lng},color:"#C00000",label:g.status?`Presence: ${g.status}`:"Presence",imageUrl:(n==null?void 0:n[g.key])??kn(g.key),onClick:r?()=>r(g.key):void 0}))}function Xt({wsUrl:t,sessionToken:n,jwt:r,defaultCenter:g,defaultZoom:a,presenceUpdates:f,realtimeErrorMessage:k,onMarkerSelect:T,avatarByKey:N,additionalMarkers:z,height:_,visible:G}){const E=un({wsUrl:t,sessionToken:n,jwt:r,disabled:Array.isArray(f)}),A=f?{byKey:new Map(f.map(K=>[K.key,K]))}:E.state,c=k??E.lastErrorMessage,[M,P]=i.useState({kind:"pending"});i.useEffect(()=>{if(!("geolocation"in navigator)||!navigator.geolocation){P({kind:"unavailable"});return}navigator.geolocation.getCurrentPosition(K=>{P({kind:"granted",center:{lat:K.coords.latitude,lng:K.coords.longitude}})},K=>{if(K.code===K.PERMISSION_DENIED){P({kind:"denied"});return}if(K.code===K.TIMEOUT){P({kind:"error",message:"Timed out while trying to read your location. Showing the default map view."});return}P({kind:"error",message:K.message||"Geolocation error."})},{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e4})},[]);const p=i.useMemo(()=>Array.from(A.byKey.values()),[A.byKey]),h=i.useMemo(()=>[...Cn(p,N,T),...z??[]],[z,N,T,p]),F=i.useMemo(()=>{const K=typeof a=="number"&&Number.isFinite(a)?a:13;return M.kind==="granted"?{center:M.center,zoom:K}:{center:g,zoom:K}},[g,a,M]),$=i.useMemo(()=>M.kind==="denied"?"Location permission denied. Showing the default map view.":M.kind==="unavailable"?"Geolocation is unavailable. Showing the default map view.":M.kind==="error"?`Geolocation error: ${M.message}`:null,[M]);return e.jsxs("section",{"aria-label":"Cruise mode map",style:{background:"#000000",color:"#FFFFFF",fontFamily:"var(--ui)",display:"grid",gap:8,height:"100%"},children:[$?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"rgba(0,0,0,0.7)",border:"1px solid rgba(255,58,77,0.45)",borderRadius:0,padding:8,color:"#AAAAAA",fontSize:12,lineHeight:1.4},children:$}):null,c?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"rgba(0,0,0,0.7)",border:"1px solid rgba(255,58,77,0.45)",borderRadius:0,padding:8,color:"#F22F2F",fontSize:12,lineHeight:1.4},children:c}):null,e.jsx("div",{style:{background:"#111111",border:0,borderRadius:0,overflow:"hidden",height:typeof _=="number"||typeof _=="string"?_:520},children:e.jsx(wn,{initialView:F,markers:h,visible:G})})]})}const Tn="FIRE_SIGNAL|1";function Mn(t){return new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function Zt(t){if(!t.startsWith("LOCATION|"))return null;const[,n,r]=t.split("|"),g=Number(n),a=Number(r);return!Number.isFinite(g)||!Number.isFinite(a)?null:{lat:g,lng:a,link:`https://maps.google.com/?q=${g},${a}`}}function Pn(t){return t.trim()===Tn?"ðŸ”¥ I'm into you":t}function Rn(t){const n=t.trim();if(n.startsWith("user:")){const r=n.slice(5).trim();return r?`User ${r.slice(0,8)}`:"User"}if(n.startsWith("session:")){const r=n.slice(8).trim();return r?`Guest ${r.slice(0,6)}`:"Guest"}return n.startsWith("spot:")?"Spot":n||"Member"}function Wt({chatKind:t,peerKey:n,currentUserKey:r,messages:g,client:a,title:f,peerSummary:k,thirdParty:T,edgeToEdge:N,showHeader:z,fillHeight:_,presentation:G,authorLabelForKey:E}){const[A,c]=i.useState(""),[M,P]=i.useState(null),[p,h]=i.useState(!1),[F,$]=i.useState({}),[K,ue]=i.useState(!1),[ye,je]=i.useState(!1),he=i.useRef(null),be=i.useRef([]),Me=i.useRef(null),ve=i.useRef(null),me=i.useRef(null),y=N===!0,x=z!==!1,v=y&&_===!0,W=G==="board",j=i.useMemo(()=>[...g].sort((l,C)=>l.createdAtMs-C.createdAtMs),[g]),ge=i.useMemo(()=>Array.from(new Set(j.map(l=>{var C;return(C=l.media)==null?void 0:C.objectKey}).filter(l=>typeof l=="string"&&l.trim().length>0))),[j]);i.useEffect(()=>{let l=!1;async function C(){for(const O of ge){if(l)return;if(!F[O])try{const te=await a.getMediaUrl(O);if(l)return;$(le=>({...le,[O]:te}))}catch{}}}return C(),()=>{l=!0}},[a,ge,F]);async function oe(l){const C=A.trim();if(!(C.length===0&&!l)){h(!0),P(null);try{await a.sendMessage(t,n,C,l),c("")}catch(O){const te=O;P(typeof(te==null?void 0:te.message)=="string"?te.message:"Message rejected.")}finally{h(!1)}}}async function Ie(l){h(!0),P(null);try{const C=await a.initiateMediaUpload(l.type||"application/octet-stream",l.size);await a.uploadToSignedUrl(C.uploadUrl,l,l.type||"application/octet-stream");const te={kind:l.type.startsWith("image/")?"image":l.type.startsWith("video/")?"video":"audio",objectKey:C.objectKey,mimeType:l.type||"application/octet-stream"};await oe(te)}catch(C){const O=C;P(typeof(O==null?void 0:O.message)=="string"?O.message:"Upload rejected."),h(!1)}}async function Se(l){var O;const C=(O=l.target.files)==null?void 0:O[0];if(l.target.value="",!!C){if(!C.type.startsWith("image/")&&!C.type.startsWith("video/")&&!C.type.startsWith("audio/")){P("Only image, video, or audio files are supported.");return}await Ie(C)}}async function Ue(){var l;if(K){(l=he.current)==null||l.stop();return}if(!navigator.mediaDevices||typeof navigator.mediaDevices.getUserMedia!="function"){P("Microphone is not available in this browser.");return}try{const C=await navigator.mediaDevices.getUserMedia({audio:!0}),O=new MediaRecorder(C);be.current=[],he.current=O,O.ondataavailable=te=>{te.data.size>0&&be.current.push(te.data)},O.onstop=()=>{const te=new Blob(be.current,{type:O.mimeType||"audio/webm"}),le=new File([te],`voice-${Date.now()}.webm`,{type:O.mimeType||"audio/webm"});Ie(le);for(const xe of C.getTracks())xe.stop();he.current=null,ue(!1)},O.start(),ue(!0)}catch(C){const O=C;P(typeof(O==null?void 0:O.message)=="string"?O.message:"Unable to record voice."),ue(!1)}}async function S(){if(!navigator.geolocation){P("Geolocation is not available in this browser.");return}h(!0),P(null);try{const l=await new Promise((le,xe)=>{navigator.geolocation.getCurrentPosition(le,xe,{enableHighAccuracy:!1,timeout:12e3,maximumAge:3e4})}),C=Number(l.coords.latitude.toFixed(5)),O=Number(l.coords.longitude.toFixed(5)),te=`LOCATION|${C}|${O}`;await a.sendMessage(t,n,te)}catch(l){const C=l;P(typeof(C==null?void 0:C.message)=="string"?C.message:"Unable to send location.")}finally{h(!1)}}return e.jsxs("section",{"aria-label":"Chat",style:{background:y?"transparent":"#000000",color:"#FFFFFF",fontFamily:"Montserrat, sans-serif",padding:y?0:16,display:"grid",gap:y?0:12,gridTemplateRows:x?"auto auto 1fr auto":"1fr auto",minHeight:_?"calc(100dvh - 196px)":void 0},children:[x?e.jsxs("header",{style:{height:56,display:"grid",alignItems:"center",background:"#000000"},children:[e.jsx("div",{style:{textAlign:"center",fontSize:20,fontWeight:600},children:f}),k?e.jsxs("div",{style:{marginTop:4,display:"flex",alignItems:"center",justifyContent:"center",gap:8,color:"#b7d8e0",fontSize:13},children:[e.jsx("span",{children:"Chat with:"}),k.avatarUrl?e.jsx("img",{src:k.avatarUrl,alt:`${k.displayName} avatar`,style:{width:24,height:24,borderRadius:"50%",objectFit:"cover",border:"1px solid rgba(38,213,255,0.8)"}}):e.jsx("span",{"aria-hidden":!0,style:{width:24,height:24,borderRadius:"50%",border:"1px solid rgba(38,213,255,0.8)",background:"rgba(255,255,255,0.08)"}}),e.jsx("span",{style:{color:"#fff",fontWeight:600},children:k.displayName})]}):null,e.jsx("div",{style:{textAlign:"center",fontSize:12,color:"#AAAAAA"},children:t==="cruise"?"CRUISE CHAT (EPHEMERAL)":"DATE CHAT (PERSISTENT)"})]}):null,M?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"#111111",border:"2px solid #C00000",borderRadius:8,padding:12,color:"#F22F2F",fontSize:14,lineHeight:1.4},children:M}):null,e.jsx("div",{"aria-label":"Messages",style:{background:y?"#09090b":"#111111",border:y?"none":"2px solid #C00000",borderRadius:y?0:8,padding:12,display:"flex",flexDirection:"column",gap:12,minHeight:y?0:320,paddingBottom:v?148:12,overflowY:"auto"},children:j.length===0?e.jsx("div",{style:{color:"#AAAAAA",fontSize:14,lineHeight:1.4},children:W?"No posts yet.":"No messages."}):j.map(l=>{const C=l.fromKey===r,O=W?"rgba(22,22,28,0.96)":C?"#C00000":"#444444",te=W?{alignItems:"stretch"}:C?{alignItems:"flex-end"}:{alignItems:"flex-start"},le=E?E(l.fromKey):Rn(l.fromKey);return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,width:"100%",...te},children:[W?e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:10,color:"#cfd4de",fontSize:12},children:[e.jsx("span",{style:{fontWeight:700,color:"#ffffff"},children:le}),e.jsx("span",{children:new Date(l.createdAtMs).toLocaleString([],{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})})]}):null,(()=>{const xe=Zt(l.text??"");return xe?e.jsxs("a",{href:xe.link,target:"_blank",rel:"noreferrer",style:{display:"grid",gap:6,textDecoration:"none",color:"#fff",background:O,borderRadius:W?12:14,border:W?"1px solid rgba(255,255,255,0.08)":"none",padding:8,width:"auto",maxWidth:W?"100%":"80%"},children:[e.jsx("div",{style:{fontSize:12,color:"#d8ecff"},children:"Shared location"}),e.jsx("iframe",{title:"Google Maps location preview",src:`https://www.google.com/maps?q=${xe.lat},${xe.lng}&z=14&output=embed`,style:{width:"100%",height:140,border:"1px solid rgba(255,255,255,0.18)",borderRadius:10},loading:"lazy",referrerPolicy:"no-referrer-when-downgrade"}),e.jsx("div",{style:{fontSize:12,color:"#3fdfff"},children:"Open in Google Maps"})]}):null})(),e.jsxs("div",{style:{background:O,color:"#FFFFFF",borderRadius:W?12:18,border:W?"1px solid rgba(255,255,255,0.08)":"none",padding:W?"10px 12px":"8px 12px",width:"auto",maxWidth:W?"100%":"80%",fontSize:W?15:16,lineHeight:1.4,whiteSpace:"pre-wrap",overflowWrap:"anywhere",wordBreak:"break-word"},children:[l.text&&!Zt(l.text)?e.jsx("div",{style:{marginBottom:l.media?8:0},children:Pn(l.text)}):null,l.media?e.jsxs("div",{children:[l.media.kind==="image"?e.jsx("img",{src:F[l.media.objectKey],alt:"Shared",style:{width:"100%",maxWidth:260,borderRadius:10,border:"1px solid rgba(255,255,255,0.18)"}}):null,l.media.kind==="video"?e.jsx("video",{controls:!0,playsInline:!0,src:F[l.media.objectKey],style:{width:"100%",maxWidth:320,borderRadius:10,background:"#000"}}):null,l.media.kind==="audio"?e.jsx("audio",{controls:!0,src:F[l.media.objectKey],style:{width:"100%",maxWidth:260}}):null]}):null]}),W?null:e.jsx("div",{style:{fontSize:10,color:"#AAAAAA"},children:Mn(l.createdAtMs)}),C&&!W?e.jsx("div",{style:{fontSize:10,color:"#6fdcff"},children:typeof l.readAtMs=="number"?"Read":typeof l.deliveredAtMs=="number"?"Delivered":""}):null]},l.messageId)})}),e.jsxs("form",{onSubmit:l=>{l.preventDefault(),oe()},"aria-label":"Message input",style:{background:y?"linear-gradient(180deg, rgba(96,0,12,0.96), rgba(58,0,8,0.98))":"#111111",border:y?"none":"2px solid #C00000",borderRadius:y?0:8,padding:12,display:"grid",gridTemplateColumns:"1fr auto auto",gap:12,alignItems:"start",position:v?"fixed":"static",left:v?0:void 0,right:v?0:void 0,bottom:v?"calc(env(safe-area-inset-bottom, 0px) + 66px)":void 0,zIndex:v?45:void 0},children:[e.jsx("label",{style:{display:"grid"},children:e.jsx("input",{value:A,onChange:l=>c(l.target.value),placeholder:"Type a message",disabled:p,style:{width:"100%",background:"#111111",color:"#FFFFFF",border:"2px solid #444444",borderRadius:8,padding:"10px 12px",fontSize:16,lineHeight:1.4,outline:"none"},"aria-label":W?"Write a post":"Message text"})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{ref:Me,type:"file",accept:"image/*,video/*,audio/*",disabled:p,onChange:l=>void Se(l),style:{display:"none"}}),e.jsx("input",{ref:ve,type:"file",accept:"image/*",capture:"environment",disabled:p,onChange:l=>void Se(l),style:{display:"none"}}),e.jsx("input",{ref:me,type:"file",accept:"video/*",capture:"environment",disabled:p,onChange:l=>void Se(l),style:{display:"none"}}),e.jsx("button",{type:"button",disabled:p,onClick:()=>je(l=>!l),style:{background:"rgba(0,0,0,0.45)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px",display:"grid",placeItems:"center",cursor:p?"not-allowed":"pointer",color:"#3fdfff",fontWeight:700,height:44,minWidth:44},"aria-label":"More actions",children:"+"}),ye?e.jsxs("div",{style:{position:"absolute",right:0,top:v?void 0:48,bottom:v?48:void 0,zIndex:5,minWidth:220,display:"grid",gap:8,padding:10,borderRadius:10,border:"1px solid rgba(255,58,77,0.5)",background:"rgba(10,11,16,0.98)"},children:[e.jsx("button",{type:"button",disabled:p,onClick:()=>{var l;je(!1),(l=ve.current)==null||l.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Take Photo"}),e.jsx("button",{type:"button",disabled:p,onClick:()=>{var l;je(!1),(l=me.current)==null||l.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Record Video"}),e.jsx("button",{type:"button",disabled:p,onClick:()=>{var l;je(!1),(l=Me.current)==null||l.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Choose Media"}),e.jsx("button",{type:"button",disabled:p,onClick:()=>{je(!1),Ue()},style:{background:K?"#ff2136":"rgba(0,0,0,0.6)",color:"#fff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:K?"Stop Voice":"Record Voice"}),e.jsx("button",{type:"button",disabled:p,onClick:()=>{je(!1),S()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Send Location"}),T?e.jsxs("div",{style:{display:"grid",gap:8,borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:8},children:[e.jsxs("select",{value:T.selectedKey,onChange:l=>T.onSelect(l.target.value),disabled:T.disabled||T.candidates.length===0,style:{background:"#0b0d12",color:"#fff",border:"1px solid rgba(255,58,77,0.62)",borderRadius:10,padding:"8px 10px"},"aria-label":"Add previous contact to group",children:[T.candidates.length===0?e.jsx("option",{value:"",children:"No previous contacts"}):null,T.candidates.map(l=>e.jsx("option",{value:l.key,children:l.label},l.key))]}),e.jsx("button",{type:"button",onClick:()=>{T.onAdd(),je(!1)},disabled:T.disabled||T.candidates.length===0||!T.selectedKey,style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,58,77,0.62)",borderRadius:10,padding:"8px 10px",fontWeight:700},children:"Add Third User"})]}):null]}):null]}),e.jsx("button",{type:"submit",disabled:p,style:{background:p?"#333333":"#C00000",color:p?"#777777":"#FFFFFF",border:"2px solid #C00000",borderRadius:8,padding:"10px 20px",fontSize:16,fontWeight:600,cursor:p?"not-allowed":"pointer",height:44},"aria-label":W?"Post message":"Send message",children:W?"POST":"SEND"})]})]})}const Dt="FIRE_SIGNAL|1";function De(){return{background:"radial-gradient(560px 240px at 10% 0%, rgba(255,46,63,0.24), transparent 58%), radial-gradient(460px 200px at 100% 0%, rgba(162,20,35,0.2), transparent 58%), linear-gradient(180deg, rgba(15,4,7,0.86), rgba(5,3,6,0.9))",border:"1px solid rgba(255,70,90,0.34)",borderRadius:20,padding:16,boxShadow:"inset 0 1px 0 rgba(255,255,255,0.08), inset 0 0 0 1px rgba(255,36,56,0.14), 0 18px 34px rgba(0,0,0,0.42)"}}function Ee(t){return{background:t?"linear-gradient(180deg, rgba(92, 92, 92, 0.7), rgba(60, 60, 60, 0.7))":"linear-gradient(180deg, #ff4c60 0%, #f1102b 45%, #c60017 100%)",border:"1px solid rgba(255,95,110,0.64)",color:t?"#999999":"#FFFFFF",padding:"12px 20px",borderRadius:12,fontSize:16,fontWeight:700,letterSpacing:"0.06em",cursor:t?"not-allowed":"pointer",textTransform:"uppercase",boxShadow:t?"none":"inset 0 1px 0 rgba(255,255,255,0.28), inset 0 -10px 16px rgba(120,0,18,0.26), 0 12px 24px rgba(198,0,24,0.32)"}}function B(t){return{background:"linear-gradient(180deg, rgba(20, 8, 12, 0.88), rgba(8, 5, 8, 0.9))",border:"1px solid rgba(255,95,110,0.36)",color:"#3fdfff",padding:"12px 18px",borderRadius:12,fontSize:16,fontWeight:700,letterSpacing:"0.05em",cursor:t?"not-allowed":"pointer",textTransform:"uppercase",opacity:t?.6:1,boxShadow:"inset 0 1px 0 rgba(255,255,255,0.12), 0 10px 18px rgba(0,0,0,0.28)"}}function X(){return{background:"linear-gradient(180deg, rgba(8,8,12,0.96), rgba(4,4,8,0.98))",color:"#ffffff",border:"1px solid rgba(255,80,98,0.22)",borderRadius:14,padding:"13px 14px",fontSize:17,lineHeight:1.25,boxShadow:"inset 0 1px 0 rgba(255,255,255,0.05), inset 0 -10px 18px rgba(0,0,0,0.2), 0 7px 14px rgba(0,0,0,0.22)"}}function An(t){return typeof t=="string"}function q(t){const n=t;return An(n==null?void 0:n.message)?n.message:"Action rejected."}function en(t){return typeof t!="number"||!Number.isFinite(t)||t<=0?"Date TBD":new Date(t).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})}function tn(t){return typeof t!="number"||!Number.isFinite(t)||t<=0?"Time TBD":new Date(t).toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"})}function At(){const t="__disabled__".trim();if(t==="__disabled__")return"";if(t!==""){if(t.startsWith("ws://")||t.startsWith("wss://"))return t;try{const r=new URL(t);return r.protocol=r.protocol==="https:"?"wss:":"ws:",r.toString()}catch{if(t.startsWith("/")){const r=new URL(t,window.location.origin);return r.protocol=r.protocol==="https:"?"wss:":"ws:",r.toString()}}}const n=new URL("/ws",window.location.origin);return n.protocol=n.protocol==="https:"?"wss:":"ws:",n.toString()}const nn=[an,ln,dn];function Nn(t){let n=0;for(let r=0;r<t.length;r+=1)n=n*31+t.charCodeAt(r)|0;return Math.abs(n)}function Ne(t){return nn[Nn(t)%nn.length]}function Kt(t){if(t.startsWith("user:")){const n=t.slice(5).trim();return n.length>0?n:null}if(t.startsWith("session:")){const n=t.slice(8).trim();return n.length>0?`guest:${n}`:null}return null}function tt(t){if(t.startsWith("guest:")){const n=t.slice(6).trim();return n?`session:${n}`:`user:${t}`}return`user:${t}`}function Oe(t){const n=t.trim();if(!n)return n;if(n.startsWith("user:guest:")){const r=n.slice(11).trim();return r?`session:${r}`:n}if(n.startsWith("guest:")){const r=n.slice(6).trim();return r?`session:${r}`:n}return n}function En(t){return t.trim()===Dt}function gn(t){return En(t)?"ðŸ”¥ I'm into you":t}function Nt(t,n){const r=_=>_*Math.PI/180,a=r(n.lat-t.lat),f=r(n.lng-t.lng),k=Math.sin(a/2),T=Math.sin(f/2),N=k*k+Math.cos(r(t.lat))*Math.cos(r(n.lat))*T*T;return 6371e3*(2*Math.atan2(Math.sqrt(N),Math.sqrt(1-N)))}function Un(t){return!Number.isFinite(t)||t<0?"-":t<1e3?`${Math.round(t)} m`:t<1e4?`${(t/1e3).toFixed(1)} km`:`${Math.round(t/1e3)} km`}function sn(){try{const t=localStorage.getItem("reddoor_travel_center");if(!t)return null;const n=JSON.parse(t);return n.enabled!==!0?null:typeof n.lat=="number"&&Number.isFinite(n.lat)&&typeof n.lng=="number"&&Number.isFinite(n.lng)?{lat:n.lat,lng:n.lng}:null}catch{return null}}function zn(){const[t,n]=i.useState(()=>window.matchMedia("(max-width: 900px)").matches);return i.useEffect(()=>{const r=window.matchMedia("(max-width: 900px)"),g=()=>n(r.matches);return g(),r.addEventListener("change",g),()=>r.removeEventListener("change",g)},[]),t}function jt(t){return t==="instant"?"cruise":"date"}function Fn({api:t,session:n,settings:r,discoverFilter:g,busy:a,setBusy:f,setLastError:k,isMobile:T,discoverScreen:N,onDiscoverScreenChange:z,onOpenThreadRequested:_,onUnreadCountChange:G}){var Qe,it,pt,de,Be,ot;const[E,A]=i.useState(N),[c,M]=i.useState(null),[P,p]=i.useState(null),[h,F]=i.useState(null),[$,K]=i.useState([]),[ue,ye]=i.useState({}),[je,he]=i.useState([]),[be,Me]=i.useState(new Set),[ve,me]=i.useState(new Set),[y,x]=i.useState({}),[v,W]=i.useState({}),[j,ge]=i.useState(null),[oe,Ie]=i.useState(0),[Se,Ue]=i.useState([]),[S,l]=i.useState(null),[C,O]=i.useState(()=>sn()),{state:te,lastErrorMessage:le}=un({wsUrl:At(),sessionToken:n.sessionToken}),xe=i.useMemo(()=>Array.from(te.byKey.values()),[te.byKey]);i.useEffect(()=>{A(N)},[N]),i.useEffect(()=>{const u=()=>{O(sn())},m=w=>{(w.key===null||w.key==="reddoor_travel_center")&&u()};return u(),window.addEventListener("rd:location-updated",u),window.addEventListener("storage",m),()=>{window.removeEventListener("rd:location-updated",u),window.removeEventListener("storage",m)}},[]);const ne=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,Te=i.useMemo(()=>{const u=new Map;for(const m of $)u.set(m.key,m);for(const m of xe){const w=u.get(m.key);(!w||m.updatedAtMs>=w.updatedAtMs)&&u.set(m.key,m)}return Array.from(u.values())},[xe,$]),ke=i.useMemo(()=>Te.filter(u=>u.key!==ne),[ne,Te]),Pe=i.useMemo(()=>h?[...ke].sort((u,m)=>Nt(h,{lat:u.lat,lng:u.lng})-Nt(h,{lat:m.lat,lng:m.lng})):ke,[ke,h]),_e=i.useMemo(()=>{if(!P)return null;if(P===ne)return"0 m";if(!h)return null;const u=Te.find(m=>m.key===P);return u?Un(Nt(h,{lat:u.lat,lng:u.lng})):null},[ne,Te,P,h]);i.useEffect(()=>{let u=!1;async function m(){try{const V=await t.listActivePresence(n.sessionToken);if(u)return;const Z=Array.isArray(V.presence)?V.presence:[];K(Z)}catch{u||K([])}}m();const w=window.setInterval(()=>{m()},8e3);return()=>{u=!0,window.clearInterval(w)}},[t,n.sessionToken]),i.useEffect(()=>{c||Pe.length>0&&M(Pe[0].key)},[c,Pe]),i.useEffect(()=>{const u=Pe.filter(m=>!ue[m.key]).map(m=>({key:m.key,profileId:Kt(m.key)})).filter(m=>typeof m.profileId=="string");u.length!==0&&Promise.all(u.map(async m=>{var w,V;try{const Z=await t.getPublicProfile(m.profileId);return{key:m.key,displayName:(w=Z.profile)==null?void 0:w.displayName,age:(V=Z.profile)==null?void 0:V.age}}catch{return null}})).then(m=>{ye(w=>{const V={...w};for(const Z of m)Z&&(V[Z.key]={displayName:Z.displayName,age:Z.age});return V})})},[t,ue,Pe]),i.useEffect(()=>{(async()=>{try{const u=await t.getPublicProfiles();he(u.profiles)}catch{he([])}if(n.userType==="guest"){Me(new Set),me(new Set);return}try{const u=await t.getFavorites(n.sessionToken);Me(new Set(u.favorites))}catch{Me(new Set)}try{const u=await t.listBlocked(n.sessionToken);me(new Set(u.blocked))}catch{me(new Set)}})()},[t,n.sessionToken,n.userType]),i.useEffect(()=>{let u=!1;async function m(){try{const V=await t.listCruisingSpots();u||Ue(V.spots)}catch{u||Ue([])}}m();const w=window.setInterval(()=>{m()},12e3);return()=>{u=!0,window.clearInterval(w)}},[t]),i.useEffect(()=>{const u=Date.now(),m=je.flatMap(w=>{const V=[];return w.mainPhotoMediaId&&V.push(w.mainPhotoMediaId),Array.isArray(w.galleryMediaIds)&&V.push(...w.galleryMediaIds),w.videoMediaId&&V.push(w.videoMediaId),V}).filter(w=>typeof w=="string"&&w.length>0&&!y[w]&&u>=(v[w]??0)).slice(0,6);m.length!==0&&Promise.all(m.map(async w=>{try{const V=await t.getPublicMediaUrl(w);return{mediaId:w,url:V.downloadUrl}}catch{return null}})).then(w=>{x(V=>{const Z={...V};for(const se of w)se&&(Z[se.mediaId]=se.url);return Z}),W(V=>{const Z={...V};for(let se=0;se<m.length;se+=1){const fe=m[se];w[se]?Z[fe]&&delete Z[fe]:Z[fe]=Date.now()+3e4}return Z})})},[t,v,y,je]);async function Ge(u){p(u),Ie(0);const m=Kt(u);if(!m){ge(null);return}try{if(u===ne){const w=await t.getMyProfile(n.sessionToken);typeof w.profile.mainPhotoMediaId=="string"&&w.profile.mainPhotoMediaId;const V=[w.profile.mainPhotoMediaId,...w.profile.galleryMediaIds??[],w.profile.videoMediaId].filter(Z=>typeof Z=="string"&&Z.length>0);if(V.length>0){const Z=await Promise.all(V.map(async se=>{try{const fe=await t.getPublicMediaUrl(se);return{mediaId:se,downloadUrl:fe.downloadUrl}}catch{return null}}));x(se=>{const fe={...se};for(const Ce of Z)Ce&&(fe[Ce.mediaId]=Ce.downloadUrl);return fe})}ge({userId:w.profile.userId,displayName:w.profile.displayName,age:w.profile.age,bio:w.profile.bio,stats:w.profile.stats,discreetMode:w.profile.discreetMode,mainPhotoMediaId:w.profile.mainPhotoMediaId,galleryMediaIds:w.profile.galleryMediaIds,videoMediaId:w.profile.videoMediaId})}else{const w=await t.getPublicProfile(m),V=[w.profile.mainPhotoMediaId,...w.profile.galleryMediaIds??[],w.profile.videoMediaId].filter(Z=>typeof Z=="string"&&Z.length>0);if(V.length>0){const Z=await Promise.all(V.map(async se=>{try{const fe=await t.getPublicMediaUrl(se);return{mediaId:se,downloadUrl:fe.downloadUrl}}catch{return null}}));x(se=>{const fe={...se};for(const Ce of Z)Ce&&(fe[Ce.mediaId]=Ce.downloadUrl);return fe})}ge(w.profile)}}catch(w){const V=w;if((V==null?void 0:V.code)==="PROFILE_HIDDEN"){p(null),ge(null);return}ge(null),k(q(w))}}async function ie(u){if(n.userType==="guest"){k("Guests cannot star users. Register to save favorites.");return}if(!(!n.userId||n.userId===u))try{const m=await t.toggleFavorite(n.sessionToken,u);Me(new Set(m.favorites))}catch(m){k(q(m))}}async function Re(u){const m=Oe(u);if(!(!m||m===ne))try{await t.sendChat(n.sessionToken,"cruise",m,Dt)}catch(w){k(q(w))}}async function we(u){if(!(!u.trim()||u===ne)){if(n.userType==="guest"){k("Anonymous users cannot block users.");return}try{ve.has(u)?await t.unblock(n.sessionToken,u):await t.block(n.sessionToken,u);const m=await t.listBlocked(n.sessionToken);me(new Set(m.blocked))}catch(m){k(q(m))}}}async function Ve(){const u=C??{lat:r.defaultCenterLat,lng:r.defaultCenterLng};if(!navigator.geolocation){F(u);try{await t.updatePresence(n.sessionToken,u.lat,u.lng,"online")}catch{}return}try{const m=await new Promise((w,V)=>{navigator.geolocation.getCurrentPosition(w,V,{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e4})});F({lat:m.coords.latitude,lng:m.coords.longitude}),await t.updatePresence(n.sessionToken,m.coords.latitude,m.coords.longitude,"online")}catch(m){F(u);try{await t.updatePresence(n.sessionToken,u.lat,u.lng,"online")}catch{const w=m&&typeof m=="object"&&"message"in m&&typeof m.message=="string"?m.message:null;k(w??q(m))}}}i.useEffect(()=>{Ve();const u=window.setInterval(()=>{Ve()},3e4);return()=>window.clearInterval(u)},[n.sessionToken]),i.useEffect(()=>{const u=m=>{var se,fe;const w=m,V=(se=w.detail)==null?void 0:se.lat,Z=(fe=w.detail)==null?void 0:fe.lng;!Number.isFinite(V)||!Number.isFinite(Z)||(F({lat:V,lng:Z}),t.updatePresence(n.sessionToken,V,Z,"online").catch(()=>{}))};return window.addEventListener("rd:location-updated",u),()=>window.removeEventListener("rd:location-updated",u)},[t,n.sessionToken]);const Ke=i.useMemo(()=>{if(Te.some(V=>V.key===ne))return Te;const m=h??C??{lat:r.defaultCenterLat,lng:r.defaultCenterLng};return[{key:ne,userType:n.userType,lat:m.lat,lng:m.lng,status:"online",updatedAtMs:Date.now()},...Te]},[ne,Te,h,n.userType,r.defaultCenterLat,r.defaultCenterLng,C]),qe=i.useMemo(()=>{const u={};for(const m of je){if(!m.mainPhotoMediaId)continue;const w=y[m.mainPhotoMediaId];w&&(u[tt(m.userId)]=w)}return u},[y,je]),Ae=i.useMemo(()=>Se.map(u=>({id:`spot:${u.spotId}`,position:{lat:u.lat,lng:u.lng},color:"#26d5ff",markerType:"spot",markerGlyph:"CS",label:`${u.name} | check-ins: ${u.checkInCount??0} | action: ${u.actionCount??0}`,onClick:()=>l(u.spotId)})),[Se]),Je=u=>{A(u),z(u)},nt=e.jsx(Xt,{wsUrl:At(),sessionToken:n.sessionToken,presenceUpdates:Ke,realtimeErrorMessage:le,onMarkerSelect:u=>void Ge(u),avatarByKey:qe,additionalMarkers:Ae,defaultCenter:C??{lat:r.defaultCenterLat,lng:r.defaultCenterLng},height:T?"calc(100vh - 340px)":"calc(100dvh - 62px)",visible:!0}),He=e.jsxs("div",{style:{background:"#000",marginInline:-10},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,padding:"8px 10px",borderBottom:"1px solid rgba(255,58,77,0.25)"},children:[e.jsx("button",{type:"button",style:B(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"reset"}}))},children:"GUYS"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"toggle_favorites"}}))},"aria-label":"Toggle favorites only",children:"â˜…"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"open_filters"}})),Je("chat")},children:"FILTER"})]}),e.jsx(Xt,{wsUrl:At(),sessionToken:n.sessionToken,presenceUpdates:Ke,realtimeErrorMessage:le,onMarkerSelect:u=>void Ge(u),avatarByKey:qe,additionalMarkers:Ae,defaultCenter:C??{lat:r.defaultCenterLat,lng:r.defaultCenterLng},height:"calc(100dvh - 220px)",visible:E==="map"})]}),rt=e.jsx(Ln,{api:t,session:n,busy:a,setBusy:f,setLastError:k,onlinePeers:Pe,selectedPeerKey:c,setSelectedPeerKey:M,onOpenProfile:u=>void Ge(u),isMobile:T,selfCoords:h,peerProfileByKey:ue,discoverFilter:g,publicProfiles:je,favorites:be,mediaUrlById:y,onUnreadCountChange:G});return e.jsxs("div",{style:!T&&E==="map"?{height:"100%"}:{display:"grid",gap:8},children:[T?e.jsx(e.Fragment,{children:E==="map"?He:rt}):e.jsx("div",{style:E==="map"?{display:"grid",height:"100%",alignItems:"stretch"}:{display:"grid",gap:12,alignItems:"start"},children:E==="map"?nt:rt}),P?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:80,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:T?"stretch":"center",padding:T?0:14},role:"dialog","aria-modal":"true","aria-label":"User profile",onClick:()=>p(null),children:e.jsx("div",{onClick:u=>u.stopPropagation(),style:T?{width:"100%",height:"100dvh",overflow:"auto",background:"linear-gradient(180deg, rgba(7,8,10,0.98), rgba(2,2,4,0.98))",borderRadius:0,border:"none",padding:"calc(env(safe-area-inset-top, 0px) + 56px) 12px calc(env(safe-area-inset-bottom, 0px) + 20px)"}:{...De(),width:"min(680px, 100%)",maxHeight:"86vh",overflow:"auto"},children:e.jsxs("div",{style:{display:"grid",gap:14},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"106px 1fr auto",gap:12,alignItems:"center"},children:[e.jsxs("div",{style:{position:"relative",width:106,height:106},children:[e.jsx("img",{src:j!=null&&j.mainPhotoMediaId&&y[j.mainPhotoMediaId]?y[j.mainPhotoMediaId]:Ne(P),alt:"Profile avatar",style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"cover",border:"2px solid #ff3047"}}),e.jsx("span",{style:{position:"absolute",right:4,bottom:4,width:14,height:14,borderRadius:"50%",background:"#26d5ff",border:"2px solid #000"}})]}),e.jsxs("div",{style:{display:"grid",gap:6},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:(j==null?void 0:j.displayName)??P}),e.jsx("div",{style:{color:"#26d5ff",fontSize:14},children:"Instant Messaging Available"})]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[j&&j.userId!==(n.userId??"")?e.jsx("button",{type:"button",style:{...B(!1),color:"#26d5ff",borderColor:"rgba(38,213,255,0.62)",minWidth:126},onClick:()=>void ie(j.userId),children:be.has(j.userId)?"â˜… STARRED":"â˜† STAR"}):null,j&&j.userId!==(n.userId??"")?e.jsx("button",{type:"button",style:{...B(!1),color:"#ffb347",borderColor:"rgba(255,179,71,0.65)",minWidth:126},onClick:()=>void Re(tt(j.userId)),children:"ðŸ”¥ FIRE"}):null,j&&j.userId!==(n.userId??"")?e.jsx("button",{type:"button",style:{...B(!1),color:ve.has(tt(j.userId))?"#ff9aa3":"#ffd4d8",borderColor:"rgba(255,120,130,0.62)",minWidth:126},onClick:()=>void we(tt(j.userId)),children:ve.has(tt(j.userId))?"UNBLOCK":"BLOCK"}):null,e.jsx("button",{type:"button",style:B(!1),onClick:()=>p(null),children:"CLOSE"})]})]}),e.jsxs("div",{style:{color:"#ced3dc",fontSize:14,lineHeight:1.5},children:[e.jsxs("div",{children:["Age: ",(j==null?void 0:j.age)??"-"]}),e.jsxs("div",{children:["Distance: ",_e??"-"]}),e.jsxs("div",{children:["Race: ",((Qe=j==null?void 0:j.stats)==null?void 0:Qe.race)??"-"]}),e.jsxs("div",{children:["Height: ",((it=j==null?void 0:j.stats)==null?void 0:it.heightInches)??"-"]}),e.jsxs("div",{children:["Weight: ",((pt=j==null?void 0:j.stats)==null?void 0:pt.weightLbs)??"-"]}),e.jsxs("div",{children:["Cock Size: ",((de=j==null?void 0:j.stats)==null?void 0:de.cockSizeInches)??"-"]}),e.jsxs("div",{children:["Cut / Uncut: ",((Be=j==null?void 0:j.stats)==null?void 0:Be.cutStatus)??"-"]}),e.jsxs("div",{children:["Position: ",((ot=j==null?void 0:j.stats)==null?void 0:ot.position)??"-"]}),e.jsxs("div",{style:{marginTop:8},children:["Bio: ",(j==null?void 0:j.bio)??"-"]})]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"MEDIA"}),j?e.jsx(e.Fragment,{children:(()=>{const u=[j.mainPhotoMediaId,...j.galleryMediaIds??[],j.videoMediaId].filter(se=>typeof se=="string"&&se.length>0);if(u.length===0)return e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No uploaded media."});const m=Math.max(0,Math.min(oe,u.length-1)),w=u[m],V=y[w],Z=w===j.videoMediaId;return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.4)",borderRadius:12,padding:8},children:Z?e.jsx("video",{controls:!0,playsInline:!0,src:V,style:{width:"100%",maxHeight:260,borderRadius:10,background:"#000"}}):e.jsx("img",{src:V??Ne(P??j.userId),alt:"Profile media",style:{width:"100%",maxHeight:260,objectFit:"cover",borderRadius:10}})}),e.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:u.map((se,fe)=>{const Ce=y[se],Ze=se===j.videoMediaId;return e.jsx("button",{type:"button",onClick:()=>Ie(fe),style:{width:64,height:64,padding:0,borderRadius:8,overflow:"hidden",border:fe===m?"2px solid #26d5ff":"1px solid rgba(255,58,77,0.4)",background:"#000",cursor:"pointer",color:"#fff",fontSize:10},"aria-label":Ze?"Open video":"Open photo",children:Ze?e.jsx("div",{style:{display:"grid",placeItems:"center",width:"100%",height:"100%"},children:Ce?e.jsx("video",{src:Ce,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}):"VIDEO"}):e.jsx("img",{src:Ce??Ne(P??j.userId),alt:"Media thumbnail",style:{width:"100%",height:"100%",objectFit:"cover"}})},se)})})]})})()}):null]}),e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:e.jsx("button",{type:"button",style:Ee(!1),onClick:()=>{P&&_(P),p(null),Ie(0)},children:"CHAT"})})]})})}):null,S?e.jsx(On,{api:t,session:n,spot:Se.find(u=>u.spotId===S)??null,onClose:()=>l(null),onUpdated:async()=>{try{const u=await t.listCruisingSpots();Ue(u.spots)}catch{}},setLastError:k}):null]})}function On({api:t,session:n,spot:r,onClose:g,onUpdated:a,setLastError:f}){return r?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},role:"dialog","aria-modal":"true","aria-label":"Cruising spot",onClick:g,children:e.jsxs("div",{onClick:k=>k.stopPropagation(),style:{...De(),width:"min(520px, 100%)",display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:r.name}),e.jsx("div",{style:{color:"#9fb6bf",fontSize:13},children:r.address}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap"},children:r.description}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:13},children:["Check-ins: ",r.checkInCount??0," | I got action there: ",r.actionCount??0]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:Ee(!1),onClick:async()=>{try{await t.checkInCruisingSpot(n.sessionToken,r.spotId),await a()}catch(k){f(q(k))}},children:"CHECK IN"}),e.jsx("button",{type:"button",style:B(!1),onClick:async()=>{try{await t.markCruisingSpotAction(n.sessionToken,r.spotId),await a()}catch(k){f(q(k))}},children:"I GOT ACTION THERE"}),e.jsx("button",{type:"button",style:B(!1),onClick:g,children:"CLOSE"})]})]})}):null}function Ln({api:t,session:n,busy:r,setBusy:g,setLastError:a,onlinePeers:f,selectedPeerKey:k,setSelectedPeerKey:T,onOpenProfile:N,openThreadRequest:z,onThreadRequestConsumed:_,isMobile:G,selfCoords:E,peerProfileByKey:A,discoverFilter:c,publicProfiles:M,favorites:P,mediaUrlById:p,onUnreadCountChange:h}){var _t;const[F,$]=i.useState({}),[K,ue]=i.useState({}),[ye,je]=i.useState("instant"),[he,be]=i.useState("grid"),[Me,ve]=i.useState(null),[me,y]=i.useState(""),[x,v]=i.useState(null),[W,j]=i.useState([]),[ge,oe]=i.useState({}),[Ie,Se]=i.useState(null),[Ue,S]=i.useState({}),[l,C]=i.useState({}),[O,te]=i.useState(!1),[le,xe]=i.useState(""),[ne,Te]=i.useState(null),ke=i.useRef(!1),Pe=i.useRef(!1),_e=i.useRef(0),Ge=i.useRef(null),ie=i.useRef(null),Re=i.useRef(null),we=i.useRef(null),Ve=i.useRef(null),Ke=i.useRef(0),qe=i.useRef(new Set),Ae=i.useRef(null),Je=i.useRef(null),nt=i.useRef(null),[He,rt]=i.useState(null),[Qe,it]=i.useState(c==="favorites"),[pt,de]=i.useState(!1),[Be,ot]=i.useState(c==="online"?"online":"all"),[u,m]=i.useState(!1),[w,V]=i.useState(""),[Z,se]=i.useState(""),[fe,Ce]=i.useState(""),[Ze,wt]=i.useState(""),[et,It]=i.useState(""),[at,kt]=i.useState(""),[lt,xt]=i.useState(""),[yt,Ct]=i.useState(""),[dt,Tt]=i.useState(""),[ct,o]=i.useState(""),[b,H]=i.useState(""),re=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,L=Me??k??"",ae=L?F[L]??[]:[],ze=i.useMemo(()=>new Map(f.map(s=>[s.key,s])),[f]),We=i.useMemo(()=>{const s={};for(const d of M)typeof d.displayName=="string"&&d.displayName.trim()&&(s[tt(d.userId)]=d.displayName);for(const[d,I]of Object.entries(A))typeof I.displayName=="string"&&I.displayName.trim()&&(s[d]=I.displayName);return s},[A,M]),ut=i.useMemo(()=>M.filter(s=>s.userId!==(n.userId??"")).map(s=>{const d=tt(s.userId),I=ze.get(d);return{key:d,userId:s.userId,displayName:s.displayName,age:s.age,stats:s.stats,meters:I&&E?Math.round(Nt(E,{lat:I.lat,lng:I.lng})):null,isOnline:!!I,hasPicture:typeof s.mainPhotoMediaId=="string"&&s.mainPhotoMediaId.trim().length>0,avatarUrl:s.mainPhotoMediaId?p[s.mainPhotoMediaId]:void 0}}),[p,ze,M,E,n.userId]),Ye=i.useMemo(()=>{const s=w.trim()?Number(w):void 0,d=Z.trim()?Number(Z):void 0,I=Ze.trim()?Number(Ze):void 0,U=et.trim()?Number(et):void 0,D=at.trim()?Number(at):void 0,Y=lt.trim()?Number(lt):void 0,ee=yt.trim()?Number(yt):void 0,J=dt.trim()?Number(dt):void 0;return[...ut.filter(R=>{var Le,Xe,ft,st,Gt,Vt,qt,Jt,Yt;if(Qe&&!P.has(R.userId)||Be==="online"&&!R.isOnline||Be==="offline"&&R.isOnline||u&&!R.hasPicture||Number.isFinite(s)&&(typeof R.age!="number"||R.age<s)||Number.isFinite(d)&&(typeof R.age!="number"||R.age>d))return!1;const ce=typeof((Le=R.stats)==null?void 0:Le.race)=="string"?R.stats.race:"";return!(fe.trim()&&ce.toLowerCase()!==fe.trim().toLowerCase()||Number.isFinite(I)&&(typeof((Xe=R.stats)==null?void 0:Xe.heightInches)!="number"||R.stats.heightInches<I)||Number.isFinite(U)&&(typeof((ft=R.stats)==null?void 0:ft.heightInches)!="number"||R.stats.heightInches>U)||Number.isFinite(D)&&(typeof((st=R.stats)==null?void 0:st.weightLbs)!="number"||R.stats.weightLbs<D)||Number.isFinite(Y)&&(typeof((Gt=R.stats)==null?void 0:Gt.weightLbs)!="number"||R.stats.weightLbs>Y)||Number.isFinite(ee)&&(typeof((Vt=R.stats)==null?void 0:Vt.cockSizeInches)!="number"||R.stats.cockSizeInches<ee)||Number.isFinite(J)&&(typeof((qt=R.stats)==null?void 0:qt.cockSizeInches)!="number"||R.stats.cockSizeInches>J)||ct&&((Jt=R.stats)==null?void 0:Jt.cutStatus)!==ct||b&&((Yt=R.stats)==null?void 0:Yt.position)!==b)})].sort((R,ce)=>{const Le=typeof R.meters=="number"&&Number.isFinite(R.meters)?R.meters:Number.POSITIVE_INFINITY,Xe=typeof ce.meters=="number"&&Number.isFinite(ce.meters)?ce.meters:Number.POSITIVE_INFINITY;if(Le!==Xe)return Le-Xe;const ft=R.displayName.localeCompare(ce.displayName);return ft!==0?ft:R.key.localeCompare(ce.key)})},[ut,P,Qe,ct,Z,dt,et,lt,w,yt,Ze,at,b,fe,u,Be]),ht=i.useMemo(()=>Array.from(new Set(Ye.map(s=>s.key).filter(s=>s.trim().length>0))).slice(0,8),[Ye]),mt=ht.join("|"),Fe=i.useMemo(()=>{const s=new Set(Object.keys(K));return L.trim()&&s.add(L),Array.from(s).sort((d,I)=>{var U,D;return(((U=K[I])==null?void 0:U.lastAt)??0)-(((D=K[d])==null?void 0:D.lastAt)??0)})},[K,L]),bt=i.useMemo(()=>Object.values(Ue).reduce((s,d)=>s+(Number.isFinite(d)?d:0),0),[Ue]);i.useMemo(()=>{var s;return L?We[L]??((s=A[L])==null?void 0:s.displayName)??L:""},[We,L,A]);const Q=i.useMemo(()=>{if(!L)return;const s=Ye.find(d=>d.key===L);return s==null?void 0:s.avatarUrl},[Ye,L]),$e=i.useMemo(()=>Fe.filter(s=>s!==L&&s!==re&&!!K[s]).map(s=>{var d;return{key:s,label:We[s]??((d=A[s])==null?void 0:d.displayName)??s}}),[Fe,K,We,re,L,A]);i.useEffect(()=>{typeof h=="function"&&h(bt)},[h,bt]),i.useEffect(()=>{const s=Ge.current;s&&(s.srcObject=ne)},[ne]),i.useEffect(()=>{const s=ie.current;s&&(s.srcObject=He)},[He]),i.useEffect(()=>()=>{if(ne){for(const s of ne.getTracks())s.stop();if(He)for(const s of He.getTracks())s.stop();Ae.current&&(Ae.current.close(),Ae.current=null)}},[ne,He]),i.useEffect(()=>{if($e.length===0){y("");return}y(s=>s&&$e.some(d=>d.key===s)?s:$e[0].key)},[$e]);const Et=i.useMemo(()=>({async sendMessage(s,d,I,U){const D=Oe(d),Y=await t.sendChat(n.sessionToken,s,D,I,U),ee=Y==null?void 0:Y.message,J=[ee];if(s==="cruise"&&x)try{const pe=await t.sendChat(n.sessionToken,s,Oe(x),I,U),R=pe==null?void 0:pe.message;J.push(R)}catch(pe){a(q(pe))}for(const pe of J)vt(pe);return ee},async initiateMediaUpload(s,d){const I=await t.initiateChatMediaUpload(n.sessionToken,{mimeType:s,sizeBytes:d});return{objectKey:I.objectKey,uploadUrl:I.uploadUrl}},async uploadToSignedUrl(s,d,I){if(await St(s,d,I))return;if(!(await fetch(s,{method:"PUT",headers:{"content-type":I},body:d})).ok)throw{code:"MEDIA_UPLOAD_INCOMPLETE",message:"Upload failed."}},async getMediaUrl(s){return(await t.getChatMediaUrl(n.sessionToken,s)).downloadUrl}}),[t,re,n.sessionToken,a,x]);function gt(s){var d,I,U;return s.text&&s.text.trim()?gn(s.text):((d=s.media)==null?void 0:d.kind)==="image"?"[Photo]":((I=s.media)==null?void 0:I.kind)==="video"?"[Video]":((U=s.media)==null?void 0:U.kind)==="audio"?"[Voice]":""}function Mt(s){if(!s||qe.current.has(s))return!1;if(qe.current.add(s),qe.current.size>5e3){const d=Array.from(qe.current).slice(-2500);qe.current=new Set(d)}return!0}function Ut(s,d){var D;const I=We[d]??((D=A[d])==null?void 0:D.displayName)??d,U=gt(s)||"New activity";if("Notification"in window){if(Notification.permission==="granted"){try{new Notification(`${I}`,{body:U})}catch{}return}Notification.permission==="default"&&Notification.requestPermission()}}function Pt(s){if(!s.startsWith("GROUP_INVITE_REQUEST|"))return null;const[,d,I,U]=s.split("|");return!d||!I||!U?null:{inviteId:d,inviterKey:I,primaryPeerKey:U}}function Rt(s){if(!s.startsWith("GROUP_INVITE_ACCEPT|"))return null;const[,d,I]=s.split("|");return!d||!I?null:{inviteId:d,candidateKey:I}}function vt(s){if(!Mt(s.messageId))return;const d=s.fromKey===re?s.toKey:s.fromKey;$(D=>{const Y=D[d]??[];return Y.some(ee=>ee.messageId===s.messageId)?D:{...D,[d]:[...Y,s].sort((ee,J)=>ee.createdAtMs-J.createdAtMs)}}),ue(D=>({...D,[d]:{lastAt:s.createdAtMs,lastText:gt(s)}})),s.fromKey!==re&&(he==="thread"&&Oe(L)===Oe(d)?(C(Y=>({...Y,[d]:Math.max(Y[d]??0,s.createdAtMs)})),S(Y=>{const ee={...Y};return delete ee[d],ee})):S(Y=>({...Y,[d]:(Y[d]??0)+1})),Ut(s,d));const I=Pt(s.text??"");I&&s.toKey===re&&j(D=>D.some(Y=>Y.inviteId===I.inviteId)?D:[...D,{...I,createdAtMs:s.createdAtMs}]);const U=Rt(s.text??"");U&&s.toKey===re&&ge[U.inviteId]&&(v(Oe(U.candidateKey)),Se(`Invite accepted by ${We[U.candidateKey]??U.candidateKey}.`),oe(Y=>{const ee={...Y};return delete ee[U.inviteId],ee}))}async function zt(s){const d=Oe(s);if(d)try{const I=await t.listChat(n.sessionToken,jt(ye),d),U=I==null?void 0:I.messages,D=Array.isArray(U)?U:[];t.markChatRead(n.sessionToken,jt(ye),d).catch(()=>{}),$(J=>({...J,[d]:D}));const Y=D.length>0?D[D.length-1]:null;Y&&ue(J=>({...J,[d]:{lastAt:Y.createdAtMs,lastText:gt(Y)}}));let ee=0;for(const J of D)J.fromKey===d&&J.createdAtMs>ee&&(ee=J.createdAtMs);ee>0&&C(J=>({...J,[d]:Math.max(J[d]??0,ee)}))}catch(I){a(q(I))}}i.useEffect(()=>{if(he!=="thread"||!L.trim())return;let s=!1,d=!1,I=null;const U=async()=>{if(!(s||d)){d=!0;try{await zt(L)}finally{d=!1}s||(I=window.setTimeout(()=>{U()},1200))}};return U(),()=>{s=!0,I!==null&&window.clearTimeout(I)}},[ye,L,he]),i.useEffect(()=>{if(he!=="grid")return;if(ht.length===0){S({});return}let s=!1;async function d(){if(!ke.current&&!document.hidden){ke.current=!0;try{const D=jt(ye),Y=[],ee=[];for(const pe of ht){if(s)break;try{const R=Oe(pe);if(!R)continue;const ce=await t.listChat(n.sessionToken,D,R),Le=(ce==null?void 0:ce.messages)??[];if(Le.length>0){const st=Le[Le.length-1];ee.push([R,{lastAt:st.createdAtMs,lastText:gt(st)}])}let Xe=0;const ft=l[R]??0;for(const st of Le)st.fromKey===R&&st.createdAtMs>ft&&(Xe+=1);Y.push([R,Xe])}catch{const R=Oe(pe);R&&Y.push([R,0])}}if(s)return;ee.length>0&&ue(pe=>{const R={...pe};for(const[ce,Le]of ee)R[ce]=Le;return R});const J={};for(const[pe,R]of Y)R>0&&(J[pe]=R);S(J)}finally{ke.current=!1}}}const I=window.setTimeout(()=>{d()},1200),U=window.setInterval(()=>{d()},15e3);return()=>{s=!0,ke.current=!1,window.clearTimeout(I),window.clearInterval(U)}},[t,ye,l,n.sessionToken,mt,he]),i.useEffect(()=>{const s=Array.from(new Set([...Fe,...ht,L].map(Y=>Oe(Y)).filter(Y=>Y.length>0))).slice(0,10);if(s.length===0)return;let d=!1;const I=async()=>{if(!(d||document.hidden||Pe.current)){Pe.current=!0;try{const Y=jt(ye),ee=[];for(const J of s){if(d)break;try{const pe=await t.listChat(n.sessionToken,Y,J),R=(pe==null?void 0:pe.messages)??[];if(R.length===0)continue;const ce=R[R.length-1];ee.push([J,{lastAt:ce.createdAtMs,lastText:gt(ce)}])}catch{}}if(d||ee.length===0)return;ue(J=>{const pe={...J};for(const[R,ce]of ee)pe[R]=ce;return pe})}finally{Pe.current=!1}}},U=window.setTimeout(()=>{I()},1e3),D=window.setInterval(()=>{I()},5e3);return()=>{d=!0,window.clearTimeout(U),window.clearInterval(D)}},[t,ye,Fe,L,n.sessionToken,mt]);async function pn(){if(ne)return ne;if(!navigator.mediaDevices||typeof navigator.mediaDevices.getUserMedia!="function")throw{code:"UNAUTHORIZED_ACTION",message:"Camera access is not available in this browser."};const s=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});return Te(s),s}function yn(s,d){Ae.current&&(Ae.current.close(),Ae.current=null);const I=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});return Ae.current=I,Je.current=d,nt.current=s,I.ontrack=U=>{const D=U.streams[0];D&&rt(D)},I.onicecandidate=U=>{const D=U.candidate;if(!D)return;const Y=nt.current,ee=Je.current;!Y||!ee||t.sendCallSignal(n.sessionToken,{toKey:Y,callId:ee,signalType:"ice",candidate:JSON.stringify(D.toJSON())}).catch(()=>{})},I}async function Ht(s=!0){const d=nt.current,I=Je.current;if(s&&d&&I)try{await t.sendCallSignal(n.sessionToken,{toKey:d,callId:I,signalType:"hangup"})}catch{}if(ne)for(const U of ne.getTracks())U.stop();if(He)for(const U of He.getTracks())U.stop();Te(null),rt(null),Ae.current&&(Ae.current.close(),Ae.current=null),Je.current=null,nt.current=null,te(!1)}i.useEffect(()=>{let s=!1;const d=At();if(!d)return;const I=()=>{we.current!==null&&(window.clearInterval(we.current),we.current=null),Ve.current!==null&&(window.clearTimeout(Ve.current),Ve.current=null)},U=()=>{if(s)return;const D=new WebSocket(d);Re.current=D,D.onopen=()=>{Ke.current=0,D.send(JSON.stringify({type:"auth",payload:{sessionToken:n.sessionToken}})),we.current=window.setInterval(()=>{D.readyState===D.OPEN&&D.send(JSON.stringify({type:"heartbeat",payload:{}}))},15e3)},D.onmessage=Y=>{let ee=null;try{ee=JSON.parse(String(Y.data))}catch{return}if(!ee||typeof ee.type!="string")return;if(ee.type==="chat_message"){const R=ee.payload,ce=R==null?void 0:R.message;if(!ce||ce.fromKey!==re&&ce.toKey!==re)return;vt(ce);return}if(ee.type!=="call_signal")return;const J=ee.payload;if(!J||J.toKey!==re||typeof J.fromKey!="string"||!J.callId||!J.signalType)return;const pe=Oe(J.fromKey);if(J.signalType==="hangup"){Ht(!1);return}if(J.signalType==="offer"){(async()=>{try{Ft(pe),xe(pe);const R=await pn(),ce=yn(pe,J.callId);for(const Xe of R.getTracks())ce.addTrack(Xe,R);await ce.setRemoteDescription({type:"offer",sdp:J.sdp??""});const Le=await ce.createAnswer();await ce.setLocalDescription(Le),await t.sendCallSignal(n.sessionToken,{toKey:pe,callId:J.callId,signalType:"answer",sdp:Le.sdp??""}),te(!0)}catch(R){a(q(R))}})();return}if(J.signalType==="answer"){(async()=>{try{if(!Ae.current||Je.current!==J.callId)return;await Ae.current.setRemoteDescription({type:"answer",sdp:J.sdp??""})}catch(R){a(q(R))}})();return}J.signalType==="ice"&&(async()=>{try{if(!Ae.current||Je.current!==J.callId||!J.candidate)return;const R=JSON.parse(J.candidate);await Ae.current.addIceCandidate(R)}catch{}})()},D.onclose=()=>{if(I(),s)return;Ke.current+=1;const Y=Math.min(8e3,500*2**Math.min(Ke.current,4));Ve.current=window.setTimeout(U,Y)},D.onerror=()=>{}};return U(),()=>{var D;s=!0,I(),(D=Re.current)==null||D.close(1e3,"chat cleanup"),Re.current=null}},[t,re,n.sessionToken]);async function hn(){if(me.trim()){if(!L.trim()){a("Select a user first.");return}try{const s=Oe(me);if(!s)return;if(!$e.some(I=>I.key===s)){a("You can only add a third user you have previously messaged.");return}const d=crypto.randomUUID();await t.sendChat(n.sessionToken,"cruise",s,`GROUP_INVITE_REQUEST|${d}|${re}|${L.trim()}`),oe(I=>({...I,[d]:{candidateKey:s,primaryPeerKey:L.trim()}})),Se(`Invite sent to ${We[s]??s}. Waiting for acceptance.`)}catch(s){a(q(s))}}}async function Bt(s,d,I){try{await t.sendChat(n.sessionToken,"cruise",d,`GROUP_INVITE_ACCEPT|${s}|${re}`),j(U=>U.filter(D=>D.inviteId!==s)),Se("Group invite accepted."),Ft(I)}catch(U){a(q(U))}}function $t(s){j(d=>d.filter(I=>I.inviteId!==s))}function Ft(s){const d=Oe(s);T(d),ve(d),S(I=>{const U={...I};return delete U[d],U}),C(I=>({...I,[d]:Date.now()})),be("thread")}function Ot(){it(!1),ot("all"),m(!1),V(""),se(""),Ce(""),wt(""),It(""),kt(""),xt(""),Ct(""),Tt(""),o(""),H(""),de(!1)}if(i.useEffect(()=>{const s=d=>{var D;const U=(D=d.detail)==null?void 0:D.action;if(U==="reset"){Ot(),be("grid");return}if(U==="toggle_favorites"){it(Y=>!Y),be("grid");return}U==="open_filters"&&(de(!0),be("grid"))};return window.addEventListener("rd:discover-control",s),()=>window.removeEventListener("rd:discover-control",s)},[]),i.useEffect(()=>{z&&z.nonce!==_e.current&&(_e.current=z.nonce,Ft(z.key),typeof _=="function"&&_())},[_,z]),i.useEffect(()=>{const s=d=>{var U;((U=d.detail)==null?void 0:U.tab)==="discover"&&(be("grid"),ve(null),de(!1))};return window.addEventListener("rd:tab-select",s),()=>window.removeEventListener("rd:tab-select",s)},[]),he==="thread"&&L.trim()){const s=We[L]??((_t=A[L])==null?void 0:_t.displayName)??L;return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:G?-10:0},children:[W.length>0?e.jsxs("div",{style:{...De(),display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"INVITE REQUESTS"}),W.map(d=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,alignItems:"center"},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:13},children:[We[d.inviterKey]??d.inviterKey," invited you to join a conversation."]}),e.jsx("button",{type:"button",style:Ee(!1),onClick:()=>void Bt(d.inviteId,d.inviterKey,d.primaryPeerKey),children:"ACCEPT"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>$t(d.inviteId),children:"DECLINE"})]},d.inviteId))]}):null,Ie?e.jsx("div",{style:{color:"#26d5ff",fontSize:12},children:Ie}):null,e.jsx(Wt,{chatKind:jt(ye),peerKey:L,currentUserKey:re,messages:ae,client:Et,title:`INSTANT THREAD: ${s}`,peerSummary:{displayName:s,avatarUrl:Q},thirdParty:{candidates:$e,selectedKey:me,onSelect:d=>y(d),onAdd:()=>void hn(),disabled:r},showHeader:!1,edgeToEdge:G,fillHeight:G}),O?e.jsx("div",{role:"dialog","aria-modal":"true","aria-label":"Video call",style:{position:"fixed",inset:0,zIndex:60,background:"rgba(0,0,0,0.82)",display:"grid",placeItems:"center",padding:16},children:e.jsxs("div",{style:{...De(),width:"min(720px, 100%)",display:"grid",gap:10},children:[e.jsxs("div",{style:{fontSize:18,fontWeight:700},children:["VIDEO CALL: ",le]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("video",{ref:Ge,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"100%",maxHeight:"52vh",borderRadius:12,background:"#000"}}),e.jsx("video",{ref:ie,autoPlay:!0,playsInline:!0,style:{width:"100%",maxHeight:"52vh",borderRadius:12,background:"#000"}})]}),e.jsx("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:e.jsx("button",{type:"button",style:B(!1),onClick:()=>void Ht(),children:"END CALL"})})]})}):null]})}return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:G?-10:0},children:[W.length>0?e.jsxs("div",{style:{...De(),display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"INVITE REQUESTS"}),W.map(s=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,alignItems:"center"},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:13},children:[We[s.inviterKey]??s.inviterKey," invited you to join a conversation."]}),e.jsx("button",{type:"button",style:Ee(!1),onClick:()=>void Bt(s.inviteId,s.inviterKey,s.primaryPeerKey),children:"ACCEPT"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>$t(s.inviteId),children:"DECLINE"})]},s.inviteId))]}):null,Ie?e.jsx("div",{style:{color:"#26d5ff",fontSize:12},children:Ie}):null,e.jsx("div",{style:{padding:10,borderBottom:"1px solid rgba(255,58,77,0.28)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8},children:[e.jsx("button",{type:"button",style:B(!1),onClick:Ot,children:"GUYS"}),e.jsx("button",{type:"button",style:Qe?Ee(!1):B(!1),onClick:()=>it(s=>!s),"aria-label":"Toggle favorites only",children:"â˜…"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>de(!0),children:"FILTER"})]})}),pt?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},role:"dialog","aria-modal":"true","aria-label":"Discover filters",onClick:()=>de(!1),children:e.jsx("div",{onClick:s=>s.stopPropagation(),style:{...De(),width:"min(760px, 100%)",maxHeight:"86vh",overflow:"auto"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"FILTER USERS"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{type:"checkbox",checked:u,onChange:s=>m(s.target.checked)}),"Has pictures"]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Online status"}),e.jsxs("select",{style:X(),value:Be,onChange:s=>ot(s.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"offline",children:"Offline"})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[e.jsx("input",{style:X(),placeholder:"Min age",value:w,onChange:s=>V(s.target.value)}),e.jsx("input",{style:X(),placeholder:"Max age",value:Z,onChange:s=>se(s.target.value)}),e.jsx("input",{style:X(),placeholder:"Race",value:fe,onChange:s=>Ce(s.target.value)}),e.jsxs("select",{style:X(),value:ct,onChange:s=>o(s.target.value),children:[e.jsx("option",{value:"",children:"Cut / Uncut"}),e.jsx("option",{value:"cut",children:"Cut"}),e.jsx("option",{value:"uncut",children:"Uncut"})]}),e.jsx("input",{style:X(),placeholder:"Min height (in)",value:Ze,onChange:s=>wt(s.target.value)}),e.jsx("input",{style:X(),placeholder:"Max height (in)",value:et,onChange:s=>It(s.target.value)}),e.jsx("input",{style:X(),placeholder:"Min weight (lbs)",value:at,onChange:s=>kt(s.target.value)}),e.jsx("input",{style:X(),placeholder:"Max weight (lbs)",value:lt,onChange:s=>xt(s.target.value)}),e.jsx("input",{style:X(),placeholder:"Min cock size (in)",value:yt,onChange:s=>Ct(s.target.value)}),e.jsx("input",{style:X(),placeholder:"Max cock size (in)",value:dt,onChange:s=>Tt(s.target.value)}),e.jsxs("select",{style:X(),value:b,onChange:s=>H(s.target.value),children:[e.jsx("option",{value:"",children:"Position"}),e.jsx("option",{value:"top",children:"Top"}),e.jsx("option",{value:"bottom",children:"Bottom"}),e.jsx("option",{value:"side",children:"Side"})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:B(!1),onClick:Ot,children:"RESET"}),e.jsx("button",{type:"button",style:Ee(!1),onClick:()=>de(!1),children:"DONE"})]})]})})}):null,e.jsx("div",{style:{display:"grid",gap:0},children:e.jsx("div",{style:{display:"grid",gap:0,gridTemplateColumns:"repeat(3, minmax(0, 1fr))"},children:Ye.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:13,padding:12,gridColumn:"1 / -1"},children:"No users match current filters."}):Ye.map(s=>e.jsx("button",{type:"button",onClick:()=>N(s.key),style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:0,display:"grid",gap:0,color:"#fff",cursor:"pointer"},children:e.jsxs("div",{style:{position:"relative",width:"100%",aspectRatio:"1 / 1"},children:[e.jsx("img",{src:s.avatarUrl??Ne(s.key),alt:"User avatar",style:{width:"100%",height:"100%",borderRadius:0,objectFit:"cover",border:"1px solid #0fd9ff"}}),s.isOnline?e.jsx("span",{style:{position:"absolute",top:4,left:4,width:10,height:10,borderRadius:"50%",background:"#26d5ff",border:"2px solid #000"}}):null]})},s.key))})})]})}function Kn({api:t,session:n,setLastError:r,openThreadRequest:g,onThreadRequestConsumed:a,isMobile:f}){var j,ge,oe,Ie,Se,Ue;const[k,T]=i.useState([]),[N,z]=i.useState(null),[_,G]=i.useState([]),[E,A]=i.useState("messages"),[c,M]=i.useState(null),[P,p]=i.useState(!1),[h,F]=i.useState(""),[$,K]=i.useState(null),[ue,ye]=i.useState({}),[je,he]=i.useState(null),be=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,Me="cruise",ve=i.useMemo(()=>k.filter(S=>S.key!==N).map(S=>({key:S.key,label:S.displayName})),[k,N]),me=i.useMemo(()=>k.find(S=>S.key===N)??null,[k,N]);i.useEffect(()=>{if(ve.length===0){F("");return}F(S=>S&&ve.some(l=>l.key===S)?S:ve[0].key)},[ve]),i.useEffect(()=>{let S=!1;async function l(){var O,te,le;try{const[xe,ne]=await Promise.all([t.getPublicProfiles(),t.listChatThreads(n.sessionToken,Me)]),Te={},ke={};for(const ie of xe.profiles)Te[tt(ie.userId)]=ie.displayName,typeof ie.mainPhotoMediaId=="string"&&ie.mainPhotoMediaId.trim()!==""&&(ke[tt(ie.userId)]=ie.mainPhotoMediaId);const Pe=[];for(const ie of ne.threads??[]){const Re=Oe((ie==null?void 0:ie.otherKey)??"");if(!Re||Re===be||Re.startsWith("spot:")||n.userId&&Re.startsWith("session:"))continue;const we=ie==null?void 0:ie.lastMessage;if(!we||typeof we.createdAtMs!="number"||!Number.isFinite(we.createdAtMs))continue;const Ve=typeof we.text=="string"&&we.text.trim().length>0?gn(we.text):((O=we.media)==null?void 0:O.kind)==="image"?"[Photo]":((te=we.media)==null?void 0:te.kind)==="video"?"[Video]":((le=we.media)==null?void 0:le.kind)==="audio"?"[Voice]":"";Pe.push({key:Re,displayName:Te[Re]??Re,preview:Ve,at:we.createdAtMs})}const _e=await Promise.all(Pe.map(async ie=>{const Re=ke[ie.key];if(!Re)return null;try{const we=await t.getPublicMediaUrl(Re);return{key:ie.key,url:we.downloadUrl}}catch{return null}})),Ge={};for(const ie of _e)ie&&(Ge[ie.key]=ie.url);for(const ie of Pe)ie.avatarUrl=Ge[ie.key];if(S)return;Pe.sort((ie,Re)=>Re.at-ie.at),T(Pe)}catch(xe){S||r(q(xe))}}l();const C=window.setInterval(()=>{l()},1e4);return()=>{S=!0,window.clearInterval(C)}},[t,n.sessionToken,n.userId,r]),i.useEffect(()=>{g!=null&&g.key&&(z(Oe(g.key)),A("messages"),typeof a=="function"&&a())},[a,g]),i.useEffect(()=>{const S=l=>{var O;((O=l.detail)==null?void 0:O.tab)==="threads"&&(z(null),A("messages"))};return window.addEventListener("rd:tab-select",S),()=>window.removeEventListener("rd:tab-select",S)},[]),i.useEffect(()=>{if(!N||E!=="profile")return;const S=Kt(N);if(!S){M(null);return}let l=!1;return p(!0),t.getPublicProfile(S).then(C=>{l||M(C.profile)}).catch(C=>{l||(M(null),r(q(C)))}).finally(()=>{l||p(!1)}),()=>{l=!0}},[t,N,r,E]),i.useEffect(()=>{if(!N){G([]);return}let S=!1;const l=async()=>{try{const O=await t.listChat(n.sessionToken,Me,N),te=(O==null?void 0:O.messages)??[];S||(G(Array.isArray(te)?te:[]),t.markChatRead(n.sessionToken,Me,N).catch(()=>{}))}catch(O){S||r(q(O))}};l();const C=window.setInterval(()=>{l()},1200);return()=>{S=!0,window.clearInterval(C)}},[t,N,n.sessionToken,r]);function y(S){if(!S.startsWith("GROUP_INVITE_ACCEPT|"))return null;const[,l,C]=S.split("|");return!l||!C?null:{inviteId:l,candidateKey:C}}const x=i.useMemo(()=>({async sendMessage(S,l,C,O){const te=await t.sendChat(n.sessionToken,S,l,C,O),le=te==null?void 0:te.message,xe=y(le.text??"");if(xe&&le.toKey===be&&ue[xe.inviteId]&&(K(xe.candidateKey),he(`Invite accepted by ${xe.candidateKey}.`),ye(Te=>{const ke={...Te};return delete ke[xe.inviteId],ke})),G(ne=>[...ne,le].sort((Te,ke)=>Te.createdAtMs-ke.createdAtMs)),S==="cruise"&&$)try{const ne=await t.sendChat(n.sessionToken,S,$,C,O),Te=ne==null?void 0:ne.message;G(ke=>[...ke,Te].sort((Pe,_e)=>Pe.createdAtMs-_e.createdAtMs))}catch(ne){r(q(ne))}return le},async initiateMediaUpload(S,l){const C=await t.initiateChatMediaUpload(n.sessionToken,{mimeType:S,sizeBytes:l});return{objectKey:C.objectKey,uploadUrl:C.uploadUrl}},async uploadToSignedUrl(S,l,C){if(await St(S,l,C))return;if(!(await fetch(S,{method:"PUT",headers:{"content-type":C},body:l})).ok)throw{code:"MEDIA_UPLOAD_INCOMPLETE",message:"Upload failed."}},async getMediaUrl(S){return(await t.getChatMediaUrl(n.sessionToken,S)).downloadUrl}}),[t,be,ue,n.sessionToken,r,$]);async function v(){var S;if(!(!N||!h)){if(!k.some(l=>l.key===h)){r("You can only add a third user you have previously messaged.");return}try{const l=crypto.randomUUID();await t.sendChat(n.sessionToken,"cruise",h,`GROUP_INVITE_REQUEST|${l}|${be}|${N}`),ye(C=>({...C,[l]:{candidateKey:h}})),he(`Invite sent to ${((S=k.find(C=>C.key===h))==null?void 0:S.displayName)??h}.`)}catch(l){r(q(l))}}}async function W(){if(N)try{await t.sendChat(n.sessionToken,"cruise",N,Dt),he("Fire sent.")}catch(S){r(q(S))}}if(N){const S=(me==null?void 0:me.displayName)??N;return e.jsxs("div",{style:{display:"grid",gap:0,minHeight:f?"calc(100dvh - 150px)":void 0,marginInline:f?-10:0,marginBlock:0},children:[e.jsx("div",{style:{position:"sticky",top:0,zIndex:46,background:"rgba(8,8,12,0.96)",borderBottom:"1px solid rgba(255,58,77,0.35)",padding:"6px 10px",display:"flex",justifyContent:"flex-end"},children:e.jsx("button",{type:"button",onClick:()=>A(l=>l==="messages"?"profile":"messages"),style:{background:"transparent",border:0,color:"#26d5ff",fontSize:13,fontWeight:700,letterSpacing:"0.03em",textTransform:"uppercase",padding:0,cursor:"pointer"},children:E==="messages"?"View Profile":"Back to Thread"})}),E==="messages"?e.jsx(Wt,{chatKind:"cruise",peerKey:N,currentUserKey:be,messages:_,client:x,title:`INSTANT THREAD: ${S}`,peerSummary:{displayName:S},thirdParty:{candidates:ve,selectedKey:h,onSelect:l=>F(l),onAdd:()=>void v(),disabled:!1},showHeader:!1,edgeToEdge:!0,fillHeight:f}):e.jsxs("div",{style:{padding:12,display:"grid",gap:12},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"88px 1fr",gap:12,alignItems:"center"},children:[e.jsx("img",{src:(me==null?void 0:me.avatarUrl)??Ne(N),alt:"Profile avatar",style:{width:88,height:88,borderRadius:"50%",objectFit:"cover",border:"2px solid #ff3047"}}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:24,fontWeight:700},children:(c==null?void 0:c.displayName)??S}),e.jsx("div",{style:{color:"#26d5ff",fontSize:14},children:"Instant Messaging Available"})]})]}),P?e.jsx("div",{style:{color:"#9fb6bf",fontSize:14},children:"Loading profile..."}):null,P?null:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:14,lineHeight:1.5},children:[e.jsxs("div",{children:["Age: ",(c==null?void 0:c.age)??"-"]}),e.jsxs("div",{children:["Race: ",((j=c==null?void 0:c.stats)==null?void 0:j.race)??"-"]}),e.jsxs("div",{children:["Height: ",((ge=c==null?void 0:c.stats)==null?void 0:ge.heightInches)??"-"]}),e.jsxs("div",{children:["Weight: ",((oe=c==null?void 0:c.stats)==null?void 0:oe.weightLbs)??"-"]}),e.jsxs("div",{children:["Cock Size: ",((Ie=c==null?void 0:c.stats)==null?void 0:Ie.cockSizeInches)??"-"]}),e.jsxs("div",{children:["Cut / Uncut: ",((Se=c==null?void 0:c.stats)==null?void 0:Se.cutStatus)??"-"]}),e.jsxs("div",{children:["Position: ",((Ue=c==null?void 0:c.stats)==null?void 0:Ue.position)??"-"]}),e.jsxs("div",{style:{marginTop:8},children:["Bio: ",(c==null?void 0:c.bio)??"-"]})]}),e.jsx("div",{children:e.jsx("button",{type:"button",style:{...B(!1),color:"#ffb347",borderColor:"rgba(255,179,71,0.65)"},onClick:()=>void W(),children:"ðŸ”¥ FIRE"})})]})]})]})}return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:f?-10:0,marginBlock:0},children:[k.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14,padding:14},children:"No conversations yet."}):k.map(S=>e.jsxs("button",{type:"button",onClick:()=>z(S.key),style:{border:0,borderBottom:"1px solid rgba(255,58,77,0.24)",borderRadius:0,padding:"10px 12px",background:"rgba(0,0,0,0.2)",textAlign:"left",color:"#fff",cursor:"pointer",display:"grid",gridTemplateColumns:"52px 1fr",gap:10,alignItems:"center",width:"100%"},children:[e.jsx("img",{src:S.avatarUrl??Ne(S.key),alt:`${S.displayName} avatar`,style:{width:52,height:52,borderRadius:6,objectFit:"cover",border:"1px solid rgba(38,213,255,0.9)"}}),e.jsxs("div",{style:{display:"grid",gap:3,minWidth:0},children:[e.jsx("div",{style:{fontWeight:700},children:S.displayName}),e.jsx("div",{style:{color:"#b9bec9",fontSize:13,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:S.preview})]})]},S.key)),je?e.jsx("div",{style:{color:"#26d5ff",fontSize:12,padding:10},children:je}):null]})}function Lt({api:t,session:n,isMobile:r,screen:g,setLastError:a}){var ct;const[f,k]=i.useState([]),[T,N]=i.useState([]),[z,_]=i.useState(""),[G,E]=i.useState(""),[A,c]=i.useState(""),[M,P]=i.useState(""),[p,h]=i.useState(""),[F,$]=i.useState(""),[K,ue]=i.useState(""),[ye,je]=i.useState(""),[he,be]=i.useState([]),[Me,ve]=i.useState(""),[me,y]=i.useState(""),[x,v]=i.useState(""),[W,j]=i.useState(null),[ge,oe]=i.useState(null),[Ie,Se]=i.useState(null),[Ue,S]=i.useState(""),[l,C]=i.useState(""),[O,te]=i.useState(""),[le,xe]=i.useState({}),[ne,Te]=i.useState({}),[ke,Pe]=i.useState(null),[_e,Ge]=i.useState([]),[ie,Re]=i.useState({}),[we,Ve]=i.useState(null),[Ke,qe]=i.useState(null),[Ae,Je]=i.useState([]),[nt,He]=i.useState(!1),rt=!0,Qe=n.userType!=="guest",it=r?"repeat(2, minmax(0, 1fr))":"repeat(3, minmax(0, 1fr))",pt=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,de=i.useMemo(()=>T.find(o=>o.postingId===we)??null,[T,we]),Be=i.useMemo(()=>he.find(o=>o.spotId===Ke)??null,[Ke,he]),ot=Ke?`spot:${Ke}`:"";function u(o,b){const H=o.trim(),re=b.trim();if(!H||!re)return null;const L=new Date(`${H}T${re}`);return Number.isFinite(L.getTime())?L.getTime():null}function m(o){const b=ne[o];return b&&b.displayName.trim().length>0?b.displayName.trim():o}function w(o){const b=o.trim();return b?b.startsWith("user:")?m(b.slice(5).trim()):b.startsWith("session:")?"Guest":b:"Member"}function V(o){const b=ne[o];return b!=null&&b.mainPhotoMediaId&&le[b.mainPhotoMediaId]?le[b.mainPhotoMediaId]:Ne(`user:${o}`)}function Z(o){const b=new Set((o.acceptedUserIds??[]).filter(H=>H&&H!==o.authorUserId));return[o.authorUserId,...Array.from(b.values()).sort()]}function se(o){return n.userId?o.authorUserId===n.userId?!0:(o.acceptedUserIds??[]).includes(n.userId):!1}async function fe(o){const b=Array.from(new Set(o.map(L=>L.trim()).filter(L=>L.length>0)));if(b.length===0)return;const H=b.filter(L=>!le[L]);if(H.length===0)return;const re=await Promise.all(H.map(async L=>{try{const ae=await t.getPublicMediaUrl(L);return{mediaId:L,url:ae.downloadUrl}}catch{return null}}));xe(L=>{const ae={...L};for(const ze of re)ze&&(ae[ze.mediaId]=ze.url);return ae})}async function Ce(){try{const[o,b,H,re,L]=await Promise.all([t.listPublicPostings("ad",n.sessionToken),t.listPublicPostings("event",n.sessionToken),t.listCruisingSpots(),n.userType==="guest"?Promise.resolve({postings:[]}):t.listEventInvites(n.sessionToken),t.getPublicProfiles()]);k([...o.postings].sort((ae,ze)=>ae.createdAtMs-ze.createdAtMs)),N([...b.postings].sort((ae,ze)=>ae.createdAtMs-ze.createdAtMs)),be(H.spots),Ge(re.postings),Te(L.profiles.reduce((ae,ze)=>(ae[ze.userId]=ze,ae),{})),await fe([...o.postings.map(ae=>ae.photoMediaId??""),...b.postings.map(ae=>ae.photoMediaId??""),...H.spots.map(ae=>ae.photoMediaId??""),...L.profiles.map(ae=>ae.mainPhotoMediaId??"")])}catch(o){a(q(o))}}i.useEffect(()=>{Ce()},[]);async function Ze(o){if(o==="event"&&!Qe){a("Anonymous users cannot create groups.");return}const b=o==="ad"?z:A,H=o==="ad"?G:M,re=o==="ad"?Ue:l,L=o==="event"?u(p,F):null;if(o==="event"&&L===null){a("Group date and time are required.");return}if(o==="event"&&ye.trim().length===0){a("Location instructions are required.");return}if(o==="event"&&K.trim().length===0){a("Group details are required.");return}try{await t.createPublicPosting(n.sessionToken,{type:o,title:b,body:H,photoMediaId:re||void 0,eventStartAtMs:L??void 0,locationInstructions:o==="event"?ye.trim():void 0,groupDetails:o==="event"?K.trim():void 0}),o==="ad"?(_(""),E(""),j(null),S("")):(c(""),P(""),h(""),$(""),ue(""),je(""),oe(null),C("")),await Ce()}catch(ae){a(q(ae))}}async function wt(o){if(!Qe){a("Anonymous users cannot invite to groups.");return}const b=(ie[o]??"").trim();if(!b){a("Target user id is required.");return}try{await t.inviteToEvent(n.sessionToken,{postingId:o,targetUserId:b}),Re(H=>({...H,[o]:""})),await Ce()}catch(H){a(q(H))}}async function et(o,b){if(n.userType==="guest"){a("Anonymous users cannot respond to group invites.");return}try{await t.respondToEventInvite(n.sessionToken,{postingId:o,accept:b}),await Ce()}catch(H){a(q(H))}}async function It(o){if(n.userType==="guest"){a("Anonymous users cannot request to join groups.");return}try{await t.requestToJoinEvent(n.sessionToken,{postingId:o}),await Ce()}catch(b){a(q(b))}}async function at(o,b,H){if(n.userType==="guest"){a("Anonymous users cannot manage join requests.");return}try{await t.respondToEventJoinRequest(n.sessionToken,{postingId:o,targetUserId:b,accept:H}),await Ce()}catch(re){a(q(re))}}async function kt(){try{await t.createCruisingSpot(n.sessionToken,{name:Me,address:me,description:x,photoMediaId:O||void 0}),ve(""),y(""),v(""),Se(null),te(""),await Ce()}catch(o){a(q(o))}}async function lt(o){try{await t.checkInCruisingSpot(n.sessionToken,o),await Ce()}catch(b){a(q(b))}}async function xt(o){const b=o==="ad"?W:o==="event"?ge:Ie;if(!b){a("Choose a photo before uploading.");return}if(n.userType==="guest"){a("Guests cannot upload media.");return}Pe(o);try{const H=await t.initiateMediaUpload(n.sessionToken,{kind:"photo_gallery",mimeType:b.type||"application/octet-stream",sizeBytes:b.size});if(!await St(H.uploadUrl,b,b.type||"application/octet-stream")){const L=await fetch(H.uploadUrl,{method:"PUT",headers:{"content-type":b.type||"application/octet-stream"},body:b});if(!L.ok)throw{message:`Upload failed (${L.status}).`}}await t.completeMediaUpload(n.sessionToken,H.mediaId),await fe([H.mediaId]),o==="ad"&&S(H.mediaId),o==="event"&&C(H.mediaId),o==="spot"&&te(H.mediaId)}catch(H){a(q(H))}finally{Pe(null)}}async function yt(o){const b=`spot:${o}`;try{const H=await t.listChat(n.sessionToken,"cruise",b),re=Array.isArray(H.messages)?H.messages??[]:[];Je([...re].sort((L,ae)=>L.createdAtMs-ae.createdAtMs)),t.markChatRead(n.sessionToken,"cruise",b).catch(()=>{})}catch(H){a(q(H))}}const Ct=i.useMemo(()=>({async sendMessage(o,b,H,re){const ae=(await t.sendChat(n.sessionToken,o,b,H,re)).message;if(!ae)throw{code:"UNAUTHORIZED_ACTION",message:"Message rejected."};return Je(ze=>[...ze,ae].sort((We,ut)=>We.createdAtMs-ut.createdAtMs)),ae},async initiateMediaUpload(o,b){const H=await t.initiateChatMediaUpload(n.sessionToken,{mimeType:o,sizeBytes:b});return{objectKey:H.objectKey,uploadUrl:H.uploadUrl}},async uploadToSignedUrl(o,b,H){if(await St(o,b,H))return;if(!(await fetch(o,{method:"PUT",headers:{"content-type":H},body:b})).ok)throw{code:"MEDIA_UPLOAD_INCOMPLETE",message:"Upload failed."}},async getMediaUrl(o){return(await t.getChatMediaUrl(n.sessionToken,o)).downloadUrl}}),[t,n.sessionToken]);i.useEffect(()=>{if(!Ke||g!=="cruise")return;let o=!1,b=null;He(!0);const H=async()=>{o||(await yt(Ke),!o&&(He(!1),b=window.setTimeout(()=>{H()},1500)))};return H(),()=>{o=!0,b!==null&&window.clearTimeout(b)}},[g,Ke]);const dt=o=>{const b=o==="ads"?"ADS":"GROUPS",H=o==="ads"?f:T,re=o==="ads"?z:A,L=o==="ads"?G:M,ae=o==="ads"?_:c,ze=o==="ads"?E:P,We=o==="ads"?W:ge,ut=o==="ads"?j:oe,Ye=o==="ads"?Ue:l,ht=o==="ads"?S:C,mt=o==="ads"?"ad":"event",Fe=o==="ads"?rt:Qe,bt=ke===mt;return e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.38)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:b}),e.jsx("input",{value:re,onChange:Q=>ae(Q.target.value),placeholder:`${b} title`,style:X(),"aria-label":`${b} title`,disabled:!Fe}),e.jsx("textarea",{value:L,onChange:Q=>ze(Q.target.value),placeholder:`Write ${b.toLowerCase()} details`,style:{...X(),minHeight:86,resize:"vertical"},"aria-label":`${b} details`,disabled:!Fe}),o==="groups"?e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:r?"1fr":"1fr 1fr",gap:8},children:[e.jsx("input",{value:p,onChange:Q=>h(Q.target.value),type:"date",style:X(),"aria-label":"Group date",disabled:!Fe}),e.jsx("input",{value:F,onChange:Q=>$(Q.target.value),type:"time",style:X(),"aria-label":"Group time",disabled:!Fe})]}),e.jsx("textarea",{value:K,onChange:Q=>ue(Q.target.value),placeholder:"Detailed group profile description",style:{...X(),minHeight:74,resize:"vertical"},"aria-label":"Group details",disabled:!Fe}),e.jsx("textarea",{value:ye,onChange:Q=>je(Q.target.value),placeholder:"Location instructions (shown only to attendees)",style:{...X(),minHeight:68,resize:"vertical"},"aria-label":"Location instructions",disabled:!Fe})]}):null,e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:Q=>{var $e;return ut((($e=Q.target.files)==null?void 0:$e[0])??null)},disabled:!Fe}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",onClick:()=>void xt(mt),style:B(Fe?bt:!0),disabled:!Fe||bt,children:bt?"UPLOADING...":"UPLOAD PHOTO"}),e.jsx("button",{type:"button",onClick:()=>{ht(""),ut(null)},style:B(!1),children:"CLEAR PHOTO"})]}),Ye?e.jsx("img",{src:le[Ye]??Ne(Ye),alt:`${b} photo preview`,style:{width:"100%",maxWidth:240,aspectRatio:"1 / 1",objectFit:"cover",border:"1px solid rgba(255,58,77,0.4)"}}):null,!Ye&&We?e.jsx("div",{style:{color:"#b9bec9",fontSize:12},children:"Photo selected. Upload to attach."}):null]}),e.jsxs("button",{type:"button",onClick:()=>void Ze(mt),style:Fe?Ee(!1):B(!0),disabled:!Fe,children:["POST ",b]}),Fe?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can view groups but cannot post groups."}),e.jsx("div",{style:{display:"grid",gap:0,marginTop:6},children:H.length===0?e.jsxs("div",{style:{color:"#b9bec9",fontSize:14},children:["No ",b.toLowerCase()," yet."]}):e.jsx("div",{style:{display:"grid",gap:0,gridTemplateColumns:it},children:H.map(Q=>{var Pt,Rt;const $e=!!n.userId&&n.userId===Q.authorUserId,Et=!!n.userId&&(Q.invitedUserIds??[]).includes(n.userId),gt=!!n.userId&&(Q.authorUserId===n.userId||(Q.acceptedUserIds??[]).includes(n.userId)),Mt=!!n.userId&&(Q.joinRequestUserIds??[]).includes(n.userId),Ut=o==="groups"&&n.userType!=="guest"&&!!n.userId&&!$e&&!gt&&!Mt;return e.jsxs("div",{style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,display:"grid",gap:0},children:[e.jsx("div",{style:{position:"relative",width:"100%",aspectRatio:"1 / 1"},children:e.jsx("img",{src:Q.photoMediaId?le[Q.photoMediaId]??Ne(Q.postingId):Ne(Q.postingId),alt:`${b} posting`,style:{width:"100%",height:"100%",borderRadius:0,objectFit:"cover",border:"1px solid #0fd9ff"}})}),e.jsxs("div",{style:{padding:8,display:"grid",gap:6},children:[e.jsx("div",{style:{fontWeight:700,fontSize:14},children:Q.title}),o==="groups"?e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12},children:[en(Q.eventStartAtMs)," at ",tn(Q.eventStartAtMs)]}):null,e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12},children:["Host: ",m(Q.authorUserId)]}),e.jsx("div",{style:{color:"#ced3dc",fontSize:13,whiteSpace:"pre-wrap"},children:Q.body}),o==="groups"?e.jsxs("div",{style:{display:"grid",gap:8,marginTop:4},children:[e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12},children:["Invited: ",((Pt=Q.invitedUserIds)==null?void 0:Pt.length)??0," | Attending: ",(((Rt=Q.acceptedUserIds)==null?void 0:Rt.length)??0)+1]}),$e?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8},children:[e.jsx("input",{value:ie[Q.postingId]??"",onChange:vt=>Re(zt=>({...zt,[Q.postingId]:vt.target.value})),placeholder:"Invite user id",style:X()}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void wt(Q.postingId),children:"INVITE"})]}):null,n.userType!=="guest"&&Et?e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:Ee(!1),onClick:()=>void et(Q.postingId,!0),children:"ACCEPT INVITE"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void et(Q.postingId,!1),children:"DECLINE"})]}):null,Ut?e.jsx("button",{type:"button",style:B(!1),onClick:()=>void It(Q.postingId),children:"REQUEST TO JOIN"}):null,Mt?e.jsx("div",{style:{color:"#b9bec9",fontSize:12},children:"Join request pending host approval."}):null,e.jsx("button",{type:"button",style:we===Q.postingId?Ee(!1):B(!1),onClick:()=>Ve(vt=>vt===Q.postingId?null:Q.postingId),children:we===Q.postingId?"HIDE GROUP PROFILE":"VIEW GROUP PROFILE"})]}):null]})]},Q.postingId)})})})]})})},Tt=Be?e.jsxs("div",{style:{display:"grid",gap:0,minHeight:r?"calc(100dvh - 150px)":void 0,marginInline:r?-10:0,marginBlock:0},children:[e.jsxs("div",{style:{position:"sticky",top:0,zIndex:46,background:"rgba(8,8,12,0.96)",borderBottom:"1px solid rgba(255,58,77,0.35)",padding:"6px 10px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[e.jsx("button",{type:"button",style:{...B(!1),padding:"6px 10px",fontSize:12},onClick:()=>qe(null),children:"BACK TO SPOTS"}),e.jsx("div",{style:{fontSize:13,fontWeight:700,color:"#ced3dc"},children:Be.name}),e.jsx("button",{type:"button",style:{...B(!1),padding:"6px 10px",fontSize:12},onClick:()=>void lt(Be.spotId),children:"CHECK IN"})]}),nt?e.jsx("div",{style:{color:"#9fb6bf",fontSize:13,padding:"8px 10px"},children:"Loading thread..."}):null,e.jsx(Wt,{chatKind:"cruise",peerKey:ot,currentUserKey:pt,messages:Ae,client:Ct,title:`${Be.name} Board`,showHeader:!1,edgeToEdge:r,fillHeight:r,presentation:"board",authorLabelForKey:w})]}):e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.38)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"CRUISE"}),e.jsx("input",{value:Me,onChange:o=>ve(o.target.value),placeholder:"Spot name",style:X(),disabled:!1}),e.jsx("input",{value:me,onChange:o=>y(o.target.value),placeholder:"Spot address",style:X(),disabled:!1}),e.jsx("textarea",{value:x,onChange:o=>v(o.target.value),placeholder:"Spot description",style:{...X(),minHeight:80,resize:"vertical"},disabled:!1}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:o=>{var b;return Se(((b=o.target.files)==null?void 0:b[0])??null)},disabled:!1}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:B(ke==="spot"),disabled:ke==="spot",onClick:()=>void xt("spot"),children:ke==="spot"?"UPLOADING...":"UPLOAD PHOTO"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>{Se(null),te("")},children:"CLEAR PHOTO"})]}),O?e.jsx("img",{src:le[O]??Ne(O),alt:"Cruising spot preview",style:{width:"100%",maxWidth:240,aspectRatio:"1 / 1",objectFit:"cover",border:"1px solid rgba(255,58,77,0.4)"}}):null,!O&&Ie?e.jsx("div",{style:{color:"#b9bec9",fontSize:12},children:"Photo selected. Upload to attach."}):null]}),e.jsx("button",{type:"button",style:Ee(!1),disabled:!1,onClick:()=>void kt(),children:"CREATE SPOT"}),null,e.jsx("div",{style:{display:"grid",gap:10},children:he.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"No cruise spots yet."}):e.jsx("div",{style:{display:"grid",gap:10},children:he.map(o=>e.jsxs("button",{type:"button",onClick:()=>qe(o.spotId),style:{border:"1px solid rgba(255,58,77,0.35)",background:"rgba(0,0,0,0.5)",borderRadius:0,display:"grid",gap:0,textAlign:"left",color:"#fff",cursor:"pointer",width:"100%",padding:0},children:[e.jsx("div",{style:{position:"relative",width:"100%",aspectRatio:"16 / 6"},children:e.jsx("img",{src:o.photoMediaId?le[o.photoMediaId]??Ne(o.spotId):Ne(o.spotId),alt:"Cruising spot",style:{width:"100%",height:"100%",borderRadius:0,objectFit:"cover",border:"1px solid #0fd9ff"}})}),e.jsxs("div",{style:{padding:"10px 12px",display:"grid",gap:8},children:[e.jsx("div",{style:{fontWeight:700},children:o.name}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsxs("span",{style:{color:"#9fb6bf",fontSize:12},children:["Check-ins: ",o.checkInCount??0]}),e.jsx("button",{type:"button",style:B(!1),onClick:b=>{b.stopPropagation(),lt(o.spotId)},children:"CHECK IN"})]})]})]},o.spotId))})})]})});return e.jsxs("div",{style:{display:"grid",gap:8,marginInline:r?-10:0},children:[g==="ads"?dt("ads"):null,g==="groups"?dt("groups"):null,g==="groups"&&de?e.jsxs("div",{style:{border:"1px solid rgba(63,223,255,0.45)",background:"rgba(0,0,0,0.45)",padding:12,display:"grid",gap:10},children:[e.jsxs("div",{style:{display:"grid",gap:6},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:de.title}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:13},children:[en(de.eventStartAtMs)," at ",tn(de.eventStartAtMs)]}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:13},children:["Host: ",m(de.authorUserId)]})]}),e.jsx("img",{src:de.photoMediaId?le[de.photoMediaId]??Ne(de.postingId):Ne(de.postingId),alt:"Group photo",style:{width:"100%",maxHeight:280,objectFit:"cover",border:"1px solid rgba(63,223,255,0.55)"}}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:13,color:"#9fb6bf"},children:"Summary"}),e.jsx("div",{style:{color:"#d2d8e2",fontSize:14,whiteSpace:"pre-wrap"},children:de.body})]}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:13,color:"#9fb6bf"},children:"Group details"}),e.jsx("div",{style:{color:"#d2d8e2",fontSize:14,whiteSpace:"pre-wrap"},children:de.groupDetails??"No extra details provided."})]}),se(de)?e.jsxs("div",{style:{display:"grid",gap:4,border:"1px solid rgba(63,223,255,0.45)",padding:8},children:[e.jsx("div",{style:{fontSize:13,color:"#9fb6bf"},children:"Attendee-only location instructions"}),e.jsx("div",{style:{color:"#d2d8e2",fontSize:14,whiteSpace:"pre-wrap"},children:de.locationInstructions??"None provided."})]}):e.jsx("div",{style:{color:"#9fb6bf",fontSize:12},children:"Location instructions are only visible to attendees."}),n.userId===de.authorUserId&&(((ct=de.joinRequestUserIds)==null?void 0:ct.length)??0)>0?e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:13,color:"#9fb6bf"},children:"Pending join requests"}),(de.joinRequestUserIds??[]).map(o=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,alignItems:"center"},children:[e.jsx("div",{style:{color:"#d2d8e2",fontSize:14},children:m(o)}),e.jsx("button",{type:"button",style:Ee(!1),onClick:()=>void at(de.postingId,o,!0),children:"APPROVE"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void at(de.postingId,o,!1),children:"DECLINE"})]},o))]}):null,e.jsxs("div",{style:{display:"grid",gap:6},children:[e.jsx("div",{style:{fontSize:13,color:"#9fb6bf"},children:"Host and attendees"}),e.jsx("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:Z(de).map((o,b)=>e.jsxs("div",{style:{display:"grid",gap:6,justifyItems:"center",width:74},children:[e.jsx("img",{src:V(o),alt:`${m(o)} profile`,style:{width:54,height:54,borderRadius:"50%",objectFit:"cover",border:b===0?"2px solid #88d6ff":"1px solid rgba(255,58,77,0.5)"}}),e.jsxs("div",{style:{color:"#c7d0de",fontSize:11,textAlign:"center",lineHeight:1.2},children:[m(o),b===0?" (Host)":""]})]},o))})]})]}):null,g==="cruise"?Tt:null,g==="groups"&&n.userType!=="guest"&&_e.length>0?e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.25)",display:"grid",gap:8,padding:10},children:[e.jsx("div",{style:{fontSize:16,fontWeight:700},children:"GROUP INVITES"}),_e.map(o=>e.jsxs("div",{style:{display:"grid",gap:6,border:"1px solid rgba(255,58,77,0.4)",borderRadius:10,padding:8},children:[e.jsx("div",{style:{fontWeight:700},children:o.title}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13},children:["Host: ",o.authorUserId]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:Ee(!1),onClick:()=>void et(o.postingId,!0),children:"ACCEPT"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void et(o.postingId,!1),children:"DECLINE"})]})]},o.postingId))]}):null]})}function Wn({api:t,session:n,setLastError:r}){const[g,a]=i.useState([]),[f,k]=i.useState(""),[T,N]=i.useState("");async function z(){try{const c=await t.listSubmissions();a([...c.submissions].sort((M,P)=>P.createdAtMs-M.createdAtMs))}catch(c){r(q(c))}}i.useEffect(()=>{z()},[]);async function _(){try{await t.createSubmission(n.sessionToken,{title:f,body:T}),k(""),N(""),await z()}catch(c){r(q(c))}}async function G(c){try{await t.recordSubmissionView(c),await z()}catch(M){r(q(M))}}async function E(c,M){try{await t.rateSubmission(c,M),await z()}catch(P){r(q(P))}}const A=n.userType!=="guest";return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("input",{style:X(),value:f,onChange:c=>k(c.target.value),placeholder:"Story title",disabled:!A}),e.jsx("textarea",{style:{...X(),minHeight:120},value:T,onChange:c=>N(c.target.value),placeholder:"Write your story",disabled:!A}),e.jsx("button",{type:"button",style:A?Ee(!1):B(!0),disabled:!A,onClick:()=>void _(),children:"PUBLISH STORY"}),A?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can read but cannot publish submissions."})]})}),e.jsx("div",{style:{display:"grid",gap:10},children:g.map(c=>{const M=c.ratingCount>0?(c.ratingSum/c.ratingCount).toFixed(2):"0.00";return e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.28)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:c.title}),e.jsx("div",{style:{color:"#ced3dc",whiteSpace:"pre-wrap",marginTop:6},children:c.body}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13,marginTop:8},children:["Views: ",c.viewCount," | Rating: ",M," (",c.ratingCount,")"]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:B(!1),onClick:()=>void G(c.submissionId),children:"VIEW"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void E(c.submissionId,1),children:"â˜…1"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void E(c.submissionId,2),children:"â˜…2"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void E(c.submissionId,3),children:"â˜…3"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void E(c.submissionId,4),children:"â˜…4"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void E(c.submissionId,5),children:"â˜…5"})]})]},c.submissionId)})})]})}function Dn({api:t,session:n,setLastError:r}){var be,Me,ve,me,y,x;const[g,a]=i.useState([]),[f,k]=i.useState({}),[T,N]=i.useState(null),[z,_]=i.useState(2e3),[G,E]=i.useState(""),[A,c]=i.useState(""),[M,P]=i.useState(""),[p,h]=i.useState(""),[F,$]=i.useState("Ready."),K=n.userType!=="guest";async function ue(){try{const v=await t.listPromotedProfiles();a([...v.listings].sort((oe,Ie)=>Ie.createdAtMs-oe.createdAtMs)),_(v.feeCents);const W=Array.from(new Set(v.listings.map(oe=>oe.userId))).filter(oe=>oe.trim().length>0),j=await Promise.all(W.map(async oe=>{try{const Se=(await t.getPublicProfile(oe)).profile.mainPhotoMediaId;if(!Se)return null;const Ue=await t.getPublicMediaUrl(Se);return{userId:oe,url:Ue.downloadUrl}}catch{return null}})),ge={};for(const oe of j)oe&&(ge[oe.userId]=oe.url);k(ge)}catch(v){r(q(v))}}i.useEffect(()=>{ue()},[]);async function ye(){if(!K){r("Anonymous users cannot create promoted profiles.");return}try{const v=await t.startPromotedPayment(n.sessionToken),W=await t.confirmPromotedPayment(n.sessionToken,v.payment.paymentToken);h(W.payment.paymentToken),$("Payment confirmed. You can now publish one promoted profile.")}catch(v){const W=q(v);$(W),r(W)}}async function je(){if(!K){r("Anonymous users cannot create promoted profiles.");return}try{await t.createPromotedProfile(n.sessionToken,{paymentToken:p,title:G,body:A,displayName:M}),E(""),c(""),P(""),h(""),$("Promoted profile published."),await ue()}catch(v){const W=q(v);$(W),r(W)}}async function he(v){try{const W=await t.getPublicProfile(v);N(W.profile)}catch(W){r(q(W))}}return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"PROMOTED PROFILES"}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:14},children:["Publishing requires a $",Math.round(z/100)," fee per profile."]}),e.jsx("div",{style:{color:"#26d5ff",fontSize:13},children:F})]})}),e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("input",{value:M,onChange:v=>P(v.target.value),placeholder:"Display name",style:X(),disabled:!K}),e.jsx("input",{value:G,onChange:v=>E(v.target.value),placeholder:"Headline",style:X(),disabled:!K}),e.jsx("textarea",{value:A,onChange:v=>c(v.target.value),placeholder:"Profile description",style:{...X(),minHeight:92,resize:"vertical"},disabled:!K}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsxs("button",{type:"button",style:B(!K),disabled:!K,onClick:()=>void ye(),children:["PAY $",Math.round(z/100)]}),e.jsx("button",{type:"button",style:K?Ee(!1):B(!0),disabled:!K,onClick:()=>void je(),children:"PUBLISH PROFILE"})]}),K?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can browse but cannot publish paid profiles."})]})}),e.jsx("div",{style:{display:"grid",gap:10},children:g.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"No promoted profiles yet."}):g.map(v=>e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.25)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"72px 1fr",gap:10,alignItems:"start"},children:[e.jsx("img",{src:f[v.userId]??Ne(`user:${v.userId}`),alt:`${v.displayName} profile`,style:{width:72,height:72,borderRadius:6,objectFit:"cover",border:"1px solid rgba(38,213,255,0.9)"}}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:v.title}),e.jsx("div",{style:{color:"#26d5ff",fontSize:13},children:v.displayName}),e.jsx("div",{style:{color:"#ced3dc",whiteSpace:"pre-wrap",fontSize:14},children:v.body}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void he(v.userId),children:"VIEW PROFILE"})]})]})},v.listingId))}),T?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},onClick:()=>N(null),children:e.jsxs("div",{onClick:v=>v.stopPropagation(),style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:12,width:"min(560px, 100%)",background:"rgba(0,0,0,0.88)"},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:T.displayName}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:6},children:["Age: ",T.age]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Race: ",((be=T.stats)==null?void 0:be.race)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Height: ",((Me=T.stats)==null?void 0:Me.heightInches)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Weight: ",((ve=T.stats)==null?void 0:ve.weightLbs)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Cock Size: ",((me=T.stats)==null?void 0:me.cockSizeInches)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Cut / Uncut: ",((y=T.stats)==null?void 0:y.cutStatus)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Position: ",((x=T.stats)==null?void 0:x.position)??"-"]}),e.jsx("div",{style:{color:"#ced3dc",marginTop:10,whiteSpace:"pre-wrap"},children:T.bio}),e.jsx("div",{style:{marginTop:10},children:e.jsx("button",{type:"button",style:B(!1),onClick:()=>N(null),children:"CLOSE"})})]})}):null]})}function Hn(){return{displayName:"",age:"",bio:"",heightInches:"",race:"",cockSizeInches:"",cutStatus:"",weightLbs:"",position:"",discreetMode:!1,travelEnabled:!1,travelLat:"",travelLng:"",lookingForMore:""}}function rn(t){var r,g,a;const n=fn(t.bio);return{displayName:t.displayName,age:String(t.age),bio:n.bio,heightInches:t.stats.heightInches!==void 0?String(t.stats.heightInches):"",race:t.stats.race??"",cockSizeInches:t.stats.cockSizeInches!==void 0?String(t.stats.cockSizeInches):"",cutStatus:t.stats.cutStatus??"",weightLbs:t.stats.weightLbs!==void 0?String(t.stats.weightLbs):"",position:t.stats.position??"",discreetMode:t.discreetMode===!0,travelEnabled:((r=t.travelMode)==null?void 0:r.enabled)===!0,travelLat:typeof((g=t.travelMode)==null?void 0:g.lat)=="number"?String(t.travelMode.lat):"",travelLng:typeof((a=t.travelMode)==null?void 0:a.lng)=="number"?String(t.travelMode.lng):"",lookingForMore:n.lookingForMore}}function fn(t){const n=t.replace(/\r\n/g,`
`).trim(),r="Looking For More:",g=/Looking For More:\s*/g,a=Array.from(n.matchAll(g));if(a.length===0)return{bio:n,lookingForMore:""};const f=a[0],k=a[a.length-1],T=typeof f.index=="number"?f.index:n.indexOf(r),N=(typeof k.index=="number"?k.index:n.lastIndexOf(r))+k[0].length,z=n.slice(0,Math.max(0,T)).trim(),_=n.slice(Math.max(0,N)).trim();return{bio:z,lookingForMore:_}}function Bn(t,n){const g=fn(t).bio.trim(),a=n.trim();return a?g?`${g}

Looking For More: ${a}`:`${a}`:g}function on(t){const n=t.trim();if(!n)return;const r=Number(n);return Number.isFinite(r)?Math.trunc(r):void 0}function $n(t){const n=t.trim();if(!n)return;const r=Number(n);return Number.isFinite(r)?r:void 0}function _n({api:t,session:n,setLastError:r}){const[g,a]=i.useState(Hn()),[f,k]=i.useState(null),[T,N]=i.useState(!1),[z,_]=i.useState(!1),[G,E]=i.useState(null),[A,c]=i.useState({}),[M,P]=i.useState(!1);async function p(){N(!0);try{const y=await t.getMyProfile(n.sessionToken);k(y.profile),a(rn(y.profile)),E("Profile loaded.")}catch(y){const x=y;if((x==null?void 0:x.code)==="PROFILE_NOT_FOUND"){k(null),a(v=>({...v,age:v.age||"18"})),E("No profile yet. Fill out the form and save.");return}E(q(y))}finally{N(!1)}}i.useEffect(()=>{p()},[n.sessionToken,n.userType]),i.useEffect(()=>{const y=[f==null?void 0:f.mainPhotoMediaId,...(f==null?void 0:f.galleryMediaIds)??[]].filter(v=>typeof v=="string"&&v.length>0);if(y.length===0)return;const x=y.filter(v=>!A[v]);x.length!==0&&Promise.all(x.map(async v=>{try{const W=await t.getPublicMediaUrl(v);return{id:v,url:W.downloadUrl}}catch{return null}})).then(v=>{c(W=>{const j={...W};for(const ge of v)ge&&(j[ge.id]=ge.url);return j})})},[t,A,f==null?void 0:f.galleryMediaIds,f==null?void 0:f.mainPhotoMediaId]);async function h(){var y,x,v,W,j;_(!0),r(null);try{const ge=Number(g.age),oe=Bn(g.bio,g.lookingForMore),Ie=g.travelLat.trim()?Number(g.travelLat):void 0,Se=g.travelLng.trim()?Number(g.travelLng):void 0,Ue={displayName:g.displayName,age:Math.trunc(ge),bio:oe,stats:{heightInches:on(g.heightInches),race:g.race.trim()||void 0,cockSizeInches:$n(g.cockSizeInches),cutStatus:g.cutStatus||void 0,weightLbs:on(g.weightLbs),position:g.position||void 0},discreetMode:g.discreetMode,travelMode:{enabled:g.travelEnabled,lat:Number.isFinite(Ie)?Ie:void 0,lng:Number.isFinite(Se)?Se:void 0}},S=await t.upsertMyProfile(n.sessionToken,Ue);k(S.profile),a(rn(S.profile));try{localStorage.setItem("reddoor_travel_center",JSON.stringify({enabled:((y=S.profile.travelMode)==null?void 0:y.enabled)===!0,lat:(x=S.profile.travelMode)==null?void 0:x.lat,lng:(v=S.profile.travelMode)==null?void 0:v.lng})),window.dispatchEvent(new CustomEvent("rd:location-updated",{detail:{lat:(W=S.profile.travelMode)==null?void 0:W.lat,lng:(j=S.profile.travelMode)==null?void 0:j.lng}}))}catch{}E("Profile saved.")}catch(ge){const oe=q(ge);E(oe),r(oe)}finally{_(!1)}}async function F(y,x){if(!x){E("Choose a file first.");return}if(!f){const v="Save your profile details first, then upload media.";E(v),r(v);return}if(n.userType==="guest"){E("Guest sessions cannot upload media. Register to persist media.");return}_(!0),r(null);try{const v=await t.initiateMediaUpload(n.sessionToken,{kind:y,mimeType:x.type||(y==="video"?"video/mp4":"image/jpeg"),sizeBytes:x.size});if(!await St(v.uploadUrl,x,x.type||"application/octet-stream")){const j=await fetch(v.uploadUrl,{method:"PUT",headers:{"content-type":x.type||"application/octet-stream"},body:x});if(!j.ok)throw{message:`Upload failed (${j.status}).`}}await t.completeMediaUpload(n.sessionToken,v.mediaId),await p(),E("Media uploaded.")}catch(v){const W=q(v);E(W),r(W)}finally{_(!1)}}const[$,K]=i.useState(null),[ue,ye]=i.useState(null),[je,he]=i.useState(null);async function be(y){if(f){_(!0);try{const x=(f.galleryMediaIds??[]).filter(W=>W!==y),v=await t.updateProfileMediaReferences(n.sessionToken,{galleryMediaIds:x});k(v.profile),E("Gallery updated.")}catch(x){const v=q(x);E(v),r(v)}finally{_(!1)}}}async function Me(y){if(f){_(!0);try{const x=await t.updateProfileMediaReferences(n.sessionToken,{galleryMediaIds:f.galleryMediaIds,mainPhotoMediaId:y});k(x.profile),E("Main photo updated.")}catch(x){const v=q(x);E(v),r(v)}finally{_(!1)}}}const ve=(f==null?void 0:f.galleryMediaIds)??[],me=f!=null&&f.mainPhotoMediaId&&A[f.mainPhotoMediaId]?A[f.mainPhotoMediaId]:f!=null&&f.mainPhotoMediaId?Ne(f.mainPhotoMediaId):void 0;return e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:De(),children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"PROFILE SETTINGS"}),n.userType==="guest"?e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guest profile data is temporary and clears on logout."}):null,G?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:G}):null,e.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",onClick:()=>void h(),style:Ee(z),disabled:z,children:"SAVE PROFILE"}),e.jsx("button",{type:"button",onClick:()=>void p(),style:B(T),disabled:T,children:"REFRESH"}),e.jsx("button",{type:"button",onClick:()=>P(y=>!y),style:B(!1),disabled:!f,children:M?"HIDE MY PROFILE":"VIEW MY PROFILE"})]})]})}),e.jsx("div",{style:De(),children:e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"ABOUT YOU"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Display Name"}),e.jsx("input",{value:g.displayName,onChange:y=>a(x=>({...x,displayName:y.target.value})),style:X()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Age"}),e.jsx("input",{value:g.age,onChange:y=>a(x=>({...x,age:y.target.value})),style:X(),inputMode:"numeric"})]})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Bio"}),e.jsx("textarea",{value:g.bio,onChange:y=>a(x=>({...x,bio:y.target.value})),style:{...X(),minHeight:88,resize:"vertical"}})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Looking For More (Optional)"}),e.jsx("textarea",{value:g.lookingForMore,onChange:y=>a(x=>({...x,lookingForMore:y.target.value})),style:{...X(),minHeight:72,resize:"vertical"}})]})]})}),e.jsx("div",{style:De(),children:e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"PROFILE DETAILS"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Height (in)"}),e.jsx("input",{value:g.heightInches,onChange:y=>a(x=>({...x,heightInches:y.target.value})),style:X(),inputMode:"numeric"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Weight (lbs)"}),e.jsx("input",{value:g.weightLbs,onChange:y=>a(x=>({...x,weightLbs:y.target.value})),style:X(),inputMode:"numeric"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Race"}),e.jsx("input",{value:g.race,onChange:y=>a(x=>({...x,race:y.target.value})),style:X()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Cock Size (in)"}),e.jsx("input",{value:g.cockSizeInches,onChange:y=>a(x=>({...x,cockSizeInches:y.target.value})),style:X(),inputMode:"decimal"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Cut / Uncut"}),e.jsxs("select",{value:g.cutStatus,onChange:y=>a(x=>({...x,cutStatus:y.target.value})),style:X(),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"cut",children:"Cut"}),e.jsx("option",{value:"uncut",children:"Uncut"})]})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Position"}),e.jsxs("select",{value:g.position,onChange:y=>a(x=>({...x,position:y.target.value})),style:X(),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"top",children:"Top"}),e.jsx("option",{value:"bottom",children:"Bottom"}),e.jsx("option",{value:"side",children:"Side"})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(240px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:g.discreetMode,onChange:y=>a(x=>({...x,discreetMode:y.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Discreet Mode"})]}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:g.travelEnabled,onChange:y=>a(x=>({...x,travelEnabled:y.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Travel Mode"})]})]}),g.travelEnabled?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Travel Lat"}),e.jsx("input",{value:g.travelLat,onChange:y=>a(x=>({...x,travelLat:y.target.value})),style:X()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Travel Lng"}),e.jsx("input",{value:g.travelLng,onChange:y=>a(x=>({...x,travelLng:y.target.value})),style:X()})]})]}):null]})}),e.jsx("div",{style:De(),children:e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"MEDIA"}),e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"Upload and manage your photos and video."}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(240px, 1fr))",gap:10},children:[e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Main Photo"}),e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:y=>{var x;return K(((x=y.target.files)==null?void 0:x[0])??null)}})]}),e.jsx("button",{type:"button",style:Ee(z),disabled:z,onClick:()=>void F("photo_main",$),children:"UPLOAD MAIN PHOTO"})]}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Gallery Photo"}),e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:y=>{var x;return ye(((x=y.target.files)==null?void 0:x[0])??null)}})]}),e.jsx("button",{type:"button",style:Ee(z),disabled:z,onClick:()=>void F("photo_gallery",ue),children:"UPLOAD GALLERY PHOTO"})]}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Video"}),e.jsx("input",{className:"rd-input",type:"file",accept:"video/*",onChange:y=>{var x;return he(((x=y.target.files)==null?void 0:x[0])??null)}})]}),e.jsx("button",{type:"button",style:Ee(z),disabled:z,onClick:()=>void F("video",je),children:"UPLOAD VIDEO"})]})]}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13},children:["Main photo media id: ",(f==null?void 0:f.mainPhotoMediaId)??"-",e.jsx("br",{}),"Gallery count: ",ve.length,e.jsx("br",{}),"Video media id: ",(f==null?void 0:f.videoMediaId)??"-"]}),ve.length?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(130px, 1fr))",gap:10},children:ve.map(y=>e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.45)",borderRadius:10,padding:8,display:"grid",gap:8},children:[e.jsx("img",{src:A[y]??Ne(y),alt:"Gallery photo",style:{width:"100%",aspectRatio:"1/1",objectFit:"cover",borderRadius:8,border:"1px solid rgba(255,58,77,0.4)"}}),e.jsx("button",{type:"button",style:B(z),disabled:z,onClick:()=>void Me(y),children:"SET MAIN"}),e.jsx("button",{type:"button",style:B(z),disabled:z,onClick:()=>void be(y),children:"REMOVE"})]},y))}):e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No gallery photos uploaded yet."})]})}),M&&f?e.jsx("div",{style:De(),children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"MY PROFILE PREVIEW"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(120px, 180px) 1fr",gap:12,alignItems:"start"},children:[e.jsx("img",{src:me??Ne(f.userId),alt:"My profile",style:{width:"100%",aspectRatio:"1/1",objectFit:"cover",borderRadius:12,border:"1px solid rgba(255,58,77,0.45)"}}),e.jsxs("div",{style:{display:"grid",gap:6},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:f.displayName}),e.jsxs("div",{style:{color:"#ced3dc",fontSize:14},children:["Age: ",f.age]}),e.jsxs("div",{style:{color:"#ced3dc",fontSize:14},children:["Race: ",f.stats.race??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",fontSize:14},children:["Height: ",f.stats.heightInches??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",fontSize:14},children:["Weight: ",f.stats.weightLbs??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",fontSize:14},children:["Cock Size: ",f.stats.cockSizeInches??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",fontSize:14},children:["Cut / Uncut: ",f.stats.cutStatus??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",fontSize:14},children:["Position: ",f.stats.position??"-"]}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap"},children:f.bio||"-"})]})]})]})}):null]})}function Gn({api:t,session:n,setLastError:r,onLogout:g}){const[a,f]=i.useState({discreetMode:!1,travelEnabled:!1,travelLat:"",travelLng:""}),[k,T]=i.useState("Loading settings..."),[N,z]=i.useState(!1),[_,G]=i.useState([]);async function E(){var p,h,F;try{const $=await t.getMyProfile(n.sessionToken);if(f({discreetMode:$.profile.discreetMode===!0,travelEnabled:((p=$.profile.travelMode)==null?void 0:p.enabled)===!0,travelLat:typeof((h=$.profile.travelMode)==null?void 0:h.lat)=="number"?String($.profile.travelMode.lat):"",travelLng:typeof((F=$.profile.travelMode)==null?void 0:F.lng)=="number"?String($.profile.travelMode.lng):""}),T("Settings loaded."),n.userType!=="guest")try{const K=await t.listBlocked(n.sessionToken);G(K.blocked)}catch{G([])}else G([])}catch($){T(q($))}}async function A(){try{const p=await fetch("/api/config"),h=await p.json();if(!p.ok)throw h;z(h.mediaStorageConfigured===!0)}catch{z(!1)}}i.useEffect(()=>{E(),A()},[n.sessionToken,n.userType]);async function c(){try{const p=await t.getMyProfile(n.sessionToken),h=a.travelLat.trim()?Number(a.travelLat):void 0,F=a.travelLng.trim()?Number(a.travelLng):void 0;await t.upsertMyProfile(n.sessionToken,{displayName:p.profile.displayName,age:p.profile.age,bio:p.profile.bio,stats:p.profile.stats,discreetMode:a.discreetMode,travelMode:{enabled:a.travelEnabled,lat:Number.isFinite(h)?h:void 0,lng:Number.isFinite(F)?F:void 0}}),T("Privacy settings saved.")}catch(p){const h=q(p);T(h),r(h)}}async function M(){if(!navigator.geolocation){const p="Geolocation is unavailable on this device.";T(p),r(p);return}try{const p=await new Promise(($,K)=>{navigator.geolocation.getCurrentPosition($,K,{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})}),h=Number(p.coords.latitude.toFixed(6)),F=Number(p.coords.longitude.toFixed(6));f($=>({...$,travelEnabled:!0,travelLat:String(h),travelLng:String(F)}));try{localStorage.setItem("reddoor_travel_center",JSON.stringify({enabled:!0,lat:h,lng:F}))}catch{}try{await t.updatePresence(n.sessionToken,h,F,"online")}catch{}window.dispatchEvent(new CustomEvent("rd:location-updated",{detail:{lat:h,lng:F}})),T("Actual location detected. Save privacy settings to persist it.")}catch(p){const h=q(p);T(h),r(h)}}async function P(p){try{await t.unblock(n.sessionToken,p);const h=await t.listBlocked(n.sessionToken);G(h.blocked),T("Blocked users updated.")}catch(h){const F=q(h);T(F),r(F)}}return e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:De(),children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"SETTINGS"}),e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:k}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:a.discreetMode,onChange:p=>f(h=>({...h,discreetMode:p.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Discreet Mode (hide your profile)"})]}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:a.travelEnabled,onChange:p=>f(h=>({...h,travelEnabled:p.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Travel Mode"})]}),a.travelEnabled?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("input",{value:a.travelLat,onChange:p=>f(h=>({...h,travelLat:p.target.value})),style:X(),placeholder:"Travel lat"}),e.jsx("input",{value:a.travelLng,onChange:p=>f(h=>({...h,travelLng:p.target.value})),style:X(),placeholder:"Travel lng"})]}):null,e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:Ee(!1),onClick:()=>void c(),children:"SAVE PRIVACY"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void M(),children:"DETECT ACTUAL LOCATION"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>g==null?void 0:g(),children:"LOGOUT"})]})]})}),e.jsx("div",{style:De(),children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"MEDIA STORAGE"}),e.jsx("div",{style:{color:N?"#26d5ff":"#ff8a95",fontSize:14},children:N?"Configured: uploads enabled.":"Not configured: set S3_BUCKET, S3_REGION, S3_ACCESS_KEY_ID, S3_SECRET_ACCESS_KEY."}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void A(),children:"REFRESH STORAGE STATUS"})]})}),n.userType!=="guest"?e.jsx("div",{style:De(),children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"BLOCKED USERS"}),_.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No blocked users."}):_.map(p=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[e.jsx("div",{style:{color:"#ced3dc",fontSize:14},children:p}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void P(p),children:"UNBLOCK"})]},p))]})}):null]})}function qn({api:t,session:n,setSession:r,settings:g,activeTab:a,setActiveTab:f,discoverScreen:k,onDiscoverScreenChange:T,discoverFilter:N,busy:z,setBusy:_,setLastError:G,onUnreadCountChange:E,hideModeCard:A,onLogout:c}){const M=zn(),[P,p]=i.useState(null),h=e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx(_n,{api:t,session:n,setLastError:G}),e.jsx(Gn,{api:t,session:n,setLastError:G,onLogout:c})]});return e.jsxs("div",{style:{display:"grid",gap:12},children:[null,e.jsx("div",{style:{display:a==="discover"?"block":"none"},children:e.jsx(Fn,{api:t,session:n,settings:g,discoverFilter:N,busy:z,setBusy:_,setLastError:G,isMobile:M,discoverScreen:k,onDiscoverScreenChange:T,onOpenThreadRequested:F=>{p({key:Oe(F),nonce:Date.now()}),f("threads")},onUnreadCountChange:E})}),a==="threads"?e.jsx(Kn,{api:t,session:n,setLastError:G,openThreadRequest:P,onThreadRequestConsumed:()=>p(null),isMobile:M}):null,a==="ads"?e.jsx(Lt,{api:t,session:n,isMobile:M,screen:"ads",setLastError:G}):null,a==="groups"?e.jsx(Lt,{api:t,session:n,isMobile:M,screen:"groups",setLastError:G}):null,a==="cruise"?e.jsx(Lt,{api:t,session:n,isMobile:M,screen:"cruise",setLastError:G}):null,a==="profile"||a==="settings"?h:null,a==="submissions"?e.jsx(Wn,{api:t,session:n,setLastError:G}):null,a==="promoted"?e.jsx(Dn,{api:t,session:n,setLastError:G}):null]})}export{qn as Router};
