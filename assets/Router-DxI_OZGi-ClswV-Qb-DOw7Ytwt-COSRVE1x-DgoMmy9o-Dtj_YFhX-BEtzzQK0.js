const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./maplibre-gl-BBv2PdBF-DWCZ6U9J-_rMbz4ag-DmXXnYPx-BuGxjfKb-DvLTmAGD-Bqxog4Jq.js","./index-Beho1hjv.js","./index-Bo-IJfkI.css"])))=>i.map(i=>d[i]);
import{R as i,g as e,C as mt,s as Gt,u as Vt,c as Jt,J as vs,v as bs,h as ms,f as xs,a as js,o as ws,_ as ks}from"./index-Beho1hjv.js";const qt=(t,s=qt,a=s.f||(s.f=["./maplibre-gl-BBv2PdBF-DWCZ6U9J-_rMbz4ag-DmXXnYPx-BuGxjfKb-DvLTmAGD.js","./index-Zr-O-W6j.js","./index-dtGyxXDT.css"]))=>t.map(w=>a[w]),Zt=(t,s=Zt,a=s.f||(s.f=["./maplibre-gl-BBv2PdBF-DWCZ6U9J-_rMbz4ag-DmXXnYPx-BuGxjfKb.js","./index-CjOGfsyb.js","./index-CWGhqHM4.css"]))=>t.map(w=>a[w]),Yt=(t,s=Yt,a=s.f||(s.f=["./maplibre-gl-BBv2PdBF-DWCZ6U9J-_rMbz4ag-DmXXnYPx.js","./index-_BoJ9Y6J.js","./index-UGnoUN2z.css"]))=>t.map(w=>a[w]),Xt=(t,s=Xt,a=s.f||(s.f=["./maplibre-gl-BBv2PdBF-DWCZ6U9J-_rMbz4ag.js","./index-BPRxYBLF.js","./index-DP67Pv4s.css"]))=>t.map(w=>a[w]),Qt=(t,s=Qt,a=s.f||(s.f=["./maplibre-gl-BBv2PdBF-DWCZ6U9J.js","./index-Cw21CfjC.js","./index-CgnsFINl.css"]))=>t.map(w=>a[w]),es=(t,s=es,a=s.f||(s.f=["./maplibre-gl-BBv2PdBF.js","./index-B5V8o1gb.js","./index-CcRnFIlo.css"]))=>t.map(w=>a[w]);function ts(t){return typeof t=="object"&&t!==null}function Ss(t){return!(!ts(t)||typeof t.key!="string"||t.userType!=="guest"&&t.userType!=="registered"&&t.userType!=="subscriber"||typeof t.lat!="number"||!Number.isFinite(t.lat)||typeof t.lng!="number"||!Number.isFinite(t.lng)||typeof t.updatedAtMs!="number"||!Number.isFinite(t.updatedAtMs)||t.status!==void 0&&typeof t.status!="string")}function ss(t){const[s,a]=i.useState(()=>new Map),[w,u]=i.useState(null),f=i.useRef(null),k=i.useRef(null);return i.useEffect(()=>{if(t.disabled===!0||t.wsUrl.trim()===""){a(new Map),u(null),k.current!==null&&(window.clearTimeout(k.current),k.current=null);return}let y=!1,D=0,G=null;const Y=()=>{G!==null&&(window.clearInterval(G),G=null)},A=()=>{if(y)return;const x=Math.min(8e3,500*2**Math.min(D,4));k.current=window.setTimeout(()=>{k.current=null,R()},x)},R=()=>{if(y)return;let x;try{x=new WebSocket(t.wsUrl)}catch{D+=1,u("Realtime unavailable in this mode."),A();return}f.current=x;let o=!1;x.onopen=()=>{o=!0,D=0,u(null);const p={};t.sessionToken&&(p.sessionToken=t.sessionToken),t.jwt&&(p.jwt=t.jwt),x.send(JSON.stringify({type:"auth",payload:p})),G=window.setInterval(()=>{x.readyState===x.OPEN&&x.send(JSON.stringify({type:"heartbeat",payload:{}}))},15e3)},x.onmessage=p=>{const L=(()=>{try{return JSON.parse(String(p.data))}catch{return null}})();if(!L||typeof L.type!="string"){u("Invalid server message.");return}if(L.type==="error"&&ts(L.payload)&&typeof L.payload.message=="string"){u(L.payload.message);return}if(L.type==="presence_update"){const U=L.payload;if(!Ss(U)){u("Invalid presence payload.");return}a(b=>{const j=new Map(b);return j.set(U.key,U),j})}},x.onerror=()=>{},x.onclose=p=>{if(Y(),!y&&p.code!==1e3){D+=1;const L=typeof p.reason=="string"&&p.reason.trim()!==""?` Reason: ${p.reason}`:"";(D>=2||o)&&u(`Realtime ${o?"disconnected":"failed to connect"} (code ${p.code}). Reconnecting...${L}`),A()}}};return R(),()=>{var x;y=!0,Y(),k.current!==null&&(window.clearTimeout(k.current),k.current=null),(x=f.current)==null||x.close(1e3,"Client cleanup"),f.current=null}},[t.disabled,t.jwt,t.sessionToken,t.wsUrl]),{state:i.useMemo(()=>({byKey:s}),[s]),lastErrorMessage:w}}async function Is(){const t=await vs(()=>bs(()=>ms(()=>xs(()=>js(()=>ws(()=>ks(()=>import("./maplibre-gl-BBv2PdBF-DWCZ6U9J-_rMbz4ag-DmXXnYPx-BuGxjfKb-DvLTmAGD-Bqxog4Jq.js"),__vite__mapDeps([0,1,2]),import.meta.url),qt([0,1,2]),import.meta.url),Zt([0,1,2]),import.meta.url),Yt([0,1,2]),import.meta.url),Xt([0,1,2]),import.meta.url),Qt([0,1,2]),import.meta.url).then(s=>s.m),es([0,1,2]),import.meta.url);return t.default??t}function Cs(t){return t.replace(/[&<>"']/g,s=>{switch(s){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return s}})}function Ts(){return{version:8,sources:{basemap:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png","https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"Â© OpenStreetMap contributors"}},layers:[{id:"basemap",type:"raster",source:"basemap"}]}}function Ms(t){const s=document.createElement("button");return s.type="button",s.setAttribute("aria-label",t.label??"Presence marker"),s.style.width="40px",s.style.height="40px",s.style.borderRadius="999px",s.style.border=`2px solid ${t.color}`,s.style.touchAction="manipulation",s.style.userSelect="none",t.markerType==="spot"?(s.style.background="radial-gradient(circle at 30% 30%, #ff4f60, #a70013)",s.style.display="grid",s.style.placeItems="center",s.style.color="#ffffff",s.style.fontWeight="700",s.style.fontSize="13px",s.textContent=typeof t.markerGlyph=="string"&&t.markerGlyph.trim()?t.markerGlyph.trim().slice(0,2):"SP"):typeof t.imageUrl=="string"&&t.imageUrl.trim()!==""?(s.style.backgroundImage=`url("${t.imageUrl}")`,s.style.backgroundSize="cover",s.style.backgroundPosition="center"):s.style.background="#000000",s.style.padding="0",s.style.cursor=typeof t.onClick=="function"?"pointer":"default",s.style.pointerEvents="auto",s}function Es({initialView:t,markers:s,interactive:a,visible:w}){const u=i.useRef(null),f=i.useRef(null),k=i.useRef(null),y=i.useRef([]),[D,G]=i.useState({kind:"ready"}),Y=i.useMemo(()=>t.center,[t.center]),A=a!==!1,R=w!==!1;return i.useEffect(()=>{let x=!1,o=null,p=null,L=null;async function U(){if(u.current&&!k.current)try{f.current||(f.current=await Is());const b=f.current,j=new b.Map({container:u.current,style:Ts(),center:[Y.lng,Y.lat],zoom:t.zoom,interactive:A});j.addControl(new b.NavigationControl({showCompass:!1}),"top-right"),k.current=j;const C=()=>{j.resize()};p=C,L=window.requestAnimationFrame(C),window.addEventListener("resize",C),o=new ResizeObserver(()=>C()),o.observe(u.current),j.on("error",z=>{var K;const ae=((K=z.error)==null?void 0:K.message)??"Map error.";x||ae.toLowerCase().includes("failed to fetch")||ae.toLowerCase().includes("network")||G({kind:"error",message:ae})}),j.once("load",()=>{x||G({kind:"ready"})})}catch(b){if(x)return;G({kind:"error",message:b instanceof Error?b.message:"Map error."})}}return U(),()=>{var b;x=!0,L!==null&&window.cancelAnimationFrame(L),p&&window.removeEventListener("resize",p),o==null||o.disconnect();for(const j of y.current)j.remove();y.current=[],(b=k.current)==null||b.remove(),k.current=null}},[A]),i.useEffect(()=>{const x=k.current;if(!x||!R)return;x.resize();const o=window.setTimeout(()=>{x.resize(),x.setCenter([t.center.lng,t.center.lat]),x.setZoom(t.zoom)},80);return()=>window.clearTimeout(o)},[t.center.lat,t.center.lng,t.zoom,R]),i.useEffect(()=>{const x=k.current;if(!x||!R)return;x.resize();const o=window.setTimeout(()=>x.resize(),120);return()=>window.clearTimeout(o)},[R]),i.useEffect(()=>{const x=k.current,o=f.current;if(!(!x||!o)){for(const p of y.current)p.remove();y.current=[];for(const p of s){const L=typeof p.label=="string"&&p.label.trim()!==""?new o.Popup({closeButton:!1,closeOnClick:!0}).setHTML(`<div style="font-family: var(--ui); font-size: 12px; line-height: 1.35;">
                 <div style="font-weight: 600;">${Cs(p.label)}</div>
               </div>`):void 0,U=Ms(p);if(typeof p.onClick=="function"){const j=C=>{var z;C.preventDefault(),C.stopPropagation(),(z=p.onClick)==null||z.call(p)};U.addEventListener("click",j),U.addEventListener("touchend",j,{passive:!1}),U.addEventListener("pointerup",j)}const b=new o.Marker({element:U}).setLngLat([p.position.lng,p.position.lat]);L&&b.setPopup(L),b.addTo(x),y.current.push(b)}}},[s]),D.kind==="error"?e.jsxs("div",{style:{background:"#000000",color:"#F22F2F",border:"2px solid #C00000",borderRadius:8,padding:12,fontFamily:"var(--ui)",fontSize:14,lineHeight:1.4},role:"alert","aria-live":"polite",children:["Map error: ",D.message]}):e.jsx("div",{ref:u,className:"rd-maplibre",style:{width:"100%",height:"100%",background:"#000000",borderRadius:8,overflow:"hidden"},"aria-label":"Cruise map"})}const Wt=[Gt,Vt,Jt];function Ps(t){let s=0;for(let a=0;a<t.length;a+=1)s=s*31+t.charCodeAt(a)|0;return Math.abs(s)}function Ns(t){return Wt[Ps(t)%Wt.length]}function As(t,s,a){return t.map(w=>({id:w.key,position:{lat:w.lat,lng:w.lng},color:"#C00000",label:w.status?`Presence: ${w.status}`:"Presence",imageUrl:(s==null?void 0:s[w.key])??Ns(w.key),onClick:a?()=>a(w.key):void 0}))}function Kt({wsUrl:t,sessionToken:s,jwt:a,defaultCenter:w,defaultZoom:u,presenceUpdates:f,realtimeErrorMessage:k,onMarkerSelect:y,avatarByKey:D,additionalMarkers:G,height:Y,visible:A}){const R=ss({wsUrl:t,sessionToken:s,jwt:a,disabled:Array.isArray(f)}),x=f?{byKey:new Map(f.map(z=>[z.key,z]))}:R.state,o=k??R.lastErrorMessage,[p,L]=i.useState({kind:"pending"});i.useEffect(()=>{if(!("geolocation"in navigator)||!navigator.geolocation){L({kind:"unavailable"});return}navigator.geolocation.getCurrentPosition(z=>{L({kind:"granted",center:{lat:z.coords.latitude,lng:z.coords.longitude}})},z=>{if(z.code===z.PERMISSION_DENIED){L({kind:"denied"});return}if(z.code===z.TIMEOUT){L({kind:"error",message:"Timed out while trying to read your location. Showing the default map view."});return}L({kind:"error",message:z.message||"Geolocation error."})},{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e4})},[]);const U=i.useMemo(()=>Array.from(x.byKey.values()),[x.byKey]),b=i.useMemo(()=>[...As(U,D,y),...G??[]],[G,D,y,U]),j=i.useMemo(()=>{const z=typeof u=="number"&&Number.isFinite(u)?u:13;return p.kind==="granted"?{center:p.center,zoom:z}:{center:w,zoom:z}},[w,u,p]),C=i.useMemo(()=>p.kind==="denied"?"Location permission denied. Showing the default map view.":p.kind==="unavailable"?"Geolocation is unavailable. Showing the default map view.":p.kind==="error"?`Geolocation error: ${p.message}`:null,[p]);return e.jsxs("section",{"aria-label":"Cruise mode map",style:{background:"#000000",color:"#FFFFFF",fontFamily:"var(--ui)",display:"grid",gap:8,height:"100%"},children:[C?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"rgba(0,0,0,0.7)",border:"1px solid rgba(255,58,77,0.45)",borderRadius:0,padding:8,color:"#AAAAAA",fontSize:12,lineHeight:1.4},children:C}):null,o?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"rgba(0,0,0,0.7)",border:"1px solid rgba(255,58,77,0.45)",borderRadius:0,padding:8,color:"#F22F2F",fontSize:12,lineHeight:1.4},children:o}):null,e.jsx("div",{style:{background:"#111111",border:0,borderRadius:0,overflow:"hidden",height:typeof Y=="number"||typeof Y=="string"?Y:520},children:e.jsx(Es,{initialView:j,markers:b,visible:A})})]})}const Rs="FIRE_SIGNAL|1";function Ls(t){return new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function _t(t){if(!t.startsWith("LOCATION|"))return null;const[,s,a]=t.split("|"),w=Number(s),u=Number(a);return!Number.isFinite(w)||!Number.isFinite(u)?null:{lat:w,lng:u,link:`https://maps.google.com/?q=${w},${u}`}}function zs(t){return t.trim()===Rs?"ðŸ”¥ I'm into you":t}function is({chatKind:t,peerKey:s,currentUserKey:a,messages:w,client:u,title:f,peerSummary:k,thirdParty:y,edgeToEdge:D,showHeader:G,fillHeight:Y}){const[A,R]=i.useState(""),[x,o]=i.useState(null),[p,L]=i.useState(!1),[U,b]=i.useState({}),[j,C]=i.useState(!1),[z,K]=i.useState(!1),ae=i.useRef(null),V=i.useRef([]),be=i.useRef(null),ue=i.useRef(null),le=i.useRef(null),g=D===!0,S=G!==!1,P=g&&Y===!0,X=i.useMemo(()=>[...w].sort((c,$)=>c.createdAtMs-$.createdAtMs),[w]),M=i.useMemo(()=>Array.from(new Set(X.map(c=>{var $;return($=c.media)==null?void 0:$.objectKey}).filter(c=>typeof c=="string"&&c.trim().length>0))),[X]);i.useEffect(()=>{let c=!1;async function $(){for(const r of M){if(c)return;if(!U[r])try{const v=await u.getMediaUrl(r);if(c)return;b(E=>({...E,[r]:v}))}catch{}}}return $(),()=>{c=!0}},[u,M,U]);async function Q(c){const $=A.trim();if(!($.length===0&&!c)){L(!0),o(null);try{await u.sendMessage(t,s,$,c),R("")}catch(r){const v=r;o(typeof(v==null?void 0:v.message)=="string"?v.message:"Message rejected.")}finally{L(!1)}}}async function pe(c){L(!0),o(null);try{const $=await u.initiateMediaUpload(c.type||"application/octet-stream",c.size);await u.uploadToSignedUrl($.uploadUrl,c,c.type||"application/octet-stream");const r={kind:c.type.startsWith("image/")?"image":c.type.startsWith("video/")?"video":"audio",objectKey:$.objectKey,mimeType:c.type||"application/octet-stream"};await Q(r)}catch($){const r=$;o(typeof(r==null?void 0:r.message)=="string"?r.message:"Upload rejected."),L(!1)}}async function oe(c){var $;const r=($=c.target.files)==null?void 0:$[0];if(c.target.value="",!!r){if(!r.type.startsWith("image/")&&!r.type.startsWith("video/")&&!r.type.startsWith("audio/")){o("Only image, video, or audio files are supported.");return}await pe(r)}}async function se(){var c;if(j){(c=ae.current)==null||c.stop();return}if(!navigator.mediaDevices||typeof navigator.mediaDevices.getUserMedia!="function"){o("Microphone is not available in this browser.");return}try{const $=await navigator.mediaDevices.getUserMedia({audio:!0}),r=new MediaRecorder($);V.current=[],ae.current=r,r.ondataavailable=v=>{v.data.size>0&&V.current.push(v.data)},r.onstop=()=>{const v=new Blob(V.current,{type:r.mimeType||"audio/webm"}),E=new File([v],`voice-${Date.now()}.webm`,{type:r.mimeType||"audio/webm"});pe(E);for(const de of $.getTracks())de.stop();ae.current=null,C(!1)},r.start(),C(!0)}catch($){const r=$;o(typeof(r==null?void 0:r.message)=="string"?r.message:"Unable to record voice."),C(!1)}}async function me(){if(!navigator.geolocation){o("Geolocation is not available in this browser.");return}L(!0),o(null);try{const c=await new Promise((E,de)=>{navigator.geolocation.getCurrentPosition(E,de,{enableHighAccuracy:!1,timeout:12e3,maximumAge:3e4})}),$=Number(c.coords.latitude.toFixed(5)),r=Number(c.coords.longitude.toFixed(5)),v=`LOCATION|${$}|${r}`;await u.sendMessage(t,s,v)}catch(c){const $=c;o(typeof($==null?void 0:$.message)=="string"?$.message:"Unable to send location.")}finally{L(!1)}}return e.jsxs("section",{"aria-label":"Chat",style:{background:g?"transparent":"#000000",color:"#FFFFFF",fontFamily:"Montserrat, sans-serif",padding:g?0:16,display:"grid",gap:g?0:12,gridTemplateRows:S?"auto auto 1fr auto":"1fr auto",minHeight:Y?"calc(100dvh - 196px)":void 0},children:[S?e.jsxs("header",{style:{height:56,display:"grid",alignItems:"center",background:"#000000"},children:[e.jsx("div",{style:{textAlign:"center",fontSize:20,fontWeight:600},children:f}),k?e.jsxs("div",{style:{marginTop:4,display:"flex",alignItems:"center",justifyContent:"center",gap:8,color:"#b7d8e0",fontSize:13},children:[e.jsx("span",{children:"Chat with:"}),k.avatarUrl?e.jsx("img",{src:k.avatarUrl,alt:`${k.displayName} avatar`,style:{width:24,height:24,borderRadius:"50%",objectFit:"cover",border:"1px solid rgba(38,213,255,0.8)"}}):e.jsx("span",{"aria-hidden":!0,style:{width:24,height:24,borderRadius:"50%",border:"1px solid rgba(38,213,255,0.8)",background:"rgba(255,255,255,0.08)"}}),e.jsx("span",{style:{color:"#fff",fontWeight:600},children:k.displayName})]}):null,e.jsx("div",{style:{textAlign:"center",fontSize:12,color:"#AAAAAA"},children:t==="cruise"?"CRUISE CHAT (EPHEMERAL)":"DATE CHAT (PERSISTENT)"})]}):null,x?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"#111111",border:"2px solid #C00000",borderRadius:8,padding:12,color:"#F22F2F",fontSize:14,lineHeight:1.4},children:x}):null,e.jsx("div",{"aria-label":"Messages",style:{background:g?"#09090b":"#111111",border:g?"none":"2px solid #C00000",borderRadius:g?0:8,padding:12,display:"flex",flexDirection:"column",gap:12,minHeight:g?0:320,paddingBottom:P?148:12,overflowY:"auto"},children:X.length===0?e.jsx("div",{style:{color:"#AAAAAA",fontSize:14,lineHeight:1.4},children:"No messages."}):X.map(c=>{const $=c.fromKey===a,r=$?"#C00000":"#444444",v=$?{alignItems:"flex-end"}:{alignItems:"flex-start"};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,width:"100%",...v},children:[(()=>{const E=_t(c.text??"");return E?e.jsxs("a",{href:E.link,target:"_blank",rel:"noreferrer",style:{display:"grid",gap:6,textDecoration:"none",color:"#fff",background:r,borderRadius:14,padding:8,width:"auto",maxWidth:"80%"},children:[e.jsx("div",{style:{fontSize:12,color:"#d8ecff"},children:"Shared location"}),e.jsx("iframe",{title:"Google Maps location preview",src:`https://www.google.com/maps?q=${E.lat},${E.lng}&z=14&output=embed`,style:{width:"100%",height:140,border:"1px solid rgba(255,255,255,0.18)",borderRadius:10},loading:"lazy",referrerPolicy:"no-referrer-when-downgrade"}),e.jsx("div",{style:{fontSize:12,color:"#3fdfff"},children:"Open in Google Maps"})]}):null})(),e.jsxs("div",{style:{background:r,color:"#FFFFFF",borderRadius:18,padding:"8px 12px",width:"auto",maxWidth:"80%",fontSize:16,lineHeight:1.4,whiteSpace:"pre-wrap",overflowWrap:"anywhere",wordBreak:"break-word"},children:[c.text&&!_t(c.text)?e.jsx("div",{style:{marginBottom:c.media?8:0},children:zs(c.text)}):null,c.media?e.jsxs("div",{children:[c.media.kind==="image"?e.jsx("img",{src:U[c.media.objectKey],alt:"Shared",style:{width:"100%",maxWidth:260,borderRadius:10,border:"1px solid rgba(255,255,255,0.18)"}}):null,c.media.kind==="video"?e.jsx("video",{controls:!0,playsInline:!0,src:U[c.media.objectKey],style:{width:"100%",maxWidth:320,borderRadius:10,background:"#000"}}):null,c.media.kind==="audio"?e.jsx("audio",{controls:!0,src:U[c.media.objectKey],style:{width:"100%",maxWidth:260}}):null]}):null]}),e.jsx("div",{style:{fontSize:10,color:"#AAAAAA"},children:Ls(c.createdAtMs)}),$?e.jsx("div",{style:{fontSize:10,color:"#6fdcff"},children:typeof c.readAtMs=="number"?"Read":typeof c.deliveredAtMs=="number"?"Delivered":""}):null]},c.messageId)})}),e.jsxs("form",{onSubmit:c=>{c.preventDefault(),Q()},"aria-label":"Message input",style:{background:g?"linear-gradient(180deg, rgba(96,0,12,0.96), rgba(58,0,8,0.98))":"#111111",border:g?"none":"2px solid #C00000",borderRadius:g?0:8,padding:12,display:"grid",gridTemplateColumns:"1fr auto auto",gap:12,alignItems:"start",position:P?"fixed":"static",left:P?0:void 0,right:P?0:void 0,bottom:P?"calc(env(safe-area-inset-bottom, 0px) + 66px)":void 0,zIndex:P?45:void 0},children:[e.jsx("label",{style:{display:"grid"},children:e.jsx("input",{value:A,onChange:c=>R(c.target.value),placeholder:"Type a message",disabled:p,style:{width:"100%",background:"#111111",color:"#FFFFFF",border:"2px solid #444444",borderRadius:8,padding:"10px 12px",fontSize:16,lineHeight:1.4,outline:"none"},"aria-label":"Message text"})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{ref:be,type:"file",accept:"image/*,video/*,audio/*",disabled:p,onChange:c=>void oe(c),style:{display:"none"}}),e.jsx("input",{ref:ue,type:"file",accept:"image/*",capture:"environment",disabled:p,onChange:c=>void oe(c),style:{display:"none"}}),e.jsx("input",{ref:le,type:"file",accept:"video/*",capture:"environment",disabled:p,onChange:c=>void oe(c),style:{display:"none"}}),e.jsx("button",{type:"button",disabled:p,onClick:()=>K(c=>!c),style:{background:"rgba(0,0,0,0.45)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px",display:"grid",placeItems:"center",cursor:p?"not-allowed":"pointer",color:"#3fdfff",fontWeight:700,height:44,minWidth:44},"aria-label":"More actions",children:"+"}),z?e.jsxs("div",{style:{position:"absolute",right:0,top:P?void 0:48,bottom:P?48:void 0,zIndex:5,minWidth:220,display:"grid",gap:8,padding:10,borderRadius:10,border:"1px solid rgba(255,58,77,0.5)",background:"rgba(10,11,16,0.98)"},children:[e.jsx("button",{type:"button",disabled:p,onClick:()=>{var c;K(!1),(c=ue.current)==null||c.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Take Photo"}),e.jsx("button",{type:"button",disabled:p,onClick:()=>{var c;K(!1),(c=le.current)==null||c.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Record Video"}),e.jsx("button",{type:"button",disabled:p,onClick:()=>{var c;K(!1),(c=be.current)==null||c.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Choose Media"}),e.jsx("button",{type:"button",disabled:p,onClick:()=>{K(!1),se()},style:{background:j?"#ff2136":"rgba(0,0,0,0.6)",color:"#fff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:j?"Stop Voice":"Record Voice"}),e.jsx("button",{type:"button",disabled:p,onClick:()=>{K(!1),me()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Send Location"}),y?e.jsxs("div",{style:{display:"grid",gap:8,borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:8},children:[e.jsxs("select",{value:y.selectedKey,onChange:c=>y.onSelect(c.target.value),disabled:y.disabled||y.candidates.length===0,style:{background:"#0b0d12",color:"#fff",border:"1px solid rgba(255,58,77,0.62)",borderRadius:10,padding:"8px 10px"},"aria-label":"Add previous contact to group",children:[y.candidates.length===0?e.jsx("option",{value:"",children:"No previous contacts"}):null,y.candidates.map(c=>e.jsx("option",{value:c.key,children:c.label},c.key))]}),e.jsx("button",{type:"button",onClick:()=>{y.onAdd(),K(!1)},disabled:y.disabled||y.candidates.length===0||!y.selectedKey,style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,58,77,0.62)",borderRadius:10,padding:"8px 10px",fontWeight:700},children:"Add Third User"})]}):null]}):null]}),e.jsx("button",{type:"submit",disabled:p,style:{background:p?"#333333":"#C00000",color:p?"#777777":"#FFFFFF",border:"2px solid #C00000",borderRadius:8,padding:"10px 20px",fontSize:16,fontWeight:600,cursor:p?"not-allowed":"pointer",height:44},"aria-label":"Send message",children:"SEND"})]})]})}const xt="FIRE_SIGNAL|1";function Re(){return{background:"radial-gradient(500px 220px at 10% 0%, rgba(255,28,46,0.15), transparent 58%), linear-gradient(180deg, rgba(8,8,10,0.88), rgba(4,4,5,0.9))",border:"1px solid rgba(255,56,74,0.56)",borderRadius:20,padding:14,boxShadow:"inset 0 1px 0 rgba(255,255,255,0.06), inset 0 0 0 1px rgba(0,0,0,0.28), 0 16px 32px rgba(0,0,0,0.42)"}}function ve(t){return{background:t?"rgba(90,90,90,0.55)":"linear-gradient(180deg, #ff2136, #c60012)",border:"1px solid rgba(255,70,90,0.68)",color:t?"#999999":"#FFFFFF",padding:"10px 18px",borderRadius:12,fontSize:15,fontWeight:700,letterSpacing:"0.04em",cursor:t?"not-allowed":"pointer",textTransform:"uppercase",boxShadow:t?"none":"inset 0 1px 0 rgba(255,255,255,0.2), 0 10px 22px rgba(198,0,18,0.34)"}}function _(t){return{background:"rgba(0,0,0,0.58)",border:"1px solid rgba(255,58,77,0.62)",color:"#3fdfff",padding:"10px 18px",borderRadius:12,fontSize:15,fontWeight:700,letterSpacing:"0.03em",cursor:t?"not-allowed":"pointer",textTransform:"uppercase",opacity:t?.6:1}}function Z(){return{background:"rgba(6,7,10,0.92)",color:"#ffffff",border:"1px solid rgba(255,64,82,0.48)",borderRadius:12,padding:"10px 12px",fontSize:15}}function Fs(t){return typeof t=="string"}function B(t){const s=t;return Fs(s==null?void 0:s.message)?s.message:"Action rejected."}function ft(){const t="__disabled__".trim();if(t==="__disabled__")return"";if(t!==""){if(t.startsWith("ws://")||t.startsWith("wss://"))return t;try{const a=new URL(t);return a.protocol=a.protocol==="https:"?"wss:":"ws:",a.toString()}catch{if(t.startsWith("/")){const a=new URL(t,window.location.origin);return a.protocol=a.protocol==="https:"?"wss:":"ws:",a.toString()}}}const s=new URL("/ws",window.location.origin);return s.protocol=s.protocol==="https:"?"wss:":"ws:",s.toString()}const Dt=[Gt,Vt,Jt];function Us(t){let s=0;for(let a=0;a<t.length;a+=1)s=s*31+t.charCodeAt(a)|0;return Math.abs(s)}function $e(t){return Dt[Us(t)%Dt.length]}function bt(t){if(t.startsWith("user:")){const s=t.slice(5).trim();return s.length>0?s:null}if(t.startsWith("session:")){const s=t.slice(8).trim();return s.length>0?`guest:${s}`:null}return null}function ze(t){if(t.startsWith("guest:")){const s=t.slice(6).trim();return s?`session:${s}`:`user:${t}`}return`user:${t}`}function Te(t){const s=t.trim();if(!s)return s;if(s.startsWith("user:guest:")){const a=s.slice(11).trim();return a?`session:${a}`:s}if(s.startsWith("guest:")){const a=s.slice(6).trim();return a?`session:${a}`:s}return s}function Os(t){return t.trim()===xt}function ns(t){return Os(t)?"ðŸ”¥ I'm into you":t}function yt(t,s){const a=D=>D*Math.PI/180,w=a(s.lat-t.lat),u=a(s.lng-t.lng),f=Math.sin(w/2),k=Math.sin(u/2),y=f*f+Math.cos(a(t.lat))*Math.cos(a(s.lat))*k*k;return 6371e3*(2*Math.atan2(Math.sqrt(y),Math.sqrt(1-y)))}function Ws(t){return!Number.isFinite(t)||t<0?"-":t<1e3?`${Math.round(t)} m`:t<1e4?`${(t/1e3).toFixed(1)} km`:`${Math.round(t/1e3)} km`}function $t(){try{const t=localStorage.getItem("reddoor_travel_center");if(!t)return null;const s=JSON.parse(t);return s.enabled!==!0?null:typeof s.lat=="number"&&Number.isFinite(s.lat)&&typeof s.lng=="number"&&Number.isFinite(s.lng)?{lat:s.lat,lng:s.lng}:null}catch{return null}}function Ks(){const[t,s]=i.useState(()=>window.matchMedia("(max-width: 900px)").matches);return i.useEffect(()=>{const a=window.matchMedia("(max-width: 900px)"),w=()=>s(a.matches);return w(),a.addEventListener("change",w),()=>a.removeEventListener("change",w)},[]),t}function tt(t){return t==="instant"?"cruise":"date"}function _s({api:t,session:s,settings:a,discoverFilter:w,busy:u,setBusy:f,setLastError:k,isMobile:y,discoverScreen:D,onDiscoverScreenChange:G,onOpenThreadRequested:Y,onUnreadCountChange:A}){var R,x,o,p,L,U;const[b,j]=i.useState(D),[C,z]=i.useState(null),[K,ae]=i.useState(null),[V,be]=i.useState(null),[ue,le]=i.useState([]),[g,S]=i.useState({}),[P,X]=i.useState([]),[M,Q]=i.useState(new Set),[pe,oe]=i.useState(new Set),[se,me]=i.useState({}),[c,$]=i.useState({}),[r,v]=i.useState(null),[E,de]=i.useState(0),[xe,we]=i.useState(!1),[Ie,je]=i.useState([]),[ce,ne]=i.useState(null),[he,Ne]=i.useState(()=>$t()),{state:Pe,lastErrorMessage:Fe}=ss({wsUrl:ft(),sessionToken:s.sessionToken}),We=i.useMemo(()=>Array.from(Pe.byKey.values()),[Pe.byKey]);i.useEffect(()=>{j(D)},[D]),i.useEffect(()=>{const d=()=>{Ne($t())},h=I=>{(I.key===null||I.key==="reddoor_travel_center")&&d()};return d(),window.addEventListener("rd:location-updated",d),window.addEventListener("storage",h),()=>{window.removeEventListener("rd:location-updated",d),window.removeEventListener("storage",h)}},[]);const O=s.userId?`user:${s.userId}`:`session:${s.sessionToken}`,ye=i.useMemo(()=>{const d=new Map;for(const h of ue)d.set(h.key,h);for(const h of We){const I=d.get(h.key);(!I||h.updatedAtMs>=I.updatedAtMs)&&d.set(h.key,h)}return Array.from(d.values())},[We,ue]),Me=i.useMemo(()=>ye.filter(d=>d.key!==O),[O,ye]),ke=i.useMemo(()=>V?[...Me].sort((d,h)=>yt(V,{lat:d.lat,lng:d.lng})-yt(V,{lat:h.lat,lng:h.lng})):Me,[Me,V]),Ue=i.useMemo(()=>{if(!K)return null;if(K===O)return"0 m";if(!V)return null;const d=ye.find(h=>h.key===K);return d?Ws(yt(V,{lat:d.lat,lng:d.lng})):null},[O,ye,K,V]);i.useEffect(()=>{let d=!1;async function h(){try{const H=await t.listActivePresence(s.sessionToken);if(d)return;const ee=Array.isArray(H.presence)?H.presence:[];le(ee)}catch{d||le([])}}h();const I=window.setInterval(()=>{h()},8e3);return()=>{d=!0,window.clearInterval(I)}},[t,s.sessionToken]),i.useEffect(()=>{C||ke.length>0&&z(ke[0].key)},[C,ke]),i.useEffect(()=>{const d=ke.filter(h=>!g[h.key]).map(h=>({key:h.key,profileId:bt(h.key)})).filter(h=>typeof h.profileId=="string");d.length!==0&&Promise.all(d.map(async h=>{var I,H;try{const ee=await t.getPublicProfile(h.profileId);return{key:h.key,displayName:(I=ee.profile)==null?void 0:I.displayName,age:(H=ee.profile)==null?void 0:H.age}}catch{return null}})).then(h=>{S(I=>{const H={...I};for(const ee of h)ee&&(H[ee.key]={displayName:ee.displayName,age:ee.age});return H})})},[t,g,ke]),i.useEffect(()=>{(async()=>{try{let d=await t.getPublicProfiles();if(d.profiles.length===0&&!xe){we(!0);try{const h=V??he??{lat:a.defaultCenterLat,lng:a.defaultCenterLng};await t.seedFakeUsers(12,h.lat,h.lng),d=await t.getPublicProfiles()}catch{}}X(d.profiles)}catch{X([])}if(s.userType==="guest"){Q(new Set),oe(new Set);return}try{const d=await t.getFavorites(s.sessionToken);Q(new Set(d.favorites))}catch{Q(new Set)}try{const d=await t.listBlocked(s.sessionToken);oe(new Set(d.blocked))}catch{oe(new Set)}})()},[t,xe,V,s.sessionToken,s.userType,a.defaultCenterLat,a.defaultCenterLng,he]),i.useEffect(()=>{let d=!1;async function h(){try{const H=await t.listCruisingSpots();d||je(H.spots)}catch{d||je([])}}h();const I=window.setInterval(()=>{h()},12e3);return()=>{d=!0,window.clearInterval(I)}},[t]),i.useEffect(()=>{const d=Date.now(),h=P.flatMap(I=>{const H=[];return I.mainPhotoMediaId&&H.push(I.mainPhotoMediaId),Array.isArray(I.galleryMediaIds)&&H.push(...I.galleryMediaIds),I.videoMediaId&&H.push(I.videoMediaId),H}).filter(I=>typeof I=="string"&&I.length>0&&!se[I]&&d>=(c[I]??0)).slice(0,6);h.length!==0&&Promise.all(h.map(async I=>{try{const H=await t.getPublicMediaUrl(I);return{mediaId:I,url:H.downloadUrl}}catch{return null}})).then(I=>{me(H=>{const ee={...H};for(const te of I)te&&(ee[te.mediaId]=te.url);return ee}),$(H=>{const ee={...H};for(let te=0;te<h.length;te+=1){const ge=h[te];I[te]?ee[ge]&&delete ee[ge]:ee[ge]=Date.now()+3e4}return ee})})},[t,c,se,P]);async function Se(d){ae(d),de(0);const h=bt(d);if(!h){v(null);return}try{if(d===O){const I=await t.getMyProfile(s.sessionToken);typeof I.profile.mainPhotoMediaId=="string"&&I.profile.mainPhotoMediaId;const H=[I.profile.mainPhotoMediaId,...I.profile.galleryMediaIds??[],I.profile.videoMediaId].filter(ee=>typeof ee=="string"&&ee.length>0);if(H.length>0){const ee=await Promise.all(H.map(async te=>{try{const ge=await t.getPublicMediaUrl(te);return{mediaId:te,downloadUrl:ge.downloadUrl}}catch{return null}}));me(te=>{const ge={...te};for(const Ce of ee)Ce&&(ge[Ce.mediaId]=Ce.downloadUrl);return ge})}v({userId:I.profile.userId,displayName:I.profile.displayName,age:I.profile.age,bio:I.profile.bio,stats:I.profile.stats,discreetMode:I.profile.discreetMode,mainPhotoMediaId:I.profile.mainPhotoMediaId,galleryMediaIds:I.profile.galleryMediaIds,videoMediaId:I.profile.videoMediaId})}else{const I=await t.getPublicProfile(h),H=[I.profile.mainPhotoMediaId,...I.profile.galleryMediaIds??[],I.profile.videoMediaId].filter(ee=>typeof ee=="string"&&ee.length>0);if(H.length>0){const ee=await Promise.all(H.map(async te=>{try{const ge=await t.getPublicMediaUrl(te);return{mediaId:te,downloadUrl:ge.downloadUrl}}catch{return null}}));me(te=>{const ge={...te};for(const Ce of ee)Ce&&(ge[Ce.mediaId]=Ce.downloadUrl);return ge})}v(I.profile)}}catch(I){const H=I;if((H==null?void 0:H.code)==="PROFILE_HIDDEN"){ae(null),v(null);return}v(null),k(B(I))}}async function Ke(d){if(s.userType==="guest"){k("Guests cannot star users. Register to save favorites.");return}if(!(!s.userId||s.userId===d))try{const h=await t.toggleFavorite(s.sessionToken,d);Q(new Set(h.favorites))}catch(h){k(B(h))}}async function Be(d){const h=Te(d);if(!(!h||h===O))try{await t.sendChat(s.sessionToken,"cruise",h,xt)}catch(I){k(B(I))}}async function Oe(d){if(!(!d.trim()||d===O)){if(s.userType==="guest"){k("Anonymous users cannot block users.");return}try{pe.has(d)?await t.unblock(s.sessionToken,d):await t.block(s.sessionToken,d);const h=await t.listBlocked(s.sessionToken);oe(new Set(h.blocked))}catch(h){k(B(h))}}}async function Xe(){const d=he??{lat:a.defaultCenterLat,lng:a.defaultCenterLng};if(!navigator.geolocation){be(d);try{await t.updatePresence(s.sessionToken,d.lat,d.lng,"online")}catch{}return}try{const h=await new Promise((I,H)=>{navigator.geolocation.getCurrentPosition(I,H,{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e4})});be({lat:h.coords.latitude,lng:h.coords.longitude}),await t.updatePresence(s.sessionToken,h.coords.latitude,h.coords.longitude,"online")}catch(h){be(d);try{await t.updatePresence(s.sessionToken,d.lat,d.lng,"online")}catch{const I=h&&typeof h=="object"&&"message"in h&&typeof h.message=="string"?h.message:null;k(I??B(h))}}}i.useEffect(()=>{Xe();const d=window.setInterval(()=>{Xe()},3e4);return()=>window.clearInterval(d)},[s.sessionToken]),i.useEffect(()=>{const d=h=>{var I,H;const ee=h,te=(I=ee.detail)==null?void 0:I.lat,ge=(H=ee.detail)==null?void 0:H.lng;!Number.isFinite(te)||!Number.isFinite(ge)||(be({lat:te,lng:ge}),t.updatePresence(s.sessionToken,te,ge,"online").catch(()=>{}))};return window.addEventListener("rd:location-updated",d),()=>window.removeEventListener("rd:location-updated",d)},[t,s.sessionToken]);const Ge=i.useMemo(()=>{if(ye.some(h=>h.key===O))return ye;const d=V??he??{lat:a.defaultCenterLat,lng:a.defaultCenterLng};return[{key:O,userType:s.userType,lat:d.lat,lng:d.lng,status:"online",updatedAtMs:Date.now()},...ye]},[O,ye,V,s.userType,a.defaultCenterLat,a.defaultCenterLng,he]),Ve=i.useMemo(()=>{const d={};for(const h of P){if(!h.mainPhotoMediaId)continue;const I=se[h.mainPhotoMediaId];I&&(d[ze(h.userId)]=I)}return d},[se,P]),st=i.useMemo(()=>Ie.map(d=>({id:`spot:${d.spotId}`,position:{lat:d.lat,lng:d.lng},color:"#26d5ff",markerType:"spot",markerGlyph:"CS",label:`${d.name} | check-ins: ${d.checkInCount??0} | action: ${d.actionCount??0}`,onClick:()=>ne(d.spotId)})),[Ie]),_e=d=>{j(d),G(d)},Je=e.jsx(Kt,{wsUrl:ft(),sessionToken:s.sessionToken,presenceUpdates:Ge,realtimeErrorMessage:Fe,onMarkerSelect:d=>void Se(d),avatarByKey:Ve,additionalMarkers:st,defaultCenter:he??{lat:a.defaultCenterLat,lng:a.defaultCenterLng},height:y?"calc(100vh - 340px)":600,visible:!0}),it=e.jsxs("div",{style:{background:"#000",marginInline:-10},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,padding:"8px 10px",borderBottom:"1px solid rgba(255,58,77,0.25)"},children:[e.jsx("button",{type:"button",style:_(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"reset"}}))},children:"GUYS"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"toggle_favorites"}}))},"aria-label":"Toggle favorites only",children:"â˜…"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"open_filters"}})),_e("chat")},children:"FILTER"})]}),e.jsx(Kt,{wsUrl:ft(),sessionToken:s.sessionToken,presenceUpdates:Ge,realtimeErrorMessage:Fe,onMarkerSelect:d=>void Se(d),avatarByKey:Ve,additionalMarkers:st,defaultCenter:he??{lat:a.defaultCenterLat,lng:a.defaultCenterLng},height:"calc(100dvh - 220px)",visible:b==="map"})]}),qe=e.jsx($s,{api:t,session:s,busy:u,setBusy:f,setLastError:k,onlinePeers:ke,selectedPeerKey:C,setSelectedPeerKey:z,onOpenProfile:d=>void Se(d),isMobile:y,selfCoords:V,peerProfileByKey:g,discoverFilter:w,publicProfiles:P,favorites:M,mediaUrlById:se,onUnreadCountChange:A});return e.jsxs("div",{style:{display:"grid",gap:8},children:[y?e.jsx(e.Fragment,{children:b==="map"?it:qe}):e.jsx("div",{style:{display:"grid",gap:12,alignItems:"start"},children:b==="map"?Je:qe}),K?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:80,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:y?"stretch":"center",padding:y?0:14},role:"dialog","aria-modal":"true","aria-label":"User profile",onClick:()=>ae(null),children:e.jsx("div",{onClick:d=>d.stopPropagation(),style:y?{width:"100%",height:"100dvh",overflow:"auto",background:"linear-gradient(180deg, rgba(7,8,10,0.98), rgba(2,2,4,0.98))",borderRadius:0,border:"none",padding:"calc(env(safe-area-inset-top, 0px) + 56px) 12px calc(env(safe-area-inset-bottom, 0px) + 20px)"}:{...Re(),width:"min(680px, 100%)",maxHeight:"86vh",overflow:"auto"},children:e.jsxs("div",{style:{display:"grid",gap:14},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"106px 1fr auto",gap:12,alignItems:"center"},children:[e.jsxs("div",{style:{position:"relative",width:106,height:106},children:[e.jsx("img",{src:r!=null&&r.mainPhotoMediaId&&se[r.mainPhotoMediaId]?se[r.mainPhotoMediaId]:$e(K),alt:"Profile avatar",style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"cover",border:"2px solid #ff3047"}}),e.jsx("span",{style:{position:"absolute",right:4,bottom:4,width:14,height:14,borderRadius:"50%",background:"#26d5ff",border:"2px solid #000"}})]}),e.jsxs("div",{style:{display:"grid",gap:6},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:(r==null?void 0:r.displayName)??K}),e.jsx("div",{style:{color:"#26d5ff",fontSize:14},children:"Instant Messaging Available"})]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[r&&r.userId!==(s.userId??"")?e.jsx("button",{type:"button",style:{..._(!1),color:"#26d5ff",borderColor:"rgba(38,213,255,0.62)",minWidth:126},onClick:()=>void Ke(r.userId),children:M.has(r.userId)?"â˜… STARRED":"â˜† STAR"}):null,r&&r.userId!==(s.userId??"")?e.jsx("button",{type:"button",style:{..._(!1),color:"#ffb347",borderColor:"rgba(255,179,71,0.65)",minWidth:126},onClick:()=>void Be(ze(r.userId)),children:"ðŸ”¥ FIRE"}):null,r&&r.userId!==(s.userId??"")?e.jsx("button",{type:"button",style:{..._(!1),color:pe.has(ze(r.userId))?"#ff9aa3":"#ffd4d8",borderColor:"rgba(255,120,130,0.62)",minWidth:126},onClick:()=>void Oe(ze(r.userId)),children:pe.has(ze(r.userId))?"UNBLOCK":"BLOCK"}):null,e.jsx("button",{type:"button",style:_(!1),onClick:()=>ae(null),children:"CLOSE"})]})]}),e.jsxs("div",{style:{color:"#ced3dc",fontSize:14,lineHeight:1.5},children:[e.jsxs("div",{children:["Age: ",(r==null?void 0:r.age)??"-"]}),e.jsxs("div",{children:["Distance: ",Ue??"-"]}),e.jsxs("div",{children:["Race: ",((R=r==null?void 0:r.stats)==null?void 0:R.race)??"-"]}),e.jsxs("div",{children:["Height: ",((x=r==null?void 0:r.stats)==null?void 0:x.heightInches)??"-"]}),e.jsxs("div",{children:["Weight: ",((o=r==null?void 0:r.stats)==null?void 0:o.weightLbs)??"-"]}),e.jsxs("div",{children:["Cock Size: ",((p=r==null?void 0:r.stats)==null?void 0:p.cockSizeInches)??"-"]}),e.jsxs("div",{children:["Cut / Uncut: ",((L=r==null?void 0:r.stats)==null?void 0:L.cutStatus)??"-"]}),e.jsxs("div",{children:["Position: ",((U=r==null?void 0:r.stats)==null?void 0:U.position)??"-"]}),e.jsxs("div",{style:{marginTop:8},children:["Bio: ",(r==null?void 0:r.bio)??"-"]})]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"MEDIA"}),r?e.jsx(e.Fragment,{children:(()=>{const d=[r.mainPhotoMediaId,...r.galleryMediaIds??[],r.videoMediaId].filter(te=>typeof te=="string"&&te.length>0);if(d.length===0)return e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No uploaded media."});const h=Math.max(0,Math.min(E,d.length-1)),I=d[h],H=se[I],ee=I===r.videoMediaId;return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.4)",borderRadius:12,padding:8},children:ee?e.jsx("video",{controls:!0,playsInline:!0,src:H,style:{width:"100%",maxHeight:260,borderRadius:10,background:"#000"}}):e.jsx("img",{src:H??$e(K??r.userId),alt:"Profile media",style:{width:"100%",maxHeight:260,objectFit:"cover",borderRadius:10}})}),e.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:d.map((te,ge)=>{const Ce=se[te],Qe=te===r.videoMediaId;return e.jsx("button",{type:"button",onClick:()=>de(ge),style:{width:64,height:64,padding:0,borderRadius:8,overflow:"hidden",border:ge===h?"2px solid #26d5ff":"1px solid rgba(255,58,77,0.4)",background:"#000",cursor:"pointer",color:"#fff",fontSize:10},"aria-label":Qe?"Open video":"Open photo",children:Qe?e.jsx("div",{style:{display:"grid",placeItems:"center",width:"100%",height:"100%"},children:Ce?e.jsx("video",{src:Ce,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}):"VIDEO"}):e.jsx("img",{src:Ce??$e(K??r.userId),alt:"Media thumbnail",style:{width:"100%",height:"100%",objectFit:"cover"}})},te)})})]})})()}):null]}),e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:e.jsx("button",{type:"button",style:ve(!1),onClick:()=>{K&&Y(K),ae(null),de(0)},children:"CHAT"})})]})})}):null,ce?e.jsx(Ds,{api:t,session:s,spot:Ie.find(d=>d.spotId===ce)??null,onClose:()=>ne(null),onUpdated:async()=>{try{const d=await t.listCruisingSpots();je(d.spots)}catch{}},setLastError:k}):null]})}function Ds({api:t,session:s,spot:a,onClose:w,onUpdated:u,setLastError:f}){return a?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},role:"dialog","aria-modal":"true","aria-label":"Cruising spot",onClick:w,children:e.jsxs("div",{onClick:k=>k.stopPropagation(),style:{...Re(),width:"min(520px, 100%)",display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:a.name}),e.jsx("div",{style:{color:"#9fb6bf",fontSize:13},children:a.address}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap"},children:a.description}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:13},children:["Check-ins: ",a.checkInCount??0," | I got action there: ",a.actionCount??0]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:ve(!1),onClick:async()=>{try{await t.checkInCruisingSpot(s.sessionToken,a.spotId),await u()}catch(k){f(B(k))}},children:"CHECK IN"}),e.jsx("button",{type:"button",style:_(!1),onClick:async()=>{try{await t.markCruisingSpotAction(s.sessionToken,a.spotId),await u()}catch(k){f(B(k))}},children:"I GOT ACTION THERE"}),e.jsx("button",{type:"button",style:_(!1),onClick:w,children:"CLOSE"})]})]})}):null}function $s({api:t,session:s,busy:a,setBusy:w,setLastError:u,onlinePeers:f,selectedPeerKey:k,setSelectedPeerKey:y,onOpenProfile:D,openThreadRequest:G,onThreadRequestConsumed:Y,isMobile:A,selfCoords:R,peerProfileByKey:x,discoverFilter:o,publicProfiles:p,favorites:L,mediaUrlById:U,onUnreadCountChange:b}){var j;const[C,z]=i.useState({}),[K,ae]=i.useState({}),[V,be]=i.useState("instant"),[ue,le]=i.useState("grid"),[g,S]=i.useState(null),[P,X]=i.useState(""),[M,Q]=i.useState(null),[pe,oe]=i.useState([]),[se,me]=i.useState({}),[c,$]=i.useState(null),[r,v]=i.useState({}),[E,de]=i.useState({}),[xe,we]=i.useState(!1),[Ie,je]=i.useState(""),[ce,ne]=i.useState(null),he=i.useRef(!1),Ne=i.useRef(!1),Pe=i.useRef(0),Fe=i.useRef(null),We=i.useRef(null),O=i.useRef(null),ye=i.useRef(null),Me=i.useRef(null),ke=i.useRef(0),Ue=i.useRef(new Set),Se=i.useRef(null),Ke=i.useRef(null),Be=i.useRef(null),[Oe,Xe]=i.useState(null),[Ge,Ve]=i.useState(o==="favorites"),[st,_e]=i.useState(!1),[Je,it]=i.useState(o==="online"?"online":"all"),[qe,d]=i.useState(!1),[h,I]=i.useState(""),[H,ee]=i.useState(""),[te,ge]=i.useState(""),[Ce,Qe]=i.useState(""),[nt,jt]=i.useState(""),[rt,wt]=i.useState(""),[at,kt]=i.useState(""),[lt,St]=i.useState(""),[ot,It]=i.useState(""),[dt,Ct]=i.useState(""),[ct,Tt]=i.useState(""),Ee=s.userId?`user:${s.userId}`:`session:${s.sessionToken}`,re=g??k??"",rs=re?C[re]??[]:[],Mt=i.useMemo(()=>new Map(f.map(n=>[n.key,n])),[f]),Le=i.useMemo(()=>{const n={};for(const l of p)typeof l.displayName=="string"&&l.displayName.trim()&&(n[ze(l.userId)]=l.displayName);for(const[l,m]of Object.entries(x))typeof m.displayName=="string"&&m.displayName.trim()&&(n[l]=m.displayName);return n},[x,p]),Et=i.useMemo(()=>p.filter(n=>n.userId!==(s.userId??"")).map(n=>{const l=ze(n.userId),m=Mt.get(l);return{key:l,userId:n.userId,displayName:n.displayName,age:n.age,stats:n.stats,meters:m&&R?Math.round(yt(R,{lat:m.lat,lng:m.lng})):null,isOnline:!!m,hasPicture:typeof n.mainPhotoMediaId=="string"&&n.mainPhotoMediaId.trim().length>0,avatarUrl:n.mainPhotoMediaId?U[n.mainPhotoMediaId]:void 0}}),[U,Mt,p,R,s.userId]),Ze=i.useMemo(()=>{const n=h.trim()?Number(h):void 0,l=H.trim()?Number(H):void 0,m=Ce.trim()?Number(Ce):void 0,N=nt.trim()?Number(nt):void 0,T=rt.trim()?Number(rt):void 0,q=at.trim()?Number(at):void 0,ie=lt.trim()?Number(lt):void 0,W=ot.trim()?Number(ot):void 0;return Et.filter(F=>{var J,fe,Ae,He,gt,De,Ft,Ut,Ot;if(Ge&&!L.has(F.userId)||Je==="online"&&!F.isOnline||Je==="offline"&&F.isOnline||qe&&!F.hasPicture||Number.isFinite(n)&&(typeof F.age!="number"||F.age<n)||Number.isFinite(l)&&(typeof F.age!="number"||F.age>l))return!1;const hs=typeof((J=F.stats)==null?void 0:J.race)=="string"?F.stats.race:"";return!(te.trim()&&hs.toLowerCase()!==te.trim().toLowerCase()||Number.isFinite(m)&&(typeof((fe=F.stats)==null?void 0:fe.heightInches)!="number"||F.stats.heightInches<m)||Number.isFinite(N)&&(typeof((Ae=F.stats)==null?void 0:Ae.heightInches)!="number"||F.stats.heightInches>N)||Number.isFinite(T)&&(typeof((He=F.stats)==null?void 0:He.weightLbs)!="number"||F.stats.weightLbs<T)||Number.isFinite(q)&&(typeof((gt=F.stats)==null?void 0:gt.weightLbs)!="number"||F.stats.weightLbs>q)||Number.isFinite(ie)&&(typeof((De=F.stats)==null?void 0:De.cockSizeInches)!="number"||F.stats.cockSizeInches<ie)||Number.isFinite(W)&&(typeof((Ft=F.stats)==null?void 0:Ft.cockSizeInches)!="number"||F.stats.cockSizeInches>W)||dt&&((Ut=F.stats)==null?void 0:Ut.cutStatus)!==dt||ct&&((Ot=F.stats)==null?void 0:Ot.position)!==ct)})},[Et,L,Ge,dt,H,ot,nt,at,h,lt,Ce,rt,ct,te,qe,Je]),ut=i.useMemo(()=>Array.from(new Set(Ze.map(n=>n.key).filter(n=>n.trim().length>0))).slice(0,8),[Ze]),Pt=ut.join("|"),pt=i.useMemo(()=>{const n=new Set(Object.keys(K));return re.trim()&&n.add(re),Array.from(n).sort((l,m)=>{var N,T;return(((N=K[m])==null?void 0:N.lastAt)??0)-(((T=K[l])==null?void 0:T.lastAt)??0)})},[K,re]),Nt=i.useMemo(()=>Object.values(r).reduce((n,l)=>n+(Number.isFinite(l)?l:0),0),[r]);i.useMemo(()=>{var n;return re?Le[re]??((n=x[re])==null?void 0:n.displayName)??re:""},[Le,re,x]);const as=i.useMemo(()=>{if(!re)return;const n=Ze.find(l=>l.key===re);return n==null?void 0:n.avatarUrl},[Ze,re]),Ye=i.useMemo(()=>pt.filter(n=>n!==re&&n!==Ee&&!!K[n]).map(n=>{var l;return{key:n,label:Le[n]??((l=x[n])==null?void 0:l.displayName)??n}}),[pt,K,Le,Ee,re,x]);i.useEffect(()=>{typeof b=="function"&&b(Nt)},[b,Nt]),i.useEffect(()=>{const n=Fe.current;n&&(n.srcObject=ce)},[ce]),i.useEffect(()=>{const n=We.current;n&&(n.srcObject=Oe)},[Oe]),i.useEffect(()=>()=>{if(ce){for(const n of ce.getTracks())n.stop();if(Oe)for(const n of Oe.getTracks())n.stop();Se.current&&(Se.current.close(),Se.current=null)}},[ce,Oe]),i.useEffect(()=>{if(Ye.length===0){X("");return}X(n=>n&&Ye.some(l=>l.key===n)?n:Ye[0].key)},[Ye]);const ls=i.useMemo(()=>({async sendMessage(n,l,m,N){const T=Te(l),q=await t.sendChat(s.sessionToken,n,T,m,N),ie=q==null?void 0:q.message,W=[ie];if(n==="cruise"&&M)try{const F=await t.sendChat(s.sessionToken,n,Te(M),m,N),J=F==null?void 0:F.message;W.push(J)}catch(F){u(B(F))}for(const F of W)At(F);return ie},async initiateMediaUpload(n,l){const m=await t.initiateChatMediaUpload(s.sessionToken,{mimeType:n,sizeBytes:l});return{objectKey:m.objectKey,uploadUrl:m.uploadUrl}},async uploadToSignedUrl(n,l,m){if(!await mt(n,l,m)&&!(await fetch(n,{method:"PUT",headers:{"content-type":m},body:l})).ok)throw{code:"MEDIA_UPLOAD_INCOMPLETE",message:"Upload failed."}},async getMediaUrl(n){return(await t.getChatMediaUrl(s.sessionToken,n)).downloadUrl}}),[t,Ee,s.sessionToken,u,M]);function et(n){var l,m,N;return n.text&&n.text.trim()?ns(n.text):((l=n.media)==null?void 0:l.kind)==="image"?"[Photo]":((m=n.media)==null?void 0:m.kind)==="video"?"[Video]":((N=n.media)==null?void 0:N.kind)==="audio"?"[Voice]":""}function os(n){if(!n||Ue.current.has(n))return!1;if(Ue.current.add(n),Ue.current.size>5e3){const l=Array.from(Ue.current).slice(-2500);Ue.current=new Set(l)}return!0}function ds(n,l){var m;const N=Le[l]??((m=x[l])==null?void 0:m.displayName)??l,T=et(n)||"New activity";if("Notification"in window){if(Notification.permission==="granted"){try{new Notification(`${N}`,{body:T})}catch{}return}Notification.permission==="default"&&Notification.requestPermission()}}function cs(n){if(!n.startsWith("GROUP_INVITE_REQUEST|"))return null;const[,l,m,N]=n.split("|");return!l||!m||!N?null:{inviteId:l,inviterKey:m,primaryPeerKey:N}}function us(n){if(!n.startsWith("GROUP_INVITE_ACCEPT|"))return null;const[,l,m]=n.split("|");return!l||!m?null:{inviteId:l,candidateKey:m}}function At(n){if(!os(n.messageId))return;const l=n.fromKey===Ee?n.toKey:n.fromKey;z(T=>{const q=T[l]??[];return q.some(ie=>ie.messageId===n.messageId)?T:{...T,[l]:[...q,n].sort((ie,W)=>ie.createdAtMs-W.createdAtMs)}}),ae(T=>({...T,[l]:{lastAt:n.createdAtMs,lastText:et(n)}})),n.fromKey!==Ee&&(ue==="thread"&&Te(re)===Te(l)?(de(T=>({...T,[l]:Math.max(T[l]??0,n.createdAtMs)})),v(T=>{const q={...T};return delete q[l],q})):v(T=>({...T,[l]:(T[l]??0)+1})),ds(n,l));const m=cs(n.text??"");m&&n.toKey===Ee&&oe(T=>T.some(q=>q.inviteId===m.inviteId)?T:[...T,{...m,createdAtMs:n.createdAtMs}]);const N=us(n.text??"");N&&n.toKey===Ee&&se[N.inviteId]&&(Q(Te(N.candidateKey)),$(`Invite accepted by ${Le[N.candidateKey]??N.candidateKey}.`),me(T=>{const q={...T};return delete q[N.inviteId],q}))}async function ps(n){const l=Te(n);if(l)try{const m=await t.listChat(s.sessionToken,tt(V),l),N=m==null?void 0:m.messages,T=Array.isArray(N)?N:[];t.markChatRead(s.sessionToken,tt(V),l).catch(()=>{}),z(W=>({...W,[l]:T}));const q=T.length>0?T[T.length-1]:null;q&&ae(W=>({...W,[l]:{lastAt:q.createdAtMs,lastText:et(q)}}));let ie=0;for(const W of T)W.fromKey===l&&W.createdAtMs>ie&&(ie=W.createdAtMs);ie>0&&de(W=>({...W,[l]:Math.max(W[l]??0,ie)}))}catch(m){u(B(m))}}i.useEffect(()=>{if(ue!=="thread"||!re.trim())return;let n=!1,l=!1,m=null;const N=async()=>{if(!(n||l)){l=!0;try{await ps(re)}finally{l=!1}n||(m=window.setTimeout(()=>{N()},1200))}};return N(),()=>{n=!0,m!==null&&window.clearTimeout(m)}},[V,re,ue]),i.useEffect(()=>{if(ue!=="grid")return;if(ut.length===0){v({});return}let n=!1;async function l(){if(!he.current&&!document.hidden){he.current=!0;try{const T=tt(V),q=[],ie=[];for(const F of ut){if(n)break;try{const J=Te(F);if(!J)continue;const fe=await t.listChat(s.sessionToken,T,J),Ae=(fe==null?void 0:fe.messages)??[];if(Ae.length>0){const De=Ae[Ae.length-1];ie.push([J,{lastAt:De.createdAtMs,lastText:et(De)}])}let He=0;const gt=E[J]??0;for(const De of Ae)De.fromKey===J&&De.createdAtMs>gt&&(He+=1);q.push([J,He])}catch{const J=Te(F);J&&q.push([J,0])}}if(n)return;ie.length>0&&ae(F=>{const J={...F};for(const[fe,Ae]of ie)J[fe]=Ae;return J});const W={};for(const[F,J]of q)J>0&&(W[F]=J);v(W)}finally{he.current=!1}}}const m=window.setTimeout(()=>{l()},1200),N=window.setInterval(()=>{l()},15e3);return()=>{n=!0,he.current=!1,window.clearTimeout(m),window.clearInterval(N)}},[t,V,E,s.sessionToken,Pt,ue]),i.useEffect(()=>{const n=Array.from(new Set([...pt,...ut,re].map(q=>Te(q)).filter(q=>q.length>0))).slice(0,10);if(n.length===0)return;let l=!1;const m=async()=>{if(!(l||document.hidden||Ne.current)){Ne.current=!0;try{const q=tt(V),ie=[];for(const W of n){if(l)break;try{const F=await t.listChat(s.sessionToken,q,W),J=(F==null?void 0:F.messages)??[];if(J.length===0)continue;const fe=J[J.length-1];ie.push([W,{lastAt:fe.createdAtMs,lastText:et(fe)}])}catch{}}if(l||ie.length===0)return;ae(W=>{const F={...W};for(const[J,fe]of ie)F[J]=fe;return F})}finally{Ne.current=!1}}},N=window.setTimeout(()=>{m()},1e3),T=window.setInterval(()=>{m()},5e3);return()=>{l=!0,window.clearTimeout(N),window.clearInterval(T)}},[t,V,pt,re,s.sessionToken,Pt]);async function gs(){if(ce)return ce;if(!navigator.mediaDevices||typeof navigator.mediaDevices.getUserMedia!="function")throw{code:"UNAUTHORIZED_ACTION",message:"Camera access is not available in this browser."};const n=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});return ne(n),n}function fs(n,l){Se.current&&(Se.current.close(),Se.current=null);const m=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});return Se.current=m,Ke.current=l,Be.current=n,m.ontrack=N=>{const T=N.streams[0];T&&Xe(T)},m.onicecandidate=N=>{const T=N.candidate;if(!T)return;const q=Be.current,ie=Ke.current;!q||!ie||t.sendCallSignal(s.sessionToken,{toKey:q,callId:ie,signalType:"ice",candidate:JSON.stringify(T.toJSON())}).catch(()=>{})},m}async function Rt(n=!0){const l=Be.current,m=Ke.current;if(n&&l&&m)try{await t.sendCallSignal(s.sessionToken,{toKey:l,callId:m,signalType:"hangup"})}catch{}if(ce)for(const N of ce.getTracks())N.stop();if(Oe)for(const N of Oe.getTracks())N.stop();ne(null),Xe(null),Se.current&&(Se.current.close(),Se.current=null),Ke.current=null,Be.current=null,we(!1)}i.useEffect(()=>{let n=!1;const l=ft();if(!l)return;const m=()=>{ye.current!==null&&(window.clearInterval(ye.current),ye.current=null),Me.current!==null&&(window.clearTimeout(Me.current),Me.current=null)},N=()=>{if(n)return;const T=new WebSocket(l);O.current=T,T.onopen=()=>{ke.current=0,T.send(JSON.stringify({type:"auth",payload:{sessionToken:s.sessionToken}})),ye.current=window.setInterval(()=>{T.readyState===T.OPEN&&T.send(JSON.stringify({type:"heartbeat",payload:{}}))},15e3)},T.onmessage=q=>{let ie=null;try{ie=JSON.parse(String(q.data))}catch{return}if(!ie||typeof ie.type!="string")return;if(ie.type==="chat_message"){const J=ie.payload,fe=J==null?void 0:J.message;if(!fe||fe.fromKey!==Ee&&fe.toKey!==Ee)return;At(fe);return}if(ie.type!=="call_signal")return;const W=ie.payload;if(!W||W.toKey!==Ee||typeof W.fromKey!="string"||!W.callId||!W.signalType)return;const F=Te(W.fromKey);if(W.signalType==="hangup"){Rt(!1);return}if(W.signalType==="offer"){(async()=>{try{ht(F),je(F);const J=await gs(),fe=fs(F,W.callId);for(const He of J.getTracks())fe.addTrack(He,J);await fe.setRemoteDescription({type:"offer",sdp:W.sdp??""});const Ae=await fe.createAnswer();await fe.setLocalDescription(Ae),await t.sendCallSignal(s.sessionToken,{toKey:F,callId:W.callId,signalType:"answer",sdp:Ae.sdp??""}),we(!0)}catch(J){u(B(J))}})();return}if(W.signalType==="answer"){(async()=>{try{if(!Se.current||Ke.current!==W.callId)return;await Se.current.setRemoteDescription({type:"answer",sdp:W.sdp??""})}catch(J){u(B(J))}})();return}W.signalType==="ice"&&(async()=>{try{if(!Se.current||Ke.current!==W.callId||!W.candidate)return;const J=JSON.parse(W.candidate);await Se.current.addIceCandidate(J)}catch{}})()},T.onclose=()=>{if(m(),n)return;ke.current+=1;const q=Math.min(8e3,500*2**Math.min(ke.current,4));Me.current=window.setTimeout(N,q)},T.onerror=()=>{}};return N(),()=>{var T;n=!0,m(),(T=O.current)==null||T.close(1e3,"chat cleanup"),O.current=null}},[t,Ee,s.sessionToken]);async function ys(){if(P.trim()){if(!re.trim()){u("Select a user first.");return}try{const n=Te(P);if(!n)return;if(!Ye.some(m=>m.key===n)){u("You can only add a third user you have previously messaged.");return}const l=crypto.randomUUID();await t.sendChat(s.sessionToken,"cruise",n,`GROUP_INVITE_REQUEST|${l}|${Ee}|${re.trim()}`),me(m=>({...m,[l]:{candidateKey:n,primaryPeerKey:re.trim()}})),$(`Invite sent to ${Le[n]??n}. Waiting for acceptance.`)}catch(n){u(B(n))}}}async function Lt(n,l,m){try{await t.sendChat(s.sessionToken,"cruise",l,`GROUP_INVITE_ACCEPT|${n}|${Ee}`),oe(N=>N.filter(T=>T.inviteId!==n)),$("Group invite accepted."),ht(m)}catch(N){u(B(N))}}function zt(n){oe(l=>l.filter(m=>m.inviteId!==n))}function ht(n){const l=Te(n);y(l),S(l),v(m=>{const N={...m};return delete N[l],N}),de(m=>({...m,[l]:Date.now()})),le("thread")}function vt(){Ve(!1),it("all"),d(!1),I(""),ee(""),ge(""),Qe(""),jt(""),wt(""),kt(""),St(""),It(""),Ct(""),Tt(""),_e(!1)}if(i.useEffect(()=>{const n=l=>{var m;const N=(m=l.detail)==null?void 0:m.action;if(N==="reset"){vt(),le("grid");return}if(N==="toggle_favorites"){Ve(T=>!T),le("grid");return}N==="open_filters"&&(_e(!0),le("grid"))};return window.addEventListener("rd:discover-control",n),()=>window.removeEventListener("rd:discover-control",n)},[]),i.useEffect(()=>{G&&G.nonce!==Pe.current&&(Pe.current=G.nonce,ht(G.key),typeof Y=="function"&&Y())},[Y,G]),i.useEffect(()=>{const n=l=>{var m;((m=l.detail)==null?void 0:m.tab)==="discover"&&(le("grid"),S(null),_e(!1))};return window.addEventListener("rd:tab-select",n),()=>window.removeEventListener("rd:tab-select",n)},[]),ue==="thread"&&re.trim()){const n=Le[re]??((j=x[re])==null?void 0:j.displayName)??re;return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:A?-10:0},children:[pe.length>0?e.jsxs("div",{style:{...Re(),display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"INVITE REQUESTS"}),pe.map(l=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,alignItems:"center"},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:13},children:[Le[l.inviterKey]??l.inviterKey," invited you to join a conversation."]}),e.jsx("button",{type:"button",style:ve(!1),onClick:()=>void Lt(l.inviteId,l.inviterKey,l.primaryPeerKey),children:"ACCEPT"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>zt(l.inviteId),children:"DECLINE"})]},l.inviteId))]}):null,c?e.jsx("div",{style:{color:"#26d5ff",fontSize:12},children:c}):null,e.jsx(is,{chatKind:tt(V),peerKey:re,currentUserKey:Ee,messages:rs,client:ls,title:`INSTANT THREAD: ${n}`,peerSummary:{displayName:n,avatarUrl:as},thirdParty:{candidates:Ye,selectedKey:P,onSelect:l=>X(l),onAdd:()=>void ys(),disabled:a},showHeader:!1,edgeToEdge:A,fillHeight:A}),xe?e.jsx("div",{role:"dialog","aria-modal":"true","aria-label":"Video call",style:{position:"fixed",inset:0,zIndex:60,background:"rgba(0,0,0,0.82)",display:"grid",placeItems:"center",padding:16},children:e.jsxs("div",{style:{...Re(),width:"min(720px, 100%)",display:"grid",gap:10},children:[e.jsxs("div",{style:{fontSize:18,fontWeight:700},children:["VIDEO CALL: ",Ie]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("video",{ref:Fe,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"100%",maxHeight:"52vh",borderRadius:12,background:"#000"}}),e.jsx("video",{ref:We,autoPlay:!0,playsInline:!0,style:{width:"100%",maxHeight:"52vh",borderRadius:12,background:"#000"}})]}),e.jsx("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:e.jsx("button",{type:"button",style:_(!1),onClick:()=>void Rt(),children:"END CALL"})})]})}):null]})}return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:A?-10:0},children:[pe.length>0?e.jsxs("div",{style:{...Re(),display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"INVITE REQUESTS"}),pe.map(n=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,alignItems:"center"},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:13},children:[Le[n.inviterKey]??n.inviterKey," invited you to join a conversation."]}),e.jsx("button",{type:"button",style:ve(!1),onClick:()=>void Lt(n.inviteId,n.inviterKey,n.primaryPeerKey),children:"ACCEPT"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>zt(n.inviteId),children:"DECLINE"})]},n.inviteId))]}):null,c?e.jsx("div",{style:{color:"#26d5ff",fontSize:12},children:c}):null,e.jsx("div",{style:{padding:10,borderBottom:"1px solid rgba(255,58,77,0.28)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8},children:[e.jsx("button",{type:"button",style:_(!1),onClick:vt,children:"GUYS"}),e.jsx("button",{type:"button",style:Ge?ve(!1):_(!1),onClick:()=>Ve(n=>!n),"aria-label":"Toggle favorites only",children:"â˜…"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>_e(!0),children:"FILTER"})]})}),st?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},role:"dialog","aria-modal":"true","aria-label":"Discover filters",onClick:()=>_e(!1),children:e.jsx("div",{onClick:n=>n.stopPropagation(),style:{...Re(),width:"min(760px, 100%)",maxHeight:"86vh",overflow:"auto"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"FILTER USERS"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{type:"checkbox",checked:qe,onChange:n=>d(n.target.checked)}),"Has pictures"]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Online status"}),e.jsxs("select",{style:Z(),value:Je,onChange:n=>it(n.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"offline",children:"Offline"})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[e.jsx("input",{style:Z(),placeholder:"Min age",value:h,onChange:n=>I(n.target.value)}),e.jsx("input",{style:Z(),placeholder:"Max age",value:H,onChange:n=>ee(n.target.value)}),e.jsx("input",{style:Z(),placeholder:"Race",value:te,onChange:n=>ge(n.target.value)}),e.jsxs("select",{style:Z(),value:dt,onChange:n=>Ct(n.target.value),children:[e.jsx("option",{value:"",children:"Cut / Uncut"}),e.jsx("option",{value:"cut",children:"Cut"}),e.jsx("option",{value:"uncut",children:"Uncut"})]}),e.jsx("input",{style:Z(),placeholder:"Min height (in)",value:Ce,onChange:n=>Qe(n.target.value)}),e.jsx("input",{style:Z(),placeholder:"Max height (in)",value:nt,onChange:n=>jt(n.target.value)}),e.jsx("input",{style:Z(),placeholder:"Min weight (lbs)",value:rt,onChange:n=>wt(n.target.value)}),e.jsx("input",{style:Z(),placeholder:"Max weight (lbs)",value:at,onChange:n=>kt(n.target.value)}),e.jsx("input",{style:Z(),placeholder:"Min cock size (in)",value:lt,onChange:n=>St(n.target.value)}),e.jsx("input",{style:Z(),placeholder:"Max cock size (in)",value:ot,onChange:n=>It(n.target.value)}),e.jsxs("select",{style:Z(),value:ct,onChange:n=>Tt(n.target.value),children:[e.jsx("option",{value:"",children:"Position"}),e.jsx("option",{value:"top",children:"Top"}),e.jsx("option",{value:"bottom",children:"Bottom"}),e.jsx("option",{value:"side",children:"Side"})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:_(!1),onClick:vt,children:"RESET"}),e.jsx("button",{type:"button",style:ve(!1),onClick:()=>_e(!1),children:"DONE"})]})]})})}):null,e.jsx("div",{style:{display:"grid",gap:0},children:e.jsx("div",{style:{display:"grid",gap:0,gridTemplateColumns:"repeat(3, minmax(0, 1fr))"},children:Ze.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:13,padding:12,gridColumn:"1 / -1"},children:"No users match current filters."}):Ze.map(n=>e.jsx("button",{type:"button",onClick:()=>D(n.key),style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:0,display:"grid",gap:0,color:"#fff",cursor:"pointer"},children:e.jsxs("div",{style:{position:"relative",width:"100%",aspectRatio:"1 / 1"},children:[e.jsx("img",{src:n.avatarUrl??$e(n.key),alt:"User avatar",style:{width:"100%",height:"100%",borderRadius:0,objectFit:"cover",border:"1px solid #0fd9ff"}}),n.isOnline?e.jsx("span",{style:{position:"absolute",top:4,left:4,width:10,height:10,borderRadius:"50%",background:"#26d5ff",border:"2px solid #000"}}):null]})},n.key))})})]})}function Hs({api:t,session:s,setLastError:a,openThreadRequest:w,onThreadRequestConsumed:u,isMobile:f}){var k,y,D,G,Y,A;const[R,x]=i.useState([]),[o,p]=i.useState(null),[L,U]=i.useState([]),[b,j]=i.useState("messages"),[C,z]=i.useState(null),[K,ae]=i.useState(!1),[V,be]=i.useState(""),[ue,le]=i.useState(null),[g,S]=i.useState({}),[P,X]=i.useState(null),M=s.userId?`user:${s.userId}`:`session:${s.sessionToken}`,Q="cruise",pe=i.useMemo(()=>R.filter(r=>r.key!==o).map(r=>({key:r.key,label:r.displayName})),[R,o]),oe=i.useMemo(()=>R.find(r=>r.key===o)??null,[R,o]);i.useEffect(()=>{if(pe.length===0){be("");return}be(r=>r&&pe.some(v=>v.key===r)?r:pe[0].key)},[pe]),i.useEffect(()=>{let r=!1;async function v(){var de,xe,we;try{const Ie=s.userId?`user:${s.userId}`:`session:${s.sessionToken}`,[je,ce]=await Promise.all([t.getPublicProfiles(),t.listActivePresence(s.sessionToken)]),ne={},he={};for(const O of je.profiles)ne[ze(O.userId)]=O.displayName,typeof O.mainPhotoMediaId=="string"&&O.mainPhotoMediaId.trim()!==""&&(he[ze(O.userId)]=O.mainPhotoMediaId);const Ne=Array.from(new Set([...je.profiles.map(O=>ze(O.userId)),...ce.presence.map(O=>Te(O.key))].filter(O=>O&&O!==Ie))).slice(0,24),Pe=[];for(const O of Ne)try{const ye=await t.listChat(s.sessionToken,"cruise",O),Me=(ye==null?void 0:ye.messages)??[];if(!Array.isArray(Me)||Me.length===0)continue;const ke=Me[Me.length-1],Ue=typeof ke.text=="string"&&ke.text.trim().length>0?ns(ke.text):((de=ke.media)==null?void 0:de.kind)==="image"?"[Photo]":((xe=ke.media)==null?void 0:xe.kind)==="video"?"[Video]":((we=ke.media)==null?void 0:we.kind)==="audio"?"[Voice]":"";Pe.push({key:O,displayName:ne[O]??O,preview:Ue,at:ke.createdAtMs})}catch{}const Fe=await Promise.all(Pe.map(async O=>{const ye=he[O.key];if(!ye)return null;try{const Me=await t.getPublicMediaUrl(ye);return{key:O.key,url:Me.downloadUrl}}catch{return null}})),We={};for(const O of Fe)O&&(We[O.key]=O.url);for(const O of Pe)O.avatarUrl=We[O.key];if(r)return;Pe.sort((O,ye)=>ye.at-O.at),x(Pe)}catch(Ie){r||a(B(Ie))}}v();const E=window.setInterval(()=>{v()},1e4);return()=>{r=!0,window.clearInterval(E)}},[t,o,s.sessionToken,s.userId,a]),i.useEffect(()=>{w!=null&&w.key&&(p(Te(w.key)),j("messages"),typeof u=="function"&&u())},[u,w]),i.useEffect(()=>{const r=v=>{var E;((E=v.detail)==null?void 0:E.tab)==="threads"&&(p(null),j("messages"))};return window.addEventListener("rd:tab-select",r),()=>window.removeEventListener("rd:tab-select",r)},[]),i.useEffect(()=>{if(!o||b!=="profile")return;const r=bt(o);if(!r){z(null);return}let v=!1;return ae(!0),t.getPublicProfile(r).then(E=>{v||z(E.profile)}).catch(E=>{v||(z(null),a(B(E)))}).finally(()=>{v||ae(!1)}),()=>{v=!0}},[t,o,a,b]),i.useEffect(()=>{if(!o){U([]);return}let r=!1;const v=async()=>{try{const de=await t.listChat(s.sessionToken,Q,o),xe=(de==null?void 0:de.messages)??[];r||(U(Array.isArray(xe)?xe:[]),t.markChatRead(s.sessionToken,Q,o).catch(()=>{}))}catch(de){r||a(B(de))}};v();const E=window.setInterval(()=>{v()},1200);return()=>{r=!0,window.clearInterval(E)}},[t,o,s.sessionToken,a]);function se(r){if(!r.startsWith("GROUP_INVITE_ACCEPT|"))return null;const[,v,E]=r.split("|");return!v||!E?null:{inviteId:v,candidateKey:E}}const me=i.useMemo(()=>({async sendMessage(r,v,E,de){const xe=await t.sendChat(s.sessionToken,r,v,E,de),we=xe==null?void 0:xe.message,Ie=se(we.text??"");if(Ie&&we.toKey===M&&g[Ie.inviteId]&&(le(Ie.candidateKey),X(`Invite accepted by ${Ie.candidateKey}.`),S(je=>{const ce={...je};return delete ce[Ie.inviteId],ce})),U(je=>[...je,we].sort((ce,ne)=>ce.createdAtMs-ne.createdAtMs)),r==="cruise"&&ue)try{const je=await t.sendChat(s.sessionToken,r,ue,E,de),ce=je==null?void 0:je.message;U(ne=>[...ne,ce].sort((he,Ne)=>he.createdAtMs-Ne.createdAtMs))}catch(je){a(B(je))}return we},async initiateMediaUpload(r,v){const E=await t.initiateChatMediaUpload(s.sessionToken,{mimeType:r,sizeBytes:v});return{objectKey:E.objectKey,uploadUrl:E.uploadUrl}},async uploadToSignedUrl(r,v,E){if(!await mt(r,v,E)&&!(await fetch(r,{method:"PUT",headers:{"content-type":E},body:v})).ok)throw{code:"MEDIA_UPLOAD_INCOMPLETE",message:"Upload failed."}},async getMediaUrl(r){return(await t.getChatMediaUrl(s.sessionToken,r)).downloadUrl}}),[t,M,g,s.sessionToken,a,ue]);async function c(){var r;if(!(!o||!V)){if(!R.some(v=>v.key===V)){a("You can only add a third user you have previously messaged.");return}try{const v=crypto.randomUUID();await t.sendChat(s.sessionToken,"cruise",V,`GROUP_INVITE_REQUEST|${v}|${M}|${o}`),S(E=>({...E,[v]:{candidateKey:V}})),X(`Invite sent to ${((r=R.find(E=>E.key===V))==null?void 0:r.displayName)??V}.`)}catch(v){a(B(v))}}}async function $(){if(o)try{await t.sendChat(s.sessionToken,"cruise",o,xt),X("Fire sent.")}catch(r){a(B(r))}}if(o){const r=(oe==null?void 0:oe.displayName)??o;return e.jsxs("div",{style:{display:"grid",gap:0,minHeight:f?"calc(100dvh - 150px)":void 0,marginInline:f?-10:0,marginBlock:0},children:[e.jsx("div",{style:{position:"sticky",top:0,zIndex:46,background:"rgba(8,8,12,0.96)",borderBottom:"1px solid rgba(255,58,77,0.35)",padding:"6px 10px",display:"flex",justifyContent:"flex-end"},children:e.jsx("button",{type:"button",onClick:()=>j(v=>v==="messages"?"profile":"messages"),style:{background:"transparent",border:0,color:"#26d5ff",fontSize:13,fontWeight:700,letterSpacing:"0.03em",textTransform:"uppercase",padding:0,cursor:"pointer"},children:b==="messages"?"View Profile":"Back to Thread"})}),b==="messages"?e.jsx(is,{chatKind:"cruise",peerKey:o,currentUserKey:M,messages:L,client:me,title:`INSTANT THREAD: ${r}`,peerSummary:{displayName:r},thirdParty:{candidates:pe,selectedKey:V,onSelect:v=>be(v),onAdd:()=>void c(),disabled:!1},showHeader:!1,edgeToEdge:!0,fillHeight:f}):e.jsxs("div",{style:{padding:12,display:"grid",gap:12},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"88px 1fr",gap:12,alignItems:"center"},children:[e.jsx("img",{src:(oe==null?void 0:oe.avatarUrl)??$e(o),alt:"Profile avatar",style:{width:88,height:88,borderRadius:"50%",objectFit:"cover",border:"2px solid #ff3047"}}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:24,fontWeight:700},children:(C==null?void 0:C.displayName)??r}),e.jsx("div",{style:{color:"#26d5ff",fontSize:14},children:"Instant Messaging Available"})]})]}),K?e.jsx("div",{style:{color:"#9fb6bf",fontSize:14},children:"Loading profile..."}):null,K?null:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:14,lineHeight:1.5},children:[e.jsxs("div",{children:["Age: ",(C==null?void 0:C.age)??"-"]}),e.jsxs("div",{children:["Race: ",((k=C==null?void 0:C.stats)==null?void 0:k.race)??"-"]}),e.jsxs("div",{children:["Height: ",((y=C==null?void 0:C.stats)==null?void 0:y.heightInches)??"-"]}),e.jsxs("div",{children:["Weight: ",((D=C==null?void 0:C.stats)==null?void 0:D.weightLbs)??"-"]}),e.jsxs("div",{children:["Cock Size: ",((G=C==null?void 0:C.stats)==null?void 0:G.cockSizeInches)??"-"]}),e.jsxs("div",{children:["Cut / Uncut: ",((Y=C==null?void 0:C.stats)==null?void 0:Y.cutStatus)??"-"]}),e.jsxs("div",{children:["Position: ",((A=C==null?void 0:C.stats)==null?void 0:A.position)??"-"]}),e.jsxs("div",{style:{marginTop:8},children:["Bio: ",(C==null?void 0:C.bio)??"-"]})]}),e.jsx("div",{children:e.jsx("button",{type:"button",style:{..._(!1),color:"#ffb347",borderColor:"rgba(255,179,71,0.65)"},onClick:()=>void $(),children:"ðŸ”¥ FIRE"})})]})]})]})}return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:f?-10:0,marginBlock:0},children:[R.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14,padding:14},children:"No conversations yet."}):R.map(r=>e.jsxs("button",{type:"button",onClick:()=>p(r.key),style:{border:0,borderBottom:"1px solid rgba(255,58,77,0.24)",borderRadius:0,padding:"10px 12px",background:"rgba(0,0,0,0.2)",textAlign:"left",color:"#fff",cursor:"pointer",display:"grid",gridTemplateColumns:"52px 1fr",gap:10,alignItems:"center",width:"100%"},children:[e.jsx("img",{src:r.avatarUrl??$e(r.key),alt:`${r.displayName} avatar`,style:{width:52,height:52,borderRadius:6,objectFit:"cover",border:"1px solid rgba(38,213,255,0.9)"}}),e.jsxs("div",{style:{display:"grid",gap:3,minWidth:0},children:[e.jsx("div",{style:{fontWeight:700},children:r.displayName}),e.jsx("div",{style:{color:"#b9bec9",fontSize:13,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:r.preview})]})]},r.key)),P?e.jsx("div",{style:{color:"#26d5ff",fontSize:12,padding:10},children:P}):null]})}function Bs({api:t,session:s,isMobile:a,setLastError:w}){const[u,f]=i.useState("ads"),[k,y]=i.useState([]),[D,G]=i.useState([]),[Y,A]=i.useState(""),[R,x]=i.useState(""),[o,p]=i.useState(""),[L,U]=i.useState(""),[b,j]=i.useState([]),[C,z]=i.useState(""),[K,ae]=i.useState(""),[V,be]=i.useState(""),[ue,le]=i.useState([]),[g,S]=i.useState({}),P=!0,X=s.userType!=="guest";async function M(){try{const[r,v,E,de]=await Promise.all([t.listPublicPostings("ad"),t.listPublicPostings("event"),t.listCruisingSpots(),s.userType==="guest"?Promise.resolve({postings:[]}):t.listEventInvites(s.sessionToken)]);y([...r.postings].sort((xe,we)=>xe.createdAtMs-we.createdAtMs)),G([...v.postings].sort((xe,we)=>xe.createdAtMs-we.createdAtMs)),j(E.spots),le(de.postings)}catch(r){w(B(r))}}i.useEffect(()=>{M()},[]),i.useEffect(()=>{const r=v=>{var E;((E=v.detail)==null?void 0:E.tab)==="public"&&f("ads")};return window.addEventListener("rd:tab-select",r),()=>window.removeEventListener("rd:tab-select",r)},[]);async function Q(r){if(r==="event"&&!X){w("Anonymous users cannot create event postings.");return}const v=r==="ad"?Y:o,E=r==="ad"?R:L;try{await t.createPublicPosting(s.sessionToken,{type:r,title:v,body:E}),r==="ad"?(A(""),x("")):(p(""),U("")),await M()}catch(de){w(B(de))}}async function pe(r){if(!X){w("Anonymous users cannot invite to events.");return}const v=(g[r]??"").trim();if(!v){w("Target user id is required.");return}try{await t.inviteToEvent(s.sessionToken,{postingId:r,targetUserId:v}),S(E=>({...E,[r]:""})),await M()}catch(E){w(B(E))}}async function oe(r,v){if(s.userType==="guest"){w("Anonymous users cannot respond to event invites.");return}try{await t.respondToEventInvite(s.sessionToken,{postingId:r,accept:v}),await M()}catch(E){w(B(E))}}async function se(){try{await t.createCruisingSpot(s.sessionToken,{name:C,address:K,description:V}),z(""),ae(""),be(""),await M()}catch(r){w(B(r))}}async function me(r){try{await t.checkInCruisingSpot(s.sessionToken,r),await M()}catch(v){w(B(v))}}const c=r=>{const v=r==="ads"?"ADS":"EVENTS",E=r==="ads"?k:D,de=r==="ads"?Y:o,xe=r==="ads"?R:L,we=r==="ads"?A:p,Ie=r==="ads"?x:U,je=r==="ads"?"ad":"event",ce=r==="ads"?P:X;return e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.38)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:v}),e.jsx("input",{value:de,onChange:ne=>we(ne.target.value),placeholder:`${v} title`,style:Z(),"aria-label":`${v} title`,disabled:!ce}),e.jsx("textarea",{value:xe,onChange:ne=>Ie(ne.target.value),placeholder:`Write ${v.toLowerCase()} details`,style:{...Z(),minHeight:86,resize:"vertical"},"aria-label":`${v} details`,disabled:!ce}),e.jsxs("button",{type:"button",onClick:()=>void Q(je),style:ce?ve(!1):_(!0),disabled:!ce,children:["POST ",v]}),ce?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can view events but cannot post events."}),e.jsx("div",{style:{display:"grid",gap:8,marginTop:6},children:E.length===0?e.jsxs("div",{style:{color:"#b9bec9",fontSize:14},children:["No ",v.toLowerCase()," yet."]}):E.map(ne=>{var he,Ne;return e.jsxs("div",{style:{borderTop:"1px solid rgba(255,58,77,0.25)",paddingTop:10,paddingBottom:10},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:4},children:ne.title}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12,marginBottom:6},children:["Host: ",ne.authorUserId]}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap"},children:ne.body}),r==="events"?e.jsxs("div",{style:{display:"grid",gap:8,marginTop:8},children:[e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12},children:["Invited: ",((he=ne.invitedUserIds)==null?void 0:he.length)??0," | Accepted: ",((Ne=ne.acceptedUserIds)==null?void 0:Ne.length)??0]}),s.userId&&s.userId===ne.authorUserId?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8},children:[e.jsx("input",{value:g[ne.postingId]??"",onChange:Pe=>S(Fe=>({...Fe,[ne.postingId]:Pe.target.value})),placeholder:"Invite user id",style:Z()}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>void pe(ne.postingId),children:"INVITE"})]}):null,s.userType!=="guest"&&s.userId&&Array.isArray(ne.invitedUserIds)&&ne.invitedUserIds.includes(s.userId)?e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:ve(!1),onClick:()=>void oe(ne.postingId,!0),children:"ACCEPT INVITE"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>void oe(ne.postingId,!1),children:"DECLINE"})]}):null]}):null]},ne.postingId)})})]})})},$=e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.38)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"CRUISING SPOTS"}),e.jsx("input",{value:C,onChange:r=>z(r.target.value),placeholder:"Spot name",style:Z(),disabled:!1}),e.jsx("input",{value:K,onChange:r=>ae(r.target.value),placeholder:"Spot address",style:Z(),disabled:!1}),e.jsx("textarea",{value:V,onChange:r=>be(r.target.value),placeholder:"Spot description",style:{...Z(),minHeight:80,resize:"vertical"},disabled:!1}),e.jsx("button",{type:"button",style:ve(!1),disabled:!1,onClick:()=>void se(),children:"CREATE SPOT"}),null,e.jsx("div",{style:{display:"grid",gap:8},children:b.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"No cruising spots yet."}):b.map(r=>e.jsxs("div",{style:{borderTop:"1px solid rgba(255,58,77,0.25)",paddingTop:10,paddingBottom:10},children:[e.jsx("div",{style:{fontWeight:700},children:r.name}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12,marginTop:4},children:["Created by: ",r.creatorUserId]}),e.jsx("div",{style:{color:"#9fb6bf",fontSize:12,marginTop:2},children:r.address}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap",marginTop:6},children:r.description}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:_(!1),onClick:()=>void me(r.spotId),children:"CHECK IN"}),e.jsxs("span",{style:{color:"#9fb6bf",fontSize:12},children:["Checked in: ",r.checkInCount??0]}),e.jsxs("span",{style:{color:"#9fb6bf",fontSize:12},children:["Got action: ",r.actionCount??0]})]})]},r.spotId))})]})});return e.jsx("div",{style:{display:"grid",gap:8,marginInline:a?-10:0},children:a?e.jsxs(e.Fragment,{children:[u==="ads"?c("ads"):null,u==="events"?c("events"):null,u==="spots"?$:null,e.jsx("div",{style:{position:"sticky",bottom:"calc(86px + env(safe-area-inset-bottom, 0px))",zIndex:31,background:"rgba(0,0,0,0.35)",padding:8},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[e.jsx("button",{type:"button",style:u==="ads"?ve(!1):_(!1),onClick:()=>f("ads"),children:"ADS"}),e.jsx("button",{type:"button",style:u==="events"?ve(!1):_(!1),onClick:()=>f("events"),children:"EVENTS"}),e.jsx("button",{type:"button",style:u==="spots"?ve(!1):_(!1),onClick:()=>f("spots"),children:"SPOTS"})]})})]}):e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[c("ads"),c("events"),e.jsx("div",{style:{gridColumn:"1 / -1"},children:$}),s.userType!=="guest"&&ue.length>0?e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.25)",gridColumn:"1 / -1",display:"grid",gap:8,padding:10},children:[e.jsx("div",{style:{fontSize:16,fontWeight:700},children:"EVENT INVITES"}),ue.map(r=>e.jsxs("div",{style:{display:"grid",gap:6,border:"1px solid rgba(255,58,77,0.4)",borderRadius:10,padding:8},children:[e.jsx("div",{style:{fontWeight:700},children:r.title}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13},children:["Host: ",r.authorUserId]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:ve(!1),onClick:()=>void oe(r.postingId,!0),children:"ACCEPT"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>void oe(r.postingId,!1),children:"DECLINE"})]})]},r.postingId))]}):null]})})}function Gs({api:t,session:s,setLastError:a}){const[w,u]=i.useState([]),[f,k]=i.useState(""),[y,D]=i.useState("");async function G(){try{const o=await t.listSubmissions();u([...o.submissions].sort((p,L)=>L.createdAtMs-p.createdAtMs))}catch(o){a(B(o))}}i.useEffect(()=>{G()},[]);async function Y(){try{await t.createSubmission(s.sessionToken,{title:f,body:y}),k(""),D(""),await G()}catch(o){a(B(o))}}async function A(o){try{await t.recordSubmissionView(o),await G()}catch(p){a(B(p))}}async function R(o,p){try{await t.rateSubmission(o,p),await G()}catch(L){a(B(L))}}const x=s.userType!=="guest";return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("input",{style:Z(),value:f,onChange:o=>k(o.target.value),placeholder:"Story title",disabled:!x}),e.jsx("textarea",{style:{...Z(),minHeight:120},value:y,onChange:o=>D(o.target.value),placeholder:"Write your story",disabled:!x}),e.jsx("button",{type:"button",style:x?ve(!1):_(!0),disabled:!x,onClick:()=>void Y(),children:"PUBLISH STORY"}),x?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can read but cannot publish submissions."})]})}),e.jsx("div",{style:{display:"grid",gap:10},children:w.map(o=>{const p=o.ratingCount>0?(o.ratingSum/o.ratingCount).toFixed(2):"0.00";return e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.28)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:o.title}),e.jsx("div",{style:{color:"#ced3dc",whiteSpace:"pre-wrap",marginTop:6},children:o.body}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13,marginTop:8},children:["Views: ",o.viewCount," | Rating: ",p," (",o.ratingCount,")"]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:_(!1),onClick:()=>void A(o.submissionId),children:"VIEW"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>void R(o.submissionId,1),children:"â˜…1"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>void R(o.submissionId,2),children:"â˜…2"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>void R(o.submissionId,3),children:"â˜…3"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>void R(o.submissionId,4),children:"â˜…4"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>void R(o.submissionId,5),children:"â˜…5"})]})]},o.submissionId)})})]})}function Vs({api:t,session:s,setLastError:a}){var w,u,f,k,y,D;const[G,Y]=i.useState([]),[A,R]=i.useState({}),[x,o]=i.useState(null),[p,L]=i.useState(2e3),[U,b]=i.useState(""),[j,C]=i.useState(""),[z,K]=i.useState(""),[ae,V]=i.useState(""),[be,ue]=i.useState("Ready."),le=s.userType!=="guest";async function g(){try{const M=await t.listPromotedProfiles();Y([...M.listings].sort((se,me)=>me.createdAtMs-se.createdAtMs)),L(M.feeCents);const Q=Array.from(new Set(M.listings.map(se=>se.userId))).filter(se=>se.trim().length>0),pe=await Promise.all(Q.map(async se=>{try{const me=(await t.getPublicProfile(se)).profile.mainPhotoMediaId;if(!me)return null;const c=await t.getPublicMediaUrl(me);return{userId:se,url:c.downloadUrl}}catch{return null}})),oe={};for(const se of pe)se&&(oe[se.userId]=se.url);R(oe)}catch(M){a(B(M))}}i.useEffect(()=>{g()},[]);async function S(){if(!le){a("Anonymous users cannot create promoted profiles.");return}try{const M=await t.startPromotedPayment(s.sessionToken),Q=await t.confirmPromotedPayment(s.sessionToken,M.payment.paymentToken);V(Q.payment.paymentToken),ue("Payment confirmed. You can now publish one promoted profile.")}catch(M){const Q=B(M);ue(Q),a(Q)}}async function P(){if(!le){a("Anonymous users cannot create promoted profiles.");return}try{await t.createPromotedProfile(s.sessionToken,{paymentToken:ae,title:U,body:j,displayName:z}),b(""),C(""),K(""),V(""),ue("Promoted profile published."),await g()}catch(M){const Q=B(M);ue(Q),a(Q)}}async function X(M){try{const Q=await t.getPublicProfile(M);o(Q.profile)}catch(Q){a(B(Q))}}return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"PROMOTED PROFILES"}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:14},children:["Publishing requires a $",Math.round(p/100)," fee per profile."]}),e.jsx("div",{style:{color:"#26d5ff",fontSize:13},children:be})]})}),e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("input",{value:z,onChange:M=>K(M.target.value),placeholder:"Display name",style:Z(),disabled:!le}),e.jsx("input",{value:U,onChange:M=>b(M.target.value),placeholder:"Headline",style:Z(),disabled:!le}),e.jsx("textarea",{value:j,onChange:M=>C(M.target.value),placeholder:"Profile description",style:{...Z(),minHeight:92,resize:"vertical"},disabled:!le}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsxs("button",{type:"button",style:_(!le),disabled:!le,onClick:()=>void S(),children:["PAY $",Math.round(p/100)]}),e.jsx("button",{type:"button",style:le?ve(!1):_(!0),disabled:!le,onClick:()=>void P(),children:"PUBLISH PROFILE"})]}),le?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can browse but cannot publish paid profiles."})]})}),e.jsx("div",{style:{display:"grid",gap:10},children:G.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"No promoted profiles yet."}):G.map(M=>e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.25)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"72px 1fr",gap:10,alignItems:"start"},children:[e.jsx("img",{src:A[M.userId]??$e(`user:${M.userId}`),alt:`${M.displayName} profile`,style:{width:72,height:72,borderRadius:6,objectFit:"cover",border:"1px solid rgba(38,213,255,0.9)"}}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:M.title}),e.jsx("div",{style:{color:"#26d5ff",fontSize:13},children:M.displayName}),e.jsx("div",{style:{color:"#ced3dc",whiteSpace:"pre-wrap",fontSize:14},children:M.body}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>void X(M.userId),children:"VIEW PROFILE"})]})]})},M.listingId))}),x?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},onClick:()=>o(null),children:e.jsxs("div",{onClick:M=>M.stopPropagation(),style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:12,width:"min(560px, 100%)",background:"rgba(0,0,0,0.88)"},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:x.displayName}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:6},children:["Age: ",x.age]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Race: ",((w=x.stats)==null?void 0:w.race)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Height: ",((u=x.stats)==null?void 0:u.heightInches)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Weight: ",((f=x.stats)==null?void 0:f.weightLbs)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Cock Size: ",((k=x.stats)==null?void 0:k.cockSizeInches)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Cut / Uncut: ",((y=x.stats)==null?void 0:y.cutStatus)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Position: ",((D=x.stats)==null?void 0:D.position)??"-"]}),e.jsx("div",{style:{color:"#ced3dc",marginTop:10,whiteSpace:"pre-wrap"},children:x.bio}),e.jsx("div",{style:{marginTop:10},children:e.jsx("button",{type:"button",style:_(!1),onClick:()=>o(null),children:"CLOSE"})})]})}):null]})}function Js(){return{displayName:"",age:"",bio:"",heightInches:"",race:"",cockSizeInches:"",cutStatus:"",weightLbs:"",position:"",discreetMode:!1,travelEnabled:!1,travelLat:"",travelLng:"",lookingForMore:""}}function Ht(t){var s,a,w;return{displayName:t.displayName,age:String(t.age),bio:t.bio,heightInches:t.stats.heightInches!==void 0?String(t.stats.heightInches):"",race:t.stats.race??"",cockSizeInches:t.stats.cockSizeInches!==void 0?String(t.stats.cockSizeInches):"",cutStatus:t.stats.cutStatus??"",weightLbs:t.stats.weightLbs!==void 0?String(t.stats.weightLbs):"",position:t.stats.position??"",discreetMode:t.discreetMode===!0,travelEnabled:((s=t.travelMode)==null?void 0:s.enabled)===!0,travelLat:typeof((a=t.travelMode)==null?void 0:a.lat)=="number"?String(t.travelMode.lat):"",travelLng:typeof((w=t.travelMode)==null?void 0:w.lng)=="number"?String(t.travelMode.lng):"",lookingForMore:t.bio}}function Bt(t){const s=t.trim();if(!s)return;const a=Number(s);return Number.isFinite(a)?Math.trunc(a):void 0}function qs(t){const s=t.trim();if(!s)return;const a=Number(s);return Number.isFinite(a)?a:void 0}function Zs({api:t,session:s,setLastError:a}){var w,u;const[f,k]=i.useState(Js()),[y,D]=i.useState(null),[G,Y]=i.useState(!1),[A,R]=i.useState(!1),[x,o]=i.useState(null),[p,L]=i.useState({});async function U(){Y(!0);try{const g=await t.getMyProfile(s.sessionToken);D(g.profile),k(Ht(g.profile)),o("Profile loaded.")}catch(g){const S=g;if((S==null?void 0:S.code)==="PROFILE_NOT_FOUND"){D(null),k(P=>({...P,age:P.age||"18"})),o("No profile yet. Fill out the form and save.");return}o(B(g))}finally{Y(!1)}}i.useEffect(()=>{U()},[s.sessionToken,s.userType]),i.useEffect(()=>{const g=[y==null?void 0:y.mainPhotoMediaId,...(y==null?void 0:y.galleryMediaIds)??[]].filter(P=>typeof P=="string"&&P.length>0);if(g.length===0)return;const S=g.filter(P=>!p[P]);S.length!==0&&Promise.all(S.map(async P=>{try{const X=await t.getPublicMediaUrl(P);return{id:P,url:X.downloadUrl}}catch{return null}})).then(P=>{L(X=>{const M={...X};for(const Q of P)Q&&(M[Q.id]=Q.url);return M})})},[t,p,y==null?void 0:y.galleryMediaIds,y==null?void 0:y.mainPhotoMediaId]);async function b(){var g,S,P,X,M;R(!0),a(null);try{const Q=Number(f.age),pe=f.lookingForMore.trim()?`${f.bio.trim()}

Looking For More: ${f.lookingForMore.trim()}`.trim():f.bio,oe=f.travelLat.trim()?Number(f.travelLat):void 0,se=f.travelLng.trim()?Number(f.travelLng):void 0,me={displayName:f.displayName,age:Math.trunc(Q),bio:pe,stats:{heightInches:Bt(f.heightInches),race:f.race.trim()||void 0,cockSizeInches:qs(f.cockSizeInches),cutStatus:f.cutStatus||void 0,weightLbs:Bt(f.weightLbs),position:f.position||void 0},discreetMode:f.discreetMode,travelMode:{enabled:f.travelEnabled,lat:Number.isFinite(oe)?oe:void 0,lng:Number.isFinite(se)?se:void 0}},c=await t.upsertMyProfile(s.sessionToken,me);D(c.profile),k(Ht(c.profile));try{localStorage.setItem("reddoor_travel_center",JSON.stringify({enabled:((g=c.profile.travelMode)==null?void 0:g.enabled)===!0,lat:(S=c.profile.travelMode)==null?void 0:S.lat,lng:(P=c.profile.travelMode)==null?void 0:P.lng})),window.dispatchEvent(new CustomEvent("rd:location-updated",{detail:{lat:(X=c.profile.travelMode)==null?void 0:X.lat,lng:(M=c.profile.travelMode)==null?void 0:M.lng}}))}catch{}o("Profile saved.")}catch(Q){const pe=B(Q);o(pe),a(pe)}finally{R(!1)}}async function j(g,S){if(!S){o("Choose a file first.");return}if(s.userType==="guest"){o("Guest sessions cannot upload media. Register to persist media.");return}R(!0),a(null);try{const P=await t.initiateMediaUpload(s.sessionToken,{kind:g,mimeType:S.type||(g==="video"?"video/mp4":"image/jpeg"),sizeBytes:S.size});if(!await mt(P.uploadUrl,S,S.type||"application/octet-stream")){const X=await fetch(P.uploadUrl,{method:"PUT",headers:{"content-type":S.type||"application/octet-stream"},body:S});if(!X.ok)throw{message:`Upload failed (${X.status}).`}}await t.completeMediaUpload(s.sessionToken,P.mediaId),await U(),o("Media uploaded.")}catch(P){const X=B(P);o(X),a(X)}finally{R(!1)}}const[C,z]=i.useState(null),[K,ae]=i.useState(null),[V,be]=i.useState(null);async function ue(g){if(y){R(!0);try{const S=(y.galleryMediaIds??[]).filter(X=>X!==g),P=await t.updateProfileMediaReferences(s.sessionToken,{galleryMediaIds:S});D(P.profile),o("Gallery updated.")}catch(S){const P=B(S);o(P),a(P)}finally{R(!1)}}}async function le(g){if(y){R(!0);try{const S=await t.updateProfileMediaReferences(s.sessionToken,{galleryMediaIds:y.galleryMediaIds,mainPhotoMediaId:g});D(S.profile),o("Main photo updated.")}catch(S){const P=B(S);o(P),a(P)}finally{R(!1)}}}return e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:Re(),children:e.jsxs("div",{style:{display:"grid",gap:14},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"SETTINGS / PROFILE"}),s.userType==="guest"?e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guest profile data is temporary for this session and is removed when you log out."}):null,x?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:x}):null,e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Display Name"}),e.jsx("input",{value:f.displayName,onChange:g=>k(S=>({...S,displayName:g.target.value})),style:Z()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Age"}),e.jsx("input",{value:f.age,onChange:g=>k(S=>({...S,age:g.target.value})),style:Z(),inputMode:"numeric"})]})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Bio"}),e.jsx("textarea",{value:f.bio,onChange:g=>k(S=>({...S,bio:g.target.value})),style:{...Z(),minHeight:88,resize:"vertical"}})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Looking For More (Optional)"}),e.jsx("textarea",{value:f.lookingForMore,onChange:g=>k(S=>({...S,lookingForMore:g.target.value})),style:{...Z(),minHeight:72,resize:"vertical"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:f.discreetMode,onChange:g=>k(S=>({...S,discreetMode:g.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0,fontSize:13},children:"Discreet Mode (hide profile from others)"})]}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:f.travelEnabled,onChange:g=>k(S=>({...S,travelEnabled:g.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Travel Mode"})]})]}),f.travelEnabled?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Travel Lat"}),e.jsx("input",{value:f.travelLat,onChange:g=>k(S=>({...S,travelLat:g.target.value})),style:Z()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Travel Lng"}),e.jsx("input",{value:f.travelLng,onChange:g=>k(S=>({...S,travelLng:g.target.value})),style:Z()})]})]}):null,e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Height (in)"}),e.jsx("input",{value:f.heightInches,onChange:g=>k(S=>({...S,heightInches:g.target.value})),style:Z(),inputMode:"numeric"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Race"}),e.jsx("input",{value:f.race,onChange:g=>k(S=>({...S,race:g.target.value})),style:Z()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Cock Size (in)"}),e.jsx("input",{value:f.cockSizeInches,onChange:g=>k(S=>({...S,cockSizeInches:g.target.value})),style:Z(),inputMode:"decimal"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Cut / Uncut"}),e.jsxs("select",{value:f.cutStatus,onChange:g=>k(S=>({...S,cutStatus:g.target.value})),style:Z(),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"cut",children:"Cut"}),e.jsx("option",{value:"uncut",children:"Uncut"})]})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Weight (lbs)"}),e.jsx("input",{value:f.weightLbs,onChange:g=>k(S=>({...S,weightLbs:g.target.value})),style:Z(),inputMode:"numeric"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Position"}),e.jsxs("select",{value:f.position,onChange:g=>k(S=>({...S,position:g.target.value})),style:Z(),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"top",children:"Top"}),e.jsx("option",{value:"bottom",children:"Bottom"}),e.jsx("option",{value:"side",children:"Side"})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",onClick:()=>void b(),style:ve(A),disabled:A,children:"SAVE PROFILE"}),e.jsx("button",{type:"button",onClick:()=>void U(),style:_(G),disabled:G,children:"REFRESH"})]})]})}),e.jsx("div",{style:Re(),children:e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"MEDIA"}),e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"Main profile photo, gallery photo, and video uploads."}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Main Photo"}),e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:g=>{var S;return z(((S=g.target.files)==null?void 0:S[0])??null)}})]}),e.jsx("button",{type:"button",style:ve(A),disabled:A,onClick:()=>void j("photo_main",C),children:"UPLOAD MAIN PHOTO"})]}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Gallery Photo"}),e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:g=>{var S;return ae(((S=g.target.files)==null?void 0:S[0])??null)}})]}),e.jsx("button",{type:"button",style:ve(A),disabled:A,onClick:()=>void j("photo_gallery",K),children:"UPLOAD GALLERY PHOTO"})]}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Video"}),e.jsx("input",{className:"rd-input",type:"file",accept:"video/*",onChange:g=>{var S;return be(((S=g.target.files)==null?void 0:S[0])??null)}})]}),e.jsx("button",{type:"button",style:ve(A),disabled:A,onClick:()=>void j("video",V),children:"UPLOAD VIDEO"})]}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13},children:["Main photo media id: ",(y==null?void 0:y.mainPhotoMediaId)??"-",e.jsx("br",{}),"Gallery count: ",((w=y==null?void 0:y.galleryMediaIds)==null?void 0:w.length)??0,e.jsx("br",{}),"Video media id: ",(y==null?void 0:y.videoMediaId)??"-"]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"YOUR GALLERY"}),(u=y==null?void 0:y.galleryMediaIds)!=null&&u.length?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(130px, 1fr))",gap:10},children:y.galleryMediaIds.map(g=>e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.45)",borderRadius:10,padding:8,display:"grid",gap:8},children:[e.jsx("img",{src:p[g]??$e(g),alt:"Gallery photo",style:{width:"100%",aspectRatio:"1/1",objectFit:"cover",borderRadius:8,border:"1px solid rgba(255,58,77,0.4)"}}),e.jsx("button",{type:"button",style:_(A),disabled:A,onClick:()=>void le(g),children:"SET MAIN"}),e.jsx("button",{type:"button",style:_(A),disabled:A,onClick:()=>void ue(g),children:"REMOVE"})]},g))}):e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No gallery photos uploaded yet."})]})]})})]})}function Ys({api:t,session:s,setLastError:a,onLogout:w}){const[u,f]=i.useState({discreetMode:!1,travelEnabled:!1,travelLat:"",travelLng:""}),[k,y]=i.useState("Loading settings..."),[D,G]=i.useState(!1),[Y,A]=i.useState([]);async function R(){var b,j,C;try{const z=await t.getMyProfile(s.sessionToken);if(f({discreetMode:z.profile.discreetMode===!0,travelEnabled:((b=z.profile.travelMode)==null?void 0:b.enabled)===!0,travelLat:typeof((j=z.profile.travelMode)==null?void 0:j.lat)=="number"?String(z.profile.travelMode.lat):"",travelLng:typeof((C=z.profile.travelMode)==null?void 0:C.lng)=="number"?String(z.profile.travelMode.lng):""}),y("Settings loaded."),s.userType!=="guest")try{const K=await t.listBlocked(s.sessionToken);A(K.blocked)}catch{A([])}else A([])}catch(z){y(B(z))}}async function x(){try{const b=await fetch("/api/config"),j=await b.json();if(!b.ok)throw j;G(j.mediaStorageConfigured===!0)}catch{G(!1)}}i.useEffect(()=>{R(),x()},[s.sessionToken,s.userType]);async function o(){try{const b=await t.getMyProfile(s.sessionToken),j=u.travelLat.trim()?Number(u.travelLat):void 0,C=u.travelLng.trim()?Number(u.travelLng):void 0;await t.upsertMyProfile(s.sessionToken,{displayName:b.profile.displayName,age:b.profile.age,bio:b.profile.bio,stats:b.profile.stats,discreetMode:u.discreetMode,travelMode:{enabled:u.travelEnabled,lat:Number.isFinite(j)?j:void 0,lng:Number.isFinite(C)?C:void 0}}),y("Privacy settings saved.")}catch(b){const j=B(b);y(j),a(j)}}async function p(){if(!navigator.geolocation){const b="Geolocation is unavailable on this device.";y(b),a(b);return}try{const b=await new Promise((z,K)=>{navigator.geolocation.getCurrentPosition(z,K,{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})}),j=Number(b.coords.latitude.toFixed(6)),C=Number(b.coords.longitude.toFixed(6));f(z=>({...z,travelEnabled:!0,travelLat:String(j),travelLng:String(C)}));try{localStorage.setItem("reddoor_travel_center",JSON.stringify({enabled:!0,lat:j,lng:C}))}catch{}try{await t.updatePresence(s.sessionToken,j,C,"online")}catch{}window.dispatchEvent(new CustomEvent("rd:location-updated",{detail:{lat:j,lng:C}})),y("Actual location detected. Save privacy settings to persist it.")}catch(b){const j=B(b);y(j),a(j)}}async function L(){try{const b=u.travelLat.trim()?Number(u.travelLat):void 0,j=u.travelLng.trim()?Number(u.travelLng):void 0,C=await t.seedFakeUsers(12,Number.isFinite(b)?b:void 0,Number.isFinite(j)?j:void 0);y(`Seeded ${C.seededCount} fake users for testing.`)}catch(b){const j=B(b);y(j),a(j)}}async function U(b){try{await t.unblock(s.sessionToken,b);const j=await t.listBlocked(s.sessionToken);A(j.blocked),y("Blocked users updated.")}catch(j){const C=B(j);y(C),a(C)}}return e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:Re(),children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"SETTINGS"}),e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:k}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:u.discreetMode,onChange:b=>f(j=>({...j,discreetMode:b.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Discreet Mode (hide your profile)"})]}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:u.travelEnabled,onChange:b=>f(j=>({...j,travelEnabled:b.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Travel Mode"})]}),u.travelEnabled?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("input",{value:u.travelLat,onChange:b=>f(j=>({...j,travelLat:b.target.value})),style:Z(),placeholder:"Travel lat"}),e.jsx("input",{value:u.travelLng,onChange:b=>f(j=>({...j,travelLng:b.target.value})),style:Z(),placeholder:"Travel lng"})]}):null,e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:ve(!1),onClick:()=>void o(),children:"SAVE PRIVACY"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>void p(),children:"DETECT ACTUAL LOCATION"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>void L(),children:"SEED FAKE USERS"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>w==null?void 0:w(),children:"LOGOUT"})]})]})}),e.jsx("div",{style:Re(),children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"MEDIA STORAGE"}),e.jsx("div",{style:{color:D?"#26d5ff":"#ff8a95",fontSize:14},children:D?"Configured: uploads enabled.":"Not configured: set S3_BUCKET, S3_REGION, S3_ACCESS_KEY_ID, S3_SECRET_ACCESS_KEY."}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>void x(),children:"REFRESH STORAGE STATUS"})]})}),s.userType!=="guest"?e.jsx("div",{style:Re(),children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"BLOCKED USERS"}),Y.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No blocked users."}):Y.map(b=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[e.jsx("div",{style:{color:"#ced3dc",fontSize:14},children:b}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>void U(b),children:"UNBLOCK"})]},b))]})}):null]})}function Qs({api:t,session:s,setSession:a,settings:w,activeTab:u,setActiveTab:f,discoverScreen:k,onDiscoverScreenChange:y,discoverFilter:D,busy:G,setBusy:Y,setLastError:A,onUnreadCountChange:R,hideModeCard:x,onLogout:o}){const p=Ks(),[L,U]=i.useState(null),b=e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx(Zs,{api:t,session:s,setLastError:A}),e.jsx(Ys,{api:t,session:s,setLastError:A,onLogout:o})]});return e.jsxs("div",{style:{display:"grid",gap:12},children:[null,e.jsx("div",{style:{display:u==="discover"?"block":"none"},children:e.jsx(_s,{api:t,session:s,settings:w,discoverFilter:D,busy:G,setBusy:Y,setLastError:A,isMobile:p,discoverScreen:k,onDiscoverScreenChange:y,onOpenThreadRequested:j=>{U({key:Te(j),nonce:Date.now()}),f("threads")},onUnreadCountChange:R})}),u==="threads"?e.jsx(Hs,{api:t,session:s,setLastError:A,openThreadRequest:L,onThreadRequestConsumed:()=>U(null),isMobile:p}):null,u==="public"?e.jsx(Bs,{api:t,session:s,isMobile:p,setLastError:A}):null,u==="profile"||u==="settings"?b:null,u==="submissions"?e.jsx(Gs,{api:t,session:s,setLastError:A}):null,u==="promoted"?e.jsx(Vs,{api:t,session:s,setLastError:A}):null]})}export{Qs as Router};
