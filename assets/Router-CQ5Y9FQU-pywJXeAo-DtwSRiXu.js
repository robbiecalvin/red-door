const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./maplibre-gl-Cm4OUVEz-BHgQVMTY-D3xw1tSh.js","./index-BSe6MXd9.js","./index-DP67Pv4s.css"])))=>i.map(i=>d[i]);
import{B as i,y as e,Q as vt,M as Vt,L as Gt,U as qt,S as gs,H as ys,_ as fs}from"./index-BSe6MXd9.js";const Jt=(t,s=Jt,o=s.f||(s.f=["./maplibre-gl-Cm4OUVEz-BHgQVMTY.js","./index-BU6WHTzR.js","./index-CgnsFINl.css"]))=>t.map(C=>o[C]),Yt=(t,s=Yt,o=s.f||(s.f=["./maplibre-gl-Cm4OUVEz.js","./index-RNk_kvsm.js","./index-CcRnFIlo.css"]))=>t.map(C=>o[C]);function Xt(t){return typeof t=="object"&&t!==null}function hs(t){return!(!Xt(t)||typeof t.key!="string"||t.userType!=="guest"&&t.userType!=="registered"&&t.userType!=="subscriber"||typeof t.lat!="number"||!Number.isFinite(t.lat)||typeof t.lng!="number"||!Number.isFinite(t.lng)||typeof t.updatedAtMs!="number"||!Number.isFinite(t.updatedAtMs)||t.status!==void 0&&typeof t.status!="string")}function Zt(t){const[s,o]=i.useState(()=>new Map),[C,u]=i.useState(null),y=i.useRef(null),j=i.useRef(null);return i.useEffect(()=>{if(t.disabled===!0||t.wsUrl.trim()===""){o(new Map),u(null),j.current!==null&&(window.clearTimeout(j.current),j.current=null);return}let f=!1,B=0,F=null;const J=()=>{F!==null&&(window.clearInterval(F),F=null)},U=()=>{if(f)return;const h=Math.min(8e3,500*2**Math.min(B,4));j.current=window.setTimeout(()=>{j.current=null,A()},h)},A=()=>{if(f)return;let h;try{h=new WebSocket(t.wsUrl)}catch{B+=1,u("Realtime unavailable in this mode."),U();return}y.current=h;let d=!1;h.onopen=()=>{d=!0,B=0,u(null);const p={};t.sessionToken&&(p.sessionToken=t.sessionToken),t.jwt&&(p.jwt=t.jwt),h.send(JSON.stringify({type:"auth",payload:p})),F=window.setInterval(()=>{h.readyState===h.OPEN&&h.send(JSON.stringify({type:"heartbeat",payload:{}}))},15e3)},h.onmessage=p=>{const N=(()=>{try{return JSON.parse(String(p.data))}catch{return null}})();if(!N||typeof N.type!="string"){u("Invalid server message.");return}if(N.type==="error"&&Xt(N.payload)&&typeof N.payload.message=="string"){u(N.payload.message);return}if(N.type==="presence_update"){const _=N.payload;if(!hs(_)){u("Invalid presence payload.");return}o(x=>{const k=new Map(x);return k.set(_.key,_),k})}},h.onerror=()=>{},h.onclose=p=>{if(J(),!f&&p.code!==1e3){B+=1;const N=typeof p.reason=="string"&&p.reason.trim()!==""?` Reason: ${p.reason}`:"";(B>=2||d)&&u(`Realtime ${d?"disconnected":"failed to connect"} (code ${p.code}). Reconnecting...${N}`),U()}}};return A(),()=>{var h;f=!0,J(),j.current!==null&&(window.clearTimeout(j.current),j.current=null),(h=y.current)==null||h.close(1e3,"Client cleanup"),y.current=null}},[t.disabled,t.jwt,t.sessionToken,t.wsUrl]),{state:i.useMemo(()=>({byKey:s}),[s]),lastErrorMessage:C}}async function vs(){const t=await gs(()=>ys(()=>fs(()=>import("./maplibre-gl-Cm4OUVEz-BHgQVMTY-D3xw1tSh.js"),__vite__mapDeps([0,1,2]),import.meta.url),Jt([0,1,2]),import.meta.url).then(s=>s.m),Yt([0,1,2]),import.meta.url);return t.default??t}function bs(t){return t.replace(/[&<>"']/g,s=>{switch(s){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return s}})}function ms(){return{version:8,sources:{basemap:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png","https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"Â© OpenStreetMap contributors"}},layers:[{id:"basemap",type:"raster",source:"basemap"}]}}function xs(t){const s=document.createElement("button");return s.type="button",s.setAttribute("aria-label",t.label??"Presence marker"),s.style.width="36px",s.style.height="36px",s.style.borderRadius="999px",s.style.border=`2px solid ${t.color}`,t.markerType==="spot"?(s.style.background="radial-gradient(circle at 30% 30%, #ff4f60, #a70013)",s.style.display="grid",s.style.placeItems="center",s.style.color="#ffffff",s.style.fontWeight="700",s.style.fontSize="13px",s.textContent=typeof t.markerGlyph=="string"&&t.markerGlyph.trim()?t.markerGlyph.trim().slice(0,2):"SP"):typeof t.imageUrl=="string"&&t.imageUrl.trim()!==""?(s.style.backgroundImage=`url("${t.imageUrl}")`,s.style.backgroundSize="cover",s.style.backgroundPosition="center"):s.style.background="#000000",s.style.padding="0",s.style.cursor=typeof t.onClick=="function"?"pointer":"default",s}function js({initialView:t,markers:s,interactive:o,visible:C}){const u=i.useRef(null),y=i.useRef(null),j=i.useRef(null),f=i.useRef([]),[B,F]=i.useState({kind:"ready"}),J=i.useMemo(()=>t.center,[t.center]),U=o!==!1,A=C!==!1;return i.useEffect(()=>{let h=!1,d=null,p=null,N=null;async function _(){if(u.current&&!j.current)try{y.current||(y.current=await vs());const x=y.current,k=new x.Map({container:u.current,style:ms(),center:[J.lng,J.lat],zoom:t.zoom,interactive:U});k.addControl(new x.NavigationControl({showCompass:!1}),"top-right"),j.current=k;const I=()=>{k.resize()};p=I,N=window.requestAnimationFrame(I),window.addEventListener("resize",I),d=new ResizeObserver(()=>I()),d.observe(u.current),k.on("error",R=>{var $;const oe=(($=R.error)==null?void 0:$.message)??"Map error.";h||oe.toLowerCase().includes("failed to fetch")||oe.toLowerCase().includes("network")||F({kind:"error",message:oe})}),k.once("load",()=>{h||F({kind:"ready"})})}catch(x){if(h)return;F({kind:"error",message:x instanceof Error?x.message:"Map error."})}}return _(),()=>{var x;h=!0,N!==null&&window.cancelAnimationFrame(N),p&&window.removeEventListener("resize",p),d==null||d.disconnect();for(const k of f.current)k.remove();f.current=[],(x=j.current)==null||x.remove(),j.current=null}},[U]),i.useEffect(()=>{const h=j.current;if(!h||!A)return;h.resize();const d=window.setTimeout(()=>{h.resize(),h.setCenter([t.center.lng,t.center.lat]),h.setZoom(t.zoom)},80);return()=>window.clearTimeout(d)},[t.center.lat,t.center.lng,t.zoom,A]),i.useEffect(()=>{const h=j.current;if(!h||!A)return;h.resize();const d=window.setTimeout(()=>h.resize(),120);return()=>window.clearTimeout(d)},[A]),i.useEffect(()=>{const h=j.current,d=y.current;if(!(!h||!d)){for(const p of f.current)p.remove();f.current=[];for(const p of s){const N=typeof p.label=="string"&&p.label.trim()!==""?new d.Popup({closeButton:!1,closeOnClick:!0}).setHTML(`<div style="font-family: var(--ui); font-size: 12px; line-height: 1.35;">
                 <div style="font-weight: 600;">${bs(p.label)}</div>
               </div>`):void 0,_=xs(p);typeof p.onClick=="function"&&_.addEventListener("click",k=>{var I;k.preventDefault(),(I=p.onClick)==null||I.call(p)});const x=new d.Marker({element:_}).setLngLat([p.position.lng,p.position.lat]);N&&x.setPopup(N),x.addTo(h),f.current.push(x)}}},[s]),B.kind==="error"?e.jsxs("div",{style:{background:"#000000",color:"#F22F2F",border:"2px solid #C00000",borderRadius:8,padding:12,fontFamily:"var(--ui)",fontSize:14,lineHeight:1.4},role:"alert","aria-live":"polite",children:["Map error: ",B.message]}):e.jsx("div",{ref:u,className:"rd-maplibre",style:{width:"100%",height:"100%",background:"#000000",borderRadius:8,overflow:"hidden"},"aria-label":"Cruise map"})}const Wt=[Vt,Gt,qt];function ws(t){let s=0;for(let o=0;o<t.length;o+=1)s=s*31+t.charCodeAt(o)|0;return Math.abs(s)}function ks(t){return Wt[ws(t)%Wt.length]}function Ss(t,s,o){return t.map(C=>({id:C.key,position:{lat:C.lat,lng:C.lng},color:"#C00000",label:C.status?`Presence: ${C.status}`:"Presence",imageUrl:(s==null?void 0:s[C.key])??ks(C.key),onClick:o?()=>o(C.key):void 0}))}function Kt({wsUrl:t,sessionToken:s,jwt:o,defaultCenter:C,defaultZoom:u,presenceUpdates:y,realtimeErrorMessage:j,onMarkerSelect:f,avatarByKey:B,additionalMarkers:F,height:J,visible:U}){const A=Zt({wsUrl:t,sessionToken:s,jwt:o,disabled:Array.isArray(y)}),h=y?{byKey:new Map(y.map(R=>[R.key,R]))}:A.state,d=j??A.lastErrorMessage,[p,N]=i.useState({kind:"pending"});i.useEffect(()=>{if(!("geolocation"in navigator)||!navigator.geolocation){N({kind:"unavailable"});return}navigator.geolocation.getCurrentPosition(R=>{N({kind:"granted",center:{lat:R.coords.latitude,lng:R.coords.longitude}})},R=>{if(R.code===R.PERMISSION_DENIED){N({kind:"denied"});return}if(R.code===R.TIMEOUT){N({kind:"error",message:"Timed out while trying to read your location. Showing the default map view."});return}N({kind:"error",message:R.message||"Geolocation error."})},{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e4})},[]);const _=i.useMemo(()=>Array.from(h.byKey.values()),[h.byKey]),x=i.useMemo(()=>[...Ss(_,B,f),...F??[]],[F,B,f,_]),k=i.useMemo(()=>{const R=typeof u=="number"&&Number.isFinite(u)?u:13;return p.kind==="granted"?{center:p.center,zoom:R}:{center:C,zoom:R}},[C,u,p]),I=i.useMemo(()=>p.kind==="denied"?"Location permission denied. Showing the default map view.":p.kind==="unavailable"?"Geolocation is unavailable. Showing the default map view.":p.kind==="error"?`Geolocation error: ${p.message}`:null,[p]);return e.jsxs("section",{"aria-label":"Cruise mode map",style:{background:"#000000",color:"#FFFFFF",fontFamily:"var(--ui)",display:"grid",gap:8,height:"100%"},children:[I?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"rgba(0,0,0,0.7)",border:"1px solid rgba(255,58,77,0.45)",borderRadius:0,padding:8,color:"#AAAAAA",fontSize:12,lineHeight:1.4},children:I}):null,d?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"rgba(0,0,0,0.7)",border:"1px solid rgba(255,58,77,0.45)",borderRadius:0,padding:8,color:"#F22F2F",fontSize:12,lineHeight:1.4},children:d}):null,e.jsx("div",{style:{background:"#111111",border:0,borderRadius:0,overflow:"hidden",height:typeof J=="number"||typeof J=="string"?J:520},children:e.jsx(js,{initialView:k,markers:x,visible:U})})]})}const Cs="FIRE_SIGNAL|1";function Is(t){return new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function _t(t){if(!t.startsWith("LOCATION|"))return null;const[,s,o]=t.split("|"),C=Number(s),u=Number(o);return!Number.isFinite(C)||!Number.isFinite(u)?null:{lat:C,lng:u,link:`https://maps.google.com/?q=${C},${u}`}}function Ts(t){return t.trim()===Cs?"ðŸ”¥ I'm into you":t}function Qt({chatKind:t,peerKey:s,currentUserKey:o,messages:C,client:u,title:y,peerSummary:j,thirdParty:f,edgeToEdge:B,showHeader:F,fillHeight:J}){const[U,A]=i.useState(""),[h,d]=i.useState(null),[p,N]=i.useState(!1),[_,x]=i.useState({}),[k,I]=i.useState(!1),[R,$]=i.useState(!1),oe=i.useRef(null),ne=i.useRef([]),xe=i.useRef(null),le=i.useRef(null),de=i.useRef(null),g=B===!0,w=F!==!1,z=g&&J===!0,V=i.useMemo(()=>[...C].sort((a,O)=>a.createdAtMs-O.createdAtMs),[C]),M=i.useMemo(()=>Array.from(new Set(V.map(a=>{var O;return(O=a.media)==null?void 0:O.objectKey}).filter(a=>typeof a=="string"&&a.trim().length>0))),[V]);i.useEffect(()=>{let a=!1;async function O(){for(const r of M){if(a)return;if(!_[r])try{const b=await u.getMediaUrl(r);if(a)return;x(E=>({...E,[r]:b}))}catch{}}}return O(),()=>{a=!0}},[u,M,_]);async function Z(a){const O=U.trim();if(!(O.length===0&&!a)){N(!0),d(null);try{await u.sendMessage(t,s,O,a),A("")}catch(r){const b=r;d(typeof(b==null?void 0:b.message)=="string"?b.message:"Message rejected.")}finally{N(!1)}}}async function se(a){N(!0),d(null);try{const O=await u.initiateMediaUpload(a.type||"application/octet-stream",a.size);await u.uploadToSignedUrl(O.uploadUrl,a,a.type||"application/octet-stream");const r={kind:a.type.startsWith("image/")?"image":a.type.startsWith("video/")?"video":"audio",objectKey:O.objectKey,mimeType:a.type||"application/octet-stream"};await Z(r)}catch(O){const r=O;d(typeof(r==null?void 0:r.message)=="string"?r.message:"Upload rejected."),N(!1)}}async function ce(a){var O;const r=(O=a.target.files)==null?void 0:O[0];if(a.target.value="",!!r){if(!r.type.startsWith("image/")&&!r.type.startsWith("video/")&&!r.type.startsWith("audio/")){d("Only image, video, or audio files are supported.");return}await se(r)}}async function ue(){var a;if(k){(a=oe.current)==null||a.stop();return}if(!navigator.mediaDevices||typeof navigator.mediaDevices.getUserMedia!="function"){d("Microphone is not available in this browser.");return}try{const O=await navigator.mediaDevices.getUserMedia({audio:!0}),r=new MediaRecorder(O);ne.current=[],oe.current=r,r.ondataavailable=b=>{b.data.size>0&&ne.current.push(b.data)},r.onstop=()=>{const b=new Blob(ne.current,{type:r.mimeType||"audio/webm"}),E=new File([b],`voice-${Date.now()}.webm`,{type:r.mimeType||"audio/webm"});se(E);for(const pe of O.getTracks())pe.stop();oe.current=null,I(!1)},r.start(),I(!0)}catch(O){const r=O;d(typeof(r==null?void 0:r.message)=="string"?r.message:"Unable to record voice."),I(!1)}}async function je(){if(!navigator.geolocation){d("Geolocation is not available in this browser.");return}N(!0),d(null);try{const a=await new Promise((E,pe)=>{navigator.geolocation.getCurrentPosition(E,pe,{enableHighAccuracy:!1,timeout:12e3,maximumAge:3e4})}),O=Number(a.coords.latitude.toFixed(5)),r=Number(a.coords.longitude.toFixed(5)),b=`LOCATION|${O}|${r}`;await u.sendMessage(t,s,b)}catch(a){const O=a;d(typeof(O==null?void 0:O.message)=="string"?O.message:"Unable to send location.")}finally{N(!1)}}return e.jsxs("section",{"aria-label":"Chat",style:{background:g?"transparent":"#000000",color:"#FFFFFF",fontFamily:"Montserrat, sans-serif",padding:g?0:16,display:"grid",gap:g?0:12,gridTemplateRows:w?"auto auto 1fr auto":"1fr auto",minHeight:J?"calc(100dvh - 196px)":void 0},children:[w?e.jsxs("header",{style:{height:56,display:"grid",alignItems:"center",background:"#000000"},children:[e.jsx("div",{style:{textAlign:"center",fontSize:20,fontWeight:600},children:y}),j?e.jsxs("div",{style:{marginTop:4,display:"flex",alignItems:"center",justifyContent:"center",gap:8,color:"#b7d8e0",fontSize:13},children:[e.jsx("span",{children:"Chat with:"}),j.avatarUrl?e.jsx("img",{src:j.avatarUrl,alt:`${j.displayName} avatar`,style:{width:24,height:24,borderRadius:"50%",objectFit:"cover",border:"1px solid rgba(38,213,255,0.8)"}}):e.jsx("span",{"aria-hidden":!0,style:{width:24,height:24,borderRadius:"50%",border:"1px solid rgba(38,213,255,0.8)",background:"rgba(255,255,255,0.08)"}}),e.jsx("span",{style:{color:"#fff",fontWeight:600},children:j.displayName})]}):null,e.jsx("div",{style:{textAlign:"center",fontSize:12,color:"#AAAAAA"},children:t==="cruise"?"CRUISE CHAT (EPHEMERAL)":"DATE CHAT (PERSISTENT)"})]}):null,h?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"#111111",border:"2px solid #C00000",borderRadius:8,padding:12,color:"#F22F2F",fontSize:14,lineHeight:1.4},children:h}):null,e.jsx("div",{"aria-label":"Messages",style:{background:g?"#09090b":"#111111",border:g?"none":"2px solid #C00000",borderRadius:g?0:8,padding:12,display:"flex",flexDirection:"column",gap:12,minHeight:g?0:320,paddingBottom:z?148:12,overflowY:"auto"},children:V.length===0?e.jsx("div",{style:{color:"#AAAAAA",fontSize:14,lineHeight:1.4},children:"No messages."}):V.map(a=>{const O=a.fromKey===o,r=O?"#C00000":"#444444",b=O?{alignItems:"flex-end"}:{alignItems:"flex-start"};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,width:"100%",...b},children:[(()=>{const E=_t(a.text??"");return E?e.jsxs("a",{href:E.link,target:"_blank",rel:"noreferrer",style:{display:"grid",gap:6,textDecoration:"none",color:"#fff",background:r,borderRadius:14,padding:8,width:"auto",maxWidth:"80%"},children:[e.jsx("div",{style:{fontSize:12,color:"#d8ecff"},children:"Shared location"}),e.jsx("iframe",{title:"Google Maps location preview",src:`https://www.google.com/maps?q=${E.lat},${E.lng}&z=14&output=embed`,style:{width:"100%",height:140,border:"1px solid rgba(255,255,255,0.18)",borderRadius:10},loading:"lazy",referrerPolicy:"no-referrer-when-downgrade"}),e.jsx("div",{style:{fontSize:12,color:"#3fdfff"},children:"Open in Google Maps"})]}):null})(),e.jsxs("div",{style:{background:r,color:"#FFFFFF",borderRadius:18,padding:"8px 12px",width:"auto",maxWidth:"80%",fontSize:16,lineHeight:1.4,whiteSpace:"pre-wrap",overflowWrap:"anywhere",wordBreak:"break-word"},children:[a.text&&!_t(a.text)?e.jsx("div",{style:{marginBottom:a.media?8:0},children:Ts(a.text)}):null,a.media?e.jsxs("div",{children:[a.media.kind==="image"?e.jsx("img",{src:_[a.media.objectKey],alt:"Shared",style:{width:"100%",maxWidth:260,borderRadius:10,border:"1px solid rgba(255,255,255,0.18)"}}):null,a.media.kind==="video"?e.jsx("video",{controls:!0,playsInline:!0,src:_[a.media.objectKey],style:{width:"100%",maxWidth:320,borderRadius:10,background:"#000"}}):null,a.media.kind==="audio"?e.jsx("audio",{controls:!0,src:_[a.media.objectKey],style:{width:"100%",maxWidth:260}}):null]}):null]}),e.jsx("div",{style:{fontSize:10,color:"#AAAAAA"},children:Is(a.createdAtMs)}),O?e.jsx("div",{style:{fontSize:10,color:"#6fdcff"},children:typeof a.readAtMs=="number"?"Read":typeof a.deliveredAtMs=="number"?"Delivered":""}):null]},a.messageId)})}),e.jsxs("form",{onSubmit:a=>{a.preventDefault(),Z()},"aria-label":"Message input",style:{background:g?"linear-gradient(180deg, rgba(96,0,12,0.96), rgba(58,0,8,0.98))":"#111111",border:g?"none":"2px solid #C00000",borderRadius:g?0:8,padding:12,display:"grid",gridTemplateColumns:"1fr auto auto",gap:12,alignItems:"start",position:z?"fixed":"static",left:z?0:void 0,right:z?0:void 0,bottom:z?"calc(env(safe-area-inset-bottom, 0px) + 66px)":void 0,zIndex:z?45:void 0},children:[e.jsx("label",{style:{display:"grid"},children:e.jsx("input",{value:U,onChange:a=>A(a.target.value),placeholder:"Type a message",disabled:p,style:{width:"100%",background:"#111111",color:"#FFFFFF",border:"2px solid #444444",borderRadius:8,padding:"10px 12px",fontSize:16,lineHeight:1.4,outline:"none"},"aria-label":"Message text"})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{ref:xe,type:"file",accept:"image/*,video/*,audio/*",disabled:p,onChange:a=>void ce(a),style:{display:"none"}}),e.jsx("input",{ref:le,type:"file",accept:"image/*",capture:"environment",disabled:p,onChange:a=>void ce(a),style:{display:"none"}}),e.jsx("input",{ref:de,type:"file",accept:"video/*",capture:"environment",disabled:p,onChange:a=>void ce(a),style:{display:"none"}}),e.jsx("button",{type:"button",disabled:p,onClick:()=>$(a=>!a),style:{background:"rgba(0,0,0,0.45)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px",display:"grid",placeItems:"center",cursor:p?"not-allowed":"pointer",color:"#3fdfff",fontWeight:700,height:44,minWidth:44},"aria-label":"More actions",children:"+"}),R?e.jsxs("div",{style:{position:"absolute",right:0,top:z?void 0:48,bottom:z?48:void 0,zIndex:5,minWidth:220,display:"grid",gap:8,padding:10,borderRadius:10,border:"1px solid rgba(255,58,77,0.5)",background:"rgba(10,11,16,0.98)"},children:[e.jsx("button",{type:"button",disabled:p,onClick:()=>{var a;$(!1),(a=le.current)==null||a.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Take Photo"}),e.jsx("button",{type:"button",disabled:p,onClick:()=>{var a;$(!1),(a=de.current)==null||a.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Record Video"}),e.jsx("button",{type:"button",disabled:p,onClick:()=>{var a;$(!1),(a=xe.current)==null||a.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Choose Media"}),e.jsx("button",{type:"button",disabled:p,onClick:()=>{$(!1),ue()},style:{background:k?"#ff2136":"rgba(0,0,0,0.6)",color:"#fff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:k?"Stop Voice":"Record Voice"}),e.jsx("button",{type:"button",disabled:p,onClick:()=>{$(!1),je()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Send Location"}),f?e.jsxs("div",{style:{display:"grid",gap:8,borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:8},children:[e.jsxs("select",{value:f.selectedKey,onChange:a=>f.onSelect(a.target.value),disabled:f.disabled||f.candidates.length===0,style:{background:"#0b0d12",color:"#fff",border:"1px solid rgba(255,58,77,0.62)",borderRadius:10,padding:"8px 10px"},"aria-label":"Add previous contact to group",children:[f.candidates.length===0?e.jsx("option",{value:"",children:"No previous contacts"}):null,f.candidates.map(a=>e.jsx("option",{value:a.key,children:a.label},a.key))]}),e.jsx("button",{type:"button",onClick:()=>{f.onAdd(),$(!1)},disabled:f.disabled||f.candidates.length===0||!f.selectedKey,style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,58,77,0.62)",borderRadius:10,padding:"8px 10px",fontWeight:700},children:"Add Third User"})]}):null]}):null]}),e.jsx("button",{type:"submit",disabled:p,style:{background:p?"#333333":"#C00000",color:p?"#777777":"#FFFFFF",border:"2px solid #C00000",borderRadius:8,padding:"10px 20px",fontSize:16,fontWeight:600,cursor:p?"not-allowed":"pointer",height:44},"aria-label":"Send message",children:"SEND"})]})]})}const bt="FIRE_SIGNAL|1";function Le(){return{background:"radial-gradient(500px 220px at 10% 0%, rgba(255,28,46,0.15), transparent 58%), linear-gradient(180deg, rgba(8,8,10,0.88), rgba(4,4,5,0.9))",border:"1px solid rgba(255,56,74,0.56)",borderRadius:20,padding:14,boxShadow:"inset 0 1px 0 rgba(255,255,255,0.06), inset 0 0 0 1px rgba(0,0,0,0.28), 0 16px 32px rgba(0,0,0,0.42)"}}function fe(t){return{background:t?"rgba(90,90,90,0.55)":"linear-gradient(180deg, #ff2136, #c60012)",border:"1px solid rgba(255,70,90,0.68)",color:t?"#999999":"#FFFFFF",padding:"10px 18px",borderRadius:12,fontSize:15,fontWeight:700,letterSpacing:"0.04em",cursor:t?"not-allowed":"pointer",textTransform:"uppercase",boxShadow:t?"none":"inset 0 1px 0 rgba(255,255,255,0.2), 0 10px 22px rgba(198,0,18,0.34)"}}function W(t){return{background:"rgba(0,0,0,0.58)",border:"1px solid rgba(255,58,77,0.62)",color:"#3fdfff",padding:"10px 18px",borderRadius:12,fontSize:15,fontWeight:700,letterSpacing:"0.03em",cursor:t?"not-allowed":"pointer",textTransform:"uppercase",opacity:t?.6:1}}function X(){return{background:"rgba(6,7,10,0.92)",color:"#ffffff",border:"1px solid rgba(255,64,82,0.48)",borderRadius:12,padding:"10px 12px",fontSize:15}}function Ms(t){return typeof t=="string"}function H(t){const s=t;return Ms(s==null?void 0:s.message)?s.message:"Action rejected."}function pt(){const t="__disabled__".trim();if(t==="__disabled__")return"";if(t!==""){if(t.startsWith("ws://")||t.startsWith("wss://"))return t;try{const o=new URL(t);return o.protocol=o.protocol==="https:"?"wss:":"ws:",o.toString()}catch{if(t.startsWith("/")){const o=new URL(t,window.location.origin);return o.protocol=o.protocol==="https:"?"wss:":"ws:",o.toString()}}}const s=new URL("/ws",window.location.origin);return s.protocol=s.protocol==="https:"?"wss:":"ws:",s.toString()}const Ht=[Vt,Gt,qt];function Es(t){let s=0;for(let o=0;o<t.length;o+=1)s=s*31+t.charCodeAt(o)|0;return Math.abs(s)}function He(t){return Ht[Es(t)%Ht.length]}function ft(t){if(t.startsWith("user:")){const s=t.slice(5).trim();return s.length>0?s:null}if(t.startsWith("session:")){const s=t.slice(8).trim();return s.length>0?`guest:${s}`:null}return null}function Oe(t){if(t.startsWith("guest:")){const s=t.slice(6).trim();return s?`session:${s}`:`user:${t}`}return`user:${t}`}function Ce(t){const s=t.trim();if(!s)return s;if(s.startsWith("user:guest:")){const o=s.slice(11).trim();return o?`session:${o}`:s}if(s.startsWith("guest:")){const o=s.slice(6).trim();return o?`session:${o}`:s}return s}function Ns(t){return t.trim()===bt}function es(t){return Ns(t)?"ðŸ”¥ I'm into you":t}function ht(t,s){const o=B=>B*Math.PI/180,C=o(s.lat-t.lat),u=o(s.lng-t.lng),y=Math.sin(C/2),j=Math.sin(u/2),f=y*y+Math.cos(o(t.lat))*Math.cos(o(s.lat))*j*j;return 6371e3*(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)))}function $t(){try{const t=localStorage.getItem("reddoor_travel_center");if(!t)return null;const s=JSON.parse(t);return s.enabled!==!0?null:typeof s.lat=="number"&&Number.isFinite(s.lat)&&typeof s.lng=="number"&&Number.isFinite(s.lng)?{lat:s.lat,lng:s.lng}:null}catch{return null}}function Ps(){const[t,s]=i.useState(()=>window.matchMedia("(max-width: 900px)").matches);return i.useEffect(()=>{const o=window.matchMedia("(max-width: 900px)"),C=()=>s(o.matches);return C(),o.addEventListener("change",C),()=>o.removeEventListener("change",C)},[]),t}function Ze(t){return t==="instant"?"cruise":"date"}function As({api:t,session:s,settings:o,discoverFilter:C,busy:u,setBusy:y,setLastError:j,isMobile:f,onOpenThreadRequested:B,onUnreadCountChange:F}){var J,U,A,h,d,p;const[N,_]=i.useState("map"),[x,k]=i.useState(null),[I,R]=i.useState(null),[$,oe]=i.useState(null),[ne,xe]=i.useState([]),[le,de]=i.useState({}),[g,w]=i.useState([]),[z,V]=i.useState(new Set),[M,Z]=i.useState(new Set),[se,ce]=i.useState({}),[ue,je]=i.useState({}),[a,O]=i.useState(null),[r,b]=i.useState(0),[E,pe]=i.useState(!1),[he,ve]=i.useState([]),[we,me]=i.useState(null),[ie,re]=i.useState(()=>$t()),{state:Ie,lastErrorMessage:Ne}=Zt({wsUrl:pt(),sessionToken:s.sessionToken}),Pe=i.useMemo(()=>Array.from(Ie.byKey.values()),[Ie.byKey]);i.useEffect(()=>{const c=()=>{re($t())},v=S=>{(S.key===null||S.key==="reddoor_travel_center")&&c()};return c(),window.addEventListener("rd:location-updated",c),window.addEventListener("storage",v),()=>{window.removeEventListener("rd:location-updated",c),window.removeEventListener("storage",v)}},[]);const Te=s.userId?`user:${s.userId}`:`session:${s.sessionToken}`,Re=i.useMemo(()=>{const c=new Map;for(const v of ne)c.set(v.key,v);for(const v of Pe){const S=c.get(v.key);(!S||v.updatedAtMs>=S.updatedAtMs)&&c.set(v.key,v)}return Array.from(c.values())},[Pe,ne]),G=i.useMemo(()=>Re.filter(c=>c.key!==Te),[Te,Re]),be=i.useMemo(()=>$?[...G].sort((c,v)=>ht($,{lat:c.lat,lng:c.lng})-ht($,{lat:v.lat,lng:v.lng})):G,[G,$]);i.useEffect(()=>{let c=!1;async function v(){try{const D=await t.listActivePresence(s.sessionToken);if(c)return;const Q=Array.isArray(D.presence)?D.presence:[];xe(Q)}catch{c||xe([])}}v();const S=window.setInterval(()=>{v()},8e3);return()=>{c=!0,window.clearInterval(S)}},[t,s.sessionToken]),i.useEffect(()=>{x||be.length>0&&k(be[0].key)},[x,be]),i.useEffect(()=>{const c=be.filter(v=>!le[v.key]).map(v=>({key:v.key,profileId:ft(v.key)})).filter(v=>typeof v.profileId=="string");c.length!==0&&Promise.all(c.map(async v=>{var S,D;try{const Q=await t.getPublicProfile(v.profileId);return{key:v.key,displayName:(S=Q.profile)==null?void 0:S.displayName,age:(D=Q.profile)==null?void 0:D.age}}catch{return null}})).then(v=>{de(S=>{const D={...S};for(const Q of v)Q&&(D[Q.key]={displayName:Q.displayName,age:Q.age});return D})})},[t,le,be]),i.useEffect(()=>{(async()=>{try{let c=await t.getPublicProfiles();if(c.profiles.length===0&&!E){pe(!0);try{const v=$??ie??{lat:o.defaultCenterLat,lng:o.defaultCenterLng};await t.seedFakeUsers(12,v.lat,v.lng),c=await t.getPublicProfiles()}catch{}}w(c.profiles)}catch{w([])}if(s.userType==="guest"){V(new Set),Z(new Set);return}try{const c=await t.getFavorites(s.sessionToken);V(new Set(c.favorites))}catch{V(new Set)}try{const c=await t.listBlocked(s.sessionToken);Z(new Set(c.blocked))}catch{Z(new Set)}})()},[t,E,$,s.sessionToken,s.userType,o.defaultCenterLat,o.defaultCenterLng,ie]),i.useEffect(()=>{let c=!1;async function v(){try{const D=await t.listCruisingSpots();c||ve(D.spots)}catch{c||ve([])}}v();const S=window.setInterval(()=>{v()},12e3);return()=>{c=!0,window.clearInterval(S)}},[t]),i.useEffect(()=>{const c=Date.now(),v=g.flatMap(S=>{const D=[];return S.mainPhotoMediaId&&D.push(S.mainPhotoMediaId),Array.isArray(S.galleryMediaIds)&&D.push(...S.galleryMediaIds),S.videoMediaId&&D.push(S.videoMediaId),D}).filter(S=>typeof S=="string"&&S.length>0&&!se[S]&&c>=(ue[S]??0)).slice(0,6);v.length!==0&&Promise.all(v.map(async S=>{try{const D=await t.getPublicMediaUrl(S);return{mediaId:S,url:D.downloadUrl}}catch{return null}})).then(S=>{ce(D=>{const Q={...D};for(const ee of S)ee&&(Q[ee.mediaId]=ee.url);return Q}),je(D=>{const Q={...D};for(let ee=0;ee<v.length;ee+=1){const ge=v[ee];S[ee]?Q[ge]&&delete Q[ge]:Q[ge]=Date.now()+3e4}return Q})})},[t,ue,se,g]);async function Me(c){R(c),b(0);const v=ft(c);if(!v){O(null);return}try{if(c===Te){const S=await t.getMyProfile(s.sessionToken);typeof S.profile.mainPhotoMediaId=="string"&&S.profile.mainPhotoMediaId;const D=[S.profile.mainPhotoMediaId,...S.profile.galleryMediaIds??[],S.profile.videoMediaId].filter(Q=>typeof Q=="string"&&Q.length>0);if(D.length>0){const Q=await Promise.all(D.map(async ee=>{try{const ge=await t.getPublicMediaUrl(ee);return{mediaId:ee,downloadUrl:ge.downloadUrl}}catch{return null}}));ce(ee=>{const ge={...ee};for(const Se of Q)Se&&(ge[Se.mediaId]=Se.downloadUrl);return ge})}O({userId:S.profile.userId,displayName:S.profile.displayName,age:S.profile.age,bio:S.profile.bio,stats:S.profile.stats,discreetMode:S.profile.discreetMode,mainPhotoMediaId:S.profile.mainPhotoMediaId,galleryMediaIds:S.profile.galleryMediaIds,videoMediaId:S.profile.videoMediaId})}else{const S=await t.getPublicProfile(v),D=[S.profile.mainPhotoMediaId,...S.profile.galleryMediaIds??[],S.profile.videoMediaId].filter(Q=>typeof Q=="string"&&Q.length>0);if(D.length>0){const Q=await Promise.all(D.map(async ee=>{try{const ge=await t.getPublicMediaUrl(ee);return{mediaId:ee,downloadUrl:ge.downloadUrl}}catch{return null}}));ce(ee=>{const ge={...ee};for(const Se of Q)Se&&(ge[Se.mediaId]=Se.downloadUrl);return ge})}O(S.profile)}}catch(S){const D=S;if((D==null?void 0:D.code)==="PROFILE_HIDDEN"){R(null),O(null);return}O(null),j(H(S))}}async function Ae(c){if(s.userType==="guest"){j("Guests cannot star users. Register to save favorites.");return}if(!(!s.userId||s.userId===c))try{const v=await t.toggleFavorite(s.sessionToken,c);V(new Set(v.favorites))}catch(v){j(H(v))}}async function We(c){const v=Ce(c);if(!(!v||v===Te))try{await t.sendChat(s.sessionToken,"cruise",v,bt)}catch(S){j(H(S))}}async function ke(c){if(!(!c.trim()||c===Te)){if(s.userType==="guest"){j("Anonymous users cannot block users.");return}try{M.has(c)?await t.unblock(s.sessionToken,c):await t.block(s.sessionToken,c);const v=await t.listBlocked(s.sessionToken);Z(new Set(v.blocked))}catch(v){j(H(v))}}}async function Ke(){const c=ie??{lat:o.defaultCenterLat,lng:o.defaultCenterLng};if(!navigator.geolocation){oe(c);try{await t.updatePresence(s.sessionToken,c.lat,c.lng,"online")}catch{}return}try{const v=await new Promise((S,D)=>{navigator.geolocation.getCurrentPosition(S,D,{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e4})});oe({lat:v.coords.latitude,lng:v.coords.longitude}),await t.updatePresence(s.sessionToken,v.coords.latitude,v.coords.longitude,"online")}catch(v){oe(c);try{await t.updatePresence(s.sessionToken,c.lat,c.lng,"online")}catch{const S=v&&typeof v=="object"&&"message"in v&&typeof v.message=="string"?v.message:null;j(S??H(v))}}}i.useEffect(()=>{Ke();const c=window.setInterval(()=>{Ke()},3e4);return()=>window.clearInterval(c)},[s.sessionToken]),i.useEffect(()=>{const c=v=>{var S,D;const Q=v,ee=(S=Q.detail)==null?void 0:S.lat,ge=(D=Q.detail)==null?void 0:D.lng;!Number.isFinite(ee)||!Number.isFinite(ge)||(oe({lat:ee,lng:ge}),t.updatePresence(s.sessionToken,ee,ge,"online").catch(()=>{}))};return window.addEventListener("rd:location-updated",c),()=>window.removeEventListener("rd:location-updated",c)},[t,s.sessionToken]);const $e=i.useMemo(()=>{if(Re.some(v=>v.key===Te))return Re;const c=$??ie??{lat:o.defaultCenterLat,lng:o.defaultCenterLng};return[{key:Te,userType:s.userType,lat:c.lat,lng:c.lng,status:"online",updatedAtMs:Date.now()},...Re]},[Te,Re,$,s.userType,o.defaultCenterLat,o.defaultCenterLng,ie]),Fe=i.useMemo(()=>{const c={};for(const v of g){if(!v.mainPhotoMediaId)continue;const S=se[v.mainPhotoMediaId];S&&(c[Oe(v.userId)]=S)}return c},[se,g]),Ge=i.useMemo(()=>he.map(c=>({id:`spot:${c.spotId}`,position:{lat:c.lat,lng:c.lng},color:"#26d5ff",markerType:"spot",markerGlyph:"CS",label:`${c.name} | check-ins: ${c.checkInCount??0} | action: ${c.actionCount??0}`,onClick:()=>me(c.spotId)})),[he]),qe=e.jsx(Kt,{wsUrl:pt(),sessionToken:s.sessionToken,presenceUpdates:$e,realtimeErrorMessage:Ne,onMarkerSelect:c=>void Me(c),avatarByKey:Fe,additionalMarkers:Ge,defaultCenter:ie??{lat:o.defaultCenterLat,lng:o.defaultCenterLng},height:f?"calc(100vh - 340px)":600,visible:!0}),Je=e.jsxs("div",{style:{background:"#000",marginInline:-10},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,padding:"8px 10px",borderBottom:"1px solid rgba(255,58,77,0.25)"},children:[e.jsx("button",{type:"button",style:W(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"reset"}}))},children:"GUYS"}),e.jsx("button",{type:"button",style:W(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"toggle_favorites"}}))},"aria-label":"Toggle favorites only",children:"â˜…"}),e.jsx("button",{type:"button",style:W(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"open_filters"}})),_("chat")},children:"FILTER"})]}),e.jsx(Kt,{wsUrl:pt(),sessionToken:s.sessionToken,presenceUpdates:$e,realtimeErrorMessage:Ne,onMarkerSelect:c=>void Me(c),avatarByKey:Fe,additionalMarkers:Ge,defaultCenter:ie??{lat:o.defaultCenterLat,lng:o.defaultCenterLng},height:"calc(100dvh - 220px)",visible:N==="map"})]}),Qe=e.jsx(zs,{api:t,session:s,busy:u,setBusy:y,setLastError:j,onlinePeers:be,selectedPeerKey:x,setSelectedPeerKey:k,onOpenProfile:c=>void Me(c),isMobile:f,selfCoords:$,peerProfileByKey:le,discoverFilter:C,publicProfiles:g,favorites:z,mediaUrlById:se,onUnreadCountChange:F});return e.jsxs("div",{style:{display:"grid",gap:8},children:[f?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:N==="map"?"block":"none"},children:Je}),e.jsx("div",{style:{display:N==="chat"?"block":"none"},children:Qe}),e.jsx("div",{style:{position:"fixed",left:10,right:10,bottom:"calc(env(safe-area-inset-bottom, 0px) + 66px)",zIndex:41,padding:8,background:"rgba(0,0,0,0.35)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("button",{type:"button",style:N==="map"?fe(!1):W(!1),onClick:()=>_("map"),children:"MAP"}),e.jsx("button",{type:"button",style:N==="chat"?fe(!1):W(!1),onClick:()=>_("chat"),children:"CHAT"})]})})]}):e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1.2fr 1fr",gap:12,alignItems:"start"},children:[qe,Qe]}),I?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:80,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:f?"stretch":"center",padding:f?0:14},role:"dialog","aria-modal":"true","aria-label":"User profile",onClick:()=>R(null),children:e.jsx("div",{onClick:c=>c.stopPropagation(),style:f?{width:"100%",height:"100dvh",overflow:"auto",background:"linear-gradient(180deg, rgba(7,8,10,0.98), rgba(2,2,4,0.98))",borderRadius:0,border:"none",padding:"calc(env(safe-area-inset-top, 0px) + 56px) 12px calc(env(safe-area-inset-bottom, 0px) + 20px)"}:{...Le(),width:"min(680px, 100%)",maxHeight:"86vh",overflow:"auto"},children:e.jsxs("div",{style:{display:"grid",gap:14},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"106px 1fr auto",gap:12,alignItems:"center"},children:[e.jsxs("div",{style:{position:"relative",width:106,height:106},children:[e.jsx("img",{src:a!=null&&a.mainPhotoMediaId&&se[a.mainPhotoMediaId]?se[a.mainPhotoMediaId]:He(I),alt:"Profile avatar",style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"cover",border:"2px solid #ff3047"}}),e.jsx("span",{style:{position:"absolute",right:4,bottom:4,width:14,height:14,borderRadius:"50%",background:"#26d5ff",border:"2px solid #000"}})]}),e.jsxs("div",{style:{display:"grid",gap:6},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:(a==null?void 0:a.displayName)??I}),e.jsx("div",{style:{color:"#26d5ff",fontSize:14},children:"Instant Messaging Available"})]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[a&&a.userId!==(s.userId??"")?e.jsx("button",{type:"button",style:{...W(!1),color:"#26d5ff",borderColor:"rgba(38,213,255,0.62)",minWidth:126},onClick:()=>void Ae(a.userId),children:z.has(a.userId)?"â˜… STARRED":"â˜† STAR"}):null,a&&a.userId!==(s.userId??"")?e.jsx("button",{type:"button",style:{...W(!1),color:"#ffb347",borderColor:"rgba(255,179,71,0.65)",minWidth:126},onClick:()=>void We(Oe(a.userId)),children:"ðŸ”¥ FIRE"}):null,a&&a.userId!==(s.userId??"")?e.jsx("button",{type:"button",style:{...W(!1),color:M.has(Oe(a.userId))?"#ff9aa3":"#ffd4d8",borderColor:"rgba(255,120,130,0.62)",minWidth:126},onClick:()=>void ke(Oe(a.userId)),children:M.has(Oe(a.userId))?"UNBLOCK":"BLOCK"}):null,e.jsx("button",{type:"button",style:W(!1),onClick:()=>R(null),children:"CLOSE"})]})]}),e.jsxs("div",{style:{color:"#ced3dc",fontSize:14,lineHeight:1.5},children:[e.jsxs("div",{children:["Age: ",(a==null?void 0:a.age)??"-"]}),e.jsxs("div",{children:["Race: ",((J=a==null?void 0:a.stats)==null?void 0:J.race)??"-"]}),e.jsxs("div",{children:["Height: ",((U=a==null?void 0:a.stats)==null?void 0:U.heightInches)??"-"]}),e.jsxs("div",{children:["Weight: ",((A=a==null?void 0:a.stats)==null?void 0:A.weightLbs)??"-"]}),e.jsxs("div",{children:["Cock Size: ",((h=a==null?void 0:a.stats)==null?void 0:h.cockSizeInches)??"-"]}),e.jsxs("div",{children:["Cut / Uncut: ",((d=a==null?void 0:a.stats)==null?void 0:d.cutStatus)??"-"]}),e.jsxs("div",{children:["Position: ",((p=a==null?void 0:a.stats)==null?void 0:p.position)??"-"]}),e.jsxs("div",{style:{marginTop:8},children:["Bio: ",(a==null?void 0:a.bio)??"-"]})]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"MEDIA"}),a?e.jsx(e.Fragment,{children:(()=>{const c=[a.mainPhotoMediaId,...a.galleryMediaIds??[],a.videoMediaId].filter(ee=>typeof ee=="string"&&ee.length>0);if(c.length===0)return e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No uploaded media."});const v=Math.max(0,Math.min(r,c.length-1)),S=c[v],D=se[S],Q=S===a.videoMediaId;return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.4)",borderRadius:12,padding:8},children:Q?e.jsx("video",{controls:!0,playsInline:!0,src:D,style:{width:"100%",maxHeight:260,borderRadius:10,background:"#000"}}):e.jsx("img",{src:D??He(I??a.userId),alt:"Profile media",style:{width:"100%",maxHeight:260,objectFit:"cover",borderRadius:10}})}),e.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:c.map((ee,ge)=>{const Se=se[ee],Ye=ee===a.videoMediaId;return e.jsx("button",{type:"button",onClick:()=>b(ge),style:{width:64,height:64,padding:0,borderRadius:8,overflow:"hidden",border:ge===v?"2px solid #26d5ff":"1px solid rgba(255,58,77,0.4)",background:"#000",cursor:"pointer",color:"#fff",fontSize:10},"aria-label":Ye?"Open video":"Open photo",children:Ye?e.jsx("div",{style:{display:"grid",placeItems:"center",width:"100%",height:"100%"},children:Se?e.jsx("video",{src:Se,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}):"VIDEO"}):e.jsx("img",{src:Se??He(I??a.userId),alt:"Media thumbnail",style:{width:"100%",height:"100%",objectFit:"cover"}})},ee)})})]})})()}):null]}),e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:e.jsx("button",{type:"button",style:fe(!1),onClick:()=>{I&&B(I),R(null),b(0)},children:"CHAT"})})]})})}):null,we?e.jsx(Rs,{api:t,session:s,spot:he.find(c=>c.spotId===we)??null,onClose:()=>me(null),onUpdated:async()=>{try{const c=await t.listCruisingSpots();ve(c.spots)}catch{}},setLastError:j}):null]})}function Rs({api:t,session:s,spot:o,onClose:C,onUpdated:u,setLastError:y}){return o?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},role:"dialog","aria-modal":"true","aria-label":"Cruising spot",onClick:C,children:e.jsxs("div",{onClick:j=>j.stopPropagation(),style:{...Le(),width:"min(520px, 100%)",display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:o.name}),e.jsx("div",{style:{color:"#9fb6bf",fontSize:13},children:o.address}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap"},children:o.description}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:13},children:["Check-ins: ",o.checkInCount??0," | I got action there: ",o.actionCount??0]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:fe(!1),onClick:async()=>{try{await t.checkInCruisingSpot(s.sessionToken,o.spotId),await u()}catch(j){y(H(j))}},children:"CHECK IN"}),e.jsx("button",{type:"button",style:W(!1),onClick:async()=>{try{await t.markCruisingSpotAction(s.sessionToken,o.spotId),await u()}catch(j){y(H(j))}},children:"I GOT ACTION THERE"}),e.jsx("button",{type:"button",style:W(!1),onClick:C,children:"CLOSE"})]})]})}):null}function zs({api:t,session:s,busy:o,setBusy:C,setLastError:u,onlinePeers:y,selectedPeerKey:j,setSelectedPeerKey:f,onOpenProfile:B,openThreadRequest:F,onThreadRequestConsumed:J,isMobile:U,selfCoords:A,peerProfileByKey:h,discoverFilter:d,publicProfiles:p,favorites:N,mediaUrlById:_,onUnreadCountChange:x}){var k;const[I,R]=i.useState({}),[$,oe]=i.useState({}),[ne,xe]=i.useState("instant"),[le,de]=i.useState("grid"),[g,w]=i.useState(null),[z,V]=i.useState(""),[M,Z]=i.useState(null),[se,ce]=i.useState([]),[ue,je]=i.useState({}),[a,O]=i.useState(null),[r,b]=i.useState({}),[E,pe]=i.useState({}),[he,ve]=i.useState(!1),[we,me]=i.useState(""),[ie,re]=i.useState(null),Ie=i.useRef(!1),Ne=i.useRef(!1),Pe=i.useRef(0),Te=i.useRef(null),Re=i.useRef(null),G=i.useRef(null),be=i.useRef(null),Me=i.useRef(null),Ae=i.useRef(0),We=i.useRef(new Set),ke=i.useRef(null),Ke=i.useRef(null),$e=i.useRef(null),[Fe,Ge]=i.useState(null),[qe,Je]=i.useState(d==="favorites"),[Qe,c]=i.useState(!1),[v,S]=i.useState(d==="online"?"online":"all"),[D,Q]=i.useState(!1),[ee,ge]=i.useState(""),[Se,Ye]=i.useState(""),[et,mt]=i.useState(""),[tt,xt]=i.useState(""),[st,jt]=i.useState(""),[it,wt]=i.useState(""),[nt,kt]=i.useState(""),[rt,St]=i.useState(""),[at,Ct]=i.useState(""),[ot,It]=i.useState(""),[lt,Tt]=i.useState(""),Ee=s.userId?`user:${s.userId}`:`session:${s.sessionToken}`,ae=g??j??"",ts=ae?I[ae]??[]:[],Mt=i.useMemo(()=>new Map(y.map(n=>[n.key,n])),[y]),Ue=i.useMemo(()=>{const n={};for(const l of p)typeof l.displayName=="string"&&l.displayName.trim()&&(n[Oe(l.userId)]=l.displayName);for(const[l,m]of Object.entries(h))typeof m.displayName=="string"&&m.displayName.trim()&&(n[l]=m.displayName);return n},[h,p]),Et=i.useMemo(()=>p.filter(n=>n.userId!==(s.userId??"")).map(n=>{const l=Oe(n.userId),m=Mt.get(l);return{key:l,userId:n.userId,displayName:n.displayName,age:n.age,stats:n.stats,meters:m&&A?Math.round(ht(A,{lat:m.lat,lng:m.lng})):null,isOnline:!!m,hasPicture:typeof n.mainPhotoMediaId=="string"&&n.mainPhotoMediaId.trim().length>0,avatarUrl:n.mainPhotoMediaId?_[n.mainPhotoMediaId]:void 0}}),[_,Mt,p,A,s.userId]),Be=i.useMemo(()=>{const n=ee.trim()?Number(ee):void 0,l=Se.trim()?Number(Se):void 0,m=tt.trim()?Number(tt):void 0,P=st.trim()?Number(st):void 0,T=it.trim()?Number(it):void 0,Y=nt.trim()?Number(nt):void 0,te=rt.trim()?Number(rt):void 0,K=at.trim()?Number(at):void 0;return Et.filter(L=>{var q,ye,ze,De,ut,_e,Ft,Ut,Ot;if(qe&&!N.has(L.userId)||v==="online"&&!L.isOnline||v==="offline"&&L.isOnline||D&&!L.hasPicture||Number.isFinite(n)&&(typeof L.age!="number"||L.age<n)||Number.isFinite(l)&&(typeof L.age!="number"||L.age>l))return!1;const ps=typeof((q=L.stats)==null?void 0:q.race)=="string"?L.stats.race:"";return!(et.trim()&&ps.toLowerCase()!==et.trim().toLowerCase()||Number.isFinite(m)&&(typeof((ye=L.stats)==null?void 0:ye.heightInches)!="number"||L.stats.heightInches<m)||Number.isFinite(P)&&(typeof((ze=L.stats)==null?void 0:ze.heightInches)!="number"||L.stats.heightInches>P)||Number.isFinite(T)&&(typeof((De=L.stats)==null?void 0:De.weightLbs)!="number"||L.stats.weightLbs<T)||Number.isFinite(Y)&&(typeof((ut=L.stats)==null?void 0:ut.weightLbs)!="number"||L.stats.weightLbs>Y)||Number.isFinite(te)&&(typeof((_e=L.stats)==null?void 0:_e.cockSizeInches)!="number"||L.stats.cockSizeInches<te)||Number.isFinite(K)&&(typeof((Ft=L.stats)==null?void 0:Ft.cockSizeInches)!="number"||L.stats.cockSizeInches>K)||ot&&((Ut=L.stats)==null?void 0:Ut.cutStatus)!==ot||lt&&((Ot=L.stats)==null?void 0:Ot.position)!==lt)})},[Et,N,qe,ot,Se,at,st,nt,ee,rt,tt,it,lt,et,D,v]),dt=i.useMemo(()=>Array.from(new Set(Be.map(n=>n.key).filter(n=>n.trim().length>0))).slice(0,8),[Be]),Nt=dt.join("|"),ct=i.useMemo(()=>{const n=new Set(Object.keys($));return ae.trim()&&n.add(ae),Array.from(n).sort((l,m)=>{var P,T;return(((P=$[m])==null?void 0:P.lastAt)??0)-(((T=$[l])==null?void 0:T.lastAt)??0)})},[$,ae]),Pt=i.useMemo(()=>Object.values(r).reduce((n,l)=>n+(Number.isFinite(l)?l:0),0),[r]);i.useMemo(()=>{var n;return ae?Ue[ae]??((n=h[ae])==null?void 0:n.displayName)??ae:""},[Ue,ae,h]);const ss=i.useMemo(()=>{if(!ae)return;const n=Be.find(l=>l.key===ae);return n==null?void 0:n.avatarUrl},[Be,ae]),Ve=i.useMemo(()=>ct.filter(n=>n!==ae&&n!==Ee&&!!$[n]).map(n=>{var l;return{key:n,label:Ue[n]??((l=h[n])==null?void 0:l.displayName)??n}}),[ct,$,Ue,Ee,ae,h]);i.useEffect(()=>{typeof x=="function"&&x(Pt)},[x,Pt]),i.useEffect(()=>{const n=Te.current;n&&(n.srcObject=ie)},[ie]),i.useEffect(()=>{const n=Re.current;n&&(n.srcObject=Fe)},[Fe]),i.useEffect(()=>()=>{if(ie){for(const n of ie.getTracks())n.stop();if(Fe)for(const n of Fe.getTracks())n.stop();ke.current&&(ke.current.close(),ke.current=null)}},[ie,Fe]),i.useEffect(()=>{if(Ve.length===0){V("");return}V(n=>n&&Ve.some(l=>l.key===n)?n:Ve[0].key)},[Ve]);const is=i.useMemo(()=>({async sendMessage(n,l,m,P){const T=Ce(l),Y=await t.sendChat(s.sessionToken,n,T,m,P),te=Y==null?void 0:Y.message,K=[te];if(n==="cruise"&&M)try{const L=await t.sendChat(s.sessionToken,n,Ce(M),m,P),q=L==null?void 0:L.message;K.push(q)}catch(L){u(H(L))}for(const L of K)At(L);return te},async initiateMediaUpload(n,l){const m=await t.initiateChatMediaUpload(s.sessionToken,{mimeType:n,sizeBytes:l});return{objectKey:m.objectKey,uploadUrl:m.uploadUrl}},async uploadToSignedUrl(n,l,m){if(!await vt(n,l,m)&&!(await fetch(n,{method:"PUT",headers:{"content-type":m},body:l})).ok)throw{code:"MEDIA_UPLOAD_INCOMPLETE",message:"Upload failed."}},async getMediaUrl(n){return(await t.getChatMediaUrl(s.sessionToken,n)).downloadUrl}}),[t,Ee,s.sessionToken,u,M]);function Xe(n){var l,m,P;return n.text&&n.text.trim()?es(n.text):((l=n.media)==null?void 0:l.kind)==="image"?"[Photo]":((m=n.media)==null?void 0:m.kind)==="video"?"[Video]":((P=n.media)==null?void 0:P.kind)==="audio"?"[Voice]":""}function ns(n){if(!n||We.current.has(n))return!1;if(We.current.add(n),We.current.size>5e3){const l=Array.from(We.current).slice(-2500);We.current=new Set(l)}return!0}function rs(n,l){var m;const P=Ue[l]??((m=h[l])==null?void 0:m.displayName)??l,T=Xe(n)||"New activity";if("Notification"in window){if(Notification.permission==="granted"){try{new Notification(`${P}`,{body:T})}catch{}return}Notification.permission==="default"&&Notification.requestPermission()}}function as(n){if(!n.startsWith("GROUP_INVITE_REQUEST|"))return null;const[,l,m,P]=n.split("|");return!l||!m||!P?null:{inviteId:l,inviterKey:m,primaryPeerKey:P}}function os(n){if(!n.startsWith("GROUP_INVITE_ACCEPT|"))return null;const[,l,m]=n.split("|");return!l||!m?null:{inviteId:l,candidateKey:m}}function At(n){if(!ns(n.messageId))return;const l=n.fromKey===Ee?n.toKey:n.fromKey;R(T=>{const Y=T[l]??[];return Y.some(te=>te.messageId===n.messageId)?T:{...T,[l]:[...Y,n].sort((te,K)=>te.createdAtMs-K.createdAtMs)}}),oe(T=>({...T,[l]:{lastAt:n.createdAtMs,lastText:Xe(n)}})),n.fromKey!==Ee&&(le==="thread"&&Ce(ae)===Ce(l)?(pe(T=>({...T,[l]:Math.max(T[l]??0,n.createdAtMs)})),b(T=>{const Y={...T};return delete Y[l],Y})):b(T=>({...T,[l]:(T[l]??0)+1})),rs(n,l));const m=as(n.text??"");m&&n.toKey===Ee&&ce(T=>T.some(Y=>Y.inviteId===m.inviteId)?T:[...T,{...m,createdAtMs:n.createdAtMs}]);const P=os(n.text??"");P&&n.toKey===Ee&&ue[P.inviteId]&&(Z(Ce(P.candidateKey)),O(`Invite accepted by ${Ue[P.candidateKey]??P.candidateKey}.`),je(T=>{const Y={...T};return delete Y[P.inviteId],Y}))}async function ls(n){const l=Ce(n);if(l)try{const m=await t.listChat(s.sessionToken,Ze(ne),l),P=m==null?void 0:m.messages,T=Array.isArray(P)?P:[];t.markChatRead(s.sessionToken,Ze(ne),l).catch(()=>{}),R(K=>({...K,[l]:T}));const Y=T.length>0?T[T.length-1]:null;Y&&oe(K=>({...K,[l]:{lastAt:Y.createdAtMs,lastText:Xe(Y)}}));let te=0;for(const K of T)K.fromKey===l&&K.createdAtMs>te&&(te=K.createdAtMs);te>0&&pe(K=>({...K,[l]:Math.max(K[l]??0,te)}))}catch(m){u(H(m))}}i.useEffect(()=>{if(le!=="thread"||!ae.trim())return;let n=!1,l=!1,m=null;const P=async()=>{if(!(n||l)){l=!0;try{await ls(ae)}finally{l=!1}n||(m=window.setTimeout(()=>{P()},1200))}};return P(),()=>{n=!0,m!==null&&window.clearTimeout(m)}},[ne,ae,le]),i.useEffect(()=>{if(le!=="grid")return;if(dt.length===0){b({});return}let n=!1;async function l(){if(!Ie.current&&!document.hidden){Ie.current=!0;try{const T=Ze(ne),Y=[],te=[];for(const L of dt){if(n)break;try{const q=Ce(L);if(!q)continue;const ye=await t.listChat(s.sessionToken,T,q),ze=(ye==null?void 0:ye.messages)??[];if(ze.length>0){const _e=ze[ze.length-1];te.push([q,{lastAt:_e.createdAtMs,lastText:Xe(_e)}])}let De=0;const ut=E[q]??0;for(const _e of ze)_e.fromKey===q&&_e.createdAtMs>ut&&(De+=1);Y.push([q,De])}catch{const q=Ce(L);q&&Y.push([q,0])}}if(n)return;te.length>0&&oe(L=>{const q={...L};for(const[ye,ze]of te)q[ye]=ze;return q});const K={};for(const[L,q]of Y)q>0&&(K[L]=q);b(K)}finally{Ie.current=!1}}}const m=window.setTimeout(()=>{l()},1200),P=window.setInterval(()=>{l()},15e3);return()=>{n=!0,Ie.current=!1,window.clearTimeout(m),window.clearInterval(P)}},[t,ne,E,s.sessionToken,Nt,le]),i.useEffect(()=>{const n=Array.from(new Set([...ct,...dt,ae].map(Y=>Ce(Y)).filter(Y=>Y.length>0))).slice(0,10);if(n.length===0)return;let l=!1;const m=async()=>{if(!(l||document.hidden||Ne.current)){Ne.current=!0;try{const Y=Ze(ne),te=[];for(const K of n){if(l)break;try{const L=await t.listChat(s.sessionToken,Y,K),q=(L==null?void 0:L.messages)??[];if(q.length===0)continue;const ye=q[q.length-1];te.push([K,{lastAt:ye.createdAtMs,lastText:Xe(ye)}])}catch{}}if(l||te.length===0)return;oe(K=>{const L={...K};for(const[q,ye]of te)L[q]=ye;return L})}finally{Ne.current=!1}}},P=window.setTimeout(()=>{m()},1e3),T=window.setInterval(()=>{m()},5e3);return()=>{l=!0,window.clearTimeout(P),window.clearInterval(T)}},[t,ne,ct,ae,s.sessionToken,Nt]);async function ds(){if(ie)return ie;if(!navigator.mediaDevices||typeof navigator.mediaDevices.getUserMedia!="function")throw{code:"UNAUTHORIZED_ACTION",message:"Camera access is not available in this browser."};const n=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});return re(n),n}function cs(n,l){ke.current&&(ke.current.close(),ke.current=null);const m=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});return ke.current=m,Ke.current=l,$e.current=n,m.ontrack=P=>{const T=P.streams[0];T&&Ge(T)},m.onicecandidate=P=>{const T=P.candidate;if(!T)return;const Y=$e.current,te=Ke.current;!Y||!te||t.sendCallSignal(s.sessionToken,{toKey:Y,callId:te,signalType:"ice",candidate:JSON.stringify(T.toJSON())}).catch(()=>{})},m}async function Rt(n=!0){const l=$e.current,m=Ke.current;if(n&&l&&m)try{await t.sendCallSignal(s.sessionToken,{toKey:l,callId:m,signalType:"hangup"})}catch{}if(ie)for(const P of ie.getTracks())P.stop();if(Fe)for(const P of Fe.getTracks())P.stop();re(null),Ge(null),ke.current&&(ke.current.close(),ke.current=null),Ke.current=null,$e.current=null,ve(!1)}i.useEffect(()=>{let n=!1;const l=pt();if(!l)return;const m=()=>{be.current!==null&&(window.clearInterval(be.current),be.current=null),Me.current!==null&&(window.clearTimeout(Me.current),Me.current=null)},P=()=>{if(n)return;const T=new WebSocket(l);G.current=T,T.onopen=()=>{Ae.current=0,T.send(JSON.stringify({type:"auth",payload:{sessionToken:s.sessionToken}})),be.current=window.setInterval(()=>{T.readyState===T.OPEN&&T.send(JSON.stringify({type:"heartbeat",payload:{}}))},15e3)},T.onmessage=Y=>{let te=null;try{te=JSON.parse(String(Y.data))}catch{return}if(!te||typeof te.type!="string")return;if(te.type==="chat_message"){const q=te.payload,ye=q==null?void 0:q.message;if(!ye||ye.fromKey!==Ee&&ye.toKey!==Ee)return;At(ye);return}if(te.type!=="call_signal")return;const K=te.payload;if(!K||K.toKey!==Ee||typeof K.fromKey!="string"||!K.callId||!K.signalType)return;const L=Ce(K.fromKey);if(K.signalType==="hangup"){Rt(!1);return}if(K.signalType==="offer"){(async()=>{try{gt(L),me(L);const q=await ds(),ye=cs(L,K.callId);for(const De of q.getTracks())ye.addTrack(De,q);await ye.setRemoteDescription({type:"offer",sdp:K.sdp??""});const ze=await ye.createAnswer();await ye.setLocalDescription(ze),await t.sendCallSignal(s.sessionToken,{toKey:L,callId:K.callId,signalType:"answer",sdp:ze.sdp??""}),ve(!0)}catch(q){u(H(q))}})();return}if(K.signalType==="answer"){(async()=>{try{if(!ke.current||Ke.current!==K.callId)return;await ke.current.setRemoteDescription({type:"answer",sdp:K.sdp??""})}catch(q){u(H(q))}})();return}K.signalType==="ice"&&(async()=>{try{if(!ke.current||Ke.current!==K.callId||!K.candidate)return;const q=JSON.parse(K.candidate);await ke.current.addIceCandidate(q)}catch{}})()},T.onclose=()=>{if(m(),n)return;Ae.current+=1;const Y=Math.min(8e3,500*2**Math.min(Ae.current,4));Me.current=window.setTimeout(P,Y)},T.onerror=()=>{}};return P(),()=>{var T;n=!0,m(),(T=G.current)==null||T.close(1e3,"chat cleanup"),G.current=null}},[t,Ee,s.sessionToken]);async function us(){if(z.trim()){if(!ae.trim()){u("Select a user first.");return}try{const n=Ce(z);if(!n)return;if(!Ve.some(m=>m.key===n)){u("You can only add a third user you have previously messaged.");return}const l=crypto.randomUUID();await t.sendChat(s.sessionToken,"cruise",n,`GROUP_INVITE_REQUEST|${l}|${Ee}|${ae.trim()}`),je(m=>({...m,[l]:{candidateKey:n,primaryPeerKey:ae.trim()}})),O(`Invite sent to ${Ue[n]??n}. Waiting for acceptance.`)}catch(n){u(H(n))}}}async function zt(n,l,m){try{await t.sendChat(s.sessionToken,"cruise",l,`GROUP_INVITE_ACCEPT|${n}|${Ee}`),ce(P=>P.filter(T=>T.inviteId!==n)),O("Group invite accepted."),gt(m)}catch(P){u(H(P))}}function Lt(n){ce(l=>l.filter(m=>m.inviteId!==n))}function gt(n){const l=Ce(n);f(l),w(l),b(m=>{const P={...m};return delete P[l],P}),pe(m=>({...m,[l]:Date.now()})),de("thread")}function yt(){Je(!1),S("all"),Q(!1),ge(""),Ye(""),mt(""),xt(""),jt(""),wt(""),kt(""),St(""),Ct(""),It(""),Tt(""),c(!1)}if(i.useEffect(()=>{const n=l=>{var m;const P=(m=l.detail)==null?void 0:m.action;if(P==="reset"){yt(),de("grid");return}if(P==="toggle_favorites"){Je(T=>!T),de("grid");return}P==="open_filters"&&(c(!0),de("grid"))};return window.addEventListener("rd:discover-control",n),()=>window.removeEventListener("rd:discover-control",n)},[]),i.useEffect(()=>{F&&F.nonce!==Pe.current&&(Pe.current=F.nonce,gt(F.key),typeof J=="function"&&J())},[J,F]),i.useEffect(()=>{const n=l=>{var m;((m=l.detail)==null?void 0:m.tab)==="discover"&&(de("grid"),w(null),c(!1))};return window.addEventListener("rd:tab-select",n),()=>window.removeEventListener("rd:tab-select",n)},[]),le==="thread"&&ae.trim()){const n=Ue[ae]??((k=h[ae])==null?void 0:k.displayName)??ae;return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:U?-10:0},children:[se.length>0?e.jsxs("div",{style:{...Le(),display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"INVITE REQUESTS"}),se.map(l=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,alignItems:"center"},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:13},children:[Ue[l.inviterKey]??l.inviterKey," invited you to join a conversation."]}),e.jsx("button",{type:"button",style:fe(!1),onClick:()=>void zt(l.inviteId,l.inviterKey,l.primaryPeerKey),children:"ACCEPT"}),e.jsx("button",{type:"button",style:W(!1),onClick:()=>Lt(l.inviteId),children:"DECLINE"})]},l.inviteId))]}):null,a?e.jsx("div",{style:{color:"#26d5ff",fontSize:12},children:a}):null,e.jsx(Qt,{chatKind:Ze(ne),peerKey:ae,currentUserKey:Ee,messages:ts,client:is,title:`INSTANT THREAD: ${n}`,peerSummary:{displayName:n,avatarUrl:ss},thirdParty:{candidates:Ve,selectedKey:z,onSelect:l=>V(l),onAdd:()=>void us(),disabled:o},showHeader:!1,edgeToEdge:U,fillHeight:U}),he?e.jsx("div",{role:"dialog","aria-modal":"true","aria-label":"Video call",style:{position:"fixed",inset:0,zIndex:60,background:"rgba(0,0,0,0.82)",display:"grid",placeItems:"center",padding:16},children:e.jsxs("div",{style:{...Le(),width:"min(720px, 100%)",display:"grid",gap:10},children:[e.jsxs("div",{style:{fontSize:18,fontWeight:700},children:["VIDEO CALL: ",we]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("video",{ref:Te,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"100%",maxHeight:"52vh",borderRadius:12,background:"#000"}}),e.jsx("video",{ref:Re,autoPlay:!0,playsInline:!0,style:{width:"100%",maxHeight:"52vh",borderRadius:12,background:"#000"}})]}),e.jsx("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:e.jsx("button",{type:"button",style:W(!1),onClick:()=>void Rt(),children:"END CALL"})})]})}):null]})}return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:U?-10:0},children:[se.length>0?e.jsxs("div",{style:{...Le(),display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"INVITE REQUESTS"}),se.map(n=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,alignItems:"center"},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:13},children:[Ue[n.inviterKey]??n.inviterKey," invited you to join a conversation."]}),e.jsx("button",{type:"button",style:fe(!1),onClick:()=>void zt(n.inviteId,n.inviterKey,n.primaryPeerKey),children:"ACCEPT"}),e.jsx("button",{type:"button",style:W(!1),onClick:()=>Lt(n.inviteId),children:"DECLINE"})]},n.inviteId))]}):null,a?e.jsx("div",{style:{color:"#26d5ff",fontSize:12},children:a}):null,e.jsx("div",{style:{padding:10,borderBottom:"1px solid rgba(255,58,77,0.28)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8},children:[e.jsx("button",{type:"button",style:W(!1),onClick:yt,children:"GUYS"}),e.jsx("button",{type:"button",style:qe?fe(!1):W(!1),onClick:()=>Je(n=>!n),"aria-label":"Toggle favorites only",children:"â˜…"}),e.jsx("button",{type:"button",style:W(!1),onClick:()=>c(!0),children:"FILTER"})]})}),Qe?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},role:"dialog","aria-modal":"true","aria-label":"Discover filters",onClick:()=>c(!1),children:e.jsx("div",{onClick:n=>n.stopPropagation(),style:{...Le(),width:"min(760px, 100%)",maxHeight:"86vh",overflow:"auto"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"FILTER USERS"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{type:"checkbox",checked:D,onChange:n=>Q(n.target.checked)}),"Has pictures"]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Online status"}),e.jsxs("select",{style:X(),value:v,onChange:n=>S(n.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"offline",children:"Offline"})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[e.jsx("input",{style:X(),placeholder:"Min age",value:ee,onChange:n=>ge(n.target.value)}),e.jsx("input",{style:X(),placeholder:"Max age",value:Se,onChange:n=>Ye(n.target.value)}),e.jsx("input",{style:X(),placeholder:"Race",value:et,onChange:n=>mt(n.target.value)}),e.jsxs("select",{style:X(),value:ot,onChange:n=>It(n.target.value),children:[e.jsx("option",{value:"",children:"Cut / Uncut"}),e.jsx("option",{value:"cut",children:"Cut"}),e.jsx("option",{value:"uncut",children:"Uncut"})]}),e.jsx("input",{style:X(),placeholder:"Min height (in)",value:tt,onChange:n=>xt(n.target.value)}),e.jsx("input",{style:X(),placeholder:"Max height (in)",value:st,onChange:n=>jt(n.target.value)}),e.jsx("input",{style:X(),placeholder:"Min weight (lbs)",value:it,onChange:n=>wt(n.target.value)}),e.jsx("input",{style:X(),placeholder:"Max weight (lbs)",value:nt,onChange:n=>kt(n.target.value)}),e.jsx("input",{style:X(),placeholder:"Min cock size (in)",value:rt,onChange:n=>St(n.target.value)}),e.jsx("input",{style:X(),placeholder:"Max cock size (in)",value:at,onChange:n=>Ct(n.target.value)}),e.jsxs("select",{style:X(),value:lt,onChange:n=>Tt(n.target.value),children:[e.jsx("option",{value:"",children:"Position"}),e.jsx("option",{value:"top",children:"Top"}),e.jsx("option",{value:"bottom",children:"Bottom"}),e.jsx("option",{value:"side",children:"Side"})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:W(!1),onClick:yt,children:"RESET"}),e.jsx("button",{type:"button",style:fe(!1),onClick:()=>c(!1),children:"DONE"})]})]})})}):null,e.jsx("div",{style:{display:"grid",gap:0},children:e.jsx("div",{style:{display:"grid",gap:0,gridTemplateColumns:"repeat(3, minmax(0, 1fr))"},children:Be.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:13,padding:12,gridColumn:"1 / -1"},children:"No users match current filters."}):Be.map(n=>e.jsx("button",{type:"button",onClick:()=>B(n.key),style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:0,display:"grid",gap:0,color:"#fff",cursor:"pointer"},children:e.jsxs("div",{style:{position:"relative",width:"100%",aspectRatio:"1 / 1"},children:[e.jsx("img",{src:n.avatarUrl??He(n.key),alt:"User avatar",style:{width:"100%",height:"100%",borderRadius:0,objectFit:"cover",border:"1px solid #0fd9ff"}}),n.isOnline?e.jsx("span",{style:{position:"absolute",top:4,left:4,width:10,height:10,borderRadius:"50%",background:"#26d5ff",border:"2px solid #000"}}):null]})},n.key))})})]})}function Ls({api:t,session:s,setLastError:o,openThreadRequest:C,onThreadRequestConsumed:u,isMobile:y}){var j,f,B,F,J,U;const[A,h]=i.useState([]),[d,p]=i.useState(null),[N,_]=i.useState([]),[x,k]=i.useState("messages"),[I,R]=i.useState(null),[$,oe]=i.useState(!1),[ne,xe]=i.useState(""),[le,de]=i.useState(null),[g,w]=i.useState({}),[z,V]=i.useState(null),M=s.userId?`user:${s.userId}`:`session:${s.sessionToken}`,Z="cruise",se=i.useMemo(()=>A.filter(r=>r.key!==d).map(r=>({key:r.key,label:r.displayName})),[A,d]),ce=i.useMemo(()=>A.find(r=>r.key===d)??null,[A,d]);i.useEffect(()=>{if(se.length===0){xe("");return}xe(r=>r&&se.some(b=>b.key===r)?r:se[0].key)},[se]),i.useEffect(()=>{let r=!1;async function b(){var pe,he,ve;try{const we=s.userId?`user:${s.userId}`:`session:${s.sessionToken}`,[me,ie]=await Promise.all([t.getPublicProfiles(),t.listActivePresence(s.sessionToken)]),re={},Ie={};for(const G of me.profiles)re[Oe(G.userId)]=G.displayName,typeof G.mainPhotoMediaId=="string"&&G.mainPhotoMediaId.trim()!==""&&(Ie[Oe(G.userId)]=G.mainPhotoMediaId);const Ne=Array.from(new Set([...me.profiles.map(G=>Oe(G.userId)),...ie.presence.map(G=>Ce(G.key))].filter(G=>G&&G!==we))).slice(0,24),Pe=[];for(const G of Ne)try{const be=await t.listChat(s.sessionToken,"cruise",G),Me=(be==null?void 0:be.messages)??[];if(!Array.isArray(Me)||Me.length===0)continue;const Ae=Me[Me.length-1],We=typeof Ae.text=="string"&&Ae.text.trim().length>0?es(Ae.text):((pe=Ae.media)==null?void 0:pe.kind)==="image"?"[Photo]":((he=Ae.media)==null?void 0:he.kind)==="video"?"[Video]":((ve=Ae.media)==null?void 0:ve.kind)==="audio"?"[Voice]":"";Pe.push({key:G,displayName:re[G]??G,preview:We,at:Ae.createdAtMs})}catch{}const Te=await Promise.all(Pe.map(async G=>{const be=Ie[G.key];if(!be)return null;try{const Me=await t.getPublicMediaUrl(be);return{key:G.key,url:Me.downloadUrl}}catch{return null}})),Re={};for(const G of Te)G&&(Re[G.key]=G.url);for(const G of Pe)G.avatarUrl=Re[G.key];if(r)return;Pe.sort((G,be)=>be.at-G.at),h(Pe)}catch(we){r||o(H(we))}}b();const E=window.setInterval(()=>{b()},1e4);return()=>{r=!0,window.clearInterval(E)}},[t,d,s.sessionToken,s.userId,o]),i.useEffect(()=>{C!=null&&C.key&&(p(Ce(C.key)),k("messages"),typeof u=="function"&&u())},[u,C]),i.useEffect(()=>{const r=b=>{var E;((E=b.detail)==null?void 0:E.tab)==="threads"&&(p(null),k("messages"))};return window.addEventListener("rd:tab-select",r),()=>window.removeEventListener("rd:tab-select",r)},[]),i.useEffect(()=>{if(!d||x!=="profile")return;const r=ft(d);if(!r){R(null);return}let b=!1;return oe(!0),t.getPublicProfile(r).then(E=>{b||R(E.profile)}).catch(E=>{b||(R(null),o(H(E)))}).finally(()=>{b||oe(!1)}),()=>{b=!0}},[t,d,o,x]),i.useEffect(()=>{if(!d){_([]);return}let r=!1;const b=async()=>{try{const pe=await t.listChat(s.sessionToken,Z,d),he=(pe==null?void 0:pe.messages)??[];r||(_(Array.isArray(he)?he:[]),t.markChatRead(s.sessionToken,Z,d).catch(()=>{}))}catch(pe){r||o(H(pe))}};b();const E=window.setInterval(()=>{b()},1200);return()=>{r=!0,window.clearInterval(E)}},[t,d,s.sessionToken,o]);function ue(r){if(!r.startsWith("GROUP_INVITE_ACCEPT|"))return null;const[,b,E]=r.split("|");return!b||!E?null:{inviteId:b,candidateKey:E}}const je=i.useMemo(()=>({async sendMessage(r,b,E,pe){const he=await t.sendChat(s.sessionToken,r,b,E,pe),ve=he==null?void 0:he.message,we=ue(ve.text??"");if(we&&ve.toKey===M&&g[we.inviteId]&&(de(we.candidateKey),V(`Invite accepted by ${we.candidateKey}.`),w(me=>{const ie={...me};return delete ie[we.inviteId],ie})),_(me=>[...me,ve].sort((ie,re)=>ie.createdAtMs-re.createdAtMs)),r==="cruise"&&le)try{const me=await t.sendChat(s.sessionToken,r,le,E,pe),ie=me==null?void 0:me.message;_(re=>[...re,ie].sort((Ie,Ne)=>Ie.createdAtMs-Ne.createdAtMs))}catch(me){o(H(me))}return ve},async initiateMediaUpload(r,b){const E=await t.initiateChatMediaUpload(s.sessionToken,{mimeType:r,sizeBytes:b});return{objectKey:E.objectKey,uploadUrl:E.uploadUrl}},async uploadToSignedUrl(r,b,E){if(!await vt(r,b,E)&&!(await fetch(r,{method:"PUT",headers:{"content-type":E},body:b})).ok)throw{code:"MEDIA_UPLOAD_INCOMPLETE",message:"Upload failed."}},async getMediaUrl(r){return(await t.getChatMediaUrl(s.sessionToken,r)).downloadUrl}}),[t,M,g,s.sessionToken,o,le]);async function a(){var r;if(!(!d||!ne)){if(!A.some(b=>b.key===ne)){o("You can only add a third user you have previously messaged.");return}try{const b=crypto.randomUUID();await t.sendChat(s.sessionToken,"cruise",ne,`GROUP_INVITE_REQUEST|${b}|${M}|${d}`),w(E=>({...E,[b]:{candidateKey:ne}})),V(`Invite sent to ${((r=A.find(E=>E.key===ne))==null?void 0:r.displayName)??ne}.`)}catch(b){o(H(b))}}}async function O(){if(d)try{await t.sendChat(s.sessionToken,"cruise",d,bt),V("Fire sent.")}catch(r){o(H(r))}}if(d){const r=(ce==null?void 0:ce.displayName)??d;return e.jsxs("div",{style:{display:"grid",gap:0,minHeight:y?"calc(100dvh - 150px)":void 0,marginInline:y?-10:0,marginBlock:0},children:[e.jsx("div",{style:{position:"sticky",top:0,zIndex:46,background:"rgba(8,8,12,0.96)",borderBottom:"1px solid rgba(255,58,77,0.35)",padding:"6px 10px",display:"flex",justifyContent:"flex-end"},children:e.jsx("button",{type:"button",onClick:()=>k(b=>b==="messages"?"profile":"messages"),style:{background:"transparent",border:0,color:"#26d5ff",fontSize:13,fontWeight:700,letterSpacing:"0.03em",textTransform:"uppercase",padding:0,cursor:"pointer"},children:x==="messages"?"View Profile":"Back to Thread"})}),x==="messages"?e.jsx(Qt,{chatKind:"cruise",peerKey:d,currentUserKey:M,messages:N,client:je,title:`INSTANT THREAD: ${r}`,peerSummary:{displayName:r},thirdParty:{candidates:se,selectedKey:ne,onSelect:b=>xe(b),onAdd:()=>void a(),disabled:!1},showHeader:!1,edgeToEdge:!0,fillHeight:y}):e.jsxs("div",{style:{padding:12,display:"grid",gap:12},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"88px 1fr",gap:12,alignItems:"center"},children:[e.jsx("img",{src:(ce==null?void 0:ce.avatarUrl)??He(d),alt:"Profile avatar",style:{width:88,height:88,borderRadius:"50%",objectFit:"cover",border:"2px solid #ff3047"}}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:24,fontWeight:700},children:(I==null?void 0:I.displayName)??r}),e.jsx("div",{style:{color:"#26d5ff",fontSize:14},children:"Instant Messaging Available"})]})]}),$?e.jsx("div",{style:{color:"#9fb6bf",fontSize:14},children:"Loading profile..."}):null,$?null:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:14,lineHeight:1.5},children:[e.jsxs("div",{children:["Age: ",(I==null?void 0:I.age)??"-"]}),e.jsxs("div",{children:["Race: ",((j=I==null?void 0:I.stats)==null?void 0:j.race)??"-"]}),e.jsxs("div",{children:["Height: ",((f=I==null?void 0:I.stats)==null?void 0:f.heightInches)??"-"]}),e.jsxs("div",{children:["Weight: ",((B=I==null?void 0:I.stats)==null?void 0:B.weightLbs)??"-"]}),e.jsxs("div",{children:["Cock Size: ",((F=I==null?void 0:I.stats)==null?void 0:F.cockSizeInches)??"-"]}),e.jsxs("div",{children:["Cut / Uncut: ",((J=I==null?void 0:I.stats)==null?void 0:J.cutStatus)??"-"]}),e.jsxs("div",{children:["Position: ",((U=I==null?void 0:I.stats)==null?void 0:U.position)??"-"]}),e.jsxs("div",{style:{marginTop:8},children:["Bio: ",(I==null?void 0:I.bio)??"-"]})]}),e.jsx("div",{children:e.jsx("button",{type:"button",style:{...W(!1),color:"#ffb347",borderColor:"rgba(255,179,71,0.65)"},onClick:()=>void O(),children:"ðŸ”¥ FIRE"})})]})]})]})}return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:y?-10:0,marginBlock:0},children:[A.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14,padding:14},children:"No conversations yet."}):A.map(r=>e.jsxs("button",{type:"button",onClick:()=>p(r.key),style:{border:0,borderBottom:"1px solid rgba(255,58,77,0.24)",borderRadius:0,padding:"10px 12px",background:"rgba(0,0,0,0.2)",textAlign:"left",color:"#fff",cursor:"pointer",display:"grid",gridTemplateColumns:"52px 1fr",gap:10,alignItems:"center",width:"100%"},children:[e.jsx("img",{src:r.avatarUrl??He(r.key),alt:`${r.displayName} avatar`,style:{width:52,height:52,borderRadius:6,objectFit:"cover",border:"1px solid rgba(38,213,255,0.9)"}}),e.jsxs("div",{style:{display:"grid",gap:3,minWidth:0},children:[e.jsx("div",{style:{fontWeight:700},children:r.displayName}),e.jsx("div",{style:{color:"#b9bec9",fontSize:13,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:r.preview})]})]},r.key)),z?e.jsx("div",{style:{color:"#26d5ff",fontSize:12,padding:10},children:z}):null]})}function Fs({api:t,session:s,isMobile:o,setLastError:C}){const[u,y]=i.useState("ads"),[j,f]=i.useState([]),[B,F]=i.useState([]),[J,U]=i.useState(""),[A,h]=i.useState(""),[d,p]=i.useState(""),[N,_]=i.useState(""),[x,k]=i.useState([]),[I,R]=i.useState(""),[$,oe]=i.useState(""),[ne,xe]=i.useState(""),[le,de]=i.useState([]),[g,w]=i.useState({}),z=!0,V=s.userType!=="guest";async function M(){try{const[r,b,E,pe]=await Promise.all([t.listPublicPostings("ad"),t.listPublicPostings("event"),t.listCruisingSpots(),s.userType==="guest"?Promise.resolve({postings:[]}):t.listEventInvites(s.sessionToken)]);f([...r.postings].sort((he,ve)=>he.createdAtMs-ve.createdAtMs)),F([...b.postings].sort((he,ve)=>he.createdAtMs-ve.createdAtMs)),k(E.spots),de(pe.postings)}catch(r){C(H(r))}}i.useEffect(()=>{M()},[]),i.useEffect(()=>{const r=b=>{var E;((E=b.detail)==null?void 0:E.tab)==="public"&&y("ads")};return window.addEventListener("rd:tab-select",r),()=>window.removeEventListener("rd:tab-select",r)},[]);async function Z(r){if(r==="event"&&!V){C("Anonymous users cannot create event postings.");return}const b=r==="ad"?J:d,E=r==="ad"?A:N;try{await t.createPublicPosting(s.sessionToken,{type:r,title:b,body:E}),r==="ad"?(U(""),h("")):(p(""),_("")),await M()}catch(pe){C(H(pe))}}async function se(r){if(!V){C("Anonymous users cannot invite to events.");return}const b=(g[r]??"").trim();if(!b){C("Target user id is required.");return}try{await t.inviteToEvent(s.sessionToken,{postingId:r,targetUserId:b}),w(E=>({...E,[r]:""})),await M()}catch(E){C(H(E))}}async function ce(r,b){if(s.userType==="guest"){C("Anonymous users cannot respond to event invites.");return}try{await t.respondToEventInvite(s.sessionToken,{postingId:r,accept:b}),await M()}catch(E){C(H(E))}}async function ue(){try{await t.createCruisingSpot(s.sessionToken,{name:I,address:$,description:ne}),R(""),oe(""),xe(""),await M()}catch(r){C(H(r))}}async function je(r){try{await t.checkInCruisingSpot(s.sessionToken,r),await M()}catch(b){C(H(b))}}const a=r=>{const b=r==="ads"?"ADS":"EVENTS",E=r==="ads"?j:B,pe=r==="ads"?J:d,he=r==="ads"?A:N,ve=r==="ads"?U:p,we=r==="ads"?h:_,me=r==="ads"?"ad":"event",ie=r==="ads"?z:V;return e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.38)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:b}),e.jsx("input",{value:pe,onChange:re=>ve(re.target.value),placeholder:`${b} title`,style:X(),"aria-label":`${b} title`,disabled:!ie}),e.jsx("textarea",{value:he,onChange:re=>we(re.target.value),placeholder:`Write ${b.toLowerCase()} details`,style:{...X(),minHeight:86,resize:"vertical"},"aria-label":`${b} details`,disabled:!ie}),e.jsxs("button",{type:"button",onClick:()=>void Z(me),style:ie?fe(!1):W(!0),disabled:!ie,children:["POST ",b]}),ie?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can view events but cannot post events."}),e.jsx("div",{style:{display:"grid",gap:8,marginTop:6},children:E.length===0?e.jsxs("div",{style:{color:"#b9bec9",fontSize:14},children:["No ",b.toLowerCase()," yet."]}):E.map(re=>{var Ie,Ne;return e.jsxs("div",{style:{borderTop:"1px solid rgba(255,58,77,0.25)",paddingTop:10,paddingBottom:10},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:4},children:re.title}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12,marginBottom:6},children:["Host: ",re.authorUserId]}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap"},children:re.body}),r==="events"?e.jsxs("div",{style:{display:"grid",gap:8,marginTop:8},children:[e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12},children:["Invited: ",((Ie=re.invitedUserIds)==null?void 0:Ie.length)??0," | Accepted: ",((Ne=re.acceptedUserIds)==null?void 0:Ne.length)??0]}),s.userId&&s.userId===re.authorUserId?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8},children:[e.jsx("input",{value:g[re.postingId]??"",onChange:Pe=>w(Te=>({...Te,[re.postingId]:Pe.target.value})),placeholder:"Invite user id",style:X()}),e.jsx("button",{type:"button",style:W(!1),onClick:()=>void se(re.postingId),children:"INVITE"})]}):null,s.userType!=="guest"&&s.userId&&Array.isArray(re.invitedUserIds)&&re.invitedUserIds.includes(s.userId)?e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:fe(!1),onClick:()=>void ce(re.postingId,!0),children:"ACCEPT INVITE"}),e.jsx("button",{type:"button",style:W(!1),onClick:()=>void ce(re.postingId,!1),children:"DECLINE"})]}):null]}):null]},re.postingId)})})]})})},O=e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.38)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"CRUISING SPOTS"}),e.jsx("input",{value:I,onChange:r=>R(r.target.value),placeholder:"Spot name",style:X(),disabled:!1}),e.jsx("input",{value:$,onChange:r=>oe(r.target.value),placeholder:"Spot address",style:X(),disabled:!1}),e.jsx("textarea",{value:ne,onChange:r=>xe(r.target.value),placeholder:"Spot description",style:{...X(),minHeight:80,resize:"vertical"},disabled:!1}),e.jsx("button",{type:"button",style:fe(!1),disabled:!1,onClick:()=>void ue(),children:"CREATE SPOT"}),null,e.jsx("div",{style:{display:"grid",gap:8},children:x.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"No cruising spots yet."}):x.map(r=>e.jsxs("div",{style:{borderTop:"1px solid rgba(255,58,77,0.25)",paddingTop:10,paddingBottom:10},children:[e.jsx("div",{style:{fontWeight:700},children:r.name}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12,marginTop:4},children:["Created by: ",r.creatorUserId]}),e.jsx("div",{style:{color:"#9fb6bf",fontSize:12,marginTop:2},children:r.address}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap",marginTop:6},children:r.description}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:W(!1),onClick:()=>void je(r.spotId),children:"CHECK IN"}),e.jsxs("span",{style:{color:"#9fb6bf",fontSize:12},children:["Checked in: ",r.checkInCount??0]}),e.jsxs("span",{style:{color:"#9fb6bf",fontSize:12},children:["Got action: ",r.actionCount??0]})]})]},r.spotId))})]})});return e.jsx("div",{style:{display:"grid",gap:8,marginInline:o?-10:0},children:o?e.jsxs(e.Fragment,{children:[u==="ads"?a("ads"):null,u==="events"?a("events"):null,u==="spots"?O:null,e.jsx("div",{style:{position:"sticky",bottom:"calc(86px + env(safe-area-inset-bottom, 0px))",zIndex:31,background:"rgba(0,0,0,0.35)",padding:8},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[e.jsx("button",{type:"button",style:u==="ads"?fe(!1):W(!1),onClick:()=>y("ads"),children:"ADS"}),e.jsx("button",{type:"button",style:u==="events"?fe(!1):W(!1),onClick:()=>y("events"),children:"EVENTS"}),e.jsx("button",{type:"button",style:u==="spots"?fe(!1):W(!1),onClick:()=>y("spots"),children:"SPOTS"})]})})]}):e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[a("ads"),a("events"),e.jsx("div",{style:{gridColumn:"1 / -1"},children:O}),s.userType!=="guest"&&le.length>0?e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.25)",gridColumn:"1 / -1",display:"grid",gap:8,padding:10},children:[e.jsx("div",{style:{fontSize:16,fontWeight:700},children:"EVENT INVITES"}),le.map(r=>e.jsxs("div",{style:{display:"grid",gap:6,border:"1px solid rgba(255,58,77,0.4)",borderRadius:10,padding:8},children:[e.jsx("div",{style:{fontWeight:700},children:r.title}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13},children:["Host: ",r.authorUserId]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:fe(!1),onClick:()=>void ce(r.postingId,!0),children:"ACCEPT"}),e.jsx("button",{type:"button",style:W(!1),onClick:()=>void ce(r.postingId,!1),children:"DECLINE"})]})]},r.postingId))]}):null]})})}function Us({api:t,session:s,setLastError:o}){const[C,u]=i.useState([]),[y,j]=i.useState(""),[f,B]=i.useState("");async function F(){try{const d=await t.listSubmissions();u([...d.submissions].sort((p,N)=>N.createdAtMs-p.createdAtMs))}catch(d){o(H(d))}}i.useEffect(()=>{F()},[]);async function J(){try{await t.createSubmission(s.sessionToken,{title:y,body:f}),j(""),B(""),await F()}catch(d){o(H(d))}}async function U(d){try{await t.recordSubmissionView(d),await F()}catch(p){o(H(p))}}async function A(d,p){try{await t.rateSubmission(d,p),await F()}catch(N){o(H(N))}}const h=s.userType!=="guest";return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("input",{style:X(),value:y,onChange:d=>j(d.target.value),placeholder:"Story title",disabled:!h}),e.jsx("textarea",{style:{...X(),minHeight:120},value:f,onChange:d=>B(d.target.value),placeholder:"Write your story",disabled:!h}),e.jsx("button",{type:"button",style:h?fe(!1):W(!0),disabled:!h,onClick:()=>void J(),children:"PUBLISH STORY"}),h?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can read but cannot publish submissions."})]})}),e.jsx("div",{style:{display:"grid",gap:10},children:C.map(d=>{const p=d.ratingCount>0?(d.ratingSum/d.ratingCount).toFixed(2):"0.00";return e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.28)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:d.title}),e.jsx("div",{style:{color:"#ced3dc",whiteSpace:"pre-wrap",marginTop:6},children:d.body}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13,marginTop:8},children:["Views: ",d.viewCount," | Rating: ",p," (",d.ratingCount,")"]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:W(!1),onClick:()=>void U(d.submissionId),children:"VIEW"}),e.jsx("button",{type:"button",style:W(!1),onClick:()=>void A(d.submissionId,1),children:"â˜…1"}),e.jsx("button",{type:"button",style:W(!1),onClick:()=>void A(d.submissionId,2),children:"â˜…2"}),e.jsx("button",{type:"button",style:W(!1),onClick:()=>void A(d.submissionId,3),children:"â˜…3"}),e.jsx("button",{type:"button",style:W(!1),onClick:()=>void A(d.submissionId,4),children:"â˜…4"}),e.jsx("button",{type:"button",style:W(!1),onClick:()=>void A(d.submissionId,5),children:"â˜…5"})]})]},d.submissionId)})})]})}function Os({api:t,session:s,setLastError:o}){var C,u,y,j,f,B;const[F,J]=i.useState([]),[U,A]=i.useState({}),[h,d]=i.useState(null),[p,N]=i.useState(2e3),[_,x]=i.useState(""),[k,I]=i.useState(""),[R,$]=i.useState(""),[oe,ne]=i.useState(""),[xe,le]=i.useState("Ready."),de=s.userType!=="guest";async function g(){try{const M=await t.listPromotedProfiles();J([...M.listings].sort((ue,je)=>je.createdAtMs-ue.createdAtMs)),N(M.feeCents);const Z=Array.from(new Set(M.listings.map(ue=>ue.userId))).filter(ue=>ue.trim().length>0),se=await Promise.all(Z.map(async ue=>{try{const je=(await t.getPublicProfile(ue)).profile.mainPhotoMediaId;if(!je)return null;const a=await t.getPublicMediaUrl(je);return{userId:ue,url:a.downloadUrl}}catch{return null}})),ce={};for(const ue of se)ue&&(ce[ue.userId]=ue.url);A(ce)}catch(M){o(H(M))}}i.useEffect(()=>{g()},[]);async function w(){if(!de){o("Anonymous users cannot create promoted profiles.");return}try{const M=await t.startPromotedPayment(s.sessionToken),Z=await t.confirmPromotedPayment(s.sessionToken,M.payment.paymentToken);ne(Z.payment.paymentToken),le("Payment confirmed. You can now publish one promoted profile.")}catch(M){const Z=H(M);le(Z),o(Z)}}async function z(){if(!de){o("Anonymous users cannot create promoted profiles.");return}try{await t.createPromotedProfile(s.sessionToken,{paymentToken:oe,title:_,body:k,displayName:R}),x(""),I(""),$(""),ne(""),le("Promoted profile published."),await g()}catch(M){const Z=H(M);le(Z),o(Z)}}async function V(M){try{const Z=await t.getPublicProfile(M);d(Z.profile)}catch(Z){o(H(Z))}}return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"PROMOTED PROFILES"}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:14},children:["Publishing requires a $",Math.round(p/100)," fee per profile."]}),e.jsx("div",{style:{color:"#26d5ff",fontSize:13},children:xe})]})}),e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("input",{value:R,onChange:M=>$(M.target.value),placeholder:"Display name",style:X(),disabled:!de}),e.jsx("input",{value:_,onChange:M=>x(M.target.value),placeholder:"Headline",style:X(),disabled:!de}),e.jsx("textarea",{value:k,onChange:M=>I(M.target.value),placeholder:"Profile description",style:{...X(),minHeight:92,resize:"vertical"},disabled:!de}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsxs("button",{type:"button",style:W(!de),disabled:!de,onClick:()=>void w(),children:["PAY $",Math.round(p/100)]}),e.jsx("button",{type:"button",style:de?fe(!1):W(!0),disabled:!de,onClick:()=>void z(),children:"PUBLISH PROFILE"})]}),de?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can browse but cannot publish paid profiles."})]})}),e.jsx("div",{style:{display:"grid",gap:10},children:F.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"No promoted profiles yet."}):F.map(M=>e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.25)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"72px 1fr",gap:10,alignItems:"start"},children:[e.jsx("img",{src:U[M.userId]??He(`user:${M.userId}`),alt:`${M.displayName} profile`,style:{width:72,height:72,borderRadius:6,objectFit:"cover",border:"1px solid rgba(38,213,255,0.9)"}}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:M.title}),e.jsx("div",{style:{color:"#26d5ff",fontSize:13},children:M.displayName}),e.jsx("div",{style:{color:"#ced3dc",whiteSpace:"pre-wrap",fontSize:14},children:M.body}),e.jsx("button",{type:"button",style:W(!1),onClick:()=>void V(M.userId),children:"VIEW PROFILE"})]})]})},M.listingId))}),h?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},onClick:()=>d(null),children:e.jsxs("div",{onClick:M=>M.stopPropagation(),style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:12,width:"min(560px, 100%)",background:"rgba(0,0,0,0.88)"},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:h.displayName}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:6},children:["Age: ",h.age]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Race: ",((C=h.stats)==null?void 0:C.race)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Height: ",((u=h.stats)==null?void 0:u.heightInches)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Weight: ",((y=h.stats)==null?void 0:y.weightLbs)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Cock Size: ",((j=h.stats)==null?void 0:j.cockSizeInches)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Cut / Uncut: ",((f=h.stats)==null?void 0:f.cutStatus)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Position: ",((B=h.stats)==null?void 0:B.position)??"-"]}),e.jsx("div",{style:{color:"#ced3dc",marginTop:10,whiteSpace:"pre-wrap"},children:h.bio}),e.jsx("div",{style:{marginTop:10},children:e.jsx("button",{type:"button",style:W(!1),onClick:()=>d(null),children:"CLOSE"})})]})}):null]})}function Ws(){return{displayName:"",age:"",bio:"",heightInches:"",race:"",cockSizeInches:"",cutStatus:"",weightLbs:"",position:"",discreetMode:!1,travelEnabled:!1,travelLat:"",travelLng:"",lookingForMore:""}}function Dt(t){var s,o,C;return{displayName:t.displayName,age:String(t.age),bio:t.bio,heightInches:t.stats.heightInches!==void 0?String(t.stats.heightInches):"",race:t.stats.race??"",cockSizeInches:t.stats.cockSizeInches!==void 0?String(t.stats.cockSizeInches):"",cutStatus:t.stats.cutStatus??"",weightLbs:t.stats.weightLbs!==void 0?String(t.stats.weightLbs):"",position:t.stats.position??"",discreetMode:t.discreetMode===!0,travelEnabled:((s=t.travelMode)==null?void 0:s.enabled)===!0,travelLat:typeof((o=t.travelMode)==null?void 0:o.lat)=="number"?String(t.travelMode.lat):"",travelLng:typeof((C=t.travelMode)==null?void 0:C.lng)=="number"?String(t.travelMode.lng):"",lookingForMore:t.bio}}function Bt(t){const s=t.trim();if(!s)return;const o=Number(s);return Number.isFinite(o)?Math.trunc(o):void 0}function Ks(t){const s=t.trim();if(!s)return;const o=Number(s);return Number.isFinite(o)?o:void 0}function _s({api:t,session:s,setLastError:o}){var C,u;const[y,j]=i.useState(Ws()),[f,B]=i.useState(null),[F,J]=i.useState(!1),[U,A]=i.useState(!1),[h,d]=i.useState(null),[p,N]=i.useState({});async function _(){J(!0);try{const g=await t.getMyProfile(s.sessionToken);B(g.profile),j(Dt(g.profile)),d("Profile loaded.")}catch(g){const w=g;if((w==null?void 0:w.code)==="PROFILE_NOT_FOUND"){B(null),j(z=>({...z,age:z.age||"18"})),d("No profile yet. Fill out the form and save.");return}d(H(g))}finally{J(!1)}}i.useEffect(()=>{_()},[s.sessionToken,s.userType]),i.useEffect(()=>{const g=[f==null?void 0:f.mainPhotoMediaId,...(f==null?void 0:f.galleryMediaIds)??[]].filter(z=>typeof z=="string"&&z.length>0);if(g.length===0)return;const w=g.filter(z=>!p[z]);w.length!==0&&Promise.all(w.map(async z=>{try{const V=await t.getPublicMediaUrl(z);return{id:z,url:V.downloadUrl}}catch{return null}})).then(z=>{N(V=>{const M={...V};for(const Z of z)Z&&(M[Z.id]=Z.url);return M})})},[t,p,f==null?void 0:f.galleryMediaIds,f==null?void 0:f.mainPhotoMediaId]);async function x(){var g,w,z,V,M;A(!0),o(null);try{const Z=Number(y.age),se=y.lookingForMore.trim()?`${y.bio.trim()}

Looking For More: ${y.lookingForMore.trim()}`.trim():y.bio,ce=y.travelLat.trim()?Number(y.travelLat):void 0,ue=y.travelLng.trim()?Number(y.travelLng):void 0,je={displayName:y.displayName,age:Math.trunc(Z),bio:se,stats:{heightInches:Bt(y.heightInches),race:y.race.trim()||void 0,cockSizeInches:Ks(y.cockSizeInches),cutStatus:y.cutStatus||void 0,weightLbs:Bt(y.weightLbs),position:y.position||void 0},discreetMode:y.discreetMode,travelMode:{enabled:y.travelEnabled,lat:Number.isFinite(ce)?ce:void 0,lng:Number.isFinite(ue)?ue:void 0}},a=await t.upsertMyProfile(s.sessionToken,je);B(a.profile),j(Dt(a.profile));try{localStorage.setItem("reddoor_travel_center",JSON.stringify({enabled:((g=a.profile.travelMode)==null?void 0:g.enabled)===!0,lat:(w=a.profile.travelMode)==null?void 0:w.lat,lng:(z=a.profile.travelMode)==null?void 0:z.lng})),window.dispatchEvent(new CustomEvent("rd:location-updated",{detail:{lat:(V=a.profile.travelMode)==null?void 0:V.lat,lng:(M=a.profile.travelMode)==null?void 0:M.lng}}))}catch{}d("Profile saved.")}catch(Z){const se=H(Z);d(se),o(se)}finally{A(!1)}}async function k(g,w){if(!w){d("Choose a file first.");return}if(s.userType==="guest"){d("Guest sessions cannot upload media. Register to persist media.");return}A(!0),o(null);try{const z=await t.initiateMediaUpload(s.sessionToken,{kind:g,mimeType:w.type||(g==="video"?"video/mp4":"image/jpeg"),sizeBytes:w.size});if(!await vt(z.uploadUrl,w,w.type||"application/octet-stream")){const V=await fetch(z.uploadUrl,{method:"PUT",headers:{"content-type":w.type||"application/octet-stream"},body:w});if(!V.ok)throw{message:`Upload failed (${V.status}).`}}await t.completeMediaUpload(s.sessionToken,z.mediaId),await _(),d("Media uploaded.")}catch(z){const V=H(z);d(V),o(V)}finally{A(!1)}}const[I,R]=i.useState(null),[$,oe]=i.useState(null),[ne,xe]=i.useState(null);async function le(g){if(f){A(!0);try{const w=(f.galleryMediaIds??[]).filter(V=>V!==g),z=await t.updateProfileMediaReferences(s.sessionToken,{galleryMediaIds:w});B(z.profile),d("Gallery updated.")}catch(w){const z=H(w);d(z),o(z)}finally{A(!1)}}}async function de(g){if(f){A(!0);try{const w=await t.updateProfileMediaReferences(s.sessionToken,{galleryMediaIds:f.galleryMediaIds,mainPhotoMediaId:g});B(w.profile),d("Main photo updated.")}catch(w){const z=H(w);d(z),o(z)}finally{A(!1)}}}return e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:Le(),children:e.jsxs("div",{style:{display:"grid",gap:14},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"SETTINGS / PROFILE"}),s.userType==="guest"?e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guest profile data is temporary for this session and is removed when you log out."}):null,h?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:h}):null,e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Display Name"}),e.jsx("input",{value:y.displayName,onChange:g=>j(w=>({...w,displayName:g.target.value})),style:X()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Age"}),e.jsx("input",{value:y.age,onChange:g=>j(w=>({...w,age:g.target.value})),style:X(),inputMode:"numeric"})]})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Bio"}),e.jsx("textarea",{value:y.bio,onChange:g=>j(w=>({...w,bio:g.target.value})),style:{...X(),minHeight:88,resize:"vertical"}})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Looking For More (Optional)"}),e.jsx("textarea",{value:y.lookingForMore,onChange:g=>j(w=>({...w,lookingForMore:g.target.value})),style:{...X(),minHeight:72,resize:"vertical"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:y.discreetMode,onChange:g=>j(w=>({...w,discreetMode:g.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0,fontSize:13},children:"Discreet Mode (hide profile from others)"})]}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:y.travelEnabled,onChange:g=>j(w=>({...w,travelEnabled:g.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Travel Mode"})]})]}),y.travelEnabled?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Travel Lat"}),e.jsx("input",{value:y.travelLat,onChange:g=>j(w=>({...w,travelLat:g.target.value})),style:X()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Travel Lng"}),e.jsx("input",{value:y.travelLng,onChange:g=>j(w=>({...w,travelLng:g.target.value})),style:X()})]})]}):null,e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Height (in)"}),e.jsx("input",{value:y.heightInches,onChange:g=>j(w=>({...w,heightInches:g.target.value})),style:X(),inputMode:"numeric"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Race"}),e.jsx("input",{value:y.race,onChange:g=>j(w=>({...w,race:g.target.value})),style:X()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Cock Size (in)"}),e.jsx("input",{value:y.cockSizeInches,onChange:g=>j(w=>({...w,cockSizeInches:g.target.value})),style:X(),inputMode:"decimal"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Cut / Uncut"}),e.jsxs("select",{value:y.cutStatus,onChange:g=>j(w=>({...w,cutStatus:g.target.value})),style:X(),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"cut",children:"Cut"}),e.jsx("option",{value:"uncut",children:"Uncut"})]})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Weight (lbs)"}),e.jsx("input",{value:y.weightLbs,onChange:g=>j(w=>({...w,weightLbs:g.target.value})),style:X(),inputMode:"numeric"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Position"}),e.jsxs("select",{value:y.position,onChange:g=>j(w=>({...w,position:g.target.value})),style:X(),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"top",children:"Top"}),e.jsx("option",{value:"bottom",children:"Bottom"}),e.jsx("option",{value:"side",children:"Side"})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",onClick:()=>void x(),style:fe(U),disabled:U,children:"SAVE PROFILE"}),e.jsx("button",{type:"button",onClick:()=>void _(),style:W(F),disabled:F,children:"REFRESH"})]})]})}),e.jsx("div",{style:Le(),children:e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"MEDIA"}),e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"Main profile photo, gallery photo, and video uploads."}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Main Photo"}),e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:g=>{var w;return R(((w=g.target.files)==null?void 0:w[0])??null)}})]}),e.jsx("button",{type:"button",style:fe(U),disabled:U,onClick:()=>void k("photo_main",I),children:"UPLOAD MAIN PHOTO"})]}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Gallery Photo"}),e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:g=>{var w;return oe(((w=g.target.files)==null?void 0:w[0])??null)}})]}),e.jsx("button",{type:"button",style:fe(U),disabled:U,onClick:()=>void k("photo_gallery",$),children:"UPLOAD GALLERY PHOTO"})]}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Video"}),e.jsx("input",{className:"rd-input",type:"file",accept:"video/*",onChange:g=>{var w;return xe(((w=g.target.files)==null?void 0:w[0])??null)}})]}),e.jsx("button",{type:"button",style:fe(U),disabled:U,onClick:()=>void k("video",ne),children:"UPLOAD VIDEO"})]}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13},children:["Main photo media id: ",(f==null?void 0:f.mainPhotoMediaId)??"-",e.jsx("br",{}),"Gallery count: ",((C=f==null?void 0:f.galleryMediaIds)==null?void 0:C.length)??0,e.jsx("br",{}),"Video media id: ",(f==null?void 0:f.videoMediaId)??"-"]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"YOUR GALLERY"}),(u=f==null?void 0:f.galleryMediaIds)!=null&&u.length?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(130px, 1fr))",gap:10},children:f.galleryMediaIds.map(g=>e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.45)",borderRadius:10,padding:8,display:"grid",gap:8},children:[e.jsx("img",{src:p[g]??He(g),alt:"Gallery photo",style:{width:"100%",aspectRatio:"1/1",objectFit:"cover",borderRadius:8,border:"1px solid rgba(255,58,77,0.4)"}}),e.jsx("button",{type:"button",style:W(U),disabled:U,onClick:()=>void de(g),children:"SET MAIN"}),e.jsx("button",{type:"button",style:W(U),disabled:U,onClick:()=>void le(g),children:"REMOVE"})]},g))}):e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No gallery photos uploaded yet."})]})]})})]})}function Hs({api:t,session:s,setLastError:o,onLogout:C}){const[u,y]=i.useState({discreetMode:!1,travelEnabled:!1,travelLat:"",travelLng:""}),[j,f]=i.useState("Loading settings..."),[B,F]=i.useState(!1),[J,U]=i.useState([]);async function A(){var x,k,I;try{const R=await t.getMyProfile(s.sessionToken);if(y({discreetMode:R.profile.discreetMode===!0,travelEnabled:((x=R.profile.travelMode)==null?void 0:x.enabled)===!0,travelLat:typeof((k=R.profile.travelMode)==null?void 0:k.lat)=="number"?String(R.profile.travelMode.lat):"",travelLng:typeof((I=R.profile.travelMode)==null?void 0:I.lng)=="number"?String(R.profile.travelMode.lng):""}),f("Settings loaded."),s.userType!=="guest")try{const $=await t.listBlocked(s.sessionToken);U($.blocked)}catch{U([])}else U([])}catch(R){f(H(R))}}async function h(){try{const x=await fetch("/api/config"),k=await x.json();if(!x.ok)throw k;F(k.mediaStorageConfigured===!0)}catch{F(!1)}}i.useEffect(()=>{A(),h()},[s.sessionToken,s.userType]);async function d(){try{const x=await t.getMyProfile(s.sessionToken),k=u.travelLat.trim()?Number(u.travelLat):void 0,I=u.travelLng.trim()?Number(u.travelLng):void 0;await t.upsertMyProfile(s.sessionToken,{displayName:x.profile.displayName,age:x.profile.age,bio:x.profile.bio,stats:x.profile.stats,discreetMode:u.discreetMode,travelMode:{enabled:u.travelEnabled,lat:Number.isFinite(k)?k:void 0,lng:Number.isFinite(I)?I:void 0}}),f("Privacy settings saved.")}catch(x){const k=H(x);f(k),o(k)}}async function p(){if(!navigator.geolocation){const x="Geolocation is unavailable on this device.";f(x),o(x);return}try{const x=await new Promise((R,$)=>{navigator.geolocation.getCurrentPosition(R,$,{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})}),k=Number(x.coords.latitude.toFixed(6)),I=Number(x.coords.longitude.toFixed(6));y(R=>({...R,travelEnabled:!0,travelLat:String(k),travelLng:String(I)}));try{localStorage.setItem("reddoor_travel_center",JSON.stringify({enabled:!0,lat:k,lng:I}))}catch{}try{await t.updatePresence(s.sessionToken,k,I,"online")}catch{}window.dispatchEvent(new CustomEvent("rd:location-updated",{detail:{lat:k,lng:I}})),f("Actual location detected. Save privacy settings to persist it.")}catch(x){const k=H(x);f(k),o(k)}}async function N(){try{const x=u.travelLat.trim()?Number(u.travelLat):void 0,k=u.travelLng.trim()?Number(u.travelLng):void 0,I=await t.seedFakeUsers(12,Number.isFinite(x)?x:void 0,Number.isFinite(k)?k:void 0);f(`Seeded ${I.seededCount} fake users for testing.`)}catch(x){const k=H(x);f(k),o(k)}}async function _(x){try{await t.unblock(s.sessionToken,x);const k=await t.listBlocked(s.sessionToken);U(k.blocked),f("Blocked users updated.")}catch(k){const I=H(k);f(I),o(I)}}return e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:Le(),children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"SETTINGS"}),e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:j}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:u.discreetMode,onChange:x=>y(k=>({...k,discreetMode:x.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Discreet Mode (hide your profile)"})]}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:u.travelEnabled,onChange:x=>y(k=>({...k,travelEnabled:x.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Travel Mode"})]}),u.travelEnabled?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("input",{value:u.travelLat,onChange:x=>y(k=>({...k,travelLat:x.target.value})),style:X(),placeholder:"Travel lat"}),e.jsx("input",{value:u.travelLng,onChange:x=>y(k=>({...k,travelLng:x.target.value})),style:X(),placeholder:"Travel lng"})]}):null,e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:fe(!1),onClick:()=>void d(),children:"SAVE PRIVACY"}),e.jsx("button",{type:"button",style:W(!1),onClick:()=>void p(),children:"DETECT ACTUAL LOCATION"}),e.jsx("button",{type:"button",style:W(!1),onClick:()=>void N(),children:"SEED FAKE USERS"}),e.jsx("button",{type:"button",style:W(!1),onClick:()=>C==null?void 0:C(),children:"LOGOUT"})]})]})}),e.jsx("div",{style:Le(),children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"MEDIA STORAGE"}),e.jsx("div",{style:{color:B?"#26d5ff":"#ff8a95",fontSize:14},children:B?"Configured: uploads enabled.":"Not configured: set S3_BUCKET, S3_REGION, S3_ACCESS_KEY_ID, S3_SECRET_ACCESS_KEY."}),e.jsx("button",{type:"button",style:W(!1),onClick:()=>void h(),children:"REFRESH STORAGE STATUS"})]})}),s.userType!=="guest"?e.jsx("div",{style:Le(),children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"BLOCKED USERS"}),J.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No blocked users."}):J.map(x=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[e.jsx("div",{style:{color:"#ced3dc",fontSize:14},children:x}),e.jsx("button",{type:"button",style:W(!1),onClick:()=>void _(x),children:"UNBLOCK"})]},x))]})}):null]})}function Ds({api:t,session:s,setSession:o,settings:C,activeTab:u,setActiveTab:y,discoverFilter:j,busy:f,setBusy:B,setLastError:F,onUnreadCountChange:J,hideModeCard:U,onLogout:A}){const h=Ps(),[d,p]=i.useState(null),N=e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx(_s,{api:t,session:s,setLastError:F}),e.jsx(Hs,{api:t,session:s,setLastError:F,onLogout:A})]});return e.jsxs("div",{style:{display:"grid",gap:12},children:[null,u==="discover"?e.jsx(As,{api:t,session:s,settings:C,discoverFilter:j,busy:f,setBusy:B,setLastError:F,isMobile:h,onOpenThreadRequested:_=>{p({key:Ce(_),nonce:Date.now()}),y("threads")},onUnreadCountChange:J}):null,u==="threads"?e.jsx(Ls,{api:t,session:s,setLastError:F,openThreadRequest:d,onThreadRequestConsumed:()=>p(null),isMobile:h}):null,u==="public"?e.jsx(Fs,{api:t,session:s,isMobile:h,setLastError:F}):null,u==="profile"||u==="settings"?N:null,u==="submissions"?e.jsx(Us,{api:t,session:s,setLastError:F}):null,u==="promoted"?e.jsx(Os,{api:t,session:s,setLastError:F}):null]})}export{Ds as Router};
