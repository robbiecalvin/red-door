const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./maplibre-gl-BZD9fb88.js","./index-NsmhPqOK.js","./index-Cb00rHS0.css"])))=>i.map(i=>d[i]);
import{r as s,j as e,_ as mn,p as on,a as an,b as ln,u as kt}from"./index-NsmhPqOK.js";function dn(t){return typeof t=="object"&&t!==null}function bn(t){return!(!dn(t)||typeof t.key!="string"||t.userType!=="guest"&&t.userType!=="registered"&&t.userType!=="subscriber"||typeof t.lat!="number"||!Number.isFinite(t.lat)||typeof t.lng!="number"||!Number.isFinite(t.lng)||typeof t.updatedAtMs!="number"||!Number.isFinite(t.updatedAtMs)||t.status!==void 0&&typeof t.status!="string")}function cn(t){const[n,a]=s.useState(()=>new Map),[f,o]=s.useState(null),x=s.useRef(null),I=s.useRef(null);return s.useEffect(()=>{if(t.disabled===!0||t.wsUrl.trim()===""){a(new Map),o(null),I.current!==null&&(window.clearTimeout(I.current),I.current=null);return}let A=!1,F=0,V=null;const _=()=>{V!==null&&(window.clearInterval(V),V=null)},z=()=>{if(A)return;const l=Math.min(8e3,500*2**Math.min(F,4));I.current=window.setTimeout(()=>{I.current=null,P()},l)},P=()=>{if(A)return;let l;try{l=new WebSocket(t.wsUrl)}catch{F+=1,o("Realtime unavailable in this mode."),z();return}x.current=l;let v=!1;l.onopen=()=>{v=!0,F=0,o(null);const M={};t.sessionToken&&(M.sessionToken=t.sessionToken),t.jwt&&(M.jwt=t.jwt),l.send(JSON.stringify({type:"auth",payload:M})),V=window.setInterval(()=>{l.readyState===l.OPEN&&l.send(JSON.stringify({type:"heartbeat",payload:{}}))},15e3)},l.onmessage=M=>{const b=(()=>{try{return JSON.parse(String(M.data))}catch{return null}})();if(!b||typeof b.type!="string"){o("Invalid server message.");return}if(b.type==="error"&&dn(b.payload)&&typeof b.payload.message=="string"){o(b.payload.message);return}if(b.type==="presence_update"){const h=b.payload;if(!bn(h)){o("Invalid presence payload.");return}a(W=>{const $=new Map(W);return $.set(h.key,h),$})}},l.onerror=()=>{},l.onclose=M=>{if(_(),!A&&M.code!==1e3){F+=1;const b=typeof M.reason=="string"&&M.reason.trim()!==""?` Reason: ${M.reason}`:"";(F>=2||v)&&o(`Realtime ${v?"disconnected":"failed to connect"} (code ${M.code}). Reconnecting...${b}`),z()}}};return P(),()=>{var l;A=!0,_(),I.current!==null&&(window.clearTimeout(I.current),I.current=null),(l=x.current)==null||l.close(1e3,"Client cleanup"),x.current=null}},[t.disabled,t.jwt,t.sessionToken,t.wsUrl]),{state:s.useMemo(()=>({byKey:n}),[n]),lastErrorMessage:f}}async function vn(){const t=await mn(()=>import("./maplibre-gl-BZD9fb88.js").then(a=>a.m),__vite__mapDeps([0,1,2]),import.meta.url);return t.default??t}function xn(t){return t.replace(/[&<>"']/g,n=>{switch(n){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return n}})}function jn(){return{version:8,sources:{basemap:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png","https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"Â© OpenStreetMap contributors"}},layers:[{id:"basemap",type:"raster",source:"basemap"}]}}function wn(t){const n=document.createElement("button");return n.type="button",n.setAttribute("aria-label",t.label??"Presence marker"),n.style.width="40px",n.style.height="40px",n.style.borderRadius="999px",n.style.border=`2px solid ${t.color}`,n.style.touchAction="manipulation",n.style.userSelect="none",t.markerType==="spot"?(n.style.background="radial-gradient(circle at 30% 30%, #ff4f60, #a70013)",n.style.display="grid",n.style.placeItems="center",n.style.color="#ffffff",n.style.fontWeight="700",n.style.fontSize="13px",n.textContent=typeof t.markerGlyph=="string"&&t.markerGlyph.trim()?t.markerGlyph.trim().slice(0,2):"SP"):typeof t.imageUrl=="string"&&t.imageUrl.trim()!==""?(n.style.backgroundImage=`url("${t.imageUrl}")`,n.style.backgroundSize="cover",n.style.backgroundPosition="center"):n.style.background="#000000",n.style.padding="0",n.style.cursor=typeof t.onClick=="function"?"pointer":"default",n.style.pointerEvents="auto",n}function Sn({initialView:t,markers:n,interactive:a,visible:f}){const o=s.useRef(null),x=s.useRef(null),I=s.useRef(null),C=s.useRef([]),[A,F]=s.useState({kind:"ready"}),V=s.useMemo(()=>t.center,[t.center]),_=a!==!1,z=f!==!1;return s.useEffect(()=>{let P=!1,l=null,v=null,M=null;async function b(){if(o.current&&!I.current)try{x.current||(x.current=await vn());const h=x.current,W=new h.Map({container:o.current,style:jn(),center:[V.lng,V.lat],zoom:t.zoom,interactive:_});W.addControl(new h.NavigationControl({showCompass:!1}),"top-right"),I.current=W;const $=()=>{W.resize()};v=$,M=window.requestAnimationFrame($),window.addEventListener("resize",$),l=new ResizeObserver(()=>$()),l.observe(o.current),W.on("error",K=>{var ge;const de=((ge=K.error)==null?void 0:ge.message)??"Map error.";P||de.toLowerCase().includes("failed to fetch")||de.toLowerCase().includes("network")||F({kind:"error",message:de})}),W.once("load",()=>{P||F({kind:"ready"})})}catch(h){if(P)return;F({kind:"error",message:h instanceof Error?h.message:"Map error."})}}return b(),()=>{var h;P=!0,M!==null&&window.cancelAnimationFrame(M),v&&window.removeEventListener("resize",v),l==null||l.disconnect();for(const W of C.current)W.remove();C.current=[],(h=I.current)==null||h.remove(),I.current=null}},[_]),s.useEffect(()=>{const P=I.current;if(!P||!z)return;P.resize();const l=window.setTimeout(()=>{P.resize(),P.setCenter([t.center.lng,t.center.lat]),P.setZoom(t.zoom)},80);return()=>window.clearTimeout(l)},[t.center.lat,t.center.lng,t.zoom,z]),s.useEffect(()=>{const P=I.current;if(!P||!z)return;P.resize();const l=window.setTimeout(()=>P.resize(),120);return()=>window.clearTimeout(l)},[z]),s.useEffect(()=>{const P=I.current,l=x.current;if(!(!P||!l)){for(const v of C.current)v.remove();C.current=[];for(const v of n){const M=typeof v.label=="string"&&v.label.trim()!==""?new l.Popup({closeButton:!1,closeOnClick:!0}).setHTML(`<div style="font-family: var(--ui); font-size: 12px; line-height: 1.35;">
                 <div style="font-weight: 600;">${xn(v.label)}</div>
               </div>`):void 0,b=wn(v);if(typeof v.onClick=="function"){const W=$=>{var K;$.preventDefault(),$.stopPropagation(),(K=v.onClick)==null||K.call(v)};b.addEventListener("click",W),b.addEventListener("touchend",W,{passive:!1}),b.addEventListener("pointerup",W)}const h=new l.Marker({element:b}).setLngLat([v.position.lng,v.position.lat]);M&&h.setPopup(M),h.addTo(P),C.current.push(h)}}},[n]),A.kind==="error"?e.jsxs("div",{style:{background:"#000000",color:"#F22F2F",border:"2px solid #C00000",borderRadius:8,padding:12,fontFamily:"var(--ui)",fontSize:14,lineHeight:1.4},role:"alert","aria-live":"polite",children:["Map error: ",A.message]}):e.jsx("div",{ref:o,className:"rd-maplibre",style:{width:"100%",height:"100%",background:"#000000",borderRadius:8,overflow:"hidden"},"aria-label":"Cruise map"})}const Yt=[on,an,ln];function In(t){let n=0;for(let a=0;a<t.length;a+=1)n=n*31+t.charCodeAt(a)|0;return Math.abs(n)}function kn(t){return Yt[In(t)%Yt.length]}function Cn(t,n,a){return t.map(f=>({id:f.key,position:{lat:f.lat,lng:f.lng},color:"#C00000",label:f.status?`Presence: ${f.status}`:"Presence",imageUrl:(n==null?void 0:n[f.key])??kn(f.key),onClick:a?()=>a(f.key):void 0}))}function Qt({wsUrl:t,sessionToken:n,jwt:a,defaultCenter:f,defaultZoom:o,presenceUpdates:x,realtimeErrorMessage:I,onMarkerSelect:C,avatarByKey:A,additionalMarkers:F,height:V,visible:_}){const z=cn({wsUrl:t,sessionToken:n,jwt:a,disabled:Array.isArray(x)}),P=x?{byKey:new Map(x.map(K=>[K.key,K]))}:z.state,l=I??z.lastErrorMessage,[v,M]=s.useState({kind:"pending"});s.useEffect(()=>{if(!("geolocation"in navigator)||!navigator.geolocation){M({kind:"unavailable"});return}navigator.geolocation.getCurrentPosition(K=>{M({kind:"granted",center:{lat:K.coords.latitude,lng:K.coords.longitude}})},K=>{if(K.code===K.PERMISSION_DENIED){M({kind:"denied"});return}if(K.code===K.TIMEOUT){M({kind:"error",message:"Timed out while trying to read your location. Showing the default map view."});return}M({kind:"error",message:K.message||"Geolocation error."})},{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e4})},[]);const b=s.useMemo(()=>Array.from(P.byKey.values()),[P.byKey]),h=s.useMemo(()=>[...Cn(b,A,C),...F??[]],[F,A,C,b]),W=s.useMemo(()=>{const K=typeof o=="number"&&Number.isFinite(o)?o:13;return v.kind==="granted"?{center:v.center,zoom:K}:{center:f,zoom:K}},[f,o,v]),$=s.useMemo(()=>v.kind==="denied"?"Location permission denied. Showing the default map view.":v.kind==="unavailable"?"Geolocation is unavailable. Showing the default map view.":v.kind==="error"?`Geolocation error: ${v.message}`:null,[v]);return e.jsxs("section",{"aria-label":"Cruise mode map",style:{background:"#000000",color:"#FFFFFF",fontFamily:"var(--ui)",display:"grid",gap:8,height:"100%"},children:[$?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"rgba(0,0,0,0.7)",border:"1px solid rgba(255,58,77,0.45)",borderRadius:0,padding:8,color:"#AAAAAA",fontSize:12,lineHeight:1.4},children:$}):null,l?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"rgba(0,0,0,0.7)",border:"1px solid rgba(255,58,77,0.45)",borderRadius:0,padding:8,color:"#F22F2F",fontSize:12,lineHeight:1.4},children:l}):null,e.jsx("div",{style:{background:"#111111",border:0,borderRadius:0,overflow:"hidden",height:typeof V=="number"||typeof V=="string"?V:520},children:e.jsx(Sn,{initialView:W,markers:h,visible:_})})]})}const Tn="FIRE_SIGNAL|1";function Mn(t){return new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function Xt(t){if(!t.startsWith("LOCATION|"))return null;const[,n,a]=t.split("|"),f=Number(n),o=Number(a);return!Number.isFinite(f)||!Number.isFinite(o)?null:{lat:f,lng:o,link:`https://maps.google.com/?q=${f},${o}`}}function Pn(t){return t.trim()===Tn?"ðŸ”¥ I'm into you":t}function Kt({chatKind:t,peerKey:n,currentUserKey:a,messages:f,client:o,title:x,peerSummary:I,thirdParty:C,edgeToEdge:A,showHeader:F,fillHeight:V}){const[_,z]=s.useState(""),[P,l]=s.useState(null),[v,M]=s.useState(!1),[b,h]=s.useState({}),[W,$]=s.useState(!1),[K,de]=s.useState(!1),ge=s.useRef(null),Te=s.useRef([]),he=s.useRef(null),me=s.useRef(null),je=s.useRef(null),p=A===!0,y=F!==!1,N=p&&V===!0,ae=s.useMemo(()=>[...f].sort((c,H)=>c.createdAtMs-H.createdAtMs),[f]),D=s.useMemo(()=>Array.from(new Set(ae.map(c=>{var H;return(H=c.media)==null?void 0:H.objectKey}).filter(c=>typeof c=="string"&&c.trim().length>0))),[ae]);s.useEffect(()=>{let c=!1;async function H(){for(const g of D){if(c)return;if(!b[g])try{const R=await o.getMediaUrl(g);if(c)return;h(G=>({...G,[g]:R}))}catch{}}}return H(),()=>{c=!0}},[o,D,b]);async function ie(c){const H=_.trim();if(!(H.length===0&&!c)){M(!0),l(null);try{await o.sendMessage(t,n,H,c),z("")}catch(g){const R=g;l(typeof(R==null?void 0:R.message)=="string"?R.message:"Message rejected.")}finally{M(!1)}}}async function k(c){M(!0),l(null);try{const H=await o.initiateMediaUpload(c.type||"application/octet-stream",c.size);await o.uploadToSignedUrl(H.uploadUrl,c,c.type||"application/octet-stream");const R={kind:c.type.startsWith("image/")?"image":c.type.startsWith("video/")?"video":"audio",objectKey:H.objectKey,mimeType:c.type||"application/octet-stream"};await ie(R)}catch(H){const g=H;l(typeof(g==null?void 0:g.message)=="string"?g.message:"Upload rejected."),M(!1)}}async function be(c){var g;const H=(g=c.target.files)==null?void 0:g[0];if(c.target.value="",!!H){if(!H.type.startsWith("image/")&&!H.type.startsWith("video/")&&!H.type.startsWith("audio/")){l("Only image, video, or audio files are supported.");return}await k(H)}}async function fe(){var c;if(W){(c=ge.current)==null||c.stop();return}if(!navigator.mediaDevices||typeof navigator.mediaDevices.getUserMedia!="function"){l("Microphone is not available in this browser.");return}try{const H=await navigator.mediaDevices.getUserMedia({audio:!0}),g=new MediaRecorder(H);Te.current=[],ge.current=g,g.ondataavailable=R=>{R.data.size>0&&Te.current.push(R.data)},g.onstop=()=>{const R=new Blob(Te.current,{type:g.mimeType||"audio/webm"}),G=new File([R],`voice-${Date.now()}.webm`,{type:g.mimeType||"audio/webm"});k(G);for(const ce of H.getTracks())ce.stop();ge.current=null,$(!1)},g.start(),$(!0)}catch(H){const g=H;l(typeof(g==null?void 0:g.message)=="string"?g.message:"Unable to record voice."),$(!1)}}async function we(){if(!navigator.geolocation){l("Geolocation is not available in this browser.");return}M(!0),l(null);try{const c=await new Promise((G,ce)=>{navigator.geolocation.getCurrentPosition(G,ce,{enableHighAccuracy:!1,timeout:12e3,maximumAge:3e4})}),H=Number(c.coords.latitude.toFixed(5)),g=Number(c.coords.longitude.toFixed(5)),R=`LOCATION|${H}|${g}`;await o.sendMessage(t,n,R)}catch(c){const H=c;l(typeof(H==null?void 0:H.message)=="string"?H.message:"Unable to send location.")}finally{M(!1)}}return e.jsxs("section",{"aria-label":"Chat",style:{background:p?"transparent":"#000000",color:"#FFFFFF",fontFamily:"Montserrat, sans-serif",padding:p?0:16,display:"grid",gap:p?0:12,gridTemplateRows:y?"auto auto 1fr auto":"1fr auto",minHeight:V?"calc(100dvh - 196px)":void 0},children:[y?e.jsxs("header",{style:{height:56,display:"grid",alignItems:"center",background:"#000000"},children:[e.jsx("div",{style:{textAlign:"center",fontSize:20,fontWeight:600},children:x}),I?e.jsxs("div",{style:{marginTop:4,display:"flex",alignItems:"center",justifyContent:"center",gap:8,color:"#b7d8e0",fontSize:13},children:[e.jsx("span",{children:"Chat with:"}),I.avatarUrl?e.jsx("img",{src:I.avatarUrl,alt:`${I.displayName} avatar`,style:{width:24,height:24,borderRadius:"50%",objectFit:"cover",border:"1px solid rgba(38,213,255,0.8)"}}):e.jsx("span",{"aria-hidden":!0,style:{width:24,height:24,borderRadius:"50%",border:"1px solid rgba(38,213,255,0.8)",background:"rgba(255,255,255,0.08)"}}),e.jsx("span",{style:{color:"#fff",fontWeight:600},children:I.displayName})]}):null,e.jsx("div",{style:{textAlign:"center",fontSize:12,color:"#AAAAAA"},children:t==="cruise"?"CRUISE CHAT (EPHEMERAL)":"DATE CHAT (PERSISTENT)"})]}):null,P?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"#111111",border:"2px solid #C00000",borderRadius:8,padding:12,color:"#F22F2F",fontSize:14,lineHeight:1.4},children:P}):null,e.jsx("div",{"aria-label":"Messages",style:{background:p?"#09090b":"#111111",border:p?"none":"2px solid #C00000",borderRadius:p?0:8,padding:12,display:"flex",flexDirection:"column",gap:12,minHeight:p?0:320,paddingBottom:N?148:12,overflowY:"auto"},children:ae.length===0?e.jsx("div",{style:{color:"#AAAAAA",fontSize:14,lineHeight:1.4},children:"No messages."}):ae.map(c=>{const H=c.fromKey===a,g=H?"#C00000":"#444444",R=H?{alignItems:"flex-end"}:{alignItems:"flex-start"};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,width:"100%",...R},children:[(()=>{const G=Xt(c.text??"");return G?e.jsxs("a",{href:G.link,target:"_blank",rel:"noreferrer",style:{display:"grid",gap:6,textDecoration:"none",color:"#fff",background:g,borderRadius:14,padding:8,width:"auto",maxWidth:"80%"},children:[e.jsx("div",{style:{fontSize:12,color:"#d8ecff"},children:"Shared location"}),e.jsx("iframe",{title:"Google Maps location preview",src:`https://www.google.com/maps?q=${G.lat},${G.lng}&z=14&output=embed`,style:{width:"100%",height:140,border:"1px solid rgba(255,255,255,0.18)",borderRadius:10},loading:"lazy",referrerPolicy:"no-referrer-when-downgrade"}),e.jsx("div",{style:{fontSize:12,color:"#3fdfff"},children:"Open in Google Maps"})]}):null})(),e.jsxs("div",{style:{background:g,color:"#FFFFFF",borderRadius:18,padding:"8px 12px",width:"auto",maxWidth:"80%",fontSize:16,lineHeight:1.4,whiteSpace:"pre-wrap",overflowWrap:"anywhere",wordBreak:"break-word"},children:[c.text&&!Xt(c.text)?e.jsx("div",{style:{marginBottom:c.media?8:0},children:Pn(c.text)}):null,c.media?e.jsxs("div",{children:[c.media.kind==="image"?e.jsx("img",{src:b[c.media.objectKey],alt:"Shared",style:{width:"100%",maxWidth:260,borderRadius:10,border:"1px solid rgba(255,255,255,0.18)"}}):null,c.media.kind==="video"?e.jsx("video",{controls:!0,playsInline:!0,src:b[c.media.objectKey],style:{width:"100%",maxWidth:320,borderRadius:10,background:"#000"}}):null,c.media.kind==="audio"?e.jsx("audio",{controls:!0,src:b[c.media.objectKey],style:{width:"100%",maxWidth:260}}):null]}):null]}),e.jsx("div",{style:{fontSize:10,color:"#AAAAAA"},children:Mn(c.createdAtMs)}),H?e.jsx("div",{style:{fontSize:10,color:"#6fdcff"},children:typeof c.readAtMs=="number"?"Read":typeof c.deliveredAtMs=="number"?"Delivered":""}):null]},c.messageId)})}),e.jsxs("form",{onSubmit:c=>{c.preventDefault(),ie()},"aria-label":"Message input",style:{background:p?"linear-gradient(180deg, rgba(96,0,12,0.96), rgba(58,0,8,0.98))":"#111111",border:p?"none":"2px solid #C00000",borderRadius:p?0:8,padding:12,display:"grid",gridTemplateColumns:"1fr auto auto",gap:12,alignItems:"start",position:N?"fixed":"static",left:N?0:void 0,right:N?0:void 0,bottom:N?"calc(env(safe-area-inset-bottom, 0px) + 66px)":void 0,zIndex:N?45:void 0},children:[e.jsx("label",{style:{display:"grid"},children:e.jsx("input",{value:_,onChange:c=>z(c.target.value),placeholder:"Type a message",disabled:v,style:{width:"100%",background:"#111111",color:"#FFFFFF",border:"2px solid #444444",borderRadius:8,padding:"10px 12px",fontSize:16,lineHeight:1.4,outline:"none"},"aria-label":"Message text"})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{ref:he,type:"file",accept:"image/*,video/*,audio/*",disabled:v,onChange:c=>void be(c),style:{display:"none"}}),e.jsx("input",{ref:me,type:"file",accept:"image/*",capture:"environment",disabled:v,onChange:c=>void be(c),style:{display:"none"}}),e.jsx("input",{ref:je,type:"file",accept:"video/*",capture:"environment",disabled:v,onChange:c=>void be(c),style:{display:"none"}}),e.jsx("button",{type:"button",disabled:v,onClick:()=>de(c=>!c),style:{background:"rgba(0,0,0,0.45)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px",display:"grid",placeItems:"center",cursor:v?"not-allowed":"pointer",color:"#3fdfff",fontWeight:700,height:44,minWidth:44},"aria-label":"More actions",children:"+"}),K?e.jsxs("div",{style:{position:"absolute",right:0,top:N?void 0:48,bottom:N?48:void 0,zIndex:5,minWidth:220,display:"grid",gap:8,padding:10,borderRadius:10,border:"1px solid rgba(255,58,77,0.5)",background:"rgba(10,11,16,0.98)"},children:[e.jsx("button",{type:"button",disabled:v,onClick:()=>{var c;de(!1),(c=me.current)==null||c.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Take Photo"}),e.jsx("button",{type:"button",disabled:v,onClick:()=>{var c;de(!1),(c=je.current)==null||c.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Record Video"}),e.jsx("button",{type:"button",disabled:v,onClick:()=>{var c;de(!1),(c=he.current)==null||c.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Choose Media"}),e.jsx("button",{type:"button",disabled:v,onClick:()=>{de(!1),fe()},style:{background:W?"#ff2136":"rgba(0,0,0,0.6)",color:"#fff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:W?"Stop Voice":"Record Voice"}),e.jsx("button",{type:"button",disabled:v,onClick:()=>{de(!1),we()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Send Location"}),C?e.jsxs("div",{style:{display:"grid",gap:8,borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:8},children:[e.jsxs("select",{value:C.selectedKey,onChange:c=>C.onSelect(c.target.value),disabled:C.disabled||C.candidates.length===0,style:{background:"#0b0d12",color:"#fff",border:"1px solid rgba(255,58,77,0.62)",borderRadius:10,padding:"8px 10px"},"aria-label":"Add previous contact to group",children:[C.candidates.length===0?e.jsx("option",{value:"",children:"No previous contacts"}):null,C.candidates.map(c=>e.jsx("option",{value:c.key,children:c.label},c.key))]}),e.jsx("button",{type:"button",onClick:()=>{C.onAdd(),de(!1)},disabled:C.disabled||C.candidates.length===0||!C.selectedKey,style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,58,77,0.62)",borderRadius:10,padding:"8px 10px",fontWeight:700},children:"Add Third User"})]}):null]}):null]}),e.jsx("button",{type:"submit",disabled:v,style:{background:v?"#333333":"#C00000",color:v?"#777777":"#FFFFFF",border:"2px solid #C00000",borderRadius:8,padding:"10px 20px",fontSize:16,fontWeight:600,cursor:v?"not-allowed":"pointer",height:44},"aria-label":"Send message",children:"SEND"})]})]})}const Wt="FIRE_SIGNAL|1";function Ve(){return{background:"radial-gradient(500px 220px at 10% 0%, rgba(255,28,46,0.15), transparent 58%), linear-gradient(180deg, rgba(8,8,10,0.88), rgba(4,4,5,0.9))",border:"1px solid rgba(255,56,74,0.56)",borderRadius:20,padding:14,boxShadow:"inset 0 1px 0 rgba(255,255,255,0.06), inset 0 0 0 1px rgba(0,0,0,0.28), 0 16px 32px rgba(0,0,0,0.42)"}}function Re(t){return{background:t?"rgba(90,90,90,0.55)":"linear-gradient(180deg, #ff2136, #c60012)",border:"1px solid rgba(255,70,90,0.68)",color:t?"#999999":"#FFFFFF",padding:"10px 18px",borderRadius:12,fontSize:15,fontWeight:700,letterSpacing:"0.04em",cursor:t?"not-allowed":"pointer",textTransform:"uppercase",boxShadow:t?"none":"inset 0 1px 0 rgba(255,255,255,0.2), 0 10px 22px rgba(198,0,18,0.34)"}}function B(t){return{background:"rgba(0,0,0,0.58)",border:"1px solid rgba(255,58,77,0.62)",color:"#3fdfff",padding:"10px 18px",borderRadius:12,fontSize:15,fontWeight:700,letterSpacing:"0.03em",cursor:t?"not-allowed":"pointer",textTransform:"uppercase",opacity:t?.6:1}}function te(){return{background:"rgba(6,7,10,0.92)",color:"#ffffff",border:"1px solid rgba(255,64,82,0.48)",borderRadius:12,padding:"10px 12px",fontSize:15}}function Rn(t){return typeof t=="string"}function J(t){const n=t;return Rn(n==null?void 0:n.message)?n.message:"Action rejected."}function Zt(t){return typeof t!="number"||!Number.isFinite(t)||t<=0?"Date TBD":new Date(t).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})}function en(t){return typeof t!="number"||!Number.isFinite(t)||t<=0?"Time TBD":new Date(t).toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"})}function At(){const t="__disabled__".trim();if(t==="__disabled__")return"";if(t!==""){if(t.startsWith("ws://")||t.startsWith("wss://"))return t;try{const a=new URL(t);return a.protocol=a.protocol==="https:"?"wss:":"ws:",a.toString()}catch{if(t.startsWith("/")){const a=new URL(t,window.location.origin);return a.protocol=a.protocol==="https:"?"wss:":"ws:",a.toString()}}}const n=new URL("/ws",window.location.origin);return n.protocol=n.protocol==="https:"?"wss:":"ws:",n.toString()}const tn=[on,an,ln];function An(t){let n=0;for(let a=0;a<t.length;a+=1)n=n*31+t.charCodeAt(a)|0;return Math.abs(n)}function Ee(t){return tn[An(t)%tn.length]}function Lt(t){if(t.startsWith("user:")){const n=t.slice(5).trim();return n.length>0?n:null}if(t.startsWith("session:")){const n=t.slice(8).trim();return n.length>0?`guest:${n}`:null}return null}function Ye(t){if(t.startsWith("guest:")){const n=t.slice(6).trim();return n?`session:${n}`:`user:${t}`}return`user:${t}`}function Oe(t){const n=t.trim();if(!n)return n;if(n.startsWith("user:guest:")){const a=n.slice(11).trim();return a?`session:${a}`:n}if(n.startsWith("guest:")){const a=n.slice(6).trim();return a?`session:${a}`:n}return n}function Nn(t){return t.trim()===Wt}function un(t){return Nn(t)?"ðŸ”¥ I'm into you":t}function Nt(t,n){const a=V=>V*Math.PI/180,o=a(n.lat-t.lat),x=a(n.lng-t.lng),I=Math.sin(o/2),C=Math.sin(x/2),A=I*I+Math.cos(a(t.lat))*Math.cos(a(n.lat))*C*C;return 6371e3*(2*Math.atan2(Math.sqrt(A),Math.sqrt(1-A)))}function En(t){return!Number.isFinite(t)||t<0?"-":t<1e3?`${Math.round(t)} m`:t<1e4?`${(t/1e3).toFixed(1)} km`:`${Math.round(t/1e3)} km`}function nn(){try{const t=localStorage.getItem("reddoor_travel_center");if(!t)return null;const n=JSON.parse(t);return n.enabled!==!0?null:typeof n.lat=="number"&&Number.isFinite(n.lat)&&typeof n.lng=="number"&&Number.isFinite(n.lng)?{lat:n.lat,lng:n.lng}:null}catch{return null}}function Un(){const[t,n]=s.useState(()=>window.matchMedia("(max-width: 900px)").matches);return s.useEffect(()=>{const a=window.matchMedia("(max-width: 900px)"),f=()=>n(a.matches);return f(),a.addEventListener("change",f),()=>a.removeEventListener("change",f)},[]),t}function It(t){return t==="instant"?"cruise":"date"}function Fn({api:t,session:n,settings:a,discoverFilter:f,busy:o,setBusy:x,setLastError:I,isMobile:C,discoverScreen:A,onDiscoverScreenChange:F,onOpenThreadRequested:V,onUnreadCountChange:_}){var qe,et,pt,ue,_e,lt;const[z,P]=s.useState(A),[l,v]=s.useState(null),[M,b]=s.useState(null),[h,W]=s.useState(null),[$,K]=s.useState([]),[de,ge]=s.useState({}),[Te,he]=s.useState([]),[me,je]=s.useState(new Set),[p,y]=s.useState(new Set),[N,ae]=s.useState({}),[D,ie]=s.useState({}),[k,be]=s.useState(null),[fe,we]=s.useState(0),[c,H]=s.useState([]),[g,R]=s.useState(null),[G,ce]=s.useState(()=>nn()),{state:Me,lastErrorMessage:Se}=cn({wsUrl:At(),sessionToken:n.sessionToken}),Ue=s.useMemo(()=>Array.from(Me.byKey.values()),[Me.byKey]);s.useEffect(()=>{P(A)},[A]),s.useEffect(()=>{const u=()=>{ce(nn())},m=j=>{(j.key===null||j.key==="reddoor_travel_center")&&u()};return u(),window.addEventListener("rd:location-updated",u),window.addEventListener("storage",m),()=>{window.removeEventListener("rd:location-updated",u),window.removeEventListener("storage",m)}},[]);const re=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,Ie=s.useMemo(()=>{const u=new Map;for(const m of $)u.set(m.key,m);for(const m of Ue){const j=u.get(m.key);(!j||m.updatedAtMs>=j.updatedAtMs)&&u.set(m.key,m)}return Array.from(u.values())},[Ue,$]),ve=s.useMemo(()=>Ie.filter(u=>u.key!==re),[re,Ie]),Ae=s.useMemo(()=>h?[...ve].sort((u,m)=>Nt(h,{lat:u.lat,lng:u.lng})-Nt(h,{lat:m.lat,lng:m.lng})):ve,[ve,h]),$e=s.useMemo(()=>{if(!M)return null;if(M===re)return"0 m";if(!h)return null;const u=Ie.find(m=>m.key===M);return u?En(Nt(h,{lat:u.lat,lng:u.lng})):null},[re,Ie,M,h]);s.useEffect(()=>{let u=!1;async function m(){try{const q=await t.listActivePresence(n.sessionToken);if(u)return;const ne=Array.isArray(q.presence)?q.presence:[];K(ne)}catch{u||K([])}}m();const j=window.setInterval(()=>{m()},8e3);return()=>{u=!0,window.clearInterval(j)}},[t,n.sessionToken]),s.useEffect(()=>{l||Ae.length>0&&v(Ae[0].key)},[l,Ae]),s.useEffect(()=>{const u=Ae.filter(m=>!de[m.key]).map(m=>({key:m.key,profileId:Lt(m.key)})).filter(m=>typeof m.profileId=="string");u.length!==0&&Promise.all(u.map(async m=>{var j,q;try{const ne=await t.getPublicProfile(m.profileId);return{key:m.key,displayName:(j=ne.profile)==null?void 0:j.displayName,age:(q=ne.profile)==null?void 0:q.age}}catch{return null}})).then(m=>{ge(j=>{const q={...j};for(const ne of m)ne&&(q[ne.key]={displayName:ne.displayName,age:ne.age});return q})})},[t,de,Ae]),s.useEffect(()=>{(async()=>{try{const u=await t.getPublicProfiles();he(u.profiles)}catch{he([])}if(n.userType==="guest"){je(new Set),y(new Set);return}try{const u=await t.getFavorites(n.sessionToken);je(new Set(u.favorites))}catch{je(new Set)}try{const u=await t.listBlocked(n.sessionToken);y(new Set(u.blocked))}catch{y(new Set)}})()},[t,n.sessionToken,n.userType]),s.useEffect(()=>{let u=!1;async function m(){try{const q=await t.listCruisingSpots();u||H(q.spots)}catch{u||H([])}}m();const j=window.setInterval(()=>{m()},12e3);return()=>{u=!0,window.clearInterval(j)}},[t]),s.useEffect(()=>{const u=Date.now(),m=Te.flatMap(j=>{const q=[];return j.mainPhotoMediaId&&q.push(j.mainPhotoMediaId),Array.isArray(j.galleryMediaIds)&&q.push(...j.galleryMediaIds),j.videoMediaId&&q.push(j.videoMediaId),q}).filter(j=>typeof j=="string"&&j.length>0&&!N[j]&&u>=(D[j]??0)).slice(0,6);m.length!==0&&Promise.all(m.map(async j=>{try{const q=await t.getPublicMediaUrl(j);return{mediaId:j,url:q.downloadUrl}}catch{return null}})).then(j=>{ae(q=>{const ne={...q};for(const oe of j)oe&&(ne[oe.mediaId]=oe.url);return ne}),ie(q=>{const ne={...q};for(let oe=0;oe<m.length;oe+=1){const le=m[oe];j[oe]?ne[le]&&delete ne[le]:ne[le]=Date.now()+3e4}return ne})})},[t,D,N,Te]);async function De(u){b(u),we(0);const m=Lt(u);if(!m){be(null);return}try{if(u===re){const j=await t.getMyProfile(n.sessionToken);typeof j.profile.mainPhotoMediaId=="string"&&j.profile.mainPhotoMediaId;const q=[j.profile.mainPhotoMediaId,...j.profile.galleryMediaIds??[],j.profile.videoMediaId].filter(ne=>typeof ne=="string"&&ne.length>0);if(q.length>0){const ne=await Promise.all(q.map(async oe=>{try{const le=await t.getPublicMediaUrl(oe);return{mediaId:oe,downloadUrl:le.downloadUrl}}catch{return null}}));ae(oe=>{const le={...oe};for(const Fe of ne)Fe&&(le[Fe.mediaId]=Fe.downloadUrl);return le})}be({userId:j.profile.userId,displayName:j.profile.displayName,age:j.profile.age,bio:j.profile.bio,stats:j.profile.stats,discreetMode:j.profile.discreetMode,mainPhotoMediaId:j.profile.mainPhotoMediaId,galleryMediaIds:j.profile.galleryMediaIds,videoMediaId:j.profile.videoMediaId})}else{const j=await t.getPublicProfile(m),q=[j.profile.mainPhotoMediaId,...j.profile.galleryMediaIds??[],j.profile.videoMediaId].filter(ne=>typeof ne=="string"&&ne.length>0);if(q.length>0){const ne=await Promise.all(q.map(async oe=>{try{const le=await t.getPublicMediaUrl(oe);return{mediaId:oe,downloadUrl:le.downloadUrl}}catch{return null}}));ae(oe=>{const le={...oe};for(const Fe of ne)Fe&&(le[Fe.mediaId]=Fe.downloadUrl);return le})}be(j.profile)}}catch(j){const q=j;if((q==null?void 0:q.code)==="PROFILE_HIDDEN"){b(null),be(null);return}be(null),I(J(j))}}async function Qe(u){if(n.userType==="guest"){I("Guests cannot star users. Register to save favorites.");return}if(!(!n.userId||n.userId===u))try{const m=await t.toggleFavorite(n.sessionToken,u);je(new Set(m.favorites))}catch(m){I(J(m))}}async function Be(u){const m=Oe(u);if(!(!m||m===re))try{await t.sendChat(n.sessionToken,"cruise",m,Wt)}catch(j){I(J(j))}}async function Z(u){if(!(!u.trim()||u===re)){if(n.userType==="guest"){I("Anonymous users cannot block users.");return}try{p.has(u)?await t.unblock(n.sessionToken,u):await t.block(n.sessionToken,u);const m=await t.listBlocked(n.sessionToken);y(new Set(m.blocked))}catch(m){I(J(m))}}}async function Ne(){const u=G??{lat:a.defaultCenterLat,lng:a.defaultCenterLng};if(!navigator.geolocation){W(u);try{await t.updatePresence(n.sessionToken,u.lat,u.lng,"online")}catch{}return}try{const m=await new Promise((j,q)=>{navigator.geolocation.getCurrentPosition(j,q,{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e4})});W({lat:m.coords.latitude,lng:m.coords.longitude}),await t.updatePresence(n.sessionToken,m.coords.latitude,m.coords.longitude,"online")}catch(m){W(u);try{await t.updatePresence(n.sessionToken,u.lat,u.lng,"online")}catch{const j=m&&typeof m=="object"&&"message"in m&&typeof m.message=="string"?m.message:null;I(j??J(m))}}}s.useEffect(()=>{Ne();const u=window.setInterval(()=>{Ne()},3e4);return()=>window.clearInterval(u)},[n.sessionToken]),s.useEffect(()=>{const u=m=>{var oe,le;const j=m,q=(oe=j.detail)==null?void 0:oe.lat,ne=(le=j.detail)==null?void 0:le.lng;!Number.isFinite(q)||!Number.isFinite(ne)||(W({lat:q,lng:ne}),t.updatePresence(n.sessionToken,q,ne,"online").catch(()=>{}))};return window.addEventListener("rd:location-updated",u),()=>window.removeEventListener("rd:location-updated",u)},[t,n.sessionToken]);const xe=s.useMemo(()=>{if(Ie.some(q=>q.key===re))return Ie;const m=h??G??{lat:a.defaultCenterLat,lng:a.defaultCenterLng};return[{key:re,userType:n.userType,lat:m.lat,lng:m.lng,status:"online",updatedAtMs:Date.now()},...Ie]},[re,Ie,h,n.userType,a.defaultCenterLat,a.defaultCenterLng,G]),Pe=s.useMemo(()=>{const u={};for(const m of Te){if(!m.mainPhotoMediaId)continue;const j=N[m.mainPhotoMediaId];j&&(u[Ye(m.userId)]=j)}return u},[N,Te]),ke=s.useMemo(()=>c.map(u=>({id:`spot:${u.spotId}`,position:{lat:u.lat,lng:u.lng},color:"#26d5ff",markerType:"spot",markerGlyph:"CS",label:`${u.name} | check-ins: ${u.checkInCount??0} | action: ${u.actionCount??0}`,onClick:()=>R(u.spotId)})),[c]),Ge=u=>{P(u),F(u)},Ze=e.jsx(Qt,{wsUrl:At(),sessionToken:n.sessionToken,presenceUpdates:xe,realtimeErrorMessage:Se,onMarkerSelect:u=>void De(u),avatarByKey:Pe,additionalMarkers:ke,defaultCenter:G??{lat:a.defaultCenterLat,lng:a.defaultCenterLng},height:C?"calc(100vh - 340px)":"calc(100dvh - 62px)",visible:!0}),He=e.jsxs("div",{style:{background:"#000",marginInline:-10},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,padding:"8px 10px",borderBottom:"1px solid rgba(255,58,77,0.25)"},children:[e.jsx("button",{type:"button",style:B(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"reset"}}))},children:"GUYS"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"toggle_favorites"}}))},"aria-label":"Toggle favorites only",children:"â˜…"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"open_filters"}})),Ge("chat")},children:"FILTER"})]}),e.jsx(Qt,{wsUrl:At(),sessionToken:n.sessionToken,presenceUpdates:xe,realtimeErrorMessage:Se,onMarkerSelect:u=>void De(u),avatarByKey:Pe,additionalMarkers:ke,defaultCenter:G??{lat:a.defaultCenterLat,lng:a.defaultCenterLng},height:"calc(100dvh - 220px)",visible:z==="map"})]}),at=e.jsx(On,{api:t,session:n,busy:o,setBusy:x,setLastError:I,onlinePeers:Ae,selectedPeerKey:l,setSelectedPeerKey:v,onOpenProfile:u=>void De(u),isMobile:C,selfCoords:h,peerProfileByKey:de,discoverFilter:f,publicProfiles:Te,favorites:me,mediaUrlById:N,onUnreadCountChange:_});return e.jsxs("div",{style:!C&&z==="map"?{height:"100%"}:{display:"grid",gap:8},children:[C?e.jsx(e.Fragment,{children:z==="map"?He:at}):e.jsx("div",{style:z==="map"?{display:"grid",height:"100%",alignItems:"stretch"}:{display:"grid",gap:12,alignItems:"start"},children:z==="map"?Ze:at}),M?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:80,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:C?"stretch":"center",padding:C?0:14},role:"dialog","aria-modal":"true","aria-label":"User profile",onClick:()=>b(null),children:e.jsx("div",{onClick:u=>u.stopPropagation(),style:C?{width:"100%",height:"100dvh",overflow:"auto",background:"linear-gradient(180deg, rgba(7,8,10,0.98), rgba(2,2,4,0.98))",borderRadius:0,border:"none",padding:"calc(env(safe-area-inset-top, 0px) + 56px) 12px calc(env(safe-area-inset-bottom, 0px) + 20px)"}:{...Ve(),width:"min(680px, 100%)",maxHeight:"86vh",overflow:"auto"},children:e.jsxs("div",{style:{display:"grid",gap:14},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"106px 1fr auto",gap:12,alignItems:"center"},children:[e.jsxs("div",{style:{position:"relative",width:106,height:106},children:[e.jsx("img",{src:k!=null&&k.mainPhotoMediaId&&N[k.mainPhotoMediaId]?N[k.mainPhotoMediaId]:Ee(M),alt:"Profile avatar",style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"cover",border:"2px solid #ff3047"}}),e.jsx("span",{style:{position:"absolute",right:4,bottom:4,width:14,height:14,borderRadius:"50%",background:"#26d5ff",border:"2px solid #000"}})]}),e.jsxs("div",{style:{display:"grid",gap:6},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:(k==null?void 0:k.displayName)??M}),e.jsx("div",{style:{color:"#26d5ff",fontSize:14},children:"Instant Messaging Available"})]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[k&&k.userId!==(n.userId??"")?e.jsx("button",{type:"button",style:{...B(!1),color:"#26d5ff",borderColor:"rgba(38,213,255,0.62)",minWidth:126},onClick:()=>void Qe(k.userId),children:me.has(k.userId)?"â˜… STARRED":"â˜† STAR"}):null,k&&k.userId!==(n.userId??"")?e.jsx("button",{type:"button",style:{...B(!1),color:"#ffb347",borderColor:"rgba(255,179,71,0.65)",minWidth:126},onClick:()=>void Be(Ye(k.userId)),children:"ðŸ”¥ FIRE"}):null,k&&k.userId!==(n.userId??"")?e.jsx("button",{type:"button",style:{...B(!1),color:p.has(Ye(k.userId))?"#ff9aa3":"#ffd4d8",borderColor:"rgba(255,120,130,0.62)",minWidth:126},onClick:()=>void Z(Ye(k.userId)),children:p.has(Ye(k.userId))?"UNBLOCK":"BLOCK"}):null,e.jsx("button",{type:"button",style:B(!1),onClick:()=>b(null),children:"CLOSE"})]})]}),e.jsxs("div",{style:{color:"#ced3dc",fontSize:14,lineHeight:1.5},children:[e.jsxs("div",{children:["Age: ",(k==null?void 0:k.age)??"-"]}),e.jsxs("div",{children:["Distance: ",$e??"-"]}),e.jsxs("div",{children:["Race: ",((qe=k==null?void 0:k.stats)==null?void 0:qe.race)??"-"]}),e.jsxs("div",{children:["Height: ",((et=k==null?void 0:k.stats)==null?void 0:et.heightInches)??"-"]}),e.jsxs("div",{children:["Weight: ",((pt=k==null?void 0:k.stats)==null?void 0:pt.weightLbs)??"-"]}),e.jsxs("div",{children:["Cock Size: ",((ue=k==null?void 0:k.stats)==null?void 0:ue.cockSizeInches)??"-"]}),e.jsxs("div",{children:["Cut / Uncut: ",((_e=k==null?void 0:k.stats)==null?void 0:_e.cutStatus)??"-"]}),e.jsxs("div",{children:["Position: ",((lt=k==null?void 0:k.stats)==null?void 0:lt.position)??"-"]}),e.jsxs("div",{style:{marginTop:8},children:["Bio: ",(k==null?void 0:k.bio)??"-"]})]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"MEDIA"}),k?e.jsx(e.Fragment,{children:(()=>{const u=[k.mainPhotoMediaId,...k.galleryMediaIds??[],k.videoMediaId].filter(oe=>typeof oe=="string"&&oe.length>0);if(u.length===0)return e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No uploaded media."});const m=Math.max(0,Math.min(fe,u.length-1)),j=u[m],q=N[j],ne=j===k.videoMediaId;return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.4)",borderRadius:12,padding:8},children:ne?e.jsx("video",{controls:!0,playsInline:!0,src:q,style:{width:"100%",maxHeight:260,borderRadius:10,background:"#000"}}):e.jsx("img",{src:q??Ee(M??k.userId),alt:"Profile media",style:{width:"100%",maxHeight:260,objectFit:"cover",borderRadius:10}})}),e.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:u.map((oe,le)=>{const Fe=N[oe],Xe=oe===k.videoMediaId;return e.jsx("button",{type:"button",onClick:()=>we(le),style:{width:64,height:64,padding:0,borderRadius:8,overflow:"hidden",border:le===m?"2px solid #26d5ff":"1px solid rgba(255,58,77,0.4)",background:"#000",cursor:"pointer",color:"#fff",fontSize:10},"aria-label":Xe?"Open video":"Open photo",children:Xe?e.jsx("div",{style:{display:"grid",placeItems:"center",width:"100%",height:"100%"},children:Fe?e.jsx("video",{src:Fe,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}):"VIDEO"}):e.jsx("img",{src:Fe??Ee(M??k.userId),alt:"Media thumbnail",style:{width:"100%",height:"100%",objectFit:"cover"}})},oe)})})]})})()}):null]}),e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:e.jsx("button",{type:"button",style:Re(!1),onClick:()=>{M&&V(M),b(null),we(0)},children:"CHAT"})})]})})}):null,g?e.jsx(zn,{api:t,session:n,spot:c.find(u=>u.spotId===g)??null,onClose:()=>R(null),onUpdated:async()=>{try{const u=await t.listCruisingSpots();H(u.spots)}catch{}},setLastError:I}):null]})}function zn({api:t,session:n,spot:a,onClose:f,onUpdated:o,setLastError:x}){return a?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},role:"dialog","aria-modal":"true","aria-label":"Cruising spot",onClick:f,children:e.jsxs("div",{onClick:I=>I.stopPropagation(),style:{...Ve(),width:"min(520px, 100%)",display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:a.name}),e.jsx("div",{style:{color:"#9fb6bf",fontSize:13},children:a.address}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap"},children:a.description}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:13},children:["Check-ins: ",a.checkInCount??0," | I got action there: ",a.actionCount??0]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:Re(!1),onClick:async()=>{try{await t.checkInCruisingSpot(n.sessionToken,a.spotId),await o()}catch(I){x(J(I))}},children:"CHECK IN"}),e.jsx("button",{type:"button",style:B(!1),onClick:async()=>{try{await t.markCruisingSpotAction(n.sessionToken,a.spotId),await o()}catch(I){x(J(I))}},children:"I GOT ACTION THERE"}),e.jsx("button",{type:"button",style:B(!1),onClick:f,children:"CLOSE"})]})]})}):null}function On({api:t,session:n,busy:a,setBusy:f,setLastError:o,onlinePeers:x,selectedPeerKey:I,setSelectedPeerKey:C,onOpenProfile:A,openThreadRequest:F,onThreadRequestConsumed:V,isMobile:_,selfCoords:z,peerProfileByKey:P,discoverFilter:l,publicProfiles:v,favorites:M,mediaUrlById:b,onUnreadCountChange:h}){var Bt;const[W,$]=s.useState({}),[K,de]=s.useState({}),[ge,Te]=s.useState("instant"),[he,me]=s.useState("grid"),[je,p]=s.useState(null),[y,N]=s.useState(""),[ae,D]=s.useState(null),[ie,k]=s.useState([]),[be,fe]=s.useState({}),[we,c]=s.useState(null),[H,g]=s.useState({}),[R,G]=s.useState({}),[ce,Me]=s.useState(!1),[Se,Ue]=s.useState(""),[re,Ie]=s.useState(null),ve=s.useRef(!1),Ae=s.useRef(!1),$e=s.useRef(0),De=s.useRef(null),Qe=s.useRef(null),Be=s.useRef(null),Z=s.useRef(null),Ne=s.useRef(null),xe=s.useRef(0),Pe=s.useRef(new Set),ke=s.useRef(null),Ge=s.useRef(null),Ze=s.useRef(null),[He,at]=s.useState(null),[qe,et]=s.useState(l==="favorites"),[pt,ue]=s.useState(!1),[_e,lt]=s.useState(l==="online"?"online":"all"),[u,m]=s.useState(!1),[j,q]=s.useState(""),[ne,oe]=s.useState(""),[le,Fe]=s.useState(""),[Xe,dt]=s.useState(""),[yt,xt]=s.useState(""),[ht,Ct]=s.useState(""),[ct,Tt]=s.useState(""),[mt,jt]=s.useState(""),[bt,wt]=s.useState(""),[r,S]=s.useState(""),[L,Ce]=s.useState(""),ee=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,E=je??I??"",ze=E?W[E]??[]:[],vt=s.useMemo(()=>new Map(x.map(i=>[i.key,i])),[x]),Le=s.useMemo(()=>{const i={};for(const d of v)typeof d.displayName=="string"&&d.displayName.trim()&&(i[Ye(d.userId)]=d.displayName);for(const[d,w]of Object.entries(P))typeof w.displayName=="string"&&w.displayName.trim()&&(i[d]=w.displayName);return i},[P,v]),ut=s.useMemo(()=>v.filter(i=>i.userId!==(n.userId??"")).map(i=>{const d=Ye(i.userId),w=vt.get(d);return{key:d,userId:i.userId,displayName:i.displayName,age:i.age,stats:i.stats,meters:w&&z?Math.round(Nt(z,{lat:w.lat,lng:w.lng})):null,isOnline:!!w,hasPicture:typeof i.mainPhotoMediaId=="string"&&i.mainPhotoMediaId.trim().length>0,avatarUrl:i.mainPhotoMediaId?b[i.mainPhotoMediaId]:void 0}}),[b,vt,v,z,n.userId]),tt=s.useMemo(()=>{const i=j.trim()?Number(j):void 0,d=ne.trim()?Number(ne):void 0,w=Xe.trim()?Number(Xe):void 0,U=yt.trim()?Number(yt):void 0,O=ht.trim()?Number(ht):void 0,X=ct.trim()?Number(ct):void 0,se=mt.trim()?Number(mt):void 0,Y=bt.trim()?Number(bt):void 0;return[...ut.filter(T=>{var We,Je,ft,ot,Gt,_t,Vt,qt,Jt;if(qe&&!M.has(T.userId)||_e==="online"&&!T.isOnline||_e==="offline"&&T.isOnline||u&&!T.hasPicture||Number.isFinite(i)&&(typeof T.age!="number"||T.age<i)||Number.isFinite(d)&&(typeof T.age!="number"||T.age>d))return!1;const pe=typeof((We=T.stats)==null?void 0:We.race)=="string"?T.stats.race:"";return!(le.trim()&&pe.toLowerCase()!==le.trim().toLowerCase()||Number.isFinite(w)&&(typeof((Je=T.stats)==null?void 0:Je.heightInches)!="number"||T.stats.heightInches<w)||Number.isFinite(U)&&(typeof((ft=T.stats)==null?void 0:ft.heightInches)!="number"||T.stats.heightInches>U)||Number.isFinite(O)&&(typeof((ot=T.stats)==null?void 0:ot.weightLbs)!="number"||T.stats.weightLbs<O)||Number.isFinite(X)&&(typeof((Gt=T.stats)==null?void 0:Gt.weightLbs)!="number"||T.stats.weightLbs>X)||Number.isFinite(se)&&(typeof((_t=T.stats)==null?void 0:_t.cockSizeInches)!="number"||T.stats.cockSizeInches<se)||Number.isFinite(Y)&&(typeof((Vt=T.stats)==null?void 0:Vt.cockSizeInches)!="number"||T.stats.cockSizeInches>Y)||r&&((qt=T.stats)==null?void 0:qt.cutStatus)!==r||L&&((Jt=T.stats)==null?void 0:Jt.position)!==L)})].sort((T,pe)=>{const We=typeof T.meters=="number"&&Number.isFinite(T.meters)?T.meters:Number.POSITIVE_INFINITY,Je=typeof pe.meters=="number"&&Number.isFinite(pe.meters)?pe.meters:Number.POSITIVE_INFINITY;if(We!==Je)return We-Je;const ft=T.displayName.localeCompare(pe.displayName);return ft!==0?ft:T.key.localeCompare(pe.key)})},[ut,M,qe,r,ne,bt,yt,ct,j,mt,Xe,ht,L,le,u,_e]),nt=s.useMemo(()=>Array.from(new Set(tt.map(i=>i.key).filter(i=>i.trim().length>0))).slice(0,8),[tt]),Ke=nt.join("|"),st=s.useMemo(()=>{const i=new Set(Object.keys(K));return E.trim()&&i.add(E),Array.from(i).sort((d,w)=>{var U,O;return(((U=K[w])==null?void 0:U.lastAt)??0)-(((O=K[d])==null?void 0:O.lastAt)??0)})},[K,E]),Q=s.useMemo(()=>Object.values(H).reduce((i,d)=>i+(Number.isFinite(d)?d:0),0),[H]);s.useMemo(()=>{var i;return E?Le[E]??((i=P[E])==null?void 0:i.displayName)??E:""},[Le,E,P]);const gt=s.useMemo(()=>{if(!E)return;const i=tt.find(d=>d.key===E);return i==null?void 0:i.avatarUrl},[tt,E]),it=s.useMemo(()=>st.filter(i=>i!==E&&i!==ee&&!!K[i]).map(i=>{var d;return{key:i,label:Le[i]??((d=P[i])==null?void 0:d.displayName)??i}}),[st,K,Le,ee,E,P]);s.useEffect(()=>{typeof h=="function"&&h(Q)},[h,Q]),s.useEffect(()=>{const i=De.current;i&&(i.srcObject=re)},[re]),s.useEffect(()=>{const i=Qe.current;i&&(i.srcObject=He)},[He]),s.useEffect(()=>()=>{if(re){for(const i of re.getTracks())i.stop();if(He)for(const i of He.getTracks())i.stop();ke.current&&(ke.current.close(),ke.current=null)}},[re,He]),s.useEffect(()=>{if(it.length===0){N("");return}N(i=>i&&it.some(d=>d.key===i)?i:it[0].key)},[it]);const Et=s.useMemo(()=>({async sendMessage(i,d,w,U){const O=Oe(d),X=await t.sendChat(n.sessionToken,i,O,w,U),se=X==null?void 0:X.message,Y=[se];if(i==="cruise"&&ae)try{const ye=await t.sendChat(n.sessionToken,i,Oe(ae),w,U),T=ye==null?void 0:ye.message;Y.push(T)}catch(ye){o(J(ye))}for(const ye of Y)Rt(ye);return se},async initiateMediaUpload(i,d){const w=await t.initiateChatMediaUpload(n.sessionToken,{mimeType:i,sizeBytes:d});return{objectKey:w.objectKey,uploadUrl:w.uploadUrl}},async uploadToSignedUrl(i,d,w){if(await kt(i,d,w))return;if(!(await fetch(i,{method:"PUT",headers:{"content-type":w},body:d})).ok)throw{code:"MEDIA_UPLOAD_INCOMPLETE",message:"Upload failed."}},async getMediaUrl(i){return(await t.getChatMediaUrl(n.sessionToken,i)).downloadUrl}}),[t,ee,n.sessionToken,o,ae]);function rt(i){var d,w,U;return i.text&&i.text.trim()?un(i.text):((d=i.media)==null?void 0:d.kind)==="image"?"[Photo]":((w=i.media)==null?void 0:w.kind)==="video"?"[Video]":((U=i.media)==null?void 0:U.kind)==="audio"?"[Voice]":""}function Ut(i){if(!i||Pe.current.has(i))return!1;if(Pe.current.add(i),Pe.current.size>5e3){const d=Array.from(Pe.current).slice(-2500);Pe.current=new Set(d)}return!0}function Mt(i,d){var O;const w=Le[d]??((O=P[d])==null?void 0:O.displayName)??d,U=rt(i)||"New activity";if("Notification"in window){if(Notification.permission==="granted"){try{new Notification(`${w}`,{body:U})}catch{}return}Notification.permission==="default"&&Notification.requestPermission()}}function Pt(i){if(!i.startsWith("GROUP_INVITE_REQUEST|"))return null;const[,d,w,U]=i.split("|");return!d||!w||!U?null:{inviteId:d,inviterKey:w,primaryPeerKey:U}}function St(i){if(!i.startsWith("GROUP_INVITE_ACCEPT|"))return null;const[,d,w]=i.split("|");return!d||!w?null:{inviteId:d,candidateKey:w}}function Rt(i){if(!Ut(i.messageId))return;const d=i.fromKey===ee?i.toKey:i.fromKey;$(O=>{const X=O[d]??[];return X.some(se=>se.messageId===i.messageId)?O:{...O,[d]:[...X,i].sort((se,Y)=>se.createdAtMs-Y.createdAtMs)}}),de(O=>({...O,[d]:{lastAt:i.createdAtMs,lastText:rt(i)}})),i.fromKey!==ee&&(he==="thread"&&Oe(E)===Oe(d)?(G(X=>({...X,[d]:Math.max(X[d]??0,i.createdAtMs)})),g(X=>{const se={...X};return delete se[d],se})):g(X=>({...X,[d]:(X[d]??0)+1})),Mt(i,d));const w=Pt(i.text??"");w&&i.toKey===ee&&k(O=>O.some(X=>X.inviteId===w.inviteId)?O:[...O,{...w,createdAtMs:i.createdAtMs}]);const U=St(i.text??"");U&&i.toKey===ee&&be[U.inviteId]&&(D(Oe(U.candidateKey)),c(`Invite accepted by ${Le[U.candidateKey]??U.candidateKey}.`),fe(X=>{const se={...X};return delete se[U.inviteId],se}))}async function fn(i){const d=Oe(i);if(d)try{const w=await t.listChat(n.sessionToken,It(ge),d),U=w==null?void 0:w.messages,O=Array.isArray(U)?U:[];t.markChatRead(n.sessionToken,It(ge),d).catch(()=>{}),$(Y=>({...Y,[d]:O}));const X=O.length>0?O[O.length-1]:null;X&&de(Y=>({...Y,[d]:{lastAt:X.createdAtMs,lastText:rt(X)}}));let se=0;for(const Y of O)Y.fromKey===d&&Y.createdAtMs>se&&(se=Y.createdAtMs);se>0&&G(Y=>({...Y,[d]:Math.max(Y[d]??0,se)}))}catch(w){o(J(w))}}s.useEffect(()=>{if(he!=="thread"||!E.trim())return;let i=!1,d=!1,w=null;const U=async()=>{if(!(i||d)){d=!0;try{await fn(E)}finally{d=!1}i||(w=window.setTimeout(()=>{U()},1200))}};return U(),()=>{i=!0,w!==null&&window.clearTimeout(w)}},[ge,E,he]),s.useEffect(()=>{if(he!=="grid")return;if(nt.length===0){g({});return}let i=!1;async function d(){if(!ve.current&&!document.hidden){ve.current=!0;try{const O=It(ge),X=[],se=[];for(const ye of nt){if(i)break;try{const T=Oe(ye);if(!T)continue;const pe=await t.listChat(n.sessionToken,O,T),We=(pe==null?void 0:pe.messages)??[];if(We.length>0){const ot=We[We.length-1];se.push([T,{lastAt:ot.createdAtMs,lastText:rt(ot)}])}let Je=0;const ft=R[T]??0;for(const ot of We)ot.fromKey===T&&ot.createdAtMs>ft&&(Je+=1);X.push([T,Je])}catch{const T=Oe(ye);T&&X.push([T,0])}}if(i)return;se.length>0&&de(ye=>{const T={...ye};for(const[pe,We]of se)T[pe]=We;return T});const Y={};for(const[ye,T]of X)T>0&&(Y[ye]=T);g(Y)}finally{ve.current=!1}}}const w=window.setTimeout(()=>{d()},1200),U=window.setInterval(()=>{d()},15e3);return()=>{i=!0,ve.current=!1,window.clearTimeout(w),window.clearInterval(U)}},[t,ge,R,n.sessionToken,Ke,he]),s.useEffect(()=>{const i=Array.from(new Set([...st,...nt,E].map(X=>Oe(X)).filter(X=>X.length>0))).slice(0,10);if(i.length===0)return;let d=!1;const w=async()=>{if(!(d||document.hidden||Ae.current)){Ae.current=!0;try{const X=It(ge),se=[];for(const Y of i){if(d)break;try{const ye=await t.listChat(n.sessionToken,X,Y),T=(ye==null?void 0:ye.messages)??[];if(T.length===0)continue;const pe=T[T.length-1];se.push([Y,{lastAt:pe.createdAtMs,lastText:rt(pe)}])}catch{}}if(d||se.length===0)return;de(Y=>{const ye={...Y};for(const[T,pe]of se)ye[T]=pe;return ye})}finally{Ae.current=!1}}},U=window.setTimeout(()=>{w()},1e3),O=window.setInterval(()=>{w()},5e3);return()=>{d=!0,window.clearTimeout(U),window.clearInterval(O)}},[t,ge,st,E,n.sessionToken,Ke]);async function pn(){if(re)return re;if(!navigator.mediaDevices||typeof navigator.mediaDevices.getUserMedia!="function")throw{code:"UNAUTHORIZED_ACTION",message:"Camera access is not available in this browser."};const i=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});return Ie(i),i}function yn(i,d){ke.current&&(ke.current.close(),ke.current=null);const w=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});return ke.current=w,Ge.current=d,Ze.current=i,w.ontrack=U=>{const O=U.streams[0];O&&at(O)},w.onicecandidate=U=>{const O=U.candidate;if(!O)return;const X=Ze.current,se=Ge.current;!X||!se||t.sendCallSignal(n.sessionToken,{toKey:X,callId:se,signalType:"ice",candidate:JSON.stringify(O.toJSON())}).catch(()=>{})},w}async function Dt(i=!0){const d=Ze.current,w=Ge.current;if(i&&d&&w)try{await t.sendCallSignal(n.sessionToken,{toKey:d,callId:w,signalType:"hangup"})}catch{}if(re)for(const U of re.getTracks())U.stop();if(He)for(const U of He.getTracks())U.stop();Ie(null),at(null),ke.current&&(ke.current.close(),ke.current=null),Ge.current=null,Ze.current=null,Me(!1)}s.useEffect(()=>{let i=!1;const d=At();if(!d)return;const w=()=>{Z.current!==null&&(window.clearInterval(Z.current),Z.current=null),Ne.current!==null&&(window.clearTimeout(Ne.current),Ne.current=null)},U=()=>{if(i)return;const O=new WebSocket(d);Be.current=O,O.onopen=()=>{xe.current=0,O.send(JSON.stringify({type:"auth",payload:{sessionToken:n.sessionToken}})),Z.current=window.setInterval(()=>{O.readyState===O.OPEN&&O.send(JSON.stringify({type:"heartbeat",payload:{}}))},15e3)},O.onmessage=X=>{let se=null;try{se=JSON.parse(String(X.data))}catch{return}if(!se||typeof se.type!="string")return;if(se.type==="chat_message"){const T=se.payload,pe=T==null?void 0:T.message;if(!pe||pe.fromKey!==ee&&pe.toKey!==ee)return;Rt(pe);return}if(se.type!=="call_signal")return;const Y=se.payload;if(!Y||Y.toKey!==ee||typeof Y.fromKey!="string"||!Y.callId||!Y.signalType)return;const ye=Oe(Y.fromKey);if(Y.signalType==="hangup"){Dt(!1);return}if(Y.signalType==="offer"){(async()=>{try{Ft(ye),Ue(ye);const T=await pn(),pe=yn(ye,Y.callId);for(const Je of T.getTracks())pe.addTrack(Je,T);await pe.setRemoteDescription({type:"offer",sdp:Y.sdp??""});const We=await pe.createAnswer();await pe.setLocalDescription(We),await t.sendCallSignal(n.sessionToken,{toKey:ye,callId:Y.callId,signalType:"answer",sdp:We.sdp??""}),Me(!0)}catch(T){o(J(T))}})();return}if(Y.signalType==="answer"){(async()=>{try{if(!ke.current||Ge.current!==Y.callId)return;await ke.current.setRemoteDescription({type:"answer",sdp:Y.sdp??""})}catch(T){o(J(T))}})();return}Y.signalType==="ice"&&(async()=>{try{if(!ke.current||Ge.current!==Y.callId||!Y.candidate)return;const T=JSON.parse(Y.candidate);await ke.current.addIceCandidate(T)}catch{}})()},O.onclose=()=>{if(w(),i)return;xe.current+=1;const X=Math.min(8e3,500*2**Math.min(xe.current,4));Ne.current=window.setTimeout(U,X)},O.onerror=()=>{}};return U(),()=>{var O;i=!0,w(),(O=Be.current)==null||O.close(1e3,"chat cleanup"),Be.current=null}},[t,ee,n.sessionToken]);async function hn(){if(y.trim()){if(!E.trim()){o("Select a user first.");return}try{const i=Oe(y);if(!i)return;if(!it.some(w=>w.key===i)){o("You can only add a third user you have previously messaged.");return}const d=crypto.randomUUID();await t.sendChat(n.sessionToken,"cruise",i,`GROUP_INVITE_REQUEST|${d}|${ee}|${E.trim()}`),fe(w=>({...w,[d]:{candidateKey:i,primaryPeerKey:E.trim()}})),c(`Invite sent to ${Le[i]??i}. Waiting for acceptance.`)}catch(i){o(J(i))}}}async function Ht(i,d,w){try{await t.sendChat(n.sessionToken,"cruise",d,`GROUP_INVITE_ACCEPT|${i}|${ee}`),k(U=>U.filter(O=>O.inviteId!==i)),c("Group invite accepted."),Ft(w)}catch(U){o(J(U))}}function $t(i){k(d=>d.filter(w=>w.inviteId!==i))}function Ft(i){const d=Oe(i);C(d),p(d),g(w=>{const U={...w};return delete U[d],U}),G(w=>({...w,[d]:Date.now()})),me("thread")}function zt(){et(!1),lt("all"),m(!1),q(""),oe(""),Fe(""),dt(""),xt(""),Ct(""),Tt(""),jt(""),wt(""),S(""),Ce(""),ue(!1)}if(s.useEffect(()=>{const i=d=>{var O;const U=(O=d.detail)==null?void 0:O.action;if(U==="reset"){zt(),me("grid");return}if(U==="toggle_favorites"){et(X=>!X),me("grid");return}U==="open_filters"&&(ue(!0),me("grid"))};return window.addEventListener("rd:discover-control",i),()=>window.removeEventListener("rd:discover-control",i)},[]),s.useEffect(()=>{F&&F.nonce!==$e.current&&($e.current=F.nonce,Ft(F.key),typeof V=="function"&&V())},[V,F]),s.useEffect(()=>{const i=d=>{var U;((U=d.detail)==null?void 0:U.tab)==="discover"&&(me("grid"),p(null),ue(!1))};return window.addEventListener("rd:tab-select",i),()=>window.removeEventListener("rd:tab-select",i)},[]),he==="thread"&&E.trim()){const i=Le[E]??((Bt=P[E])==null?void 0:Bt.displayName)??E;return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:_?-10:0},children:[ie.length>0?e.jsxs("div",{style:{...Ve(),display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"INVITE REQUESTS"}),ie.map(d=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,alignItems:"center"},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:13},children:[Le[d.inviterKey]??d.inviterKey," invited you to join a conversation."]}),e.jsx("button",{type:"button",style:Re(!1),onClick:()=>void Ht(d.inviteId,d.inviterKey,d.primaryPeerKey),children:"ACCEPT"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>$t(d.inviteId),children:"DECLINE"})]},d.inviteId))]}):null,we?e.jsx("div",{style:{color:"#26d5ff",fontSize:12},children:we}):null,e.jsx(Kt,{chatKind:It(ge),peerKey:E,currentUserKey:ee,messages:ze,client:Et,title:`INSTANT THREAD: ${i}`,peerSummary:{displayName:i,avatarUrl:gt},thirdParty:{candidates:it,selectedKey:y,onSelect:d=>N(d),onAdd:()=>void hn(),disabled:a},showHeader:!1,edgeToEdge:_,fillHeight:_}),ce?e.jsx("div",{role:"dialog","aria-modal":"true","aria-label":"Video call",style:{position:"fixed",inset:0,zIndex:60,background:"rgba(0,0,0,0.82)",display:"grid",placeItems:"center",padding:16},children:e.jsxs("div",{style:{...Ve(),width:"min(720px, 100%)",display:"grid",gap:10},children:[e.jsxs("div",{style:{fontSize:18,fontWeight:700},children:["VIDEO CALL: ",Se]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("video",{ref:De,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"100%",maxHeight:"52vh",borderRadius:12,background:"#000"}}),e.jsx("video",{ref:Qe,autoPlay:!0,playsInline:!0,style:{width:"100%",maxHeight:"52vh",borderRadius:12,background:"#000"}})]}),e.jsx("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:e.jsx("button",{type:"button",style:B(!1),onClick:()=>void Dt(),children:"END CALL"})})]})}):null]})}return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:_?-10:0},children:[ie.length>0?e.jsxs("div",{style:{...Ve(),display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"INVITE REQUESTS"}),ie.map(i=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,alignItems:"center"},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:13},children:[Le[i.inviterKey]??i.inviterKey," invited you to join a conversation."]}),e.jsx("button",{type:"button",style:Re(!1),onClick:()=>void Ht(i.inviteId,i.inviterKey,i.primaryPeerKey),children:"ACCEPT"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>$t(i.inviteId),children:"DECLINE"})]},i.inviteId))]}):null,we?e.jsx("div",{style:{color:"#26d5ff",fontSize:12},children:we}):null,e.jsx("div",{style:{padding:10,borderBottom:"1px solid rgba(255,58,77,0.28)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8},children:[e.jsx("button",{type:"button",style:B(!1),onClick:zt,children:"GUYS"}),e.jsx("button",{type:"button",style:qe?Re(!1):B(!1),onClick:()=>et(i=>!i),"aria-label":"Toggle favorites only",children:"â˜…"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>ue(!0),children:"FILTER"})]})}),pt?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},role:"dialog","aria-modal":"true","aria-label":"Discover filters",onClick:()=>ue(!1),children:e.jsx("div",{onClick:i=>i.stopPropagation(),style:{...Ve(),width:"min(760px, 100%)",maxHeight:"86vh",overflow:"auto"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"FILTER USERS"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{type:"checkbox",checked:u,onChange:i=>m(i.target.checked)}),"Has pictures"]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Online status"}),e.jsxs("select",{style:te(),value:_e,onChange:i=>lt(i.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"offline",children:"Offline"})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[e.jsx("input",{style:te(),placeholder:"Min age",value:j,onChange:i=>q(i.target.value)}),e.jsx("input",{style:te(),placeholder:"Max age",value:ne,onChange:i=>oe(i.target.value)}),e.jsx("input",{style:te(),placeholder:"Race",value:le,onChange:i=>Fe(i.target.value)}),e.jsxs("select",{style:te(),value:r,onChange:i=>S(i.target.value),children:[e.jsx("option",{value:"",children:"Cut / Uncut"}),e.jsx("option",{value:"cut",children:"Cut"}),e.jsx("option",{value:"uncut",children:"Uncut"})]}),e.jsx("input",{style:te(),placeholder:"Min height (in)",value:Xe,onChange:i=>dt(i.target.value)}),e.jsx("input",{style:te(),placeholder:"Max height (in)",value:yt,onChange:i=>xt(i.target.value)}),e.jsx("input",{style:te(),placeholder:"Min weight (lbs)",value:ht,onChange:i=>Ct(i.target.value)}),e.jsx("input",{style:te(),placeholder:"Max weight (lbs)",value:ct,onChange:i=>Tt(i.target.value)}),e.jsx("input",{style:te(),placeholder:"Min cock size (in)",value:mt,onChange:i=>jt(i.target.value)}),e.jsx("input",{style:te(),placeholder:"Max cock size (in)",value:bt,onChange:i=>wt(i.target.value)}),e.jsxs("select",{style:te(),value:L,onChange:i=>Ce(i.target.value),children:[e.jsx("option",{value:"",children:"Position"}),e.jsx("option",{value:"top",children:"Top"}),e.jsx("option",{value:"bottom",children:"Bottom"}),e.jsx("option",{value:"side",children:"Side"})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:B(!1),onClick:zt,children:"RESET"}),e.jsx("button",{type:"button",style:Re(!1),onClick:()=>ue(!1),children:"DONE"})]})]})})}):null,e.jsx("div",{style:{display:"grid",gap:0},children:e.jsx("div",{style:{display:"grid",gap:0,gridTemplateColumns:"repeat(3, minmax(0, 1fr))"},children:tt.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:13,padding:12,gridColumn:"1 / -1"},children:"No users match current filters."}):tt.map(i=>e.jsx("button",{type:"button",onClick:()=>A(i.key),style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:0,display:"grid",gap:0,color:"#fff",cursor:"pointer"},children:e.jsxs("div",{style:{position:"relative",width:"100%",aspectRatio:"1 / 1"},children:[e.jsx("img",{src:i.avatarUrl??Ee(i.key),alt:"User avatar",style:{width:"100%",height:"100%",borderRadius:0,objectFit:"cover",border:"1px solid #0fd9ff"}}),i.isOnline?e.jsx("span",{style:{position:"absolute",top:4,left:4,width:10,height:10,borderRadius:"50%",background:"#26d5ff",border:"2px solid #000"}}):null]})},i.key))})})]})}function Ln({api:t,session:n,setLastError:a,openThreadRequest:f,onThreadRequestConsumed:o,isMobile:x}){var k,be,fe,we,c,H;const[I,C]=s.useState([]),[A,F]=s.useState(null),[V,_]=s.useState([]),[z,P]=s.useState("messages"),[l,v]=s.useState(null),[M,b]=s.useState(!1),[h,W]=s.useState(""),[$,K]=s.useState(null),[de,ge]=s.useState({}),[Te,he]=s.useState(null),me=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,je="cruise",p=s.useMemo(()=>I.filter(g=>g.key!==A).map(g=>({key:g.key,label:g.displayName})),[I,A]),y=s.useMemo(()=>I.find(g=>g.key===A)??null,[I,A]);s.useEffect(()=>{if(p.length===0){W("");return}W(g=>g&&p.some(R=>R.key===g)?g:p[0].key)},[p]),s.useEffect(()=>{let g=!1;async function R(){var ce,Me,Se;try{const Ue=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,[re,Ie]=await Promise.all([t.getPublicProfiles(),t.listActivePresence(n.sessionToken)]),ve={},Ae={};for(const Z of re.profiles)ve[Ye(Z.userId)]=Z.displayName,typeof Z.mainPhotoMediaId=="string"&&Z.mainPhotoMediaId.trim()!==""&&(Ae[Ye(Z.userId)]=Z.mainPhotoMediaId);const $e=Array.from(new Set([...re.profiles.map(Z=>Ye(Z.userId)),...Ie.presence.map(Z=>Oe(Z.key))].filter(Z=>Z&&Z!==Ue))).slice(0,24),De=[];for(const Z of $e)try{const Ne=await t.listChat(n.sessionToken,"cruise",Z),xe=(Ne==null?void 0:Ne.messages)??[];if(!Array.isArray(xe)||xe.length===0)continue;const Pe=xe[xe.length-1],ke=typeof Pe.text=="string"&&Pe.text.trim().length>0?un(Pe.text):((ce=Pe.media)==null?void 0:ce.kind)==="image"?"[Photo]":((Me=Pe.media)==null?void 0:Me.kind)==="video"?"[Video]":((Se=Pe.media)==null?void 0:Se.kind)==="audio"?"[Voice]":"";De.push({key:Z,displayName:ve[Z]??Z,preview:ke,at:Pe.createdAtMs})}catch{}const Qe=await Promise.all(De.map(async Z=>{const Ne=Ae[Z.key];if(!Ne)return null;try{const xe=await t.getPublicMediaUrl(Ne);return{key:Z.key,url:xe.downloadUrl}}catch{return null}})),Be={};for(const Z of Qe)Z&&(Be[Z.key]=Z.url);for(const Z of De)Z.avatarUrl=Be[Z.key];if(g)return;De.sort((Z,Ne)=>Ne.at-Z.at),C(De)}catch(Ue){g||a(J(Ue))}}R();const G=window.setInterval(()=>{R()},1e4);return()=>{g=!0,window.clearInterval(G)}},[t,A,n.sessionToken,n.userId,a]),s.useEffect(()=>{f!=null&&f.key&&(F(Oe(f.key)),P("messages"),typeof o=="function"&&o())},[o,f]),s.useEffect(()=>{const g=R=>{var ce;((ce=R.detail)==null?void 0:ce.tab)==="threads"&&(F(null),P("messages"))};return window.addEventListener("rd:tab-select",g),()=>window.removeEventListener("rd:tab-select",g)},[]),s.useEffect(()=>{if(!A||z!=="profile")return;const g=Lt(A);if(!g){v(null);return}let R=!1;return b(!0),t.getPublicProfile(g).then(G=>{R||v(G.profile)}).catch(G=>{R||(v(null),a(J(G)))}).finally(()=>{R||b(!1)}),()=>{R=!0}},[t,A,a,z]),s.useEffect(()=>{if(!A){_([]);return}let g=!1;const R=async()=>{try{const ce=await t.listChat(n.sessionToken,je,A),Me=(ce==null?void 0:ce.messages)??[];g||(_(Array.isArray(Me)?Me:[]),t.markChatRead(n.sessionToken,je,A).catch(()=>{}))}catch(ce){g||a(J(ce))}};R();const G=window.setInterval(()=>{R()},1200);return()=>{g=!0,window.clearInterval(G)}},[t,A,n.sessionToken,a]);function N(g){if(!g.startsWith("GROUP_INVITE_ACCEPT|"))return null;const[,R,G]=g.split("|");return!R||!G?null:{inviteId:R,candidateKey:G}}const ae=s.useMemo(()=>({async sendMessage(g,R,G,ce){const Me=await t.sendChat(n.sessionToken,g,R,G,ce),Se=Me==null?void 0:Me.message,Ue=N(Se.text??"");if(Ue&&Se.toKey===me&&de[Ue.inviteId]&&(K(Ue.candidateKey),he(`Invite accepted by ${Ue.candidateKey}.`),ge(Ie=>{const ve={...Ie};return delete ve[Ue.inviteId],ve})),_(re=>[...re,Se].sort((Ie,ve)=>Ie.createdAtMs-ve.createdAtMs)),g==="cruise"&&$)try{const re=await t.sendChat(n.sessionToken,g,$,G,ce),Ie=re==null?void 0:re.message;_(ve=>[...ve,Ie].sort((Ae,$e)=>Ae.createdAtMs-$e.createdAtMs))}catch(re){a(J(re))}return Se},async initiateMediaUpload(g,R){const G=await t.initiateChatMediaUpload(n.sessionToken,{mimeType:g,sizeBytes:R});return{objectKey:G.objectKey,uploadUrl:G.uploadUrl}},async uploadToSignedUrl(g,R,G){if(await kt(g,R,G))return;if(!(await fetch(g,{method:"PUT",headers:{"content-type":G},body:R})).ok)throw{code:"MEDIA_UPLOAD_INCOMPLETE",message:"Upload failed."}},async getMediaUrl(g){return(await t.getChatMediaUrl(n.sessionToken,g)).downloadUrl}}),[t,me,de,n.sessionToken,a,$]);async function D(){var g;if(!(!A||!h)){if(!I.some(R=>R.key===h)){a("You can only add a third user you have previously messaged.");return}try{const R=crypto.randomUUID();await t.sendChat(n.sessionToken,"cruise",h,`GROUP_INVITE_REQUEST|${R}|${me}|${A}`),ge(G=>({...G,[R]:{candidateKey:h}})),he(`Invite sent to ${((g=I.find(G=>G.key===h))==null?void 0:g.displayName)??h}.`)}catch(R){a(J(R))}}}async function ie(){if(A)try{await t.sendChat(n.sessionToken,"cruise",A,Wt),he("Fire sent.")}catch(g){a(J(g))}}if(A){const g=(y==null?void 0:y.displayName)??A;return e.jsxs("div",{style:{display:"grid",gap:0,minHeight:x?"calc(100dvh - 150px)":void 0,marginInline:x?-10:0,marginBlock:0},children:[e.jsx("div",{style:{position:"sticky",top:0,zIndex:46,background:"rgba(8,8,12,0.96)",borderBottom:"1px solid rgba(255,58,77,0.35)",padding:"6px 10px",display:"flex",justifyContent:"flex-end"},children:e.jsx("button",{type:"button",onClick:()=>P(R=>R==="messages"?"profile":"messages"),style:{background:"transparent",border:0,color:"#26d5ff",fontSize:13,fontWeight:700,letterSpacing:"0.03em",textTransform:"uppercase",padding:0,cursor:"pointer"},children:z==="messages"?"View Profile":"Back to Thread"})}),z==="messages"?e.jsx(Kt,{chatKind:"cruise",peerKey:A,currentUserKey:me,messages:V,client:ae,title:`INSTANT THREAD: ${g}`,peerSummary:{displayName:g},thirdParty:{candidates:p,selectedKey:h,onSelect:R=>W(R),onAdd:()=>void D(),disabled:!1},showHeader:!1,edgeToEdge:!0,fillHeight:x}):e.jsxs("div",{style:{padding:12,display:"grid",gap:12},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"88px 1fr",gap:12,alignItems:"center"},children:[e.jsx("img",{src:(y==null?void 0:y.avatarUrl)??Ee(A),alt:"Profile avatar",style:{width:88,height:88,borderRadius:"50%",objectFit:"cover",border:"2px solid #ff3047"}}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:24,fontWeight:700},children:(l==null?void 0:l.displayName)??g}),e.jsx("div",{style:{color:"#26d5ff",fontSize:14},children:"Instant Messaging Available"})]})]}),M?e.jsx("div",{style:{color:"#9fb6bf",fontSize:14},children:"Loading profile..."}):null,M?null:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:14,lineHeight:1.5},children:[e.jsxs("div",{children:["Age: ",(l==null?void 0:l.age)??"-"]}),e.jsxs("div",{children:["Race: ",((k=l==null?void 0:l.stats)==null?void 0:k.race)??"-"]}),e.jsxs("div",{children:["Height: ",((be=l==null?void 0:l.stats)==null?void 0:be.heightInches)??"-"]}),e.jsxs("div",{children:["Weight: ",((fe=l==null?void 0:l.stats)==null?void 0:fe.weightLbs)??"-"]}),e.jsxs("div",{children:["Cock Size: ",((we=l==null?void 0:l.stats)==null?void 0:we.cockSizeInches)??"-"]}),e.jsxs("div",{children:["Cut / Uncut: ",((c=l==null?void 0:l.stats)==null?void 0:c.cutStatus)??"-"]}),e.jsxs("div",{children:["Position: ",((H=l==null?void 0:l.stats)==null?void 0:H.position)??"-"]}),e.jsxs("div",{style:{marginTop:8},children:["Bio: ",(l==null?void 0:l.bio)??"-"]})]}),e.jsx("div",{children:e.jsx("button",{type:"button",style:{...B(!1),color:"#ffb347",borderColor:"rgba(255,179,71,0.65)"},onClick:()=>void ie(),children:"ðŸ”¥ FIRE"})})]})]})]})}return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:x?-10:0,marginBlock:0},children:[I.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14,padding:14},children:"No conversations yet."}):I.map(g=>e.jsxs("button",{type:"button",onClick:()=>F(g.key),style:{border:0,borderBottom:"1px solid rgba(255,58,77,0.24)",borderRadius:0,padding:"10px 12px",background:"rgba(0,0,0,0.2)",textAlign:"left",color:"#fff",cursor:"pointer",display:"grid",gridTemplateColumns:"52px 1fr",gap:10,alignItems:"center",width:"100%"},children:[e.jsx("img",{src:g.avatarUrl??Ee(g.key),alt:`${g.displayName} avatar`,style:{width:52,height:52,borderRadius:6,objectFit:"cover",border:"1px solid rgba(38,213,255,0.9)"}}),e.jsxs("div",{style:{display:"grid",gap:3,minWidth:0},children:[e.jsx("div",{style:{fontWeight:700},children:g.displayName}),e.jsx("div",{style:{color:"#b9bec9",fontSize:13,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:g.preview})]})]},g.key)),Te?e.jsx("div",{style:{color:"#26d5ff",fontSize:12,padding:10},children:Te}):null]})}function Ot({api:t,session:n,isMobile:a,screen:f,setLastError:o}){var wt;const[x,I]=s.useState([]),[C,A]=s.useState([]),[F,V]=s.useState(""),[_,z]=s.useState(""),[P,l]=s.useState(""),[v,M]=s.useState(""),[b,h]=s.useState(""),[W,$]=s.useState(""),[K,de]=s.useState(""),[ge,Te]=s.useState(""),[he,me]=s.useState([]),[je,p]=s.useState(""),[y,N]=s.useState(""),[ae,D]=s.useState(""),[ie,k]=s.useState(null),[be,fe]=s.useState(null),[we,c]=s.useState(null),[H,g]=s.useState(""),[R,G]=s.useState(""),[ce,Me]=s.useState(""),[Se,Ue]=s.useState({}),[re,Ie]=s.useState({}),[ve,Ae]=s.useState(null),[$e,De]=s.useState([]),[Qe,Be]=s.useState({}),[Z,Ne]=s.useState(null),[xe,Pe]=s.useState(null),[ke,Ge]=s.useState([]),[Ze,He]=s.useState(!1),at=!0,qe=n.userType!=="guest",et=a?"repeat(2, minmax(0, 1fr))":"repeat(3, minmax(0, 1fr))",pt=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,ue=s.useMemo(()=>C.find(r=>r.postingId===Z)??null,[C,Z]),_e=s.useMemo(()=>he.find(r=>r.spotId===xe)??null,[xe,he]),lt=xe?`spot:${xe}`:"";function u(r,S){const L=r.trim(),Ce=S.trim();if(!L||!Ce)return null;const ee=new Date(`${L}T${Ce}`);return Number.isFinite(ee.getTime())?ee.getTime():null}function m(r){const S=re[r];return S&&S.displayName.trim().length>0?S.displayName.trim():r}function j(r){const S=re[r];return S!=null&&S.mainPhotoMediaId&&Se[S.mainPhotoMediaId]?Se[S.mainPhotoMediaId]:Ee(`user:${r}`)}function q(r){const S=new Set((r.acceptedUserIds??[]).filter(L=>L&&L!==r.authorUserId));return[r.authorUserId,...Array.from(S.values()).sort()]}function ne(r){return n.userId?r.authorUserId===n.userId?!0:(r.acceptedUserIds??[]).includes(n.userId):!1}async function oe(r){const S=Array.from(new Set(r.map(ee=>ee.trim()).filter(ee=>ee.length>0)));if(S.length===0)return;const L=S.filter(ee=>!Se[ee]);if(L.length===0)return;const Ce=await Promise.all(L.map(async ee=>{try{const E=await t.getPublicMediaUrl(ee);return{mediaId:ee,url:E.downloadUrl}}catch{return null}}));Ue(ee=>{const E={...ee};for(const ze of Ce)ze&&(E[ze.mediaId]=ze.url);return E})}async function le(){try{const[r,S,L,Ce,ee]=await Promise.all([t.listPublicPostings("ad",n.sessionToken),t.listPublicPostings("event",n.sessionToken),t.listCruisingSpots(),n.userType==="guest"?Promise.resolve({postings:[]}):t.listEventInvites(n.sessionToken),t.getPublicProfiles()]);I([...r.postings].sort((E,ze)=>E.createdAtMs-ze.createdAtMs)),A([...S.postings].sort((E,ze)=>E.createdAtMs-ze.createdAtMs)),me(L.spots),De(Ce.postings),Ie(ee.profiles.reduce((E,ze)=>(E[ze.userId]=ze,E),{})),await oe([...r.postings.map(E=>E.photoMediaId??""),...S.postings.map(E=>E.photoMediaId??""),...L.spots.map(E=>E.photoMediaId??""),...ee.profiles.map(E=>E.mainPhotoMediaId??"")])}catch(r){o(J(r))}}s.useEffect(()=>{le()},[]);async function Fe(r){if(r==="event"&&!qe){o("Anonymous users cannot create groups.");return}const S=r==="ad"?F:P,L=r==="ad"?_:v,Ce=r==="ad"?H:R,ee=r==="event"?u(b,W):null;if(r==="event"&&ee===null){o("Group date and time are required.");return}if(r==="event"&&ge.trim().length===0){o("Location instructions are required.");return}if(r==="event"&&K.trim().length===0){o("Group details are required.");return}try{await t.createPublicPosting(n.sessionToken,{type:r,title:S,body:L,photoMediaId:Ce||void 0,eventStartAtMs:ee??void 0,locationInstructions:r==="event"?ge.trim():void 0,groupDetails:r==="event"?K.trim():void 0}),r==="ad"?(V(""),z(""),k(null),g("")):(l(""),M(""),h(""),$(""),de(""),Te(""),fe(null),G("")),await le()}catch(E){o(J(E))}}async function Xe(r){if(!qe){o("Anonymous users cannot invite to groups.");return}const S=(Qe[r]??"").trim();if(!S){o("Target user id is required.");return}try{await t.inviteToEvent(n.sessionToken,{postingId:r,targetUserId:S}),Be(L=>({...L,[r]:""})),await le()}catch(L){o(J(L))}}async function dt(r,S){if(n.userType==="guest"){o("Anonymous users cannot respond to group invites.");return}try{await t.respondToEventInvite(n.sessionToken,{postingId:r,accept:S}),await le()}catch(L){o(J(L))}}async function yt(r){if(n.userType==="guest"){o("Anonymous users cannot request to join groups.");return}try{await t.requestToJoinEvent(n.sessionToken,{postingId:r}),await le()}catch(S){o(J(S))}}async function xt(r,S,L){if(n.userType==="guest"){o("Anonymous users cannot manage join requests.");return}try{await t.respondToEventJoinRequest(n.sessionToken,{postingId:r,targetUserId:S,accept:L}),await le()}catch(Ce){o(J(Ce))}}async function ht(){try{await t.createCruisingSpot(n.sessionToken,{name:je,address:y,description:ae,photoMediaId:ce||void 0}),p(""),N(""),D(""),c(null),Me(""),await le()}catch(r){o(J(r))}}async function Ct(r){try{await t.checkInCruisingSpot(n.sessionToken,r),await le()}catch(S){o(J(S))}}async function ct(r){const S=r==="ad"?ie:r==="event"?be:we;if(!S){o("Choose a photo before uploading.");return}if(n.userType==="guest"){o("Guests cannot upload media.");return}Ae(r);try{const L=await t.initiateMediaUpload(n.sessionToken,{kind:"photo_gallery",mimeType:S.type||"application/octet-stream",sizeBytes:S.size});if(!await kt(L.uploadUrl,S,S.type||"application/octet-stream")){const ee=await fetch(L.uploadUrl,{method:"PUT",headers:{"content-type":S.type||"application/octet-stream"},body:S});if(!ee.ok)throw{message:`Upload failed (${ee.status}).`}}await t.completeMediaUpload(n.sessionToken,L.mediaId),await oe([L.mediaId]),r==="ad"&&g(L.mediaId),r==="event"&&G(L.mediaId),r==="spot"&&Me(L.mediaId)}catch(L){o(J(L))}finally{Ae(null)}}async function Tt(r){const S=`spot:${r}`;try{const L=await t.listChat(n.sessionToken,"cruise",S),Ce=Array.isArray(L.messages)?L.messages??[]:[];Ge([...Ce].sort((ee,E)=>ee.createdAtMs-E.createdAtMs)),t.markChatRead(n.sessionToken,"cruise",S).catch(()=>{})}catch(L){o(J(L))}}const mt=s.useMemo(()=>({async sendMessage(r,S,L,Ce){const E=(await t.sendChat(n.sessionToken,r,S,L,Ce)).message;if(!E)throw{code:"UNAUTHORIZED_ACTION",message:"Message rejected."};return Ge(ze=>[...ze,E].sort((vt,Le)=>vt.createdAtMs-Le.createdAtMs)),E},async initiateMediaUpload(r,S){const L=await t.initiateChatMediaUpload(n.sessionToken,{mimeType:r,sizeBytes:S});return{objectKey:L.objectKey,uploadUrl:L.uploadUrl}},async uploadToSignedUrl(r,S,L){if(await kt(r,S,L))return;if(!(await fetch(r,{method:"PUT",headers:{"content-type":L},body:S})).ok)throw{code:"MEDIA_UPLOAD_INCOMPLETE",message:"Upload failed."}},async getMediaUrl(r){return(await t.getChatMediaUrl(n.sessionToken,r)).downloadUrl}}),[t,n.sessionToken]);s.useEffect(()=>{if(!xe||f!=="cruise")return;let r=!1,S=null;He(!0);const L=async()=>{r||(await Tt(xe),!r&&(He(!1),S=window.setTimeout(()=>{L()},1500)))};return L(),()=>{r=!0,S!==null&&window.clearTimeout(S)}},[f,xe]);const jt=r=>{const S=r==="ads"?"ADS":"GROUPS",L=r==="ads"?x:C,Ce=r==="ads"?F:P,ee=r==="ads"?_:v,E=r==="ads"?V:l,ze=r==="ads"?z:M,vt=r==="ads"?ie:be,Le=r==="ads"?k:fe,ut=r==="ads"?H:R,tt=r==="ads"?g:G,nt=r==="ads"?"ad":"event",Ke=r==="ads"?at:qe,st=ve===nt;return e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.38)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:S}),e.jsx("input",{value:Ce,onChange:Q=>E(Q.target.value),placeholder:`${S} title`,style:te(),"aria-label":`${S} title`,disabled:!Ke}),e.jsx("textarea",{value:ee,onChange:Q=>ze(Q.target.value),placeholder:`Write ${S.toLowerCase()} details`,style:{...te(),minHeight:86,resize:"vertical"},"aria-label":`${S} details`,disabled:!Ke}),r==="groups"?e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:a?"1fr":"1fr 1fr",gap:8},children:[e.jsx("input",{value:b,onChange:Q=>h(Q.target.value),type:"date",style:te(),"aria-label":"Group date",disabled:!Ke}),e.jsx("input",{value:W,onChange:Q=>$(Q.target.value),type:"time",style:te(),"aria-label":"Group time",disabled:!Ke})]}),e.jsx("textarea",{value:K,onChange:Q=>de(Q.target.value),placeholder:"Detailed group profile description",style:{...te(),minHeight:74,resize:"vertical"},"aria-label":"Group details",disabled:!Ke}),e.jsx("textarea",{value:ge,onChange:Q=>Te(Q.target.value),placeholder:"Location instructions (shown only to attendees)",style:{...te(),minHeight:68,resize:"vertical"},"aria-label":"Location instructions",disabled:!Ke})]}):null,e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:Q=>{var gt;return Le(((gt=Q.target.files)==null?void 0:gt[0])??null)},disabled:!Ke}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",onClick:()=>void ct(nt),style:B(Ke?st:!0),disabled:!Ke||st,children:st?"UPLOADING...":"UPLOAD PHOTO"}),e.jsx("button",{type:"button",onClick:()=>{tt(""),Le(null)},style:B(!1),children:"CLEAR PHOTO"})]}),ut?e.jsx("img",{src:Se[ut]??Ee(ut),alt:`${S} photo preview`,style:{width:"100%",maxWidth:240,aspectRatio:"1 / 1",objectFit:"cover",border:"1px solid rgba(255,58,77,0.4)"}}):null,!ut&&vt?e.jsx("div",{style:{color:"#b9bec9",fontSize:12},children:"Photo selected. Upload to attach."}):null]}),e.jsxs("button",{type:"button",onClick:()=>void Fe(nt),style:Ke?Re(!1):B(!0),disabled:!Ke,children:["POST ",S]}),Ke?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can view groups but cannot post groups."}),e.jsx("div",{style:{display:"grid",gap:0,marginTop:6},children:L.length===0?e.jsxs("div",{style:{color:"#b9bec9",fontSize:14},children:["No ",S.toLowerCase()," yet."]}):e.jsx("div",{style:{display:"grid",gap:0,gridTemplateColumns:et},children:L.map(Q=>{var Mt,Pt;const gt=!!n.userId&&n.userId===Q.authorUserId,it=!!n.userId&&(Q.invitedUserIds??[]).includes(n.userId),Et=!!n.userId&&(Q.authorUserId===n.userId||(Q.acceptedUserIds??[]).includes(n.userId)),rt=!!n.userId&&(Q.joinRequestUserIds??[]).includes(n.userId),Ut=r==="groups"&&n.userType!=="guest"&&!!n.userId&&!gt&&!Et&&!rt;return e.jsxs("div",{style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,display:"grid",gap:0},children:[e.jsx("div",{style:{position:"relative",width:"100%",aspectRatio:"1 / 1"},children:e.jsx("img",{src:Q.photoMediaId?Se[Q.photoMediaId]??Ee(Q.postingId):Ee(Q.postingId),alt:`${S} posting`,style:{width:"100%",height:"100%",borderRadius:0,objectFit:"cover",border:"1px solid #0fd9ff"}})}),e.jsxs("div",{style:{padding:8,display:"grid",gap:6},children:[e.jsx("div",{style:{fontWeight:700,fontSize:14},children:Q.title}),r==="groups"?e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12},children:[Zt(Q.eventStartAtMs)," at ",en(Q.eventStartAtMs)]}):null,e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12},children:["Host: ",m(Q.authorUserId)]}),e.jsx("div",{style:{color:"#ced3dc",fontSize:13,whiteSpace:"pre-wrap"},children:Q.body}),r==="groups"?e.jsxs("div",{style:{display:"grid",gap:8,marginTop:4},children:[e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12},children:["Invited: ",((Mt=Q.invitedUserIds)==null?void 0:Mt.length)??0," | Attending: ",(((Pt=Q.acceptedUserIds)==null?void 0:Pt.length)??0)+1]}),gt?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8},children:[e.jsx("input",{value:Qe[Q.postingId]??"",onChange:St=>Be(Rt=>({...Rt,[Q.postingId]:St.target.value})),placeholder:"Invite user id",style:te()}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void Xe(Q.postingId),children:"INVITE"})]}):null,n.userType!=="guest"&&it?e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:Re(!1),onClick:()=>void dt(Q.postingId,!0),children:"ACCEPT INVITE"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void dt(Q.postingId,!1),children:"DECLINE"})]}):null,Ut?e.jsx("button",{type:"button",style:B(!1),onClick:()=>void yt(Q.postingId),children:"REQUEST TO JOIN"}):null,rt?e.jsx("div",{style:{color:"#b9bec9",fontSize:12},children:"Join request pending host approval."}):null,e.jsx("button",{type:"button",style:Z===Q.postingId?Re(!1):B(!1),onClick:()=>Ne(St=>St===Q.postingId?null:Q.postingId),children:Z===Q.postingId?"HIDE GROUP PROFILE":"VIEW GROUP PROFILE"})]}):null]})]},Q.postingId)})})})]})})},bt=e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.38)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"CRUISE"}),e.jsx("input",{value:je,onChange:r=>p(r.target.value),placeholder:"Spot name",style:te(),disabled:!1}),e.jsx("input",{value:y,onChange:r=>N(r.target.value),placeholder:"Spot address",style:te(),disabled:!1}),e.jsx("textarea",{value:ae,onChange:r=>D(r.target.value),placeholder:"Spot description",style:{...te(),minHeight:80,resize:"vertical"},disabled:!1}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:r=>{var S;return c(((S=r.target.files)==null?void 0:S[0])??null)},disabled:!1}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:B(ve==="spot"),disabled:ve==="spot",onClick:()=>void ct("spot"),children:ve==="spot"?"UPLOADING...":"UPLOAD PHOTO"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>{c(null),Me("")},children:"CLEAR PHOTO"})]}),ce?e.jsx("img",{src:Se[ce]??Ee(ce),alt:"Cruising spot preview",style:{width:"100%",maxWidth:240,aspectRatio:"1 / 1",objectFit:"cover",border:"1px solid rgba(255,58,77,0.4)"}}):null,!ce&&we?e.jsx("div",{style:{color:"#b9bec9",fontSize:12},children:"Photo selected. Upload to attach."}):null]}),e.jsx("button",{type:"button",style:Re(!1),disabled:!1,onClick:()=>void ht(),children:"CREATE SPOT"}),null,e.jsx("div",{style:{display:"grid",gap:10},children:he.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"No cruise spots yet."}):e.jsx("div",{style:{display:"grid",gap:10},children:he.map(r=>e.jsxs("button",{type:"button",onClick:()=>Pe(r.spotId),style:{border:xe===r.spotId?"1px solid #26d5ff":"1px solid rgba(255,58,77,0.35)",background:"rgba(0,0,0,0.5)",borderRadius:0,display:"grid",gap:0,textAlign:"left",color:"#fff",cursor:"pointer",width:"100%",padding:0},children:[e.jsx("div",{style:{position:"relative",width:"100%",aspectRatio:"16 / 6"},children:e.jsx("img",{src:r.photoMediaId?Se[r.photoMediaId]??Ee(r.spotId):Ee(r.spotId),alt:"Cruising spot",style:{width:"100%",height:"100%",borderRadius:0,objectFit:"cover",border:"1px solid #0fd9ff"}})}),e.jsxs("div",{style:{padding:"10px 12px",display:"grid",gap:8},children:[e.jsx("div",{style:{fontWeight:700},children:r.name}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsxs("span",{style:{color:"#9fb6bf",fontSize:12},children:["Check-ins: ",r.checkInCount??0]}),e.jsx("button",{type:"button",style:B(!1),onClick:S=>{S.stopPropagation(),Ct(r.spotId)},children:"CHECK IN"})]})]})]},r.spotId))})}),_e?e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.38)",background:"rgba(0,0,0,0.4)",padding:8},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:8,alignItems:"center",marginBottom:8},children:[e.jsxs("div",{style:{fontWeight:700,fontSize:16},children:[_e.name," Thread"]}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>Pe(null),children:"CLOSE THREAD"})]}),Ze?e.jsx("div",{style:{color:"#9fb6bf",fontSize:13,marginBottom:8},children:"Loading thread..."}):null,e.jsx(Kt,{chatKind:"cruise",peerKey:lt,currentUserKey:pt,messages:ke,client:mt,title:`${_e.name} Chat`,showHeader:!1})]}):null]})});return e.jsxs("div",{style:{display:"grid",gap:8,marginInline:a?-10:0},children:[f==="ads"?jt("ads"):null,f==="groups"?jt("groups"):null,f==="groups"&&ue?e.jsxs("div",{style:{border:"1px solid rgba(63,223,255,0.45)",background:"rgba(0,0,0,0.45)",padding:12,display:"grid",gap:10},children:[e.jsxs("div",{style:{display:"grid",gap:6},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:ue.title}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:13},children:[Zt(ue.eventStartAtMs)," at ",en(ue.eventStartAtMs)]}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:13},children:["Host: ",m(ue.authorUserId)]})]}),e.jsx("img",{src:ue.photoMediaId?Se[ue.photoMediaId]??Ee(ue.postingId):Ee(ue.postingId),alt:"Group photo",style:{width:"100%",maxHeight:280,objectFit:"cover",border:"1px solid rgba(63,223,255,0.55)"}}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:13,color:"#9fb6bf"},children:"Summary"}),e.jsx("div",{style:{color:"#d2d8e2",fontSize:14,whiteSpace:"pre-wrap"},children:ue.body})]}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:13,color:"#9fb6bf"},children:"Group details"}),e.jsx("div",{style:{color:"#d2d8e2",fontSize:14,whiteSpace:"pre-wrap"},children:ue.groupDetails??"No extra details provided."})]}),ne(ue)?e.jsxs("div",{style:{display:"grid",gap:4,border:"1px solid rgba(63,223,255,0.45)",padding:8},children:[e.jsx("div",{style:{fontSize:13,color:"#9fb6bf"},children:"Attendee-only location instructions"}),e.jsx("div",{style:{color:"#d2d8e2",fontSize:14,whiteSpace:"pre-wrap"},children:ue.locationInstructions??"None provided."})]}):e.jsx("div",{style:{color:"#9fb6bf",fontSize:12},children:"Location instructions are only visible to attendees."}),n.userId===ue.authorUserId&&(((wt=ue.joinRequestUserIds)==null?void 0:wt.length)??0)>0?e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:13,color:"#9fb6bf"},children:"Pending join requests"}),(ue.joinRequestUserIds??[]).map(r=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,alignItems:"center"},children:[e.jsx("div",{style:{color:"#d2d8e2",fontSize:14},children:m(r)}),e.jsx("button",{type:"button",style:Re(!1),onClick:()=>void xt(ue.postingId,r,!0),children:"APPROVE"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void xt(ue.postingId,r,!1),children:"DECLINE"})]},r))]}):null,e.jsxs("div",{style:{display:"grid",gap:6},children:[e.jsx("div",{style:{fontSize:13,color:"#9fb6bf"},children:"Host and attendees"}),e.jsx("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:q(ue).map((r,S)=>e.jsxs("div",{style:{display:"grid",gap:6,justifyItems:"center",width:74},children:[e.jsx("img",{src:j(r),alt:`${m(r)} profile`,style:{width:54,height:54,borderRadius:"50%",objectFit:"cover",border:S===0?"2px solid #88d6ff":"1px solid rgba(255,58,77,0.5)"}}),e.jsxs("div",{style:{color:"#c7d0de",fontSize:11,textAlign:"center",lineHeight:1.2},children:[m(r),S===0?" (Host)":""]})]},r))})]})]}):null,f==="cruise"?bt:null,f==="groups"&&n.userType!=="guest"&&$e.length>0?e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.25)",display:"grid",gap:8,padding:10},children:[e.jsx("div",{style:{fontSize:16,fontWeight:700},children:"GROUP INVITES"}),$e.map(r=>e.jsxs("div",{style:{display:"grid",gap:6,border:"1px solid rgba(255,58,77,0.4)",borderRadius:10,padding:8},children:[e.jsx("div",{style:{fontWeight:700},children:r.title}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13},children:["Host: ",r.authorUserId]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:Re(!1),onClick:()=>void dt(r.postingId,!0),children:"ACCEPT"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void dt(r.postingId,!1),children:"DECLINE"})]})]},r.postingId))]}):null]})}function Kn({api:t,session:n,setLastError:a}){const[f,o]=s.useState([]),[x,I]=s.useState(""),[C,A]=s.useState("");async function F(){try{const l=await t.listSubmissions();o([...l.submissions].sort((v,M)=>M.createdAtMs-v.createdAtMs))}catch(l){a(J(l))}}s.useEffect(()=>{F()},[]);async function V(){try{await t.createSubmission(n.sessionToken,{title:x,body:C}),I(""),A(""),await F()}catch(l){a(J(l))}}async function _(l){try{await t.recordSubmissionView(l),await F()}catch(v){a(J(v))}}async function z(l,v){try{await t.rateSubmission(l,v),await F()}catch(M){a(J(M))}}const P=n.userType!=="guest";return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("input",{style:te(),value:x,onChange:l=>I(l.target.value),placeholder:"Story title",disabled:!P}),e.jsx("textarea",{style:{...te(),minHeight:120},value:C,onChange:l=>A(l.target.value),placeholder:"Write your story",disabled:!P}),e.jsx("button",{type:"button",style:P?Re(!1):B(!0),disabled:!P,onClick:()=>void V(),children:"PUBLISH STORY"}),P?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can read but cannot publish submissions."})]})}),e.jsx("div",{style:{display:"grid",gap:10},children:f.map(l=>{const v=l.ratingCount>0?(l.ratingSum/l.ratingCount).toFixed(2):"0.00";return e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.28)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:l.title}),e.jsx("div",{style:{color:"#ced3dc",whiteSpace:"pre-wrap",marginTop:6},children:l.body}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13,marginTop:8},children:["Views: ",l.viewCount," | Rating: ",v," (",l.ratingCount,")"]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:B(!1),onClick:()=>void _(l.submissionId),children:"VIEW"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void z(l.submissionId,1),children:"â˜…1"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void z(l.submissionId,2),children:"â˜…2"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void z(l.submissionId,3),children:"â˜…3"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void z(l.submissionId,4),children:"â˜…4"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void z(l.submissionId,5),children:"â˜…5"})]})]},l.submissionId)})})]})}function Wn({api:t,session:n,setLastError:a}){var me,je,p,y,N,ae;const[f,o]=s.useState([]),[x,I]=s.useState({}),[C,A]=s.useState(null),[F,V]=s.useState(2e3),[_,z]=s.useState(""),[P,l]=s.useState(""),[v,M]=s.useState(""),[b,h]=s.useState(""),[W,$]=s.useState("Ready."),K=n.userType!=="guest";async function de(){try{const D=await t.listPromotedProfiles();o([...D.listings].sort((fe,we)=>we.createdAtMs-fe.createdAtMs)),V(D.feeCents);const ie=Array.from(new Set(D.listings.map(fe=>fe.userId))).filter(fe=>fe.trim().length>0),k=await Promise.all(ie.map(async fe=>{try{const c=(await t.getPublicProfile(fe)).profile.mainPhotoMediaId;if(!c)return null;const H=await t.getPublicMediaUrl(c);return{userId:fe,url:H.downloadUrl}}catch{return null}})),be={};for(const fe of k)fe&&(be[fe.userId]=fe.url);I(be)}catch(D){a(J(D))}}s.useEffect(()=>{de()},[]);async function ge(){if(!K){a("Anonymous users cannot create promoted profiles.");return}try{const D=await t.startPromotedPayment(n.sessionToken),ie=await t.confirmPromotedPayment(n.sessionToken,D.payment.paymentToken);h(ie.payment.paymentToken),$("Payment confirmed. You can now publish one promoted profile.")}catch(D){const ie=J(D);$(ie),a(ie)}}async function Te(){if(!K){a("Anonymous users cannot create promoted profiles.");return}try{await t.createPromotedProfile(n.sessionToken,{paymentToken:b,title:_,body:P,displayName:v}),z(""),l(""),M(""),h(""),$("Promoted profile published."),await de()}catch(D){const ie=J(D);$(ie),a(ie)}}async function he(D){try{const ie=await t.getPublicProfile(D);A(ie.profile)}catch(ie){a(J(ie))}}return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"PROMOTED PROFILES"}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:14},children:["Publishing requires a $",Math.round(F/100)," fee per profile."]}),e.jsx("div",{style:{color:"#26d5ff",fontSize:13},children:W})]})}),e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("input",{value:v,onChange:D=>M(D.target.value),placeholder:"Display name",style:te(),disabled:!K}),e.jsx("input",{value:_,onChange:D=>z(D.target.value),placeholder:"Headline",style:te(),disabled:!K}),e.jsx("textarea",{value:P,onChange:D=>l(D.target.value),placeholder:"Profile description",style:{...te(),minHeight:92,resize:"vertical"},disabled:!K}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsxs("button",{type:"button",style:B(!K),disabled:!K,onClick:()=>void ge(),children:["PAY $",Math.round(F/100)]}),e.jsx("button",{type:"button",style:K?Re(!1):B(!0),disabled:!K,onClick:()=>void Te(),children:"PUBLISH PROFILE"})]}),K?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can browse but cannot publish paid profiles."})]})}),e.jsx("div",{style:{display:"grid",gap:10},children:f.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"No promoted profiles yet."}):f.map(D=>e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.25)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"72px 1fr",gap:10,alignItems:"start"},children:[e.jsx("img",{src:x[D.userId]??Ee(`user:${D.userId}`),alt:`${D.displayName} profile`,style:{width:72,height:72,borderRadius:6,objectFit:"cover",border:"1px solid rgba(38,213,255,0.9)"}}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:D.title}),e.jsx("div",{style:{color:"#26d5ff",fontSize:13},children:D.displayName}),e.jsx("div",{style:{color:"#ced3dc",whiteSpace:"pre-wrap",fontSize:14},children:D.body}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void he(D.userId),children:"VIEW PROFILE"})]})]})},D.listingId))}),C?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},onClick:()=>A(null),children:e.jsxs("div",{onClick:D=>D.stopPropagation(),style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:12,width:"min(560px, 100%)",background:"rgba(0,0,0,0.88)"},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:C.displayName}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:6},children:["Age: ",C.age]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Race: ",((me=C.stats)==null?void 0:me.race)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Height: ",((je=C.stats)==null?void 0:je.heightInches)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Weight: ",((p=C.stats)==null?void 0:p.weightLbs)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Cock Size: ",((y=C.stats)==null?void 0:y.cockSizeInches)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Cut / Uncut: ",((N=C.stats)==null?void 0:N.cutStatus)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Position: ",((ae=C.stats)==null?void 0:ae.position)??"-"]}),e.jsx("div",{style:{color:"#ced3dc",marginTop:10,whiteSpace:"pre-wrap"},children:C.bio}),e.jsx("div",{style:{marginTop:10},children:e.jsx("button",{type:"button",style:B(!1),onClick:()=>A(null),children:"CLOSE"})})]})}):null]})}function Dn(){return{displayName:"",age:"",bio:"",heightInches:"",race:"",cockSizeInches:"",cutStatus:"",weightLbs:"",position:"",discreetMode:!1,travelEnabled:!1,travelLat:"",travelLng:"",lookingForMore:""}}function sn(t){var a,f,o;const n=gn(t.bio);return{displayName:t.displayName,age:String(t.age),bio:n.bio,heightInches:t.stats.heightInches!==void 0?String(t.stats.heightInches):"",race:t.stats.race??"",cockSizeInches:t.stats.cockSizeInches!==void 0?String(t.stats.cockSizeInches):"",cutStatus:t.stats.cutStatus??"",weightLbs:t.stats.weightLbs!==void 0?String(t.stats.weightLbs):"",position:t.stats.position??"",discreetMode:t.discreetMode===!0,travelEnabled:((a=t.travelMode)==null?void 0:a.enabled)===!0,travelLat:typeof((f=t.travelMode)==null?void 0:f.lat)=="number"?String(t.travelMode.lat):"",travelLng:typeof((o=t.travelMode)==null?void 0:o.lng)=="number"?String(t.travelMode.lng):"",lookingForMore:n.lookingForMore}}function gn(t){const n=t.replace(/\r\n/g,`
`).trim(),a="Looking For More:",f=/Looking For More:\s*/g,o=Array.from(n.matchAll(f));if(o.length===0)return{bio:n,lookingForMore:""};const x=o[0],I=o[o.length-1],C=typeof x.index=="number"?x.index:n.indexOf(a),A=(typeof I.index=="number"?I.index:n.lastIndexOf(a))+I[0].length,F=n.slice(0,Math.max(0,C)).trim(),V=n.slice(Math.max(0,A)).trim();return{bio:F,lookingForMore:V}}function Hn(t,n){const f=gn(t).bio.trim(),o=n.trim();return o?f?`${f}

Looking For More: ${o}`:`${o}`:f}function rn(t){const n=t.trim();if(!n)return;const a=Number(n);return Number.isFinite(a)?Math.trunc(a):void 0}function $n(t){const n=t.trim();if(!n)return;const a=Number(n);return Number.isFinite(a)?a:void 0}function Bn({api:t,session:n,setLastError:a}){var me,je;const[f,o]=s.useState(Dn()),[x,I]=s.useState(null),[C,A]=s.useState(!1),[F,V]=s.useState(!1),[_,z]=s.useState(null),[P,l]=s.useState({});async function v(){A(!0);try{const p=await t.getMyProfile(n.sessionToken);I(p.profile),o(sn(p.profile)),z("Profile loaded.")}catch(p){const y=p;if((y==null?void 0:y.code)==="PROFILE_NOT_FOUND"){I(null),o(N=>({...N,age:N.age||"18"})),z("No profile yet. Fill out the form and save.");return}z(J(p))}finally{A(!1)}}s.useEffect(()=>{v()},[n.sessionToken,n.userType]),s.useEffect(()=>{const p=[x==null?void 0:x.mainPhotoMediaId,...(x==null?void 0:x.galleryMediaIds)??[]].filter(N=>typeof N=="string"&&N.length>0);if(p.length===0)return;const y=p.filter(N=>!P[N]);y.length!==0&&Promise.all(y.map(async N=>{try{const ae=await t.getPublicMediaUrl(N);return{id:N,url:ae.downloadUrl}}catch{return null}})).then(N=>{l(ae=>{const D={...ae};for(const ie of N)ie&&(D[ie.id]=ie.url);return D})})},[t,P,x==null?void 0:x.galleryMediaIds,x==null?void 0:x.mainPhotoMediaId]);async function M(){var p,y,N,ae,D;V(!0),a(null);try{const ie=Number(f.age),k=Hn(f.bio,f.lookingForMore),be=f.travelLat.trim()?Number(f.travelLat):void 0,fe=f.travelLng.trim()?Number(f.travelLng):void 0,we={displayName:f.displayName,age:Math.trunc(ie),bio:k,stats:{heightInches:rn(f.heightInches),race:f.race.trim()||void 0,cockSizeInches:$n(f.cockSizeInches),cutStatus:f.cutStatus||void 0,weightLbs:rn(f.weightLbs),position:f.position||void 0},discreetMode:f.discreetMode,travelMode:{enabled:f.travelEnabled,lat:Number.isFinite(be)?be:void 0,lng:Number.isFinite(fe)?fe:void 0}},c=await t.upsertMyProfile(n.sessionToken,we);I(c.profile),o(sn(c.profile));try{localStorage.setItem("reddoor_travel_center",JSON.stringify({enabled:((p=c.profile.travelMode)==null?void 0:p.enabled)===!0,lat:(y=c.profile.travelMode)==null?void 0:y.lat,lng:(N=c.profile.travelMode)==null?void 0:N.lng})),window.dispatchEvent(new CustomEvent("rd:location-updated",{detail:{lat:(ae=c.profile.travelMode)==null?void 0:ae.lat,lng:(D=c.profile.travelMode)==null?void 0:D.lng}}))}catch{}z("Profile saved.")}catch(ie){const k=J(ie);z(k),a(k)}finally{V(!1)}}async function b(p,y){if(!y){z("Choose a file first.");return}if(n.userType==="guest"){z("Guest sessions cannot upload media. Register to persist media.");return}V(!0),a(null);try{const N=await t.initiateMediaUpload(n.sessionToken,{kind:p,mimeType:y.type||(p==="video"?"video/mp4":"image/jpeg"),sizeBytes:y.size});if(!await kt(N.uploadUrl,y,y.type||"application/octet-stream")){const D=await fetch(N.uploadUrl,{method:"PUT",headers:{"content-type":y.type||"application/octet-stream"},body:y});if(!D.ok)throw{message:`Upload failed (${D.status}).`}}await t.completeMediaUpload(n.sessionToken,N.mediaId),await v(),z("Media uploaded.")}catch(N){const ae=J(N);z(ae),a(ae)}finally{V(!1)}}const[h,W]=s.useState(null),[$,K]=s.useState(null),[de,ge]=s.useState(null);async function Te(p){if(x){V(!0);try{const y=(x.galleryMediaIds??[]).filter(ae=>ae!==p),N=await t.updateProfileMediaReferences(n.sessionToken,{galleryMediaIds:y});I(N.profile),z("Gallery updated.")}catch(y){const N=J(y);z(N),a(N)}finally{V(!1)}}}async function he(p){if(x){V(!0);try{const y=await t.updateProfileMediaReferences(n.sessionToken,{galleryMediaIds:x.galleryMediaIds,mainPhotoMediaId:p});I(y.profile),z("Main photo updated.")}catch(y){const N=J(y);z(N),a(N)}finally{V(!1)}}}return e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:Ve(),children:e.jsxs("div",{style:{display:"grid",gap:14},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"SETTINGS / PROFILE"}),n.userType==="guest"?e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guest profile data is temporary for this session and is removed when you log out."}):null,_?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:_}):null,e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Display Name"}),e.jsx("input",{value:f.displayName,onChange:p=>o(y=>({...y,displayName:p.target.value})),style:te()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Age"}),e.jsx("input",{value:f.age,onChange:p=>o(y=>({...y,age:p.target.value})),style:te(),inputMode:"numeric"})]})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Bio"}),e.jsx("textarea",{value:f.bio,onChange:p=>o(y=>({...y,bio:p.target.value})),style:{...te(),minHeight:88,resize:"vertical"}})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Looking For More (Optional)"}),e.jsx("textarea",{value:f.lookingForMore,onChange:p=>o(y=>({...y,lookingForMore:p.target.value})),style:{...te(),minHeight:72,resize:"vertical"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:f.discreetMode,onChange:p=>o(y=>({...y,discreetMode:p.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0,fontSize:13},children:"Discreet Mode (hide profile from others)"})]}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:f.travelEnabled,onChange:p=>o(y=>({...y,travelEnabled:p.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Travel Mode"})]})]}),f.travelEnabled?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Travel Lat"}),e.jsx("input",{value:f.travelLat,onChange:p=>o(y=>({...y,travelLat:p.target.value})),style:te()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Travel Lng"}),e.jsx("input",{value:f.travelLng,onChange:p=>o(y=>({...y,travelLng:p.target.value})),style:te()})]})]}):null,e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Height (in)"}),e.jsx("input",{value:f.heightInches,onChange:p=>o(y=>({...y,heightInches:p.target.value})),style:te(),inputMode:"numeric"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Race"}),e.jsx("input",{value:f.race,onChange:p=>o(y=>({...y,race:p.target.value})),style:te()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Cock Size (in)"}),e.jsx("input",{value:f.cockSizeInches,onChange:p=>o(y=>({...y,cockSizeInches:p.target.value})),style:te(),inputMode:"decimal"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Cut / Uncut"}),e.jsxs("select",{value:f.cutStatus,onChange:p=>o(y=>({...y,cutStatus:p.target.value})),style:te(),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"cut",children:"Cut"}),e.jsx("option",{value:"uncut",children:"Uncut"})]})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Weight (lbs)"}),e.jsx("input",{value:f.weightLbs,onChange:p=>o(y=>({...y,weightLbs:p.target.value})),style:te(),inputMode:"numeric"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Position"}),e.jsxs("select",{value:f.position,onChange:p=>o(y=>({...y,position:p.target.value})),style:te(),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"top",children:"Top"}),e.jsx("option",{value:"bottom",children:"Bottom"}),e.jsx("option",{value:"side",children:"Side"})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",onClick:()=>void M(),style:Re(F),disabled:F,children:"SAVE PROFILE"}),e.jsx("button",{type:"button",onClick:()=>void v(),style:B(C),disabled:C,children:"REFRESH"})]})]})}),e.jsx("div",{style:Ve(),children:e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"MEDIA"}),e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"Main profile photo, gallery photo, and video uploads."}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Main Photo"}),e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:p=>{var y;return W(((y=p.target.files)==null?void 0:y[0])??null)}})]}),e.jsx("button",{type:"button",style:Re(F),disabled:F,onClick:()=>void b("photo_main",h),children:"UPLOAD MAIN PHOTO"})]}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Gallery Photo"}),e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:p=>{var y;return K(((y=p.target.files)==null?void 0:y[0])??null)}})]}),e.jsx("button",{type:"button",style:Re(F),disabled:F,onClick:()=>void b("photo_gallery",$),children:"UPLOAD GALLERY PHOTO"})]}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Video"}),e.jsx("input",{className:"rd-input",type:"file",accept:"video/*",onChange:p=>{var y;return ge(((y=p.target.files)==null?void 0:y[0])??null)}})]}),e.jsx("button",{type:"button",style:Re(F),disabled:F,onClick:()=>void b("video",de),children:"UPLOAD VIDEO"})]}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13},children:["Main photo media id: ",(x==null?void 0:x.mainPhotoMediaId)??"-",e.jsx("br",{}),"Gallery count: ",((me=x==null?void 0:x.galleryMediaIds)==null?void 0:me.length)??0,e.jsx("br",{}),"Video media id: ",(x==null?void 0:x.videoMediaId)??"-"]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"YOUR GALLERY"}),(je=x==null?void 0:x.galleryMediaIds)!=null&&je.length?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(130px, 1fr))",gap:10},children:x.galleryMediaIds.map(p=>e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.45)",borderRadius:10,padding:8,display:"grid",gap:8},children:[e.jsx("img",{src:P[p]??Ee(p),alt:"Gallery photo",style:{width:"100%",aspectRatio:"1/1",objectFit:"cover",borderRadius:8,border:"1px solid rgba(255,58,77,0.4)"}}),e.jsx("button",{type:"button",style:B(F),disabled:F,onClick:()=>void he(p),children:"SET MAIN"}),e.jsx("button",{type:"button",style:B(F),disabled:F,onClick:()=>void Te(p),children:"REMOVE"})]},p))}):e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No gallery photos uploaded yet."})]})]})})]})}function Gn({api:t,session:n,setLastError:a,onLogout:f}){const[o,x]=s.useState({discreetMode:!1,travelEnabled:!1,travelLat:"",travelLng:""}),[I,C]=s.useState("Loading settings..."),[A,F]=s.useState(!1),[V,_]=s.useState([]);async function z(){var b,h,W;try{const $=await t.getMyProfile(n.sessionToken);if(x({discreetMode:$.profile.discreetMode===!0,travelEnabled:((b=$.profile.travelMode)==null?void 0:b.enabled)===!0,travelLat:typeof((h=$.profile.travelMode)==null?void 0:h.lat)=="number"?String($.profile.travelMode.lat):"",travelLng:typeof((W=$.profile.travelMode)==null?void 0:W.lng)=="number"?String($.profile.travelMode.lng):""}),C("Settings loaded."),n.userType!=="guest")try{const K=await t.listBlocked(n.sessionToken);_(K.blocked)}catch{_([])}else _([])}catch($){C(J($))}}async function P(){try{const b=await fetch("/api/config"),h=await b.json();if(!b.ok)throw h;F(h.mediaStorageConfigured===!0)}catch{F(!1)}}s.useEffect(()=>{z(),P()},[n.sessionToken,n.userType]);async function l(){try{const b=await t.getMyProfile(n.sessionToken),h=o.travelLat.trim()?Number(o.travelLat):void 0,W=o.travelLng.trim()?Number(o.travelLng):void 0;await t.upsertMyProfile(n.sessionToken,{displayName:b.profile.displayName,age:b.profile.age,bio:b.profile.bio,stats:b.profile.stats,discreetMode:o.discreetMode,travelMode:{enabled:o.travelEnabled,lat:Number.isFinite(h)?h:void 0,lng:Number.isFinite(W)?W:void 0}}),C("Privacy settings saved.")}catch(b){const h=J(b);C(h),a(h)}}async function v(){if(!navigator.geolocation){const b="Geolocation is unavailable on this device.";C(b),a(b);return}try{const b=await new Promise(($,K)=>{navigator.geolocation.getCurrentPosition($,K,{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})}),h=Number(b.coords.latitude.toFixed(6)),W=Number(b.coords.longitude.toFixed(6));x($=>({...$,travelEnabled:!0,travelLat:String(h),travelLng:String(W)}));try{localStorage.setItem("reddoor_travel_center",JSON.stringify({enabled:!0,lat:h,lng:W}))}catch{}try{await t.updatePresence(n.sessionToken,h,W,"online")}catch{}window.dispatchEvent(new CustomEvent("rd:location-updated",{detail:{lat:h,lng:W}})),C("Actual location detected. Save privacy settings to persist it.")}catch(b){const h=J(b);C(h),a(h)}}async function M(b){try{await t.unblock(n.sessionToken,b);const h=await t.listBlocked(n.sessionToken);_(h.blocked),C("Blocked users updated.")}catch(h){const W=J(h);C(W),a(W)}}return e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:Ve(),children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"SETTINGS"}),e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:I}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:o.discreetMode,onChange:b=>x(h=>({...h,discreetMode:b.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Discreet Mode (hide your profile)"})]}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:o.travelEnabled,onChange:b=>x(h=>({...h,travelEnabled:b.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Travel Mode"})]}),o.travelEnabled?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("input",{value:o.travelLat,onChange:b=>x(h=>({...h,travelLat:b.target.value})),style:te(),placeholder:"Travel lat"}),e.jsx("input",{value:o.travelLng,onChange:b=>x(h=>({...h,travelLng:b.target.value})),style:te(),placeholder:"Travel lng"})]}):null,e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:Re(!1),onClick:()=>void l(),children:"SAVE PRIVACY"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void v(),children:"DETECT ACTUAL LOCATION"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>f==null?void 0:f(),children:"LOGOUT"})]})]})}),e.jsx("div",{style:Ve(),children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"MEDIA STORAGE"}),e.jsx("div",{style:{color:A?"#26d5ff":"#ff8a95",fontSize:14},children:A?"Configured: uploads enabled.":"Not configured: set S3_BUCKET, S3_REGION, S3_ACCESS_KEY_ID, S3_SECRET_ACCESS_KEY."}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void P(),children:"REFRESH STORAGE STATUS"})]})}),n.userType!=="guest"?e.jsx("div",{style:Ve(),children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"BLOCKED USERS"}),V.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No blocked users."}):V.map(b=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[e.jsx("div",{style:{color:"#ced3dc",fontSize:14},children:b}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void M(b),children:"UNBLOCK"})]},b))]})}):null]})}function Vn({api:t,session:n,setSession:a,settings:f,activeTab:o,setActiveTab:x,discoverScreen:I,onDiscoverScreenChange:C,discoverFilter:A,busy:F,setBusy:V,setLastError:_,onUnreadCountChange:z,hideModeCard:P,onLogout:l}){const v=Un(),[M,b]=s.useState(null),h=e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx(Bn,{api:t,session:n,setLastError:_}),e.jsx(Gn,{api:t,session:n,setLastError:_,onLogout:l})]});return e.jsxs("div",{style:{display:"grid",gap:12},children:[null,e.jsx("div",{style:{display:o==="discover"?"block":"none"},children:e.jsx(Fn,{api:t,session:n,settings:f,discoverFilter:A,busy:F,setBusy:V,setLastError:_,isMobile:v,discoverScreen:I,onDiscoverScreenChange:C,onOpenThreadRequested:W=>{b({key:Oe(W),nonce:Date.now()}),x("threads")},onUnreadCountChange:z})}),o==="threads"?e.jsx(Ln,{api:t,session:n,setLastError:_,openThreadRequest:M,onThreadRequestConsumed:()=>b(null),isMobile:v}):null,o==="ads"?e.jsx(Ot,{api:t,session:n,isMobile:v,screen:"ads",setLastError:_}):null,o==="groups"?e.jsx(Ot,{api:t,session:n,isMobile:v,screen:"groups",setLastError:_}):null,o==="cruise"?e.jsx(Ot,{api:t,session:n,isMobile:v,screen:"cruise",setLastError:_}):null,o==="profile"||o==="settings"?h:null,o==="submissions"?e.jsx(Kn,{api:t,session:n,setLastError:_}):null,o==="promoted"?e.jsx(Wn,{api:t,session:n,setLastError:_}):null]})}export{Vn as Router};
