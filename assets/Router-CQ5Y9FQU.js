const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./maplibre-gl-Cm4OUVEz.js","./index-RNk_kvsm.js","./index-CcRnFIlo.css"])))=>i.map(i=>d[i]);
import{r as s,j as e,_ as fn,p as Vt,a as Yt,b as Jt,u as ht}from"./index-RNk_kvsm.js";function Qt(t){return typeof t=="object"&&t!==null}function gn(t){return!(!Qt(t)||typeof t.key!="string"||t.userType!=="guest"&&t.userType!=="registered"&&t.userType!=="subscriber"||typeof t.lat!="number"||!Number.isFinite(t.lat)||typeof t.lng!="number"||!Number.isFinite(t.lng)||typeof t.updatedAtMs!="number"||!Number.isFinite(t.updatedAtMs)||t.status!==void 0&&typeof t.status!="string")}function qt(t){const[n,o]=s.useState(()=>new Map),[f,u]=s.useState(null),x=s.useRef(null),S=s.useRef(null);return s.useEffect(()=>{if(t.disabled===!0||t.wsUrl.trim()===""){o(new Map),u(null),S.current!==null&&(window.clearTimeout(S.current),S.current=null);return}let P=!1,M=0,K=null;const G=()=>{K!==null&&(window.clearInterval(K),K=null)},E=()=>{if(P)return;const a=Math.min(8e3,500*2**Math.min(M,4));S.current=window.setTimeout(()=>{S.current=null,C()},a)},C=()=>{if(P)return;let a;try{a=new WebSocket(t.wsUrl)}catch{M+=1,u("Realtime unavailable in this mode."),E();return}x.current=a;let m=!1;a.onopen=()=>{m=!0,M=0,u(null);const T={};t.sessionToken&&(T.sessionToken=t.sessionToken),t.jwt&&(T.jwt=t.jwt),a.send(JSON.stringify({type:"auth",payload:T})),K=window.setInterval(()=>{a.readyState===a.OPEN&&a.send(JSON.stringify({type:"heartbeat",payload:{}}))},15e3)},a.onmessage=T=>{const W=(()=>{try{return JSON.parse(String(T.data))}catch{return null}})();if(!W||typeof W.type!="string"){u("Invalid server message.");return}if(W.type==="error"&&Qt(W.payload)&&typeof W.payload.message=="string"){u(W.payload.message);return}if(W.type==="presence_update"){const h=W.payload;if(!gn(h)){u("Invalid presence payload.");return}o(k=>{const z=new Map(k);return z.set(h.key,h),z})}},a.onerror=()=>{},a.onclose=T=>{if(G(),!P&&T.code!==1e3){M+=1;const W=typeof T.reason=="string"&&T.reason.trim()!==""?` Reason: ${T.reason}`:"";(M>=2||m)&&u(`Realtime ${m?"disconnected":"failed to connect"} (code ${T.code}). Reconnecting...${W}`),E()}}};return C(),()=>{var a;P=!0,G(),S.current!==null&&(window.clearTimeout(S.current),S.current=null),(a=x.current)==null||a.close(1e3,"Client cleanup"),x.current=null}},[t.disabled,t.jwt,t.sessionToken,t.wsUrl]),{state:s.useMemo(()=>({byKey:n}),[n]),lastErrorMessage:f}}async function yn(){const t=await fn(()=>import("./maplibre-gl-Cm4OUVEz.js").then(o=>o.m),__vite__mapDeps([0,1,2]),import.meta.url);return t.default??t}function pn(t){return t.replace(/[&<>"']/g,n=>{switch(n){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return n}})}function hn(){return{version:8,sources:{basemap:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png","https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"Â© OpenStreetMap contributors"}},layers:[{id:"basemap",type:"raster",source:"basemap"}]}}function mn(t){const n=document.createElement("button");return n.type="button",n.setAttribute("aria-label",t.label??"Presence marker"),n.style.width="36px",n.style.height="36px",n.style.borderRadius="999px",n.style.border=`2px solid ${t.color}`,t.markerType==="spot"?(n.style.background="radial-gradient(circle at 30% 30%, #ff4f60, #a70013)",n.style.display="grid",n.style.placeItems="center",n.style.color="#ffffff",n.style.fontWeight="700",n.style.fontSize="13px",n.textContent=typeof t.markerGlyph=="string"&&t.markerGlyph.trim()?t.markerGlyph.trim().slice(0,2):"SP"):typeof t.imageUrl=="string"&&t.imageUrl.trim()!==""?(n.style.backgroundImage=`url("${t.imageUrl}")`,n.style.backgroundSize="cover",n.style.backgroundPosition="center"):n.style.background="#000000",n.style.padding="0",n.style.cursor=typeof t.onClick=="function"?"pointer":"default",n}function bn({initialView:t,markers:n,interactive:o,visible:f}){const u=s.useRef(null),x=s.useRef(null),S=s.useRef(null),I=s.useRef([]),[P,M]=s.useState({kind:"ready"}),K=s.useMemo(()=>t.center,[t.center]),G=o!==!1,E=f!==!1;return s.useEffect(()=>{let C=!1,a=null,m=null,T=null;async function W(){if(u.current&&!S.current)try{x.current||(x.current=await yn());const h=x.current,k=new h.Map({container:u.current,style:hn(),center:[K.lng,K.lat],zoom:t.zoom,interactive:G});k.addControl(new h.NavigationControl({showCompass:!1}),"top-right"),S.current=k;const z=()=>{k.resize()};m=z,T=window.requestAnimationFrame(z),window.addEventListener("resize",z),a=new ResizeObserver(()=>z()),a.observe(u.current),k.on("error",N=>{var ae;const X=((ae=N.error)==null?void 0:ae.message)??"Map error.";C||X.toLowerCase().includes("failed to fetch")||X.toLowerCase().includes("network")||M({kind:"error",message:X})}),k.once("load",()=>{C||M({kind:"ready"})})}catch(h){if(C)return;M({kind:"error",message:h instanceof Error?h.message:"Map error."})}}return W(),()=>{var h;C=!0,T!==null&&window.cancelAnimationFrame(T),m&&window.removeEventListener("resize",m),a==null||a.disconnect();for(const k of I.current)k.remove();I.current=[],(h=S.current)==null||h.remove(),S.current=null}},[G]),s.useEffect(()=>{const C=S.current;if(!C||!E)return;C.resize();const a=window.setTimeout(()=>{C.resize(),C.setCenter([t.center.lng,t.center.lat]),C.setZoom(t.zoom)},80);return()=>window.clearTimeout(a)},[t.center.lat,t.center.lng,t.zoom,E]),s.useEffect(()=>{const C=S.current;if(!C||!E)return;C.resize();const a=window.setTimeout(()=>C.resize(),120);return()=>window.clearTimeout(a)},[E]),s.useEffect(()=>{const C=S.current,a=x.current;if(!(!C||!a)){for(const m of I.current)m.remove();I.current=[];for(const m of n){const T=typeof m.label=="string"&&m.label.trim()!==""?new a.Popup({closeButton:!1,closeOnClick:!0}).setHTML(`<div style="font-family: var(--ui); font-size: 12px; line-height: 1.35;">
                 <div style="font-weight: 600;">${pn(m.label)}</div>
               </div>`):void 0,W=mn(m);typeof m.onClick=="function"&&W.addEventListener("click",k=>{var z;k.preventDefault(),(z=m.onClick)==null||z.call(m)});const h=new a.Marker({element:W}).setLngLat([m.position.lng,m.position.lat]);T&&h.setPopup(T),h.addTo(C),I.current.push(h)}}},[n]),P.kind==="error"?e.jsxs("div",{style:{background:"#000000",color:"#F22F2F",border:"2px solid #C00000",borderRadius:8,padding:12,fontFamily:"var(--ui)",fontSize:14,lineHeight:1.4},role:"alert","aria-live":"polite",children:["Map error: ",P.message]}):e.jsx("div",{ref:u,className:"rd-maplibre",style:{width:"100%",height:"100%",background:"#000000",borderRadius:8,overflow:"hidden"},"aria-label":"Cruise map"})}const Wt=[Vt,Yt,Jt];function vn(t){let n=0;for(let o=0;o<t.length;o+=1)n=n*31+t.charCodeAt(o)|0;return Math.abs(n)}function xn(t){return Wt[vn(t)%Wt.length]}function jn(t,n,o){return t.map(f=>({id:f.key,position:{lat:f.lat,lng:f.lng},color:"#C00000",label:f.status?`Presence: ${f.status}`:"Presence",imageUrl:(n==null?void 0:n[f.key])??xn(f.key),onClick:o?()=>o(f.key):void 0}))}function Dt({wsUrl:t,sessionToken:n,jwt:o,defaultCenter:f,defaultZoom:u,presenceUpdates:x,realtimeErrorMessage:S,onMarkerSelect:I,avatarByKey:P,additionalMarkers:M,height:K,visible:G}){const E=qt({wsUrl:t,sessionToken:n,jwt:o,disabled:Array.isArray(x)}),C=x?{byKey:new Map(x.map(N=>[N.key,N]))}:E.state,a=S??E.lastErrorMessage,[m,T]=s.useState({kind:"pending"});s.useEffect(()=>{if(!("geolocation"in navigator)||!navigator.geolocation){T({kind:"unavailable"});return}navigator.geolocation.getCurrentPosition(N=>{T({kind:"granted",center:{lat:N.coords.latitude,lng:N.coords.longitude}})},N=>{if(N.code===N.PERMISSION_DENIED){T({kind:"denied"});return}if(N.code===N.TIMEOUT){T({kind:"error",message:"Timed out while trying to read your location. Showing the default map view."});return}T({kind:"error",message:N.message||"Geolocation error."})},{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e4})},[]);const W=s.useMemo(()=>Array.from(C.byKey.values()),[C.byKey]),h=s.useMemo(()=>[...jn(W,P,I),...M??[]],[M,P,I,W]),k=s.useMemo(()=>{const N=typeof u=="number"&&Number.isFinite(u)?u:13;return m.kind==="granted"?{center:m.center,zoom:N}:{center:f,zoom:N}},[f,u,m]),z=s.useMemo(()=>m.kind==="denied"?"Location permission denied. Showing the default map view.":m.kind==="unavailable"?"Geolocation is unavailable. Showing the default map view.":m.kind==="error"?`Geolocation error: ${m.message}`:null,[m]);return e.jsxs("section",{"aria-label":"Cruise mode map",style:{background:"#000000",color:"#FFFFFF",fontFamily:"var(--ui)",display:"grid",gap:8,height:"100%"},children:[z?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"rgba(0,0,0,0.7)",border:"1px solid rgba(255,58,77,0.45)",borderRadius:0,padding:8,color:"#AAAAAA",fontSize:12,lineHeight:1.4},children:z}):null,a?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"rgba(0,0,0,0.7)",border:"1px solid rgba(255,58,77,0.45)",borderRadius:0,padding:8,color:"#F22F2F",fontSize:12,lineHeight:1.4},children:a}):null,e.jsx("div",{style:{background:"#111111",border:0,borderRadius:0,overflow:"hidden",height:typeof K=="number"||typeof K=="string"?K:520},children:e.jsx(bn,{initialView:k,markers:h,visible:G})})]})}const wn="FIRE_SIGNAL|1";function Sn(t){return new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function Bt(t){if(!t.startsWith("LOCATION|"))return null;const[,n,o]=t.split("|"),f=Number(n),u=Number(o);return!Number.isFinite(f)||!Number.isFinite(u)?null:{lat:f,lng:u,link:`https://maps.google.com/?q=${f},${u}`}}function kn(t){return t.trim()===wn?"ðŸ”¥ I'm into you":t}function Xt({chatKind:t,peerKey:n,currentUserKey:o,messages:f,client:u,title:x,peerSummary:S,thirdParty:I,edgeToEdge:P,showHeader:M,fillHeight:K}){const[G,E]=s.useState(""),[C,a]=s.useState(null),[m,T]=s.useState(!1),[W,h]=s.useState({}),[k,z]=s.useState(!1),[N,X]=s.useState(!1),ae=s.useRef(null),we=s.useRef([]),de=s.useRef(null),le=s.useRef(null),he=s.useRef(null),y=P===!0,p=M!==!1,U=y&&K===!0,te=s.useMemo(()=>[...f].sort((c,O)=>c.createdAtMs-O.createdAtMs),[f]),d=s.useMemo(()=>Array.from(new Set(te.map(c=>{var O;return(O=c.media)==null?void 0:O.objectKey}).filter(c=>typeof c=="string"&&c.trim().length>0))),[te]);s.useEffect(()=>{let c=!1;async function O(){for(const r of d){if(c)return;if(!W[r])try{const b=await u.getMediaUrl(r);if(c)return;h(A=>({...A,[r]:b}))}catch{}}}return O(),()=>{c=!0}},[u,d,W]);async function V(c){const O=G.trim();if(!(O.length===0&&!c)){T(!0),a(null);try{await u.sendMessage(t,n,O,c),E("")}catch(r){const b=r;a(typeof(b==null?void 0:b.message)=="string"?b.message:"Message rejected.")}finally{T(!1)}}}async function me(c){T(!0),a(null);try{const O=await u.initiateMediaUpload(c.type||"application/octet-stream",c.size);await u.uploadToSignedUrl(O.uploadUrl,c,c.type||"application/octet-stream");const b={kind:c.type.startsWith("image/")?"image":c.type.startsWith("video/")?"video":"audio",objectKey:O.objectKey,mimeType:c.type||"application/octet-stream"};await V(b)}catch(O){const r=O;a(typeof(r==null?void 0:r.message)=="string"?r.message:"Upload rejected."),T(!1)}}async function ue(c){var r;const O=(r=c.target.files)==null?void 0:r[0];if(c.target.value="",!!O){if(!O.type.startsWith("image/")&&!O.type.startsWith("video/")&&!O.type.startsWith("audio/")){a("Only image, video, or audio files are supported.");return}await me(O)}}async function oe(){var c;if(k){(c=ae.current)==null||c.stop();return}if(!navigator.mediaDevices||typeof navigator.mediaDevices.getUserMedia!="function"){a("Microphone is not available in this browser.");return}try{const O=await navigator.mediaDevices.getUserMedia({audio:!0}),r=new MediaRecorder(O);we.current=[],ae.current=r,r.ondataavailable=b=>{b.data.size>0&&we.current.push(b.data)},r.onstop=()=>{const b=new Blob(we.current,{type:r.mimeType||"audio/webm"}),A=new File([b],`voice-${Date.now()}.webm`,{type:r.mimeType||"audio/webm"});me(A);for(const ne of O.getTracks())ne.stop();ae.current=null,z(!1)},r.start(),z(!0)}catch(O){const r=O;a(typeof(r==null?void 0:r.message)=="string"?r.message:"Unable to record voice."),z(!1)}}async function be(){if(!navigator.geolocation){a("Geolocation is not available in this browser.");return}T(!0),a(null);try{const c=await new Promise((A,ne)=>{navigator.geolocation.getCurrentPosition(A,ne,{enableHighAccuracy:!1,timeout:12e3,maximumAge:3e4})}),O=Number(c.coords.latitude.toFixed(5)),r=Number(c.coords.longitude.toFixed(5)),b=`LOCATION|${O}|${r}`;await u.sendMessage(t,n,b)}catch(c){const O=c;a(typeof(O==null?void 0:O.message)=="string"?O.message:"Unable to send location.")}finally{T(!1)}}return e.jsxs("section",{"aria-label":"Chat",style:{background:y?"transparent":"#000000",color:"#FFFFFF",fontFamily:"Montserrat, sans-serif",padding:y?0:16,display:"grid",gap:y?0:12,gridTemplateRows:p?"auto auto 1fr auto":"1fr auto",minHeight:K?"calc(100dvh - 196px)":void 0},children:[p?e.jsxs("header",{style:{height:56,display:"grid",alignItems:"center",background:"#000000"},children:[e.jsx("div",{style:{textAlign:"center",fontSize:20,fontWeight:600},children:x}),S?e.jsxs("div",{style:{marginTop:4,display:"flex",alignItems:"center",justifyContent:"center",gap:8,color:"#b7d8e0",fontSize:13},children:[e.jsx("span",{children:"Chat with:"}),S.avatarUrl?e.jsx("img",{src:S.avatarUrl,alt:`${S.displayName} avatar`,style:{width:24,height:24,borderRadius:"50%",objectFit:"cover",border:"1px solid rgba(38,213,255,0.8)"}}):e.jsx("span",{"aria-hidden":!0,style:{width:24,height:24,borderRadius:"50%",border:"1px solid rgba(38,213,255,0.8)",background:"rgba(255,255,255,0.08)"}}),e.jsx("span",{style:{color:"#fff",fontWeight:600},children:S.displayName})]}):null,e.jsx("div",{style:{textAlign:"center",fontSize:12,color:"#AAAAAA"},children:t==="cruise"?"CRUISE CHAT (EPHEMERAL)":"DATE CHAT (PERSISTENT)"})]}):null,C?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"#111111",border:"2px solid #C00000",borderRadius:8,padding:12,color:"#F22F2F",fontSize:14,lineHeight:1.4},children:C}):null,e.jsx("div",{"aria-label":"Messages",style:{background:y?"#09090b":"#111111",border:y?"none":"2px solid #C00000",borderRadius:y?0:8,padding:12,display:"flex",flexDirection:"column",gap:12,minHeight:y?0:320,paddingBottom:U?148:12,overflowY:"auto"},children:te.length===0?e.jsx("div",{style:{color:"#AAAAAA",fontSize:14,lineHeight:1.4},children:"No messages."}):te.map(c=>{const O=c.fromKey===o,r=O?"#C00000":"#444444",b=O?{alignItems:"flex-end"}:{alignItems:"flex-start"};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,width:"100%",...b},children:[(()=>{const A=Bt(c.text??"");return A?e.jsxs("a",{href:A.link,target:"_blank",rel:"noreferrer",style:{display:"grid",gap:6,textDecoration:"none",color:"#fff",background:r,borderRadius:14,padding:8,width:"auto",maxWidth:"80%"},children:[e.jsx("div",{style:{fontSize:12,color:"#d8ecff"},children:"Shared location"}),e.jsx("iframe",{title:"Google Maps location preview",src:`https://www.google.com/maps?q=${A.lat},${A.lng}&z=14&output=embed`,style:{width:"100%",height:140,border:"1px solid rgba(255,255,255,0.18)",borderRadius:10},loading:"lazy",referrerPolicy:"no-referrer-when-downgrade"}),e.jsx("div",{style:{fontSize:12,color:"#3fdfff"},children:"Open in Google Maps"})]}):null})(),e.jsxs("div",{style:{background:r,color:"#FFFFFF",borderRadius:18,padding:"8px 12px",width:"auto",maxWidth:"80%",fontSize:16,lineHeight:1.4,whiteSpace:"pre-wrap",overflowWrap:"anywhere",wordBreak:"break-word"},children:[c.text&&!Bt(c.text)?e.jsx("div",{style:{marginBottom:c.media?8:0},children:kn(c.text)}):null,c.media?e.jsxs("div",{children:[c.media.kind==="image"?e.jsx("img",{src:W[c.media.objectKey],alt:"Shared",style:{width:"100%",maxWidth:260,borderRadius:10,border:"1px solid rgba(255,255,255,0.18)"}}):null,c.media.kind==="video"?e.jsx("video",{controls:!0,playsInline:!0,src:W[c.media.objectKey],style:{width:"100%",maxWidth:320,borderRadius:10,background:"#000"}}):null,c.media.kind==="audio"?e.jsx("audio",{controls:!0,src:W[c.media.objectKey],style:{width:"100%",maxWidth:260}}):null]}):null]}),e.jsx("div",{style:{fontSize:10,color:"#AAAAAA"},children:Sn(c.createdAtMs)}),O?e.jsx("div",{style:{fontSize:10,color:"#6fdcff"},children:typeof c.readAtMs=="number"?"Read":typeof c.deliveredAtMs=="number"?"Delivered":""}):null]},c.messageId)})}),e.jsxs("form",{onSubmit:c=>{c.preventDefault(),V()},"aria-label":"Message input",style:{background:y?"linear-gradient(180deg, rgba(96,0,12,0.96), rgba(58,0,8,0.98))":"#111111",border:y?"none":"2px solid #C00000",borderRadius:y?0:8,padding:12,display:"grid",gridTemplateColumns:"1fr auto auto",gap:12,alignItems:"start",position:U?"fixed":"static",left:U?0:void 0,right:U?0:void 0,bottom:U?"calc(env(safe-area-inset-bottom, 0px) + 66px)":void 0,zIndex:U?45:void 0},children:[e.jsx("label",{style:{display:"grid"},children:e.jsx("input",{value:G,onChange:c=>E(c.target.value),placeholder:"Type a message",disabled:m,style:{width:"100%",background:"#111111",color:"#FFFFFF",border:"2px solid #444444",borderRadius:8,padding:"10px 12px",fontSize:16,lineHeight:1.4,outline:"none"},"aria-label":"Message text"})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{ref:de,type:"file",accept:"image/*,video/*,audio/*",disabled:m,onChange:c=>void ue(c),style:{display:"none"}}),e.jsx("input",{ref:le,type:"file",accept:"image/*",capture:"environment",disabled:m,onChange:c=>void ue(c),style:{display:"none"}}),e.jsx("input",{ref:he,type:"file",accept:"video/*",capture:"environment",disabled:m,onChange:c=>void ue(c),style:{display:"none"}}),e.jsx("button",{type:"button",disabled:m,onClick:()=>X(c=>!c),style:{background:"rgba(0,0,0,0.45)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px",display:"grid",placeItems:"center",cursor:m?"not-allowed":"pointer",color:"#3fdfff",fontWeight:700,height:44,minWidth:44},"aria-label":"More actions",children:"+"}),N?e.jsxs("div",{style:{position:"absolute",right:0,top:U?void 0:48,bottom:U?48:void 0,zIndex:5,minWidth:220,display:"grid",gap:8,padding:10,borderRadius:10,border:"1px solid rgba(255,58,77,0.5)",background:"rgba(10,11,16,0.98)"},children:[e.jsx("button",{type:"button",disabled:m,onClick:()=>{var c;X(!1),(c=le.current)==null||c.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Take Photo"}),e.jsx("button",{type:"button",disabled:m,onClick:()=>{var c;X(!1),(c=he.current)==null||c.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Record Video"}),e.jsx("button",{type:"button",disabled:m,onClick:()=>{var c;X(!1),(c=de.current)==null||c.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Choose Media"}),e.jsx("button",{type:"button",disabled:m,onClick:()=>{X(!1),oe()},style:{background:k?"#ff2136":"rgba(0,0,0,0.6)",color:"#fff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:k?"Stop Voice":"Record Voice"}),e.jsx("button",{type:"button",disabled:m,onClick:()=>{X(!1),be()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Send Location"}),I?e.jsxs("div",{style:{display:"grid",gap:8,borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:8},children:[e.jsxs("select",{value:I.selectedKey,onChange:c=>I.onSelect(c.target.value),disabled:I.disabled||I.candidates.length===0,style:{background:"#0b0d12",color:"#fff",border:"1px solid rgba(255,58,77,0.62)",borderRadius:10,padding:"8px 10px"},"aria-label":"Add previous contact to group",children:[I.candidates.length===0?e.jsx("option",{value:"",children:"No previous contacts"}):null,I.candidates.map(c=>e.jsx("option",{value:c.key,children:c.label},c.key))]}),e.jsx("button",{type:"button",onClick:()=>{I.onAdd(),X(!1)},disabled:I.disabled||I.candidates.length===0||!I.selectedKey,style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,58,77,0.62)",borderRadius:10,padding:"8px 10px",fontWeight:700},children:"Add Third User"})]}):null]}):null]}),e.jsx("button",{type:"submit",disabled:m,style:{background:m?"#333333":"#C00000",color:m?"#777777":"#FFFFFF",border:"2px solid #C00000",borderRadius:8,padding:"10px 20px",fontSize:16,fontWeight:600,cursor:m?"not-allowed":"pointer",height:44},"aria-label":"Send message",children:"SEND"})]})]})}const mt="FIRE_SIGNAL|1";function Ee(){return{background:"radial-gradient(500px 220px at 10% 0%, rgba(255,28,46,0.15), transparent 58%), linear-gradient(180deg, rgba(8,8,10,0.88), rgba(4,4,5,0.9))",border:"1px solid rgba(255,56,74,0.56)",borderRadius:20,padding:14,boxShadow:"inset 0 1px 0 rgba(255,255,255,0.06), inset 0 0 0 1px rgba(0,0,0,0.28), 0 16px 32px rgba(0,0,0,0.42)"}}function ye(t){return{background:t?"rgba(90,90,90,0.55)":"linear-gradient(180deg, #ff2136, #c60012)",border:"1px solid rgba(255,70,90,0.68)",color:t?"#999999":"#FFFFFF",padding:"10px 18px",borderRadius:12,fontSize:15,fontWeight:700,letterSpacing:"0.04em",cursor:t?"not-allowed":"pointer",textTransform:"uppercase",boxShadow:t?"none":"inset 0 1px 0 rgba(255,255,255,0.2), 0 10px 22px rgba(198,0,18,0.34)"}}function D(t){return{background:"rgba(0,0,0,0.58)",border:"1px solid rgba(255,58,77,0.62)",color:"#3fdfff",padding:"10px 18px",borderRadius:12,fontSize:15,fontWeight:700,letterSpacing:"0.03em",cursor:t?"not-allowed":"pointer",textTransform:"uppercase",opacity:t?.6:1}}function ee(){return{background:"rgba(6,7,10,0.92)",color:"#ffffff",border:"1px solid rgba(255,64,82,0.48)",borderRadius:12,padding:"10px 12px",fontSize:15}}function In(t){return typeof t=="string"}function $(t){const n=t;return In(n==null?void 0:n.message)?n.message:"Action rejected."}function ut(){const t="__disabled__".trim();if(t==="__disabled__")return"";if(t!==""){if(t.startsWith("ws://")||t.startsWith("wss://"))return t;try{const o=new URL(t);return o.protocol=o.protocol==="https:"?"wss:":"ws:",o.toString()}catch{if(t.startsWith("/")){const o=new URL(t,window.location.origin);return o.protocol=o.protocol==="https:"?"wss:":"ws:",o.toString()}}}const n=new URL("/ws",window.location.origin);return n.protocol=n.protocol==="https:"?"wss:":"ws:",n.toString()}const Ht=[Vt,Yt,Jt];function Cn(t){let n=0;for(let o=0;o<t.length;o+=1)n=n*31+t.charCodeAt(o)|0;return Math.abs(n)}function Be(t){return Ht[Cn(t)%Ht.length]}function yt(t){if(t.startsWith("user:")){const n=t.slice(5).trim();return n.length>0?n:null}if(t.startsWith("session:")){const n=t.slice(8).trim();return n.length>0?`guest:${n}`:null}return null}function Ue(t){if(t.startsWith("guest:")){const n=t.slice(6).trim();return n?`session:${n}`:`user:${t}`}return`user:${t}`}function Ce(t){const n=t.trim();if(!n)return n;if(n.startsWith("user:guest:")){const o=n.slice(11).trim();return o?`session:${o}`:n}if(n.startsWith("guest:")){const o=n.slice(6).trim();return o?`session:${o}`:n}return n}function Tn(t){return t.trim()===mt}function Zt(t){return Tn(t)?"ðŸ”¥ I'm into you":t}function pt(t,n){const o=K=>K*Math.PI/180,u=o(n.lat-t.lat),x=o(n.lng-t.lng),S=Math.sin(u/2),I=Math.sin(x/2),P=S*S+Math.cos(o(t.lat))*Math.cos(o(n.lat))*I*I;return 6371e3*(2*Math.atan2(Math.sqrt(P),Math.sqrt(1-P)))}function _t(){try{const t=localStorage.getItem("reddoor_travel_center");if(!t)return null;const n=JSON.parse(t);return n.enabled!==!0?null:typeof n.lat=="number"&&Number.isFinite(n.lat)&&typeof n.lng=="number"&&Number.isFinite(n.lng)?{lat:n.lat,lng:n.lng}:null}catch{return null}}function Mn(){const[t,n]=s.useState(()=>window.matchMedia("(max-width: 900px)").matches);return s.useEffect(()=>{const o=window.matchMedia("(max-width: 900px)"),f=()=>n(o.matches);return f(),o.addEventListener("change",f),()=>o.removeEventListener("change",f)},[]),t}function Xe(t){return t==="instant"?"cruise":"date"}function An({api:t,session:n,settings:o,discoverFilter:f,busy:u,setBusy:x,setLastError:S,isMobile:I,onOpenThreadRequested:P,onUnreadCountChange:M}){var Fe,Qe,Ge,Ve,Ze,Oe;const[K,G]=s.useState("map"),[E,C]=s.useState(null),[a,m]=s.useState(null),[T,W]=s.useState(null),[h,k]=s.useState([]),[z,N]=s.useState({}),[X,ae]=s.useState([]),[we,de]=s.useState(new Set),[le,he]=s.useState(new Set),[y,p]=s.useState({}),[U,te]=s.useState({}),[d,V]=s.useState(null),[me,ue]=s.useState(0),[oe,be]=s.useState(!1),[c,O]=s.useState([]),[r,b]=s.useState(null),[A,ne]=s.useState(()=>_t()),{state:pe,lastErrorMessage:ve}=qt({wsUrl:ut(),sessionToken:n.sessionToken}),Se=s.useMemo(()=>Array.from(pe.byKey.values()),[pe.byKey]);s.useEffect(()=>{const g=()=>{ne(_t())},v=w=>{(w.key===null||w.key==="reddoor_travel_center")&&g()};return g(),window.addEventListener("rd:location-updated",g),window.addEventListener("storage",v),()=>{window.removeEventListener("rd:location-updated",g),window.removeEventListener("storage",v)}},[]);const se=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,fe=s.useMemo(()=>{const g=new Map;for(const v of h)g.set(v.key,v);for(const v of Se){const w=g.get(v.key);(!w||v.updatedAtMs>=w.updatedAtMs)&&g.set(v.key,v)}return Array.from(g.values())},[Se,h]),Z=s.useMemo(()=>fe.filter(g=>g.key!==se),[se,fe]),xe=s.useMemo(()=>T?[...Z].sort((g,v)=>pt(T,{lat:g.lat,lng:g.lng})-pt(T,{lat:v.lat,lng:v.lng})):Z,[Z,T]);s.useEffect(()=>{let g=!1;async function v(){try{const B=await t.listActivePresence(n.sessionToken);if(g)return;const Q=Array.isArray(B.presence)?B.presence:[];k(Q)}catch{g||k([])}}v();const w=window.setInterval(()=>{v()},8e3);return()=>{g=!0,window.clearInterval(w)}},[t,n.sessionToken]),s.useEffect(()=>{E||xe.length>0&&C(xe[0].key)},[E,xe]),s.useEffect(()=>{const g=xe.filter(v=>!z[v.key]).map(v=>({key:v.key,profileId:yt(v.key)})).filter(v=>typeof v.profileId=="string");g.length!==0&&Promise.all(g.map(async v=>{var w,B;try{const Q=await t.getPublicProfile(v.profileId);return{key:v.key,displayName:(w=Q.profile)==null?void 0:w.displayName,age:(B=Q.profile)==null?void 0:B.age}}catch{return null}})).then(v=>{N(w=>{const B={...w};for(const Q of v)Q&&(B[Q.key]={displayName:Q.displayName,age:Q.age});return B})})},[t,z,xe]),s.useEffect(()=>{(async()=>{try{let g=await t.getPublicProfiles();if(g.profiles.length===0&&!oe){be(!0);try{const v=T??A??{lat:o.defaultCenterLat,lng:o.defaultCenterLng};await t.seedFakeUsers(12,v.lat,v.lng),g=await t.getPublicProfiles()}catch{}}ae(g.profiles)}catch{ae([])}if(n.userType==="guest"){de(new Set),he(new Set);return}try{const g=await t.getFavorites(n.sessionToken);de(new Set(g.favorites))}catch{de(new Set)}try{const g=await t.listBlocked(n.sessionToken);he(new Set(g.blocked))}catch{he(new Set)}})()},[t,oe,T,n.sessionToken,n.userType,o.defaultCenterLat,o.defaultCenterLng,A]),s.useEffect(()=>{let g=!1;async function v(){try{const B=await t.listCruisingSpots();g||O(B.spots)}catch{g||O([])}}v();const w=window.setInterval(()=>{v()},12e3);return()=>{g=!0,window.clearInterval(w)}},[t]),s.useEffect(()=>{const g=Date.now(),v=X.flatMap(w=>{const B=[];return w.mainPhotoMediaId&&B.push(w.mainPhotoMediaId),Array.isArray(w.galleryMediaIds)&&B.push(...w.galleryMediaIds),w.videoMediaId&&B.push(w.videoMediaId),B}).filter(w=>typeof w=="string"&&w.length>0&&!y[w]&&g>=(U[w]??0)).slice(0,6);v.length!==0&&Promise.all(v.map(async w=>{try{const B=await t.getPublicMediaUrl(w);return{mediaId:w,url:B.downloadUrl}}catch{return null}})).then(w=>{p(B=>{const Q={...B};for(const ie of w)ie&&(Q[ie.mediaId]=ie.url);return Q}),te(B=>{const Q={...B};for(let ie=0;ie<v.length;ie+=1){const ce=v[ie];w[ie]?Q[ce]&&delete Q[ce]:Q[ce]=Date.now()+3e4}return Q})})},[t,U,y,X]);async function Ae(g){m(g),ue(0);const v=yt(g);if(!v){V(null);return}try{if(g===se){const w=await t.getMyProfile(n.sessionToken);typeof w.profile.mainPhotoMediaId=="string"&&w.profile.mainPhotoMediaId;const B=[w.profile.mainPhotoMediaId,...w.profile.galleryMediaIds??[],w.profile.videoMediaId].filter(Q=>typeof Q=="string"&&Q.length>0);if(B.length>0){const Q=await Promise.all(B.map(async ie=>{try{const ce=await t.getPublicMediaUrl(ie);return{mediaId:ie,downloadUrl:ce.downloadUrl}}catch{return null}}));p(ie=>{const ce={...ie};for(const Te of Q)Te&&(ce[Te.mediaId]=Te.downloadUrl);return ce})}V({userId:w.profile.userId,displayName:w.profile.displayName,age:w.profile.age,bio:w.profile.bio,stats:w.profile.stats,discreetMode:w.profile.discreetMode,mainPhotoMediaId:w.profile.mainPhotoMediaId,galleryMediaIds:w.profile.galleryMediaIds,videoMediaId:w.profile.videoMediaId})}else{const w=await t.getPublicProfile(v),B=[w.profile.mainPhotoMediaId,...w.profile.galleryMediaIds??[],w.profile.videoMediaId].filter(Q=>typeof Q=="string"&&Q.length>0);if(B.length>0){const Q=await Promise.all(B.map(async ie=>{try{const ce=await t.getPublicMediaUrl(ie);return{mediaId:ie,downloadUrl:ce.downloadUrl}}catch{return null}}));p(ie=>{const ce={...ie};for(const Te of Q)Te&&(ce[Te.mediaId]=Te.downloadUrl);return ce})}V(w.profile)}}catch(w){const B=w;if((B==null?void 0:B.code)==="PROFILE_HIDDEN"){m(null),V(null);return}V(null),S($(w))}}async function Ne(g){if(n.userType==="guest"){S("Guests cannot star users. Register to save favorites.");return}if(!(!n.userId||n.userId===g))try{const v=await t.toggleFavorite(n.sessionToken,g);de(new Set(v.favorites))}catch(v){S($(v))}}async function Le(g){const v=Ce(g);if(!(!v||v===se))try{await t.sendChat(n.sessionToken,"cruise",v,mt)}catch(w){S($(w))}}async function Ke(g){if(!(!g.trim()||g===se)){if(n.userType==="guest"){S("Anonymous users cannot block users.");return}try{le.has(g)?await t.unblock(n.sessionToken,g):await t.block(n.sessionToken,g);const v=await t.listBlocked(n.sessionToken);he(new Set(v.blocked))}catch(v){S($(v))}}}async function J(){const g=A??{lat:o.defaultCenterLat,lng:o.defaultCenterLng};if(!navigator.geolocation){W(g);try{await t.updatePresence(n.sessionToken,g.lat,g.lng,"online")}catch{}return}try{const v=await new Promise((w,B)=>{navigator.geolocation.getCurrentPosition(w,B,{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e4})});W({lat:v.coords.latitude,lng:v.coords.longitude}),await t.updatePresence(n.sessionToken,v.coords.latitude,v.coords.longitude,"online")}catch(v){W(g);try{await t.updatePresence(n.sessionToken,g.lat,g.lng,"online")}catch{const w=v&&typeof v=="object"&&"message"in v&&typeof v.message=="string"?v.message:null;S(w??$(v))}}}s.useEffect(()=>{J();const g=window.setInterval(()=>{J()},3e4);return()=>window.clearInterval(g)},[n.sessionToken]),s.useEffect(()=>{const g=v=>{var ie,ce;const w=v,B=(ie=w.detail)==null?void 0:ie.lat,Q=(ce=w.detail)==null?void 0:ce.lng;!Number.isFinite(B)||!Number.isFinite(Q)||(W({lat:B,lng:Q}),t.updatePresence(n.sessionToken,B,Q,"online").catch(()=>{}))};return window.addEventListener("rd:location-updated",g),()=>window.removeEventListener("rd:location-updated",g)},[t,n.sessionToken]);const ke=s.useMemo(()=>{if(fe.some(B=>B.key===se))return fe;const v=T??A??{lat:o.defaultCenterLat,lng:o.defaultCenterLng};return[{key:se,userType:n.userType,lat:v.lat,lng:v.lng,status:"online",updatedAtMs:Date.now()},...fe]},[se,fe,T,n.userType,o.defaultCenterLat,o.defaultCenterLng,A]),Re=s.useMemo(()=>{const g={};for(const v of X){if(!v.mainPhotoMediaId)continue;const w=y[v.mainPhotoMediaId];w&&(g[Ue(v.userId)]=w)}return g},[y,X]),Ie=s.useMemo(()=>c.map(g=>({id:`spot:${g.spotId}`,position:{lat:g.lat,lng:g.lng},color:"#26d5ff",markerType:"spot",markerGlyph:"CS",label:`${g.name} | check-ins: ${g.checkInCount??0} | action: ${g.actionCount??0}`,onClick:()=>b(g.spotId)})),[c]),je=e.jsx(Dt,{wsUrl:ut(),sessionToken:n.sessionToken,presenceUpdates:ke,realtimeErrorMessage:ve,onMarkerSelect:g=>void Ae(g),avatarByKey:Re,additionalMarkers:Ie,defaultCenter:A??{lat:o.defaultCenterLat,lng:o.defaultCenterLng},height:I?"calc(100vh - 340px)":600,visible:!0}),We=e.jsxs("div",{style:{background:"#000",marginInline:-10},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,padding:"8px 10px",borderBottom:"1px solid rgba(255,58,77,0.25)"},children:[e.jsx("button",{type:"button",style:D(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"reset"}}))},children:"GUYS"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"toggle_favorites"}}))},"aria-label":"Toggle favorites only",children:"â˜…"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"open_filters"}})),G("chat")},children:"FILTER"})]}),e.jsx(Dt,{wsUrl:ut(),sessionToken:n.sessionToken,presenceUpdates:ke,realtimeErrorMessage:ve,onMarkerSelect:g=>void Ae(g),avatarByKey:Re,additionalMarkers:Ie,defaultCenter:A??{lat:o.defaultCenterLat,lng:o.defaultCenterLng},height:"calc(100dvh - 220px)",visible:K==="map"})]}),He=e.jsx(Nn,{api:t,session:n,busy:u,setBusy:x,setLastError:S,onlinePeers:xe,selectedPeerKey:E,setSelectedPeerKey:C,onOpenProfile:g=>void Ae(g),isMobile:I,selfCoords:T,peerProfileByKey:z,discoverFilter:f,publicProfiles:X,favorites:we,mediaUrlById:y,onUnreadCountChange:M});return e.jsxs("div",{style:{display:"grid",gap:8},children:[I?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:K==="map"?"block":"none"},children:We}),e.jsx("div",{style:{display:K==="chat"?"block":"none"},children:He}),e.jsx("div",{style:{position:"fixed",left:10,right:10,bottom:"calc(env(safe-area-inset-bottom, 0px) + 66px)",zIndex:41,padding:8,background:"rgba(0,0,0,0.35)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("button",{type:"button",style:K==="map"?ye(!1):D(!1),onClick:()=>G("map"),children:"MAP"}),e.jsx("button",{type:"button",style:K==="chat"?ye(!1):D(!1),onClick:()=>G("chat"),children:"CHAT"})]})})]}):e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1.2fr 1fr",gap:12,alignItems:"start"},children:[je,He]}),a?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:80,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:I?"stretch":"center",padding:I?0:14},role:"dialog","aria-modal":"true","aria-label":"User profile",onClick:()=>m(null),children:e.jsx("div",{onClick:g=>g.stopPropagation(),style:I?{width:"100%",height:"100dvh",overflow:"auto",background:"linear-gradient(180deg, rgba(7,8,10,0.98), rgba(2,2,4,0.98))",borderRadius:0,border:"none",padding:"calc(env(safe-area-inset-top, 0px) + 56px) 12px calc(env(safe-area-inset-bottom, 0px) + 20px)"}:{...Ee(),width:"min(680px, 100%)",maxHeight:"86vh",overflow:"auto"},children:e.jsxs("div",{style:{display:"grid",gap:14},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"106px 1fr auto",gap:12,alignItems:"center"},children:[e.jsxs("div",{style:{position:"relative",width:106,height:106},children:[e.jsx("img",{src:d!=null&&d.mainPhotoMediaId&&y[d.mainPhotoMediaId]?y[d.mainPhotoMediaId]:Be(a),alt:"Profile avatar",style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"cover",border:"2px solid #ff3047"}}),e.jsx("span",{style:{position:"absolute",right:4,bottom:4,width:14,height:14,borderRadius:"50%",background:"#26d5ff",border:"2px solid #000"}})]}),e.jsxs("div",{style:{display:"grid",gap:6},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:(d==null?void 0:d.displayName)??a}),e.jsx("div",{style:{color:"#26d5ff",fontSize:14},children:"Instant Messaging Available"})]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[d&&d.userId!==(n.userId??"")?e.jsx("button",{type:"button",style:{...D(!1),color:"#26d5ff",borderColor:"rgba(38,213,255,0.62)",minWidth:126},onClick:()=>void Ne(d.userId),children:we.has(d.userId)?"â˜… STARRED":"â˜† STAR"}):null,d&&d.userId!==(n.userId??"")?e.jsx("button",{type:"button",style:{...D(!1),color:"#ffb347",borderColor:"rgba(255,179,71,0.65)",minWidth:126},onClick:()=>void Le(Ue(d.userId)),children:"ðŸ”¥ FIRE"}):null,d&&d.userId!==(n.userId??"")?e.jsx("button",{type:"button",style:{...D(!1),color:le.has(Ue(d.userId))?"#ff9aa3":"#ffd4d8",borderColor:"rgba(255,120,130,0.62)",minWidth:126},onClick:()=>void Ke(Ue(d.userId)),children:le.has(Ue(d.userId))?"UNBLOCK":"BLOCK"}):null,e.jsx("button",{type:"button",style:D(!1),onClick:()=>m(null),children:"CLOSE"})]})]}),e.jsxs("div",{style:{color:"#ced3dc",fontSize:14,lineHeight:1.5},children:[e.jsxs("div",{children:["Age: ",(d==null?void 0:d.age)??"-"]}),e.jsxs("div",{children:["Race: ",((Fe=d==null?void 0:d.stats)==null?void 0:Fe.race)??"-"]}),e.jsxs("div",{children:["Height: ",((Qe=d==null?void 0:d.stats)==null?void 0:Qe.heightInches)??"-"]}),e.jsxs("div",{children:["Weight: ",((Ge=d==null?void 0:d.stats)==null?void 0:Ge.weightLbs)??"-"]}),e.jsxs("div",{children:["Cock Size: ",((Ve=d==null?void 0:d.stats)==null?void 0:Ve.cockSizeInches)??"-"]}),e.jsxs("div",{children:["Cut / Uncut: ",((Ze=d==null?void 0:d.stats)==null?void 0:Ze.cutStatus)??"-"]}),e.jsxs("div",{children:["Position: ",((Oe=d==null?void 0:d.stats)==null?void 0:Oe.position)??"-"]}),e.jsxs("div",{style:{marginTop:8},children:["Bio: ",(d==null?void 0:d.bio)??"-"]})]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"MEDIA"}),d?e.jsx(e.Fragment,{children:(()=>{const g=[d.mainPhotoMediaId,...d.galleryMediaIds??[],d.videoMediaId].filter(ie=>typeof ie=="string"&&ie.length>0);if(g.length===0)return e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No uploaded media."});const v=Math.max(0,Math.min(me,g.length-1)),w=g[v],B=y[w],Q=w===d.videoMediaId;return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.4)",borderRadius:12,padding:8},children:Q?e.jsx("video",{controls:!0,playsInline:!0,src:B,style:{width:"100%",maxHeight:260,borderRadius:10,background:"#000"}}):e.jsx("img",{src:B??Be(a??d.userId),alt:"Profile media",style:{width:"100%",maxHeight:260,objectFit:"cover",borderRadius:10}})}),e.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:g.map((ie,ce)=>{const Te=y[ie],_e=ie===d.videoMediaId;return e.jsx("button",{type:"button",onClick:()=>ue(ce),style:{width:64,height:64,padding:0,borderRadius:8,overflow:"hidden",border:ce===v?"2px solid #26d5ff":"1px solid rgba(255,58,77,0.4)",background:"#000",cursor:"pointer",color:"#fff",fontSize:10},"aria-label":_e?"Open video":"Open photo",children:_e?e.jsx("div",{style:{display:"grid",placeItems:"center",width:"100%",height:"100%"},children:Te?e.jsx("video",{src:Te,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}):"VIDEO"}):e.jsx("img",{src:Te??Be(a??d.userId),alt:"Media thumbnail",style:{width:"100%",height:"100%",objectFit:"cover"}})},ie)})})]})})()}):null]}),e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:e.jsx("button",{type:"button",style:ye(!1),onClick:()=>{a&&P(a),m(null),ue(0)},children:"CHAT"})})]})})}):null,r?e.jsx(Rn,{api:t,session:n,spot:c.find(g=>g.spotId===r)??null,onClose:()=>b(null),onUpdated:async()=>{try{const g=await t.listCruisingSpots();O(g.spots)}catch{}},setLastError:S}):null]})}function Rn({api:t,session:n,spot:o,onClose:f,onUpdated:u,setLastError:x}){return o?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},role:"dialog","aria-modal":"true","aria-label":"Cruising spot",onClick:f,children:e.jsxs("div",{onClick:S=>S.stopPropagation(),style:{...Ee(),width:"min(520px, 100%)",display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:o.name}),e.jsx("div",{style:{color:"#9fb6bf",fontSize:13},children:o.address}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap"},children:o.description}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:13},children:["Check-ins: ",o.checkInCount??0," | I got action there: ",o.actionCount??0]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:ye(!1),onClick:async()=>{try{await t.checkInCruisingSpot(n.sessionToken,o.spotId),await u()}catch(S){x($(S))}},children:"CHECK IN"}),e.jsx("button",{type:"button",style:D(!1),onClick:async()=>{try{await t.markCruisingSpotAction(n.sessionToken,o.spotId),await u()}catch(S){x($(S))}},children:"I GOT ACTION THERE"}),e.jsx("button",{type:"button",style:D(!1),onClick:f,children:"CLOSE"})]})]})}):null}function Nn({api:t,session:n,busy:o,setBusy:f,setLastError:u,onlinePeers:x,selectedPeerKey:S,setSelectedPeerKey:I,onOpenProfile:P,openThreadRequest:M,onThreadRequestConsumed:K,isMobile:G,selfCoords:E,peerProfileByKey:C,discoverFilter:a,publicProfiles:m,favorites:T,mediaUrlById:W,onUnreadCountChange:h}){var zt;const[k,z]=s.useState({}),[N,X]=s.useState({}),[ae,we]=s.useState("instant"),[de,le]=s.useState("grid"),[he,y]=s.useState(null),[p,U]=s.useState(""),[te,d]=s.useState(null),[V,me]=s.useState([]),[ue,oe]=s.useState({}),[be,c]=s.useState(null),[O,r]=s.useState({}),[b,A]=s.useState({}),[ne,pe]=s.useState(!1),[ve,Se]=s.useState(""),[se,fe]=s.useState(null),Z=s.useRef(!1),xe=s.useRef(!1),Ae=s.useRef(0),Ne=s.useRef(null),Le=s.useRef(null),Ke=s.useRef(null),J=s.useRef(null),ke=s.useRef(null),Re=s.useRef(0),Ie=s.useRef(new Set),je=s.useRef(null),We=s.useRef(null),He=s.useRef(null),[Fe,Qe]=s.useState(null),[Ge,Ve]=s.useState(a==="favorites"),[Ze,Oe]=s.useState(!1),[g,v]=s.useState(a==="online"?"online":"all"),[w,B]=s.useState(!1),[Q,ie]=s.useState(""),[ce,Te]=s.useState(""),[_e,bt]=s.useState(""),[et,vt]=s.useState(""),[tt,xt]=s.useState(""),[nt,jt]=s.useState(""),[st,wt]=s.useState(""),[it,St]=s.useState(""),[rt,kt]=s.useState(""),[at,It]=s.useState(""),[ot,Ct]=s.useState(""),Me=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,re=he??S??"",en=re?k[re]??[]:[],Tt=s.useMemo(()=>new Map(x.map(i=>[i.key,i])),[x]),ze=s.useMemo(()=>{const i={};for(const l of m)typeof l.displayName=="string"&&l.displayName.trim()&&(i[Ue(l.userId)]=l.displayName);for(const[l,j]of Object.entries(C))typeof j.displayName=="string"&&j.displayName.trim()&&(i[l]=j.displayName);return i},[C,m]),Mt=s.useMemo(()=>m.filter(i=>i.userId!==(n.userId??"")).map(i=>{const l=Ue(i.userId),j=Tt.get(l);return{key:l,userId:i.userId,displayName:i.displayName,age:i.age,stats:i.stats,meters:j&&E?Math.round(pt(E,{lat:j.lat,lng:j.lng})):null,isOnline:!!j,hasPicture:typeof i.mainPhotoMediaId=="string"&&i.mainPhotoMediaId.trim().length>0,avatarUrl:i.mainPhotoMediaId?W[i.mainPhotoMediaId]:void 0}}),[W,Tt,m,E,n.userId]),Ye=s.useMemo(()=>{const i=Q.trim()?Number(Q):void 0,l=ce.trim()?Number(ce):void 0,j=et.trim()?Number(et):void 0,R=tt.trim()?Number(tt):void 0,F=nt.trim()?Number(nt):void 0,_=st.trim()?Number(st):void 0,Y=it.trim()?Number(it):void 0,H=rt.trim()?Number(rt):void 0;return Mt.filter(L=>{var ge,Pe,$e,ct,De,Ut,Ot,Lt,Kt;if(Ge&&!T.has(L.userId)||g==="online"&&!L.isOnline||g==="offline"&&L.isOnline||w&&!L.hasPicture||Number.isFinite(i)&&(typeof L.age!="number"||L.age<i)||Number.isFinite(l)&&(typeof L.age!="number"||L.age>l))return!1;const q=typeof((ge=L.stats)==null?void 0:ge.race)=="string"?L.stats.race:"";return!(_e.trim()&&q.toLowerCase()!==_e.trim().toLowerCase()||Number.isFinite(j)&&(typeof((Pe=L.stats)==null?void 0:Pe.heightInches)!="number"||L.stats.heightInches<j)||Number.isFinite(R)&&(typeof(($e=L.stats)==null?void 0:$e.heightInches)!="number"||L.stats.heightInches>R)||Number.isFinite(F)&&(typeof((ct=L.stats)==null?void 0:ct.weightLbs)!="number"||L.stats.weightLbs<F)||Number.isFinite(_)&&(typeof((De=L.stats)==null?void 0:De.weightLbs)!="number"||L.stats.weightLbs>_)||Number.isFinite(Y)&&(typeof((Ut=L.stats)==null?void 0:Ut.cockSizeInches)!="number"||L.stats.cockSizeInches<Y)||Number.isFinite(H)&&(typeof((Ot=L.stats)==null?void 0:Ot.cockSizeInches)!="number"||L.stats.cockSizeInches>H)||at&&((Lt=L.stats)==null?void 0:Lt.cutStatus)!==at||ot&&((Kt=L.stats)==null?void 0:Kt.position)!==ot)})},[Mt,T,Ge,at,ce,rt,tt,st,Q,it,et,nt,ot,_e,w,g]),lt=s.useMemo(()=>Array.from(new Set(Ye.map(i=>i.key).filter(i=>i.trim().length>0))).slice(0,8),[Ye]),At=lt.join("|"),dt=s.useMemo(()=>{const i=new Set(Object.keys(N));return re.trim()&&i.add(re),Array.from(i).sort((l,j)=>{var R,F;return(((R=N[j])==null?void 0:R.lastAt)??0)-(((F=N[l])==null?void 0:F.lastAt)??0)})},[N,re]),Rt=s.useMemo(()=>Object.values(O).reduce((i,l)=>i+(Number.isFinite(l)?l:0),0),[O]);s.useMemo(()=>{var i;return re?ze[re]??((i=C[re])==null?void 0:i.displayName)??re:""},[ze,re,C]);const tn=s.useMemo(()=>{if(!re)return;const i=Ye.find(l=>l.key===re);return i==null?void 0:i.avatarUrl},[Ye,re]),Je=s.useMemo(()=>dt.filter(i=>i!==re&&i!==Me&&!!N[i]).map(i=>{var l;return{key:i,label:ze[i]??((l=C[i])==null?void 0:l.displayName)??i}}),[dt,N,ze,Me,re,C]);s.useEffect(()=>{typeof h=="function"&&h(Rt)},[h,Rt]),s.useEffect(()=>{const i=Ne.current;i&&(i.srcObject=se)},[se]),s.useEffect(()=>{const i=Le.current;i&&(i.srcObject=Fe)},[Fe]),s.useEffect(()=>()=>{if(se){for(const i of se.getTracks())i.stop();if(Fe)for(const i of Fe.getTracks())i.stop();je.current&&(je.current.close(),je.current=null)}},[se,Fe]),s.useEffect(()=>{if(Je.length===0){U("");return}U(i=>i&&Je.some(l=>l.key===i)?i:Je[0].key)},[Je]);const nn=s.useMemo(()=>({async sendMessage(i,l,j,R){const F=Ce(l),_=await t.sendChat(n.sessionToken,i,F,j,R),Y=_==null?void 0:_.message,H=[Y];if(i==="cruise"&&te)try{const L=await t.sendChat(n.sessionToken,i,Ce(te),j,R),q=L==null?void 0:L.message;H.push(q)}catch(L){u($(L))}for(const L of H)Nt(L);return Y},async initiateMediaUpload(i,l){const j=await t.initiateChatMediaUpload(n.sessionToken,{mimeType:i,sizeBytes:l});return{objectKey:j.objectKey,uploadUrl:j.uploadUrl}},async uploadToSignedUrl(i,l,j){if(await ht(i,l,j))return;if(!(await fetch(i,{method:"PUT",headers:{"content-type":j},body:l})).ok)throw{code:"MEDIA_UPLOAD_INCOMPLETE",message:"Upload failed."}},async getMediaUrl(i){return(await t.getChatMediaUrl(n.sessionToken,i)).downloadUrl}}),[t,Me,n.sessionToken,u,te]);function qe(i){var l,j,R;return i.text&&i.text.trim()?Zt(i.text):((l=i.media)==null?void 0:l.kind)==="image"?"[Photo]":((j=i.media)==null?void 0:j.kind)==="video"?"[Video]":((R=i.media)==null?void 0:R.kind)==="audio"?"[Voice]":""}function sn(i){if(!i||Ie.current.has(i))return!1;if(Ie.current.add(i),Ie.current.size>5e3){const l=Array.from(Ie.current).slice(-2500);Ie.current=new Set(l)}return!0}function rn(i,l){var F;const j=ze[l]??((F=C[l])==null?void 0:F.displayName)??l,R=qe(i)||"New activity";if("Notification"in window){if(Notification.permission==="granted"){try{new Notification(`${j}`,{body:R})}catch{}return}Notification.permission==="default"&&Notification.requestPermission()}}function an(i){if(!i.startsWith("GROUP_INVITE_REQUEST|"))return null;const[,l,j,R]=i.split("|");return!l||!j||!R?null:{inviteId:l,inviterKey:j,primaryPeerKey:R}}function on(i){if(!i.startsWith("GROUP_INVITE_ACCEPT|"))return null;const[,l,j]=i.split("|");return!l||!j?null:{inviteId:l,candidateKey:j}}function Nt(i){if(!sn(i.messageId))return;const l=i.fromKey===Me?i.toKey:i.fromKey;z(F=>{const _=F[l]??[];return _.some(Y=>Y.messageId===i.messageId)?F:{...F,[l]:[..._,i].sort((Y,H)=>Y.createdAtMs-H.createdAtMs)}}),X(F=>({...F,[l]:{lastAt:i.createdAtMs,lastText:qe(i)}})),i.fromKey!==Me&&(de==="thread"&&Ce(re)===Ce(l)?(A(_=>({..._,[l]:Math.max(_[l]??0,i.createdAtMs)})),r(_=>{const Y={..._};return delete Y[l],Y})):r(_=>({..._,[l]:(_[l]??0)+1})),rn(i,l));const j=an(i.text??"");j&&i.toKey===Me&&me(F=>F.some(_=>_.inviteId===j.inviteId)?F:[...F,{...j,createdAtMs:i.createdAtMs}]);const R=on(i.text??"");R&&i.toKey===Me&&ue[R.inviteId]&&(d(Ce(R.candidateKey)),c(`Invite accepted by ${ze[R.candidateKey]??R.candidateKey}.`),oe(_=>{const Y={..._};return delete Y[R.inviteId],Y}))}async function ln(i){const l=Ce(i);if(l)try{const j=await t.listChat(n.sessionToken,Xe(ae),l),R=j==null?void 0:j.messages,F=Array.isArray(R)?R:[];t.markChatRead(n.sessionToken,Xe(ae),l).catch(()=>{}),z(H=>({...H,[l]:F}));const _=F.length>0?F[F.length-1]:null;_&&X(H=>({...H,[l]:{lastAt:_.createdAtMs,lastText:qe(_)}}));let Y=0;for(const H of F)H.fromKey===l&&H.createdAtMs>Y&&(Y=H.createdAtMs);Y>0&&A(H=>({...H,[l]:Math.max(H[l]??0,Y)}))}catch(j){u($(j))}}s.useEffect(()=>{if(de!=="thread"||!re.trim())return;let i=!1,l=!1,j=null;const R=async()=>{if(!(i||l)){l=!0;try{await ln(re)}finally{l=!1}i||(j=window.setTimeout(()=>{R()},1200))}};return R(),()=>{i=!0,j!==null&&window.clearTimeout(j)}},[ae,re,de]),s.useEffect(()=>{if(de!=="grid")return;if(lt.length===0){r({});return}let i=!1;async function l(){if(!Z.current&&!document.hidden){Z.current=!0;try{const F=Xe(ae),_=[],Y=[];for(const L of lt){if(i)break;try{const q=Ce(L);if(!q)continue;const ge=await t.listChat(n.sessionToken,F,q),Pe=(ge==null?void 0:ge.messages)??[];if(Pe.length>0){const De=Pe[Pe.length-1];Y.push([q,{lastAt:De.createdAtMs,lastText:qe(De)}])}let $e=0;const ct=b[q]??0;for(const De of Pe)De.fromKey===q&&De.createdAtMs>ct&&($e+=1);_.push([q,$e])}catch{const q=Ce(L);q&&_.push([q,0])}}if(i)return;Y.length>0&&X(L=>{const q={...L};for(const[ge,Pe]of Y)q[ge]=Pe;return q});const H={};for(const[L,q]of _)q>0&&(H[L]=q);r(H)}finally{Z.current=!1}}}const j=window.setTimeout(()=>{l()},1200),R=window.setInterval(()=>{l()},15e3);return()=>{i=!0,Z.current=!1,window.clearTimeout(j),window.clearInterval(R)}},[t,ae,b,n.sessionToken,At,de]),s.useEffect(()=>{const i=Array.from(new Set([...dt,...lt,re].map(_=>Ce(_)).filter(_=>_.length>0))).slice(0,10);if(i.length===0)return;let l=!1;const j=async()=>{if(!(l||document.hidden||xe.current)){xe.current=!0;try{const _=Xe(ae),Y=[];for(const H of i){if(l)break;try{const L=await t.listChat(n.sessionToken,_,H),q=(L==null?void 0:L.messages)??[];if(q.length===0)continue;const ge=q[q.length-1];Y.push([H,{lastAt:ge.createdAtMs,lastText:qe(ge)}])}catch{}}if(l||Y.length===0)return;X(H=>{const L={...H};for(const[q,ge]of Y)L[q]=ge;return L})}finally{xe.current=!1}}},R=window.setTimeout(()=>{j()},1e3),F=window.setInterval(()=>{j()},5e3);return()=>{l=!0,window.clearTimeout(R),window.clearInterval(F)}},[t,ae,dt,re,n.sessionToken,At]);async function dn(){if(se)return se;if(!navigator.mediaDevices||typeof navigator.mediaDevices.getUserMedia!="function")throw{code:"UNAUTHORIZED_ACTION",message:"Camera access is not available in this browser."};const i=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});return fe(i),i}function cn(i,l){je.current&&(je.current.close(),je.current=null);const j=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});return je.current=j,We.current=l,He.current=i,j.ontrack=R=>{const F=R.streams[0];F&&Qe(F)},j.onicecandidate=R=>{const F=R.candidate;if(!F)return;const _=He.current,Y=We.current;!_||!Y||t.sendCallSignal(n.sessionToken,{toKey:_,callId:Y,signalType:"ice",candidate:JSON.stringify(F.toJSON())}).catch(()=>{})},j}async function Pt(i=!0){const l=He.current,j=We.current;if(i&&l&&j)try{await t.sendCallSignal(n.sessionToken,{toKey:l,callId:j,signalType:"hangup"})}catch{}if(se)for(const R of se.getTracks())R.stop();if(Fe)for(const R of Fe.getTracks())R.stop();fe(null),Qe(null),je.current&&(je.current.close(),je.current=null),We.current=null,He.current=null,pe(!1)}s.useEffect(()=>{let i=!1;const l=ut();if(!l)return;const j=()=>{J.current!==null&&(window.clearInterval(J.current),J.current=null),ke.current!==null&&(window.clearTimeout(ke.current),ke.current=null)},R=()=>{if(i)return;const F=new WebSocket(l);Ke.current=F,F.onopen=()=>{Re.current=0,F.send(JSON.stringify({type:"auth",payload:{sessionToken:n.sessionToken}})),J.current=window.setInterval(()=>{F.readyState===F.OPEN&&F.send(JSON.stringify({type:"heartbeat",payload:{}}))},15e3)},F.onmessage=_=>{let Y=null;try{Y=JSON.parse(String(_.data))}catch{return}if(!Y||typeof Y.type!="string")return;if(Y.type==="chat_message"){const q=Y.payload,ge=q==null?void 0:q.message;if(!ge||ge.fromKey!==Me&&ge.toKey!==Me)return;Nt(ge);return}if(Y.type!=="call_signal")return;const H=Y.payload;if(!H||H.toKey!==Me||typeof H.fromKey!="string"||!H.callId||!H.signalType)return;const L=Ce(H.fromKey);if(H.signalType==="hangup"){Pt(!1);return}if(H.signalType==="offer"){(async()=>{try{ft(L),Se(L);const q=await dn(),ge=cn(L,H.callId);for(const $e of q.getTracks())ge.addTrack($e,q);await ge.setRemoteDescription({type:"offer",sdp:H.sdp??""});const Pe=await ge.createAnswer();await ge.setLocalDescription(Pe),await t.sendCallSignal(n.sessionToken,{toKey:L,callId:H.callId,signalType:"answer",sdp:Pe.sdp??""}),pe(!0)}catch(q){u($(q))}})();return}if(H.signalType==="answer"){(async()=>{try{if(!je.current||We.current!==H.callId)return;await je.current.setRemoteDescription({type:"answer",sdp:H.sdp??""})}catch(q){u($(q))}})();return}H.signalType==="ice"&&(async()=>{try{if(!je.current||We.current!==H.callId||!H.candidate)return;const q=JSON.parse(H.candidate);await je.current.addIceCandidate(q)}catch{}})()},F.onclose=()=>{if(j(),i)return;Re.current+=1;const _=Math.min(8e3,500*2**Math.min(Re.current,4));ke.current=window.setTimeout(R,_)},F.onerror=()=>{}};return R(),()=>{var F;i=!0,j(),(F=Ke.current)==null||F.close(1e3,"chat cleanup"),Ke.current=null}},[t,Me,n.sessionToken]);async function un(){if(p.trim()){if(!re.trim()){u("Select a user first.");return}try{const i=Ce(p);if(!i)return;if(!Je.some(j=>j.key===i)){u("You can only add a third user you have previously messaged.");return}const l=crypto.randomUUID();await t.sendChat(n.sessionToken,"cruise",i,`GROUP_INVITE_REQUEST|${l}|${Me}|${re.trim()}`),oe(j=>({...j,[l]:{candidateKey:i,primaryPeerKey:re.trim()}})),c(`Invite sent to ${ze[i]??i}. Waiting for acceptance.`)}catch(i){u($(i))}}}async function Et(i,l,j){try{await t.sendChat(n.sessionToken,"cruise",l,`GROUP_INVITE_ACCEPT|${i}|${Me}`),me(R=>R.filter(F=>F.inviteId!==i)),c("Group invite accepted."),ft(j)}catch(R){u($(R))}}function Ft(i){me(l=>l.filter(j=>j.inviteId!==i))}function ft(i){const l=Ce(i);I(l),y(l),r(j=>{const R={...j};return delete R[l],R}),A(j=>({...j,[l]:Date.now()})),le("thread")}function gt(){Ve(!1),v("all"),B(!1),ie(""),Te(""),bt(""),vt(""),xt(""),jt(""),wt(""),St(""),kt(""),It(""),Ct(""),Oe(!1)}if(s.useEffect(()=>{const i=l=>{var F;const R=(F=l.detail)==null?void 0:F.action;if(R==="reset"){gt(),le("grid");return}if(R==="toggle_favorites"){Ve(_=>!_),le("grid");return}R==="open_filters"&&(Oe(!0),le("grid"))};return window.addEventListener("rd:discover-control",i),()=>window.removeEventListener("rd:discover-control",i)},[]),s.useEffect(()=>{M&&M.nonce!==Ae.current&&(Ae.current=M.nonce,ft(M.key),typeof K=="function"&&K())},[K,M]),s.useEffect(()=>{const i=l=>{var R;((R=l.detail)==null?void 0:R.tab)==="discover"&&(le("grid"),y(null),Oe(!1))};return window.addEventListener("rd:tab-select",i),()=>window.removeEventListener("rd:tab-select",i)},[]),de==="thread"&&re.trim()){const i=ze[re]??((zt=C[re])==null?void 0:zt.displayName)??re;return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:G?-10:0},children:[V.length>0?e.jsxs("div",{style:{...Ee(),display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"INVITE REQUESTS"}),V.map(l=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,alignItems:"center"},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:13},children:[ze[l.inviterKey]??l.inviterKey," invited you to join a conversation."]}),e.jsx("button",{type:"button",style:ye(!1),onClick:()=>void Et(l.inviteId,l.inviterKey,l.primaryPeerKey),children:"ACCEPT"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>Ft(l.inviteId),children:"DECLINE"})]},l.inviteId))]}):null,be?e.jsx("div",{style:{color:"#26d5ff",fontSize:12},children:be}):null,e.jsx(Xt,{chatKind:Xe(ae),peerKey:re,currentUserKey:Me,messages:en,client:nn,title:`INSTANT THREAD: ${i}`,peerSummary:{displayName:i,avatarUrl:tn},thirdParty:{candidates:Je,selectedKey:p,onSelect:l=>U(l),onAdd:()=>void un(),disabled:o},showHeader:!1,edgeToEdge:G,fillHeight:G}),ne?e.jsx("div",{role:"dialog","aria-modal":"true","aria-label":"Video call",style:{position:"fixed",inset:0,zIndex:60,background:"rgba(0,0,0,0.82)",display:"grid",placeItems:"center",padding:16},children:e.jsxs("div",{style:{...Ee(),width:"min(720px, 100%)",display:"grid",gap:10},children:[e.jsxs("div",{style:{fontSize:18,fontWeight:700},children:["VIDEO CALL: ",ve]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("video",{ref:Ne,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"100%",maxHeight:"52vh",borderRadius:12,background:"#000"}}),e.jsx("video",{ref:Le,autoPlay:!0,playsInline:!0,style:{width:"100%",maxHeight:"52vh",borderRadius:12,background:"#000"}})]}),e.jsx("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:e.jsx("button",{type:"button",style:D(!1),onClick:()=>void Pt(),children:"END CALL"})})]})}):null]})}return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:G?-10:0},children:[V.length>0?e.jsxs("div",{style:{...Ee(),display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"INVITE REQUESTS"}),V.map(i=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,alignItems:"center"},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:13},children:[ze[i.inviterKey]??i.inviterKey," invited you to join a conversation."]}),e.jsx("button",{type:"button",style:ye(!1),onClick:()=>void Et(i.inviteId,i.inviterKey,i.primaryPeerKey),children:"ACCEPT"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>Ft(i.inviteId),children:"DECLINE"})]},i.inviteId))]}):null,be?e.jsx("div",{style:{color:"#26d5ff",fontSize:12},children:be}):null,e.jsx("div",{style:{padding:10,borderBottom:"1px solid rgba(255,58,77,0.28)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8},children:[e.jsx("button",{type:"button",style:D(!1),onClick:gt,children:"GUYS"}),e.jsx("button",{type:"button",style:Ge?ye(!1):D(!1),onClick:()=>Ve(i=>!i),"aria-label":"Toggle favorites only",children:"â˜…"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>Oe(!0),children:"FILTER"})]})}),Ze?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},role:"dialog","aria-modal":"true","aria-label":"Discover filters",onClick:()=>Oe(!1),children:e.jsx("div",{onClick:i=>i.stopPropagation(),style:{...Ee(),width:"min(760px, 100%)",maxHeight:"86vh",overflow:"auto"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"FILTER USERS"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{type:"checkbox",checked:w,onChange:i=>B(i.target.checked)}),"Has pictures"]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Online status"}),e.jsxs("select",{style:ee(),value:g,onChange:i=>v(i.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"offline",children:"Offline"})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[e.jsx("input",{style:ee(),placeholder:"Min age",value:Q,onChange:i=>ie(i.target.value)}),e.jsx("input",{style:ee(),placeholder:"Max age",value:ce,onChange:i=>Te(i.target.value)}),e.jsx("input",{style:ee(),placeholder:"Race",value:_e,onChange:i=>bt(i.target.value)}),e.jsxs("select",{style:ee(),value:at,onChange:i=>It(i.target.value),children:[e.jsx("option",{value:"",children:"Cut / Uncut"}),e.jsx("option",{value:"cut",children:"Cut"}),e.jsx("option",{value:"uncut",children:"Uncut"})]}),e.jsx("input",{style:ee(),placeholder:"Min height (in)",value:et,onChange:i=>vt(i.target.value)}),e.jsx("input",{style:ee(),placeholder:"Max height (in)",value:tt,onChange:i=>xt(i.target.value)}),e.jsx("input",{style:ee(),placeholder:"Min weight (lbs)",value:nt,onChange:i=>jt(i.target.value)}),e.jsx("input",{style:ee(),placeholder:"Max weight (lbs)",value:st,onChange:i=>wt(i.target.value)}),e.jsx("input",{style:ee(),placeholder:"Min cock size (in)",value:it,onChange:i=>St(i.target.value)}),e.jsx("input",{style:ee(),placeholder:"Max cock size (in)",value:rt,onChange:i=>kt(i.target.value)}),e.jsxs("select",{style:ee(),value:ot,onChange:i=>Ct(i.target.value),children:[e.jsx("option",{value:"",children:"Position"}),e.jsx("option",{value:"top",children:"Top"}),e.jsx("option",{value:"bottom",children:"Bottom"}),e.jsx("option",{value:"side",children:"Side"})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:D(!1),onClick:gt,children:"RESET"}),e.jsx("button",{type:"button",style:ye(!1),onClick:()=>Oe(!1),children:"DONE"})]})]})})}):null,e.jsx("div",{style:{display:"grid",gap:0},children:e.jsx("div",{style:{display:"grid",gap:0,gridTemplateColumns:"repeat(3, minmax(0, 1fr))"},children:Ye.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:13,padding:12,gridColumn:"1 / -1"},children:"No users match current filters."}):Ye.map(i=>e.jsx("button",{type:"button",onClick:()=>P(i.key),style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:0,display:"grid",gap:0,color:"#fff",cursor:"pointer"},children:e.jsxs("div",{style:{position:"relative",width:"100%",aspectRatio:"1 / 1"},children:[e.jsx("img",{src:i.avatarUrl??Be(i.key),alt:"User avatar",style:{width:"100%",height:"100%",borderRadius:0,objectFit:"cover",border:"1px solid #0fd9ff"}}),i.isOnline?e.jsx("span",{style:{position:"absolute",top:4,left:4,width:10,height:10,borderRadius:"50%",background:"#26d5ff",border:"2px solid #000"}}):null]})},i.key))})})]})}function Pn({api:t,session:n,setLastError:o,openThreadRequest:f,onThreadRequestConsumed:u,isMobile:x}){var me,ue,oe,be,c,O;const[S,I]=s.useState([]),[P,M]=s.useState(null),[K,G]=s.useState([]),[E,C]=s.useState("messages"),[a,m]=s.useState(null),[T,W]=s.useState(!1),[h,k]=s.useState(""),[z,N]=s.useState(null),[X,ae]=s.useState({}),[we,de]=s.useState(null),le=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,he="cruise",y=s.useMemo(()=>S.filter(r=>r.key!==P).map(r=>({key:r.key,label:r.displayName})),[S,P]),p=s.useMemo(()=>S.find(r=>r.key===P)??null,[S,P]);s.useEffect(()=>{if(y.length===0){k("");return}k(r=>r&&y.some(b=>b.key===r)?r:y[0].key)},[y]),s.useEffect(()=>{let r=!1;async function b(){var ne,pe,ve;try{const Se=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,[se,fe]=await Promise.all([t.getPublicProfiles(),t.listActivePresence(n.sessionToken)]),Z={},xe={};for(const J of se.profiles)Z[Ue(J.userId)]=J.displayName,typeof J.mainPhotoMediaId=="string"&&J.mainPhotoMediaId.trim()!==""&&(xe[Ue(J.userId)]=J.mainPhotoMediaId);const Ae=Array.from(new Set([...se.profiles.map(J=>Ue(J.userId)),...fe.presence.map(J=>Ce(J.key))].filter(J=>J&&J!==Se))).slice(0,24),Ne=[];for(const J of Ae)try{const ke=await t.listChat(n.sessionToken,"cruise",J),Re=(ke==null?void 0:ke.messages)??[];if(!Array.isArray(Re)||Re.length===0)continue;const Ie=Re[Re.length-1],je=typeof Ie.text=="string"&&Ie.text.trim().length>0?Zt(Ie.text):((ne=Ie.media)==null?void 0:ne.kind)==="image"?"[Photo]":((pe=Ie.media)==null?void 0:pe.kind)==="video"?"[Video]":((ve=Ie.media)==null?void 0:ve.kind)==="audio"?"[Voice]":"";Ne.push({key:J,displayName:Z[J]??J,preview:je,at:Ie.createdAtMs})}catch{}const Le=await Promise.all(Ne.map(async J=>{const ke=xe[J.key];if(!ke)return null;try{const Re=await t.getPublicMediaUrl(ke);return{key:J.key,url:Re.downloadUrl}}catch{return null}})),Ke={};for(const J of Le)J&&(Ke[J.key]=J.url);for(const J of Ne)J.avatarUrl=Ke[J.key];if(r)return;Ne.sort((J,ke)=>ke.at-J.at),I(Ne)}catch(Se){r||o($(Se))}}b();const A=window.setInterval(()=>{b()},1e4);return()=>{r=!0,window.clearInterval(A)}},[t,P,n.sessionToken,n.userId,o]),s.useEffect(()=>{f!=null&&f.key&&(M(Ce(f.key)),C("messages"),typeof u=="function"&&u())},[u,f]),s.useEffect(()=>{const r=b=>{var ne;((ne=b.detail)==null?void 0:ne.tab)==="threads"&&(M(null),C("messages"))};return window.addEventListener("rd:tab-select",r),()=>window.removeEventListener("rd:tab-select",r)},[]),s.useEffect(()=>{if(!P||E!=="profile")return;const r=yt(P);if(!r){m(null);return}let b=!1;return W(!0),t.getPublicProfile(r).then(A=>{b||m(A.profile)}).catch(A=>{b||(m(null),o($(A)))}).finally(()=>{b||W(!1)}),()=>{b=!0}},[t,P,o,E]),s.useEffect(()=>{if(!P){G([]);return}let r=!1;const b=async()=>{try{const ne=await t.listChat(n.sessionToken,he,P),pe=(ne==null?void 0:ne.messages)??[];r||(G(Array.isArray(pe)?pe:[]),t.markChatRead(n.sessionToken,he,P).catch(()=>{}))}catch(ne){r||o($(ne))}};b();const A=window.setInterval(()=>{b()},1200);return()=>{r=!0,window.clearInterval(A)}},[t,P,n.sessionToken,o]);function U(r){if(!r.startsWith("GROUP_INVITE_ACCEPT|"))return null;const[,b,A]=r.split("|");return!b||!A?null:{inviteId:b,candidateKey:A}}const te=s.useMemo(()=>({async sendMessage(r,b,A,ne){const pe=await t.sendChat(n.sessionToken,r,b,A,ne),ve=pe==null?void 0:pe.message,Se=U(ve.text??"");if(Se&&ve.toKey===le&&X[Se.inviteId]&&(N(Se.candidateKey),de(`Invite accepted by ${Se.candidateKey}.`),ae(fe=>{const Z={...fe};return delete Z[Se.inviteId],Z})),G(se=>[...se,ve].sort((fe,Z)=>fe.createdAtMs-Z.createdAtMs)),r==="cruise"&&z)try{const se=await t.sendChat(n.sessionToken,r,z,A,ne),fe=se==null?void 0:se.message;G(Z=>[...Z,fe].sort((xe,Ae)=>xe.createdAtMs-Ae.createdAtMs))}catch(se){o($(se))}return ve},async initiateMediaUpload(r,b){const A=await t.initiateChatMediaUpload(n.sessionToken,{mimeType:r,sizeBytes:b});return{objectKey:A.objectKey,uploadUrl:A.uploadUrl}},async uploadToSignedUrl(r,b,A){if(await ht(r,b,A))return;if(!(await fetch(r,{method:"PUT",headers:{"content-type":A},body:b})).ok)throw{code:"MEDIA_UPLOAD_INCOMPLETE",message:"Upload failed."}},async getMediaUrl(r){return(await t.getChatMediaUrl(n.sessionToken,r)).downloadUrl}}),[t,le,X,n.sessionToken,o,z]);async function d(){var r;if(!(!P||!h)){if(!S.some(b=>b.key===h)){o("You can only add a third user you have previously messaged.");return}try{const b=crypto.randomUUID();await t.sendChat(n.sessionToken,"cruise",h,`GROUP_INVITE_REQUEST|${b}|${le}|${P}`),ae(A=>({...A,[b]:{candidateKey:h}})),de(`Invite sent to ${((r=S.find(A=>A.key===h))==null?void 0:r.displayName)??h}.`)}catch(b){o($(b))}}}async function V(){if(P)try{await t.sendChat(n.sessionToken,"cruise",P,mt),de("Fire sent.")}catch(r){o($(r))}}if(P){const r=(p==null?void 0:p.displayName)??P;return e.jsxs("div",{style:{display:"grid",gap:0,minHeight:x?"calc(100dvh - 150px)":void 0,marginInline:x?-10:0,marginBlock:0},children:[e.jsx("div",{style:{position:"sticky",top:0,zIndex:46,background:"rgba(8,8,12,0.96)",borderBottom:"1px solid rgba(255,58,77,0.35)",padding:"6px 10px",display:"flex",justifyContent:"flex-end"},children:e.jsx("button",{type:"button",onClick:()=>C(b=>b==="messages"?"profile":"messages"),style:{background:"transparent",border:0,color:"#26d5ff",fontSize:13,fontWeight:700,letterSpacing:"0.03em",textTransform:"uppercase",padding:0,cursor:"pointer"},children:E==="messages"?"View Profile":"Back to Thread"})}),E==="messages"?e.jsx(Xt,{chatKind:"cruise",peerKey:P,currentUserKey:le,messages:K,client:te,title:`INSTANT THREAD: ${r}`,peerSummary:{displayName:r},thirdParty:{candidates:y,selectedKey:h,onSelect:b=>k(b),onAdd:()=>void d(),disabled:!1},showHeader:!1,edgeToEdge:!0,fillHeight:x}):e.jsxs("div",{style:{padding:12,display:"grid",gap:12},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"88px 1fr",gap:12,alignItems:"center"},children:[e.jsx("img",{src:(p==null?void 0:p.avatarUrl)??Be(P),alt:"Profile avatar",style:{width:88,height:88,borderRadius:"50%",objectFit:"cover",border:"2px solid #ff3047"}}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:24,fontWeight:700},children:(a==null?void 0:a.displayName)??r}),e.jsx("div",{style:{color:"#26d5ff",fontSize:14},children:"Instant Messaging Available"})]})]}),T?e.jsx("div",{style:{color:"#9fb6bf",fontSize:14},children:"Loading profile..."}):null,T?null:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:14,lineHeight:1.5},children:[e.jsxs("div",{children:["Age: ",(a==null?void 0:a.age)??"-"]}),e.jsxs("div",{children:["Race: ",((me=a==null?void 0:a.stats)==null?void 0:me.race)??"-"]}),e.jsxs("div",{children:["Height: ",((ue=a==null?void 0:a.stats)==null?void 0:ue.heightInches)??"-"]}),e.jsxs("div",{children:["Weight: ",((oe=a==null?void 0:a.stats)==null?void 0:oe.weightLbs)??"-"]}),e.jsxs("div",{children:["Cock Size: ",((be=a==null?void 0:a.stats)==null?void 0:be.cockSizeInches)??"-"]}),e.jsxs("div",{children:["Cut / Uncut: ",((c=a==null?void 0:a.stats)==null?void 0:c.cutStatus)??"-"]}),e.jsxs("div",{children:["Position: ",((O=a==null?void 0:a.stats)==null?void 0:O.position)??"-"]}),e.jsxs("div",{style:{marginTop:8},children:["Bio: ",(a==null?void 0:a.bio)??"-"]})]}),e.jsx("div",{children:e.jsx("button",{type:"button",style:{...D(!1),color:"#ffb347",borderColor:"rgba(255,179,71,0.65)"},onClick:()=>void V(),children:"ðŸ”¥ FIRE"})})]})]})]})}return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:x?-10:0,marginBlock:0},children:[S.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14,padding:14},children:"No conversations yet."}):S.map(r=>e.jsxs("button",{type:"button",onClick:()=>M(r.key),style:{border:0,borderBottom:"1px solid rgba(255,58,77,0.24)",borderRadius:0,padding:"10px 12px",background:"rgba(0,0,0,0.2)",textAlign:"left",color:"#fff",cursor:"pointer",display:"grid",gridTemplateColumns:"52px 1fr",gap:10,alignItems:"center",width:"100%"},children:[e.jsx("img",{src:r.avatarUrl??Be(r.key),alt:`${r.displayName} avatar`,style:{width:52,height:52,borderRadius:6,objectFit:"cover",border:"1px solid rgba(38,213,255,0.9)"}}),e.jsxs("div",{style:{display:"grid",gap:3,minWidth:0},children:[e.jsx("div",{style:{fontWeight:700},children:r.displayName}),e.jsx("div",{style:{color:"#b9bec9",fontSize:13,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:r.preview})]})]},r.key)),we?e.jsx("div",{style:{color:"#26d5ff",fontSize:12,padding:10},children:we}):null]})}function En({api:t,session:n,isMobile:o,setLastError:f}){const[u,x]=s.useState("ads"),[S,I]=s.useState([]),[P,M]=s.useState([]),[K,G]=s.useState(""),[E,C]=s.useState(""),[a,m]=s.useState(""),[T,W]=s.useState(""),[h,k]=s.useState([]),[z,N]=s.useState(""),[X,ae]=s.useState(""),[we,de]=s.useState(""),[le,he]=s.useState([]),[y,p]=s.useState({}),U=!0,te=n.userType!=="guest";async function d(){try{const[r,b,A,ne]=await Promise.all([t.listPublicPostings("ad"),t.listPublicPostings("event"),t.listCruisingSpots(),n.userType==="guest"?Promise.resolve({postings:[]}):t.listEventInvites(n.sessionToken)]);I([...r.postings].sort((pe,ve)=>pe.createdAtMs-ve.createdAtMs)),M([...b.postings].sort((pe,ve)=>pe.createdAtMs-ve.createdAtMs)),k(A.spots),he(ne.postings)}catch(r){f($(r))}}s.useEffect(()=>{d()},[]),s.useEffect(()=>{const r=b=>{var ne;((ne=b.detail)==null?void 0:ne.tab)==="public"&&x("ads")};return window.addEventListener("rd:tab-select",r),()=>window.removeEventListener("rd:tab-select",r)},[]);async function V(r){if(r==="event"&&!te){f("Anonymous users cannot create event postings.");return}const b=r==="ad"?K:a,A=r==="ad"?E:T;try{await t.createPublicPosting(n.sessionToken,{type:r,title:b,body:A}),r==="ad"?(G(""),C("")):(m(""),W("")),await d()}catch(ne){f($(ne))}}async function me(r){if(!te){f("Anonymous users cannot invite to events.");return}const b=(y[r]??"").trim();if(!b){f("Target user id is required.");return}try{await t.inviteToEvent(n.sessionToken,{postingId:r,targetUserId:b}),p(A=>({...A,[r]:""})),await d()}catch(A){f($(A))}}async function ue(r,b){if(n.userType==="guest"){f("Anonymous users cannot respond to event invites.");return}try{await t.respondToEventInvite(n.sessionToken,{postingId:r,accept:b}),await d()}catch(A){f($(A))}}async function oe(){try{await t.createCruisingSpot(n.sessionToken,{name:z,address:X,description:we}),N(""),ae(""),de(""),await d()}catch(r){f($(r))}}async function be(r){try{await t.checkInCruisingSpot(n.sessionToken,r),await d()}catch(b){f($(b))}}const c=r=>{const b=r==="ads"?"ADS":"EVENTS",A=r==="ads"?S:P,ne=r==="ads"?K:a,pe=r==="ads"?E:T,ve=r==="ads"?G:m,Se=r==="ads"?C:W,se=r==="ads"?"ad":"event",fe=r==="ads"?U:te;return e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.38)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:b}),e.jsx("input",{value:ne,onChange:Z=>ve(Z.target.value),placeholder:`${b} title`,style:ee(),"aria-label":`${b} title`,disabled:!fe}),e.jsx("textarea",{value:pe,onChange:Z=>Se(Z.target.value),placeholder:`Write ${b.toLowerCase()} details`,style:{...ee(),minHeight:86,resize:"vertical"},"aria-label":`${b} details`,disabled:!fe}),e.jsxs("button",{type:"button",onClick:()=>void V(se),style:fe?ye(!1):D(!0),disabled:!fe,children:["POST ",b]}),fe?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can view events but cannot post events."}),e.jsx("div",{style:{display:"grid",gap:8,marginTop:6},children:A.length===0?e.jsxs("div",{style:{color:"#b9bec9",fontSize:14},children:["No ",b.toLowerCase()," yet."]}):A.map(Z=>{var xe,Ae;return e.jsxs("div",{style:{borderTop:"1px solid rgba(255,58,77,0.25)",paddingTop:10,paddingBottom:10},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:4},children:Z.title}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12,marginBottom:6},children:["Host: ",Z.authorUserId]}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap"},children:Z.body}),r==="events"?e.jsxs("div",{style:{display:"grid",gap:8,marginTop:8},children:[e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12},children:["Invited: ",((xe=Z.invitedUserIds)==null?void 0:xe.length)??0," | Accepted: ",((Ae=Z.acceptedUserIds)==null?void 0:Ae.length)??0]}),n.userId&&n.userId===Z.authorUserId?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8},children:[e.jsx("input",{value:y[Z.postingId]??"",onChange:Ne=>p(Le=>({...Le,[Z.postingId]:Ne.target.value})),placeholder:"Invite user id",style:ee()}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void me(Z.postingId),children:"INVITE"})]}):null,n.userType!=="guest"&&n.userId&&Array.isArray(Z.invitedUserIds)&&Z.invitedUserIds.includes(n.userId)?e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:ye(!1),onClick:()=>void ue(Z.postingId,!0),children:"ACCEPT INVITE"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void ue(Z.postingId,!1),children:"DECLINE"})]}):null]}):null]},Z.postingId)})})]})})},O=e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.38)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"CRUISING SPOTS"}),e.jsx("input",{value:z,onChange:r=>N(r.target.value),placeholder:"Spot name",style:ee(),disabled:!1}),e.jsx("input",{value:X,onChange:r=>ae(r.target.value),placeholder:"Spot address",style:ee(),disabled:!1}),e.jsx("textarea",{value:we,onChange:r=>de(r.target.value),placeholder:"Spot description",style:{...ee(),minHeight:80,resize:"vertical"},disabled:!1}),e.jsx("button",{type:"button",style:ye(!1),disabled:!1,onClick:()=>void oe(),children:"CREATE SPOT"}),null,e.jsx("div",{style:{display:"grid",gap:8},children:h.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"No cruising spots yet."}):h.map(r=>e.jsxs("div",{style:{borderTop:"1px solid rgba(255,58,77,0.25)",paddingTop:10,paddingBottom:10},children:[e.jsx("div",{style:{fontWeight:700},children:r.name}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12,marginTop:4},children:["Created by: ",r.creatorUserId]}),e.jsx("div",{style:{color:"#9fb6bf",fontSize:12,marginTop:2},children:r.address}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap",marginTop:6},children:r.description}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:D(!1),onClick:()=>void be(r.spotId),children:"CHECK IN"}),e.jsxs("span",{style:{color:"#9fb6bf",fontSize:12},children:["Checked in: ",r.checkInCount??0]}),e.jsxs("span",{style:{color:"#9fb6bf",fontSize:12},children:["Got action: ",r.actionCount??0]})]})]},r.spotId))})]})});return e.jsx("div",{style:{display:"grid",gap:8,marginInline:o?-10:0},children:o?e.jsxs(e.Fragment,{children:[u==="ads"?c("ads"):null,u==="events"?c("events"):null,u==="spots"?O:null,e.jsx("div",{style:{position:"sticky",bottom:"calc(86px + env(safe-area-inset-bottom, 0px))",zIndex:31,background:"rgba(0,0,0,0.35)",padding:8},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[e.jsx("button",{type:"button",style:u==="ads"?ye(!1):D(!1),onClick:()=>x("ads"),children:"ADS"}),e.jsx("button",{type:"button",style:u==="events"?ye(!1):D(!1),onClick:()=>x("events"),children:"EVENTS"}),e.jsx("button",{type:"button",style:u==="spots"?ye(!1):D(!1),onClick:()=>x("spots"),children:"SPOTS"})]})})]}):e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[c("ads"),c("events"),e.jsx("div",{style:{gridColumn:"1 / -1"},children:O}),n.userType!=="guest"&&le.length>0?e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.25)",gridColumn:"1 / -1",display:"grid",gap:8,padding:10},children:[e.jsx("div",{style:{fontSize:16,fontWeight:700},children:"EVENT INVITES"}),le.map(r=>e.jsxs("div",{style:{display:"grid",gap:6,border:"1px solid rgba(255,58,77,0.4)",borderRadius:10,padding:8},children:[e.jsx("div",{style:{fontWeight:700},children:r.title}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13},children:["Host: ",r.authorUserId]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:ye(!1),onClick:()=>void ue(r.postingId,!0),children:"ACCEPT"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void ue(r.postingId,!1),children:"DECLINE"})]})]},r.postingId))]}):null]})})}function Fn({api:t,session:n,setLastError:o}){const[f,u]=s.useState([]),[x,S]=s.useState(""),[I,P]=s.useState("");async function M(){try{const a=await t.listSubmissions();u([...a.submissions].sort((m,T)=>T.createdAtMs-m.createdAtMs))}catch(a){o($(a))}}s.useEffect(()=>{M()},[]);async function K(){try{await t.createSubmission(n.sessionToken,{title:x,body:I}),S(""),P(""),await M()}catch(a){o($(a))}}async function G(a){try{await t.recordSubmissionView(a),await M()}catch(m){o($(m))}}async function E(a,m){try{await t.rateSubmission(a,m),await M()}catch(T){o($(T))}}const C=n.userType!=="guest";return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("input",{style:ee(),value:x,onChange:a=>S(a.target.value),placeholder:"Story title",disabled:!C}),e.jsx("textarea",{style:{...ee(),minHeight:120},value:I,onChange:a=>P(a.target.value),placeholder:"Write your story",disabled:!C}),e.jsx("button",{type:"button",style:C?ye(!1):D(!0),disabled:!C,onClick:()=>void K(),children:"PUBLISH STORY"}),C?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can read but cannot publish submissions."})]})}),e.jsx("div",{style:{display:"grid",gap:10},children:f.map(a=>{const m=a.ratingCount>0?(a.ratingSum/a.ratingCount).toFixed(2):"0.00";return e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.28)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:a.title}),e.jsx("div",{style:{color:"#ced3dc",whiteSpace:"pre-wrap",marginTop:6},children:a.body}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13,marginTop:8},children:["Views: ",a.viewCount," | Rating: ",m," (",a.ratingCount,")"]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:D(!1),onClick:()=>void G(a.submissionId),children:"VIEW"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void E(a.submissionId,1),children:"â˜…1"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void E(a.submissionId,2),children:"â˜…2"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void E(a.submissionId,3),children:"â˜…3"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void E(a.submissionId,4),children:"â˜…4"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void E(a.submissionId,5),children:"â˜…5"})]})]},a.submissionId)})})]})}function zn({api:t,session:n,setLastError:o}){var le,he,y,p,U,te;const[f,u]=s.useState([]),[x,S]=s.useState({}),[I,P]=s.useState(null),[M,K]=s.useState(2e3),[G,E]=s.useState(""),[C,a]=s.useState(""),[m,T]=s.useState(""),[W,h]=s.useState(""),[k,z]=s.useState("Ready."),N=n.userType!=="guest";async function X(){try{const d=await t.listPromotedProfiles();u([...d.listings].sort((oe,be)=>be.createdAtMs-oe.createdAtMs)),K(d.feeCents);const V=Array.from(new Set(d.listings.map(oe=>oe.userId))).filter(oe=>oe.trim().length>0),me=await Promise.all(V.map(async oe=>{try{const c=(await t.getPublicProfile(oe)).profile.mainPhotoMediaId;if(!c)return null;const O=await t.getPublicMediaUrl(c);return{userId:oe,url:O.downloadUrl}}catch{return null}})),ue={};for(const oe of me)oe&&(ue[oe.userId]=oe.url);S(ue)}catch(d){o($(d))}}s.useEffect(()=>{X()},[]);async function ae(){if(!N){o("Anonymous users cannot create promoted profiles.");return}try{const d=await t.startPromotedPayment(n.sessionToken),V=await t.confirmPromotedPayment(n.sessionToken,d.payment.paymentToken);h(V.payment.paymentToken),z("Payment confirmed. You can now publish one promoted profile.")}catch(d){const V=$(d);z(V),o(V)}}async function we(){if(!N){o("Anonymous users cannot create promoted profiles.");return}try{await t.createPromotedProfile(n.sessionToken,{paymentToken:W,title:G,body:C,displayName:m}),E(""),a(""),T(""),h(""),z("Promoted profile published."),await X()}catch(d){const V=$(d);z(V),o(V)}}async function de(d){try{const V=await t.getPublicProfile(d);P(V.profile)}catch(V){o($(V))}}return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"PROMOTED PROFILES"}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:14},children:["Publishing requires a $",Math.round(M/100)," fee per profile."]}),e.jsx("div",{style:{color:"#26d5ff",fontSize:13},children:k})]})}),e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("input",{value:m,onChange:d=>T(d.target.value),placeholder:"Display name",style:ee(),disabled:!N}),e.jsx("input",{value:G,onChange:d=>E(d.target.value),placeholder:"Headline",style:ee(),disabled:!N}),e.jsx("textarea",{value:C,onChange:d=>a(d.target.value),placeholder:"Profile description",style:{...ee(),minHeight:92,resize:"vertical"},disabled:!N}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsxs("button",{type:"button",style:D(!N),disabled:!N,onClick:()=>void ae(),children:["PAY $",Math.round(M/100)]}),e.jsx("button",{type:"button",style:N?ye(!1):D(!0),disabled:!N,onClick:()=>void we(),children:"PUBLISH PROFILE"})]}),N?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can browse but cannot publish paid profiles."})]})}),e.jsx("div",{style:{display:"grid",gap:10},children:f.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"No promoted profiles yet."}):f.map(d=>e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.25)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"72px 1fr",gap:10,alignItems:"start"},children:[e.jsx("img",{src:x[d.userId]??Be(`user:${d.userId}`),alt:`${d.displayName} profile`,style:{width:72,height:72,borderRadius:6,objectFit:"cover",border:"1px solid rgba(38,213,255,0.9)"}}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:d.title}),e.jsx("div",{style:{color:"#26d5ff",fontSize:13},children:d.displayName}),e.jsx("div",{style:{color:"#ced3dc",whiteSpace:"pre-wrap",fontSize:14},children:d.body}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void de(d.userId),children:"VIEW PROFILE"})]})]})},d.listingId))}),I?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},onClick:()=>P(null),children:e.jsxs("div",{onClick:d=>d.stopPropagation(),style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:12,width:"min(560px, 100%)",background:"rgba(0,0,0,0.88)"},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:I.displayName}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:6},children:["Age: ",I.age]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Race: ",((le=I.stats)==null?void 0:le.race)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Height: ",((he=I.stats)==null?void 0:he.heightInches)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Weight: ",((y=I.stats)==null?void 0:y.weightLbs)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Cock Size: ",((p=I.stats)==null?void 0:p.cockSizeInches)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Cut / Uncut: ",((U=I.stats)==null?void 0:U.cutStatus)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Position: ",((te=I.stats)==null?void 0:te.position)??"-"]}),e.jsx("div",{style:{color:"#ced3dc",marginTop:10,whiteSpace:"pre-wrap"},children:I.bio}),e.jsx("div",{style:{marginTop:10},children:e.jsx("button",{type:"button",style:D(!1),onClick:()=>P(null),children:"CLOSE"})})]})}):null]})}function Un(){return{displayName:"",age:"",bio:"",heightInches:"",race:"",cockSizeInches:"",cutStatus:"",weightLbs:"",position:"",discreetMode:!1,travelEnabled:!1,travelLat:"",travelLng:"",lookingForMore:""}}function $t(t){var n,o,f;return{displayName:t.displayName,age:String(t.age),bio:t.bio,heightInches:t.stats.heightInches!==void 0?String(t.stats.heightInches):"",race:t.stats.race??"",cockSizeInches:t.stats.cockSizeInches!==void 0?String(t.stats.cockSizeInches):"",cutStatus:t.stats.cutStatus??"",weightLbs:t.stats.weightLbs!==void 0?String(t.stats.weightLbs):"",position:t.stats.position??"",discreetMode:t.discreetMode===!0,travelEnabled:((n=t.travelMode)==null?void 0:n.enabled)===!0,travelLat:typeof((o=t.travelMode)==null?void 0:o.lat)=="number"?String(t.travelMode.lat):"",travelLng:typeof((f=t.travelMode)==null?void 0:f.lng)=="number"?String(t.travelMode.lng):"",lookingForMore:t.bio}}function Gt(t){const n=t.trim();if(!n)return;const o=Number(n);return Number.isFinite(o)?Math.trunc(o):void 0}function On(t){const n=t.trim();if(!n)return;const o=Number(n);return Number.isFinite(o)?o:void 0}function Ln({api:t,session:n,setLastError:o}){var le,he;const[f,u]=s.useState(Un()),[x,S]=s.useState(null),[I,P]=s.useState(!1),[M,K]=s.useState(!1),[G,E]=s.useState(null),[C,a]=s.useState({});async function m(){P(!0);try{const y=await t.getMyProfile(n.sessionToken);S(y.profile),u($t(y.profile)),E("Profile loaded.")}catch(y){const p=y;if((p==null?void 0:p.code)==="PROFILE_NOT_FOUND"){S(null),u(U=>({...U,age:U.age||"18"})),E("No profile yet. Fill out the form and save.");return}E($(y))}finally{P(!1)}}s.useEffect(()=>{m()},[n.sessionToken,n.userType]),s.useEffect(()=>{const y=[x==null?void 0:x.mainPhotoMediaId,...(x==null?void 0:x.galleryMediaIds)??[]].filter(U=>typeof U=="string"&&U.length>0);if(y.length===0)return;const p=y.filter(U=>!C[U]);p.length!==0&&Promise.all(p.map(async U=>{try{const te=await t.getPublicMediaUrl(U);return{id:U,url:te.downloadUrl}}catch{return null}})).then(U=>{a(te=>{const d={...te};for(const V of U)V&&(d[V.id]=V.url);return d})})},[t,C,x==null?void 0:x.galleryMediaIds,x==null?void 0:x.mainPhotoMediaId]);async function T(){var y,p,U,te,d;K(!0),o(null);try{const V=Number(f.age),me=f.lookingForMore.trim()?`${f.bio.trim()}

Looking For More: ${f.lookingForMore.trim()}`.trim():f.bio,ue=f.travelLat.trim()?Number(f.travelLat):void 0,oe=f.travelLng.trim()?Number(f.travelLng):void 0,be={displayName:f.displayName,age:Math.trunc(V),bio:me,stats:{heightInches:Gt(f.heightInches),race:f.race.trim()||void 0,cockSizeInches:On(f.cockSizeInches),cutStatus:f.cutStatus||void 0,weightLbs:Gt(f.weightLbs),position:f.position||void 0},discreetMode:f.discreetMode,travelMode:{enabled:f.travelEnabled,lat:Number.isFinite(ue)?ue:void 0,lng:Number.isFinite(oe)?oe:void 0}},c=await t.upsertMyProfile(n.sessionToken,be);S(c.profile),u($t(c.profile));try{localStorage.setItem("reddoor_travel_center",JSON.stringify({enabled:((y=c.profile.travelMode)==null?void 0:y.enabled)===!0,lat:(p=c.profile.travelMode)==null?void 0:p.lat,lng:(U=c.profile.travelMode)==null?void 0:U.lng})),window.dispatchEvent(new CustomEvent("rd:location-updated",{detail:{lat:(te=c.profile.travelMode)==null?void 0:te.lat,lng:(d=c.profile.travelMode)==null?void 0:d.lng}}))}catch{}E("Profile saved.")}catch(V){const me=$(V);E(me),o(me)}finally{K(!1)}}async function W(y,p){if(!p){E("Choose a file first.");return}if(n.userType==="guest"){E("Guest sessions cannot upload media. Register to persist media.");return}K(!0),o(null);try{const U=await t.initiateMediaUpload(n.sessionToken,{kind:y,mimeType:p.type||(y==="video"?"video/mp4":"image/jpeg"),sizeBytes:p.size});if(!await ht(U.uploadUrl,p,p.type||"application/octet-stream")){const d=await fetch(U.uploadUrl,{method:"PUT",headers:{"content-type":p.type||"application/octet-stream"},body:p});if(!d.ok)throw{message:`Upload failed (${d.status}).`}}await t.completeMediaUpload(n.sessionToken,U.mediaId),await m(),E("Media uploaded.")}catch(U){const te=$(U);E(te),o(te)}finally{K(!1)}}const[h,k]=s.useState(null),[z,N]=s.useState(null),[X,ae]=s.useState(null);async function we(y){if(x){K(!0);try{const p=(x.galleryMediaIds??[]).filter(te=>te!==y),U=await t.updateProfileMediaReferences(n.sessionToken,{galleryMediaIds:p});S(U.profile),E("Gallery updated.")}catch(p){const U=$(p);E(U),o(U)}finally{K(!1)}}}async function de(y){if(x){K(!0);try{const p=await t.updateProfileMediaReferences(n.sessionToken,{galleryMediaIds:x.galleryMediaIds,mainPhotoMediaId:y});S(p.profile),E("Main photo updated.")}catch(p){const U=$(p);E(U),o(U)}finally{K(!1)}}}return e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:14},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"SETTINGS / PROFILE"}),n.userType==="guest"?e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guest profile data is temporary for this session and is removed when you log out."}):null,G?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:G}):null,e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Display Name"}),e.jsx("input",{value:f.displayName,onChange:y=>u(p=>({...p,displayName:y.target.value})),style:ee()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Age"}),e.jsx("input",{value:f.age,onChange:y=>u(p=>({...p,age:y.target.value})),style:ee(),inputMode:"numeric"})]})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Bio"}),e.jsx("textarea",{value:f.bio,onChange:y=>u(p=>({...p,bio:y.target.value})),style:{...ee(),minHeight:88,resize:"vertical"}})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Looking For More (Optional)"}),e.jsx("textarea",{value:f.lookingForMore,onChange:y=>u(p=>({...p,lookingForMore:y.target.value})),style:{...ee(),minHeight:72,resize:"vertical"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:f.discreetMode,onChange:y=>u(p=>({...p,discreetMode:y.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0,fontSize:13},children:"Discreet Mode (hide profile from others)"})]}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:f.travelEnabled,onChange:y=>u(p=>({...p,travelEnabled:y.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Travel Mode"})]})]}),f.travelEnabled?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Travel Lat"}),e.jsx("input",{value:f.travelLat,onChange:y=>u(p=>({...p,travelLat:y.target.value})),style:ee()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Travel Lng"}),e.jsx("input",{value:f.travelLng,onChange:y=>u(p=>({...p,travelLng:y.target.value})),style:ee()})]})]}):null,e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Height (in)"}),e.jsx("input",{value:f.heightInches,onChange:y=>u(p=>({...p,heightInches:y.target.value})),style:ee(),inputMode:"numeric"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Race"}),e.jsx("input",{value:f.race,onChange:y=>u(p=>({...p,race:y.target.value})),style:ee()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Cock Size (in)"}),e.jsx("input",{value:f.cockSizeInches,onChange:y=>u(p=>({...p,cockSizeInches:y.target.value})),style:ee(),inputMode:"decimal"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Cut / Uncut"}),e.jsxs("select",{value:f.cutStatus,onChange:y=>u(p=>({...p,cutStatus:y.target.value})),style:ee(),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"cut",children:"Cut"}),e.jsx("option",{value:"uncut",children:"Uncut"})]})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Weight (lbs)"}),e.jsx("input",{value:f.weightLbs,onChange:y=>u(p=>({...p,weightLbs:y.target.value})),style:ee(),inputMode:"numeric"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Position"}),e.jsxs("select",{value:f.position,onChange:y=>u(p=>({...p,position:y.target.value})),style:ee(),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"top",children:"Top"}),e.jsx("option",{value:"bottom",children:"Bottom"}),e.jsx("option",{value:"side",children:"Side"})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",onClick:()=>void T(),style:ye(M),disabled:M,children:"SAVE PROFILE"}),e.jsx("button",{type:"button",onClick:()=>void m(),style:D(I),disabled:I,children:"REFRESH"})]})]})}),e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"MEDIA"}),e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"Main profile photo, gallery photo, and video uploads."}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Main Photo"}),e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:y=>{var p;return k(((p=y.target.files)==null?void 0:p[0])??null)}})]}),e.jsx("button",{type:"button",style:ye(M),disabled:M,onClick:()=>void W("photo_main",h),children:"UPLOAD MAIN PHOTO"})]}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Gallery Photo"}),e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:y=>{var p;return N(((p=y.target.files)==null?void 0:p[0])??null)}})]}),e.jsx("button",{type:"button",style:ye(M),disabled:M,onClick:()=>void W("photo_gallery",z),children:"UPLOAD GALLERY PHOTO"})]}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Video"}),e.jsx("input",{className:"rd-input",type:"file",accept:"video/*",onChange:y=>{var p;return ae(((p=y.target.files)==null?void 0:p[0])??null)}})]}),e.jsx("button",{type:"button",style:ye(M),disabled:M,onClick:()=>void W("video",X),children:"UPLOAD VIDEO"})]}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13},children:["Main photo media id: ",(x==null?void 0:x.mainPhotoMediaId)??"-",e.jsx("br",{}),"Gallery count: ",((le=x==null?void 0:x.galleryMediaIds)==null?void 0:le.length)??0,e.jsx("br",{}),"Video media id: ",(x==null?void 0:x.videoMediaId)??"-"]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"YOUR GALLERY"}),(he=x==null?void 0:x.galleryMediaIds)!=null&&he.length?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(130px, 1fr))",gap:10},children:x.galleryMediaIds.map(y=>e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.45)",borderRadius:10,padding:8,display:"grid",gap:8},children:[e.jsx("img",{src:C[y]??Be(y),alt:"Gallery photo",style:{width:"100%",aspectRatio:"1/1",objectFit:"cover",borderRadius:8,border:"1px solid rgba(255,58,77,0.4)"}}),e.jsx("button",{type:"button",style:D(M),disabled:M,onClick:()=>void de(y),children:"SET MAIN"}),e.jsx("button",{type:"button",style:D(M),disabled:M,onClick:()=>void we(y),children:"REMOVE"})]},y))}):e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No gallery photos uploaded yet."})]})]})})]})}function Kn({api:t,session:n,setLastError:o,onLogout:f}){const[u,x]=s.useState({discreetMode:!1,travelEnabled:!1,travelLat:"",travelLng:""}),[S,I]=s.useState("Loading settings..."),[P,M]=s.useState(!1),[K,G]=s.useState([]);async function E(){var h,k,z;try{const N=await t.getMyProfile(n.sessionToken);if(x({discreetMode:N.profile.discreetMode===!0,travelEnabled:((h=N.profile.travelMode)==null?void 0:h.enabled)===!0,travelLat:typeof((k=N.profile.travelMode)==null?void 0:k.lat)=="number"?String(N.profile.travelMode.lat):"",travelLng:typeof((z=N.profile.travelMode)==null?void 0:z.lng)=="number"?String(N.profile.travelMode.lng):""}),I("Settings loaded."),n.userType!=="guest")try{const X=await t.listBlocked(n.sessionToken);G(X.blocked)}catch{G([])}else G([])}catch(N){I($(N))}}async function C(){try{const h=await fetch("/api/config"),k=await h.json();if(!h.ok)throw k;M(k.mediaStorageConfigured===!0)}catch{M(!1)}}s.useEffect(()=>{E(),C()},[n.sessionToken,n.userType]);async function a(){try{const h=await t.getMyProfile(n.sessionToken),k=u.travelLat.trim()?Number(u.travelLat):void 0,z=u.travelLng.trim()?Number(u.travelLng):void 0;await t.upsertMyProfile(n.sessionToken,{displayName:h.profile.displayName,age:h.profile.age,bio:h.profile.bio,stats:h.profile.stats,discreetMode:u.discreetMode,travelMode:{enabled:u.travelEnabled,lat:Number.isFinite(k)?k:void 0,lng:Number.isFinite(z)?z:void 0}}),I("Privacy settings saved.")}catch(h){const k=$(h);I(k),o(k)}}async function m(){if(!navigator.geolocation){const h="Geolocation is unavailable on this device.";I(h),o(h);return}try{const h=await new Promise((N,X)=>{navigator.geolocation.getCurrentPosition(N,X,{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})}),k=Number(h.coords.latitude.toFixed(6)),z=Number(h.coords.longitude.toFixed(6));x(N=>({...N,travelEnabled:!0,travelLat:String(k),travelLng:String(z)}));try{localStorage.setItem("reddoor_travel_center",JSON.stringify({enabled:!0,lat:k,lng:z}))}catch{}try{await t.updatePresence(n.sessionToken,k,z,"online")}catch{}window.dispatchEvent(new CustomEvent("rd:location-updated",{detail:{lat:k,lng:z}})),I("Actual location detected. Save privacy settings to persist it.")}catch(h){const k=$(h);I(k),o(k)}}async function T(){try{const h=u.travelLat.trim()?Number(u.travelLat):void 0,k=u.travelLng.trim()?Number(u.travelLng):void 0,z=await t.seedFakeUsers(12,Number.isFinite(h)?h:void 0,Number.isFinite(k)?k:void 0);I(`Seeded ${z.seededCount} fake users for testing.`)}catch(h){const k=$(h);I(k),o(k)}}async function W(h){try{await t.unblock(n.sessionToken,h);const k=await t.listBlocked(n.sessionToken);G(k.blocked),I("Blocked users updated.")}catch(k){const z=$(k);I(z),o(z)}}return e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"SETTINGS"}),e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:S}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:u.discreetMode,onChange:h=>x(k=>({...k,discreetMode:h.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Discreet Mode (hide your profile)"})]}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:u.travelEnabled,onChange:h=>x(k=>({...k,travelEnabled:h.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Travel Mode"})]}),u.travelEnabled?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("input",{value:u.travelLat,onChange:h=>x(k=>({...k,travelLat:h.target.value})),style:ee(),placeholder:"Travel lat"}),e.jsx("input",{value:u.travelLng,onChange:h=>x(k=>({...k,travelLng:h.target.value})),style:ee(),placeholder:"Travel lng"})]}):null,e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:ye(!1),onClick:()=>void a(),children:"SAVE PRIVACY"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void m(),children:"DETECT ACTUAL LOCATION"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void T(),children:"SEED FAKE USERS"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>f==null?void 0:f(),children:"LOGOUT"})]})]})}),e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"MEDIA STORAGE"}),e.jsx("div",{style:{color:P?"#26d5ff":"#ff8a95",fontSize:14},children:P?"Configured: uploads enabled.":"Not configured: set S3_BUCKET, S3_REGION, S3_ACCESS_KEY_ID, S3_SECRET_ACCESS_KEY."}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void C(),children:"REFRESH STORAGE STATUS"})]})}),n.userType!=="guest"?e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"BLOCKED USERS"}),K.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No blocked users."}):K.map(h=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[e.jsx("div",{style:{color:"#ced3dc",fontSize:14},children:h}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void W(h),children:"UNBLOCK"})]},h))]})}):null]})}function Dn({api:t,session:n,setSession:o,settings:f,activeTab:u,setActiveTab:x,discoverFilter:S,busy:I,setBusy:P,setLastError:M,onUnreadCountChange:K,hideModeCard:G,onLogout:E}){const C=Mn(),[a,m]=s.useState(null),T=e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx(Ln,{api:t,session:n,setLastError:M}),e.jsx(Kn,{api:t,session:n,setLastError:M,onLogout:E})]});return e.jsxs("div",{style:{display:"grid",gap:12},children:[null,u==="discover"?e.jsx(An,{api:t,session:n,settings:f,discoverFilter:S,busy:I,setBusy:P,setLastError:M,isMobile:C,onOpenThreadRequested:W=>{m({key:Ce(W),nonce:Date.now()}),x("threads")},onUnreadCountChange:K}):null,u==="threads"?e.jsx(Pn,{api:t,session:n,setLastError:M,openThreadRequest:a,onThreadRequestConsumed:()=>m(null),isMobile:C}):null,u==="public"?e.jsx(En,{api:t,session:n,isMobile:C,setLastError:M}):null,u==="profile"||u==="settings"?T:null,u==="submissions"?e.jsx(Fn,{api:t,session:n,setLastError:M}):null,u==="promoted"?e.jsx(zn,{api:t,session:n,setLastError:M}):null]})}export{Dn as Router};
