const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./maplibre-gl-BqoVe-IS-BfVEe9fL-BkJapvDM-HrNkh4On.js","./index-BNcGpZ22.js","./index-Hpa_8JS7.css"])))=>i.map(i=>d[i]);
import{R as s,y as e,b as bt,Y as Bt,X as Gt,Z as qt,j as yi,o as hi,a as vi,_ as mi}from"./index-BNcGpZ22.js";const Jt=(t,i=Jt,a=i.f||(i.f=["./maplibre-gl-BqoVe-IS-BfVEe9fL-BkJapvDM.js","./index-DaSSHGOR.js","./index-D0qkSR-P.css"]))=>t.map(k=>a[k]),Yt=(t,i=Yt,a=i.f||(i.f=["./maplibre-gl-BqoVe-IS-BfVEe9fL.js","./index-BTqTESyK.js","./index-DcVfiC_1.css"]))=>t.map(k=>a[k]),Qt=(t,i=Qt,a=i.f||(i.f=["./maplibre-gl-BqoVe-IS.js","./index-BQvD5UPx.js","./index-D_xfmmRC.css"]))=>t.map(k=>a[k]);function Zt(t){return typeof t=="object"&&t!==null}function bi(t){return!(!Zt(t)||typeof t.key!="string"||t.userType!=="guest"&&t.userType!=="registered"&&t.userType!=="subscriber"||typeof t.lat!="number"||!Number.isFinite(t.lat)||typeof t.lng!="number"||!Number.isFinite(t.lng)||typeof t.updatedAtMs!="number"||!Number.isFinite(t.updatedAtMs)||t.status!==void 0&&typeof t.status!="string")}function Xt(t){const[i,a]=s.useState(()=>new Map),[k,u]=s.useState(null),f=s.useRef(null),b=s.useRef(null);return s.useEffect(()=>{if(t.disabled===!0||t.wsUrl.trim()===""){a(new Map),u(null),b.current!==null&&(window.clearTimeout(b.current),b.current=null);return}let g=!1,F=0,D=null;const J=()=>{D!==null&&(window.clearInterval(D),D=null)},R=()=>{if(g)return;const j=Math.min(8e3,500*2**Math.min(F,4));b.current=window.setTimeout(()=>{b.current=null,U()},j)},U=()=>{if(g)return;let j;try{j=new WebSocket(t.wsUrl)}catch{F+=1,u("Realtime unavailable in this mode."),R();return}f.current=j;let l=!1;j.onopen=()=>{l=!0,F=0,u(null);const p={};t.sessionToken&&(p.sessionToken=t.sessionToken),t.jwt&&(p.jwt=t.jwt),j.send(JSON.stringify({type:"auth",payload:p})),D=window.setInterval(()=>{j.readyState===j.OPEN&&j.send(JSON.stringify({type:"heartbeat",payload:{}}))},15e3)},j.onmessage=p=>{const z=(()=>{try{return JSON.parse(String(p.data))}catch{return null}})();if(!z||typeof z.type!="string"){u("Invalid server message.");return}if(z.type==="error"&&Zt(z.payload)&&typeof z.payload.message=="string"){u(z.payload.message);return}if(z.type==="presence_update"){const O=z.payload;if(!bi(O)){u("Invalid presence payload.");return}a(v=>{const w=new Map(v);return w.set(O.key,O),w})}},j.onerror=()=>{},j.onclose=p=>{if(J(),!g&&p.code!==1e3){F+=1;const z=typeof p.reason=="string"&&p.reason.trim()!==""?` Reason: ${p.reason}`:"";(F>=2||l)&&u(`Realtime ${l?"disconnected":"failed to connect"} (code ${p.code}). Reconnecting...${z}`),R()}}};return U(),()=>{var j;g=!0,J(),b.current!==null&&(window.clearTimeout(b.current),b.current=null),(j=f.current)==null||j.close(1e3,"Client cleanup"),f.current=null}},[t.disabled,t.jwt,t.sessionToken,t.wsUrl]),{state:s.useMemo(()=>({byKey:i}),[i]),lastErrorMessage:k}}async function xi(){const t=await yi(()=>hi(()=>vi(()=>mi(()=>import("./maplibre-gl-BqoVe-IS-BfVEe9fL-BkJapvDM-HrNkh4On.js"),__vite__mapDeps([0,1,2]),import.meta.url),Jt([0,1,2]),import.meta.url),Yt([0,1,2]),import.meta.url).then(i=>i.m),Qt([0,1,2]),import.meta.url);return t.default??t}function ji(t){return t.replace(/[&<>"']/g,i=>{switch(i){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return i}})}function wi(){return{version:8,sources:{basemap:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png","https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"Â© OpenStreetMap contributors"}},layers:[{id:"basemap",type:"raster",source:"basemap"}]}}function ki(t){const i=document.createElement("button");return i.type="button",i.setAttribute("aria-label",t.label??"Presence marker"),i.style.width="40px",i.style.height="40px",i.style.borderRadius="999px",i.style.border=`2px solid ${t.color}`,i.style.touchAction="manipulation",i.style.userSelect="none",t.markerType==="spot"?(i.style.background="radial-gradient(circle at 30% 30%, #ff4f60, #a70013)",i.style.display="grid",i.style.placeItems="center",i.style.color="#ffffff",i.style.fontWeight="700",i.style.fontSize="13px",i.textContent=typeof t.markerGlyph=="string"&&t.markerGlyph.trim()?t.markerGlyph.trim().slice(0,2):"SP"):typeof t.imageUrl=="string"&&t.imageUrl.trim()!==""?(i.style.backgroundImage=`url("${t.imageUrl}")`,i.style.backgroundSize="cover",i.style.backgroundPosition="center"):i.style.background="#000000",i.style.padding="0",i.style.cursor=typeof t.onClick=="function"?"pointer":"default",i.style.pointerEvents="auto",i}function Si({initialView:t,markers:i,interactive:a,visible:k}){const u=s.useRef(null),f=s.useRef(null),b=s.useRef(null),g=s.useRef([]),[F,D]=s.useState({kind:"ready"}),J=s.useMemo(()=>t.center,[t.center]),R=a!==!1,U=k!==!1;return s.useEffect(()=>{let j=!1,l=null,p=null,z=null;async function O(){if(u.current&&!b.current)try{f.current||(f.current=await xi());const v=f.current,w=new v.Map({container:u.current,style:wi(),center:[J.lng,J.lat],zoom:t.zoom,interactive:R});w.addControl(new v.NavigationControl({showCompass:!1}),"top-right"),b.current=w;const C=()=>{w.resize()};p=C,z=window.requestAnimationFrame(C),window.addEventListener("resize",C),l=new ResizeObserver(()=>C()),l.observe(u.current),w.on("error",L=>{var _;const ae=((_=L.error)==null?void 0:_.message)??"Map error.";j||ae.toLowerCase().includes("failed to fetch")||ae.toLowerCase().includes("network")||D({kind:"error",message:ae})}),w.once("load",()=>{j||D({kind:"ready"})})}catch(v){if(j)return;D({kind:"error",message:v instanceof Error?v.message:"Map error."})}}return O(),()=>{var v;j=!0,z!==null&&window.cancelAnimationFrame(z),p&&window.removeEventListener("resize",p),l==null||l.disconnect();for(const w of g.current)w.remove();g.current=[],(v=b.current)==null||v.remove(),b.current=null}},[R]),s.useEffect(()=>{const j=b.current;if(!j||!U)return;j.resize();const l=window.setTimeout(()=>{j.resize(),j.setCenter([t.center.lng,t.center.lat]),j.setZoom(t.zoom)},80);return()=>window.clearTimeout(l)},[t.center.lat,t.center.lng,t.zoom,U]),s.useEffect(()=>{const j=b.current;if(!j||!U)return;j.resize();const l=window.setTimeout(()=>j.resize(),120);return()=>window.clearTimeout(l)},[U]),s.useEffect(()=>{const j=b.current,l=f.current;if(!(!j||!l)){for(const p of g.current)p.remove();g.current=[];for(const p of i){const z=typeof p.label=="string"&&p.label.trim()!==""?new l.Popup({closeButton:!1,closeOnClick:!0}).setHTML(`<div style="font-family: var(--ui); font-size: 12px; line-height: 1.35;">
                 <div style="font-weight: 600;">${ji(p.label)}</div>
               </div>`):void 0,O=ki(p);if(typeof p.onClick=="function"){const w=C=>{var L;C.preventDefault(),C.stopPropagation(),(L=p.onClick)==null||L.call(p)};O.addEventListener("click",w),O.addEventListener("touchend",w,{passive:!1}),O.addEventListener("pointerup",w)}const v=new l.Marker({element:O}).setLngLat([p.position.lng,p.position.lat]);z&&v.setPopup(z),v.addTo(j),g.current.push(v)}}},[i]),F.kind==="error"?e.jsxs("div",{style:{background:"#000000",color:"#F22F2F",border:"2px solid #C00000",borderRadius:8,padding:12,fontFamily:"var(--ui)",fontSize:14,lineHeight:1.4},role:"alert","aria-live":"polite",children:["Map error: ",F.message]}):e.jsx("div",{ref:u,className:"rd-maplibre",style:{width:"100%",height:"100%",background:"#000000",borderRadius:8,overflow:"hidden"},"aria-label":"Cruise map"})}const Wt=[Bt,Gt,qt];function Ii(t){let i=0;for(let a=0;a<t.length;a+=1)i=i*31+t.charCodeAt(a)|0;return Math.abs(i)}function Ci(t){return Wt[Ii(t)%Wt.length]}function Ti(t,i,a){return t.map(k=>({id:k.key,position:{lat:k.lat,lng:k.lng},color:"#C00000",label:k.status?`Presence: ${k.status}`:"Presence",imageUrl:(i==null?void 0:i[k.key])??Ci(k.key),onClick:a?()=>a(k.key):void 0}))}function Kt({wsUrl:t,sessionToken:i,jwt:a,defaultCenter:k,defaultZoom:u,presenceUpdates:f,realtimeErrorMessage:b,onMarkerSelect:g,avatarByKey:F,additionalMarkers:D,height:J,visible:R}){const U=Xt({wsUrl:t,sessionToken:i,jwt:a,disabled:Array.isArray(f)}),j=f?{byKey:new Map(f.map(L=>[L.key,L]))}:U.state,l=b??U.lastErrorMessage,[p,z]=s.useState({kind:"pending"});s.useEffect(()=>{if(!("geolocation"in navigator)||!navigator.geolocation){z({kind:"unavailable"});return}navigator.geolocation.getCurrentPosition(L=>{z({kind:"granted",center:{lat:L.coords.latitude,lng:L.coords.longitude}})},L=>{if(L.code===L.PERMISSION_DENIED){z({kind:"denied"});return}if(L.code===L.TIMEOUT){z({kind:"error",message:"Timed out while trying to read your location. Showing the default map view."});return}z({kind:"error",message:L.message||"Geolocation error."})},{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e4})},[]);const O=s.useMemo(()=>Array.from(j.byKey.values()),[j.byKey]),v=s.useMemo(()=>[...Ti(O,F,g),...D??[]],[D,F,g,O]),w=s.useMemo(()=>{const L=typeof u=="number"&&Number.isFinite(u)?u:13;return p.kind==="granted"?{center:p.center,zoom:L}:{center:k,zoom:L}},[k,u,p]),C=s.useMemo(()=>p.kind==="denied"?"Location permission denied. Showing the default map view.":p.kind==="unavailable"?"Geolocation is unavailable. Showing the default map view.":p.kind==="error"?`Geolocation error: ${p.message}`:null,[p]);return e.jsxs("section",{"aria-label":"Cruise mode map",style:{background:"#000000",color:"#FFFFFF",fontFamily:"var(--ui)",display:"grid",gap:8,height:"100%"},children:[C?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"rgba(0,0,0,0.7)",border:"1px solid rgba(255,58,77,0.45)",borderRadius:0,padding:8,color:"#AAAAAA",fontSize:12,lineHeight:1.4},children:C}):null,l?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"rgba(0,0,0,0.7)",border:"1px solid rgba(255,58,77,0.45)",borderRadius:0,padding:8,color:"#F22F2F",fontSize:12,lineHeight:1.4},children:l}):null,e.jsx("div",{style:{background:"#111111",border:0,borderRadius:0,overflow:"hidden",height:typeof J=="number"||typeof J=="string"?J:520},children:e.jsx(Si,{initialView:w,markers:v,visible:R})})]})}const Mi="FIRE_SIGNAL|1";function Ei(t){return new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function Dt(t){if(!t.startsWith("LOCATION|"))return null;const[,i,a]=t.split("|"),k=Number(i),u=Number(a);return!Number.isFinite(k)||!Number.isFinite(u)?null:{lat:k,lng:u,link:`https://maps.google.com/?q=${k},${u}`}}function Ni(t){return t.trim()===Mi?"ðŸ”¥ I'm into you":t}function ei({chatKind:t,peerKey:i,currentUserKey:a,messages:k,client:u,title:f,peerSummary:b,thirdParty:g,edgeToEdge:F,showHeader:D,fillHeight:J}){const[R,U]=s.useState(""),[j,l]=s.useState(null),[p,z]=s.useState(!1),[O,v]=s.useState({}),[w,C]=s.useState(!1),[L,_]=s.useState(!1),ae=s.useRef(null),q=s.useRef([]),me=s.useRef(null),ue=s.useRef(null),oe=s.useRef(null),y=F===!0,S=D!==!1,N=y&&J===!0,Z=s.useMemo(()=>[...k].sort((c,V)=>c.createdAtMs-V.createdAtMs),[k]),M=s.useMemo(()=>Array.from(new Set(Z.map(c=>{var V;return(V=c.media)==null?void 0:V.objectKey}).filter(c=>typeof c=="string"&&c.trim().length>0))),[Z]);s.useEffect(()=>{let c=!1;async function V(){for(const r of M){if(c)return;if(!O[r])try{const m=await u.getMediaUrl(r);if(c)return;v(E=>({...E,[r]:m}))}catch{}}}return V(),()=>{c=!0}},[u,M,O]);async function X(c){const V=R.trim();if(!(V.length===0&&!c)){z(!0),l(null);try{await u.sendMessage(t,i,V,c),U("")}catch(r){const m=r;l(typeof(m==null?void 0:m.message)=="string"?m.message:"Message rejected.")}finally{z(!1)}}}async function pe(c){z(!0),l(null);try{const V=await u.initiateMediaUpload(c.type||"application/octet-stream",c.size);await u.uploadToSignedUrl(V.uploadUrl,c,c.type||"application/octet-stream");const r={kind:c.type.startsWith("image/")?"image":c.type.startsWith("video/")?"video":"audio",objectKey:V.objectKey,mimeType:c.type||"application/octet-stream"};await X(r)}catch(V){const r=V;l(typeof(r==null?void 0:r.message)=="string"?r.message:"Upload rejected."),z(!1)}}async function le(c){var V;const r=(V=c.target.files)==null?void 0:V[0];if(c.target.value="",!!r){if(!r.type.startsWith("image/")&&!r.type.startsWith("video/")&&!r.type.startsWith("audio/")){l("Only image, video, or audio files are supported.");return}await pe(r)}}async function ie(){var c;if(w){(c=ae.current)==null||c.stop();return}if(!navigator.mediaDevices||typeof navigator.mediaDevices.getUserMedia!="function"){l("Microphone is not available in this browser.");return}try{const V=await navigator.mediaDevices.getUserMedia({audio:!0}),r=new MediaRecorder(V);q.current=[],ae.current=r,r.ondataavailable=m=>{m.data.size>0&&q.current.push(m.data)},r.onstop=()=>{const m=new Blob(q.current,{type:r.mimeType||"audio/webm"}),E=new File([m],`voice-${Date.now()}.webm`,{type:r.mimeType||"audio/webm"});pe(E);for(const de of V.getTracks())de.stop();ae.current=null,C(!1)},r.start(),C(!0)}catch(V){const r=V;l(typeof(r==null?void 0:r.message)=="string"?r.message:"Unable to record voice."),C(!1)}}async function be(){if(!navigator.geolocation){l("Geolocation is not available in this browser.");return}z(!0),l(null);try{const c=await new Promise((E,de)=>{navigator.geolocation.getCurrentPosition(E,de,{enableHighAccuracy:!1,timeout:12e3,maximumAge:3e4})}),V=Number(c.coords.latitude.toFixed(5)),r=Number(c.coords.longitude.toFixed(5)),m=`LOCATION|${V}|${r}`;await u.sendMessage(t,i,m)}catch(c){const V=c;l(typeof(V==null?void 0:V.message)=="string"?V.message:"Unable to send location.")}finally{z(!1)}}return e.jsxs("section",{"aria-label":"Chat",style:{background:y?"transparent":"#000000",color:"#FFFFFF",fontFamily:"Montserrat, sans-serif",padding:y?0:16,display:"grid",gap:y?0:12,gridTemplateRows:S?"auto auto 1fr auto":"1fr auto",minHeight:J?"calc(100dvh - 196px)":void 0},children:[S?e.jsxs("header",{style:{height:56,display:"grid",alignItems:"center",background:"#000000"},children:[e.jsx("div",{style:{textAlign:"center",fontSize:20,fontWeight:600},children:f}),b?e.jsxs("div",{style:{marginTop:4,display:"flex",alignItems:"center",justifyContent:"center",gap:8,color:"#b7d8e0",fontSize:13},children:[e.jsx("span",{children:"Chat with:"}),b.avatarUrl?e.jsx("img",{src:b.avatarUrl,alt:`${b.displayName} avatar`,style:{width:24,height:24,borderRadius:"50%",objectFit:"cover",border:"1px solid rgba(38,213,255,0.8)"}}):e.jsx("span",{"aria-hidden":!0,style:{width:24,height:24,borderRadius:"50%",border:"1px solid rgba(38,213,255,0.8)",background:"rgba(255,255,255,0.08)"}}),e.jsx("span",{style:{color:"#fff",fontWeight:600},children:b.displayName})]}):null,e.jsx("div",{style:{textAlign:"center",fontSize:12,color:"#AAAAAA"},children:t==="cruise"?"CRUISE CHAT (EPHEMERAL)":"DATE CHAT (PERSISTENT)"})]}):null,j?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"#111111",border:"2px solid #C00000",borderRadius:8,padding:12,color:"#F22F2F",fontSize:14,lineHeight:1.4},children:j}):null,e.jsx("div",{"aria-label":"Messages",style:{background:y?"#09090b":"#111111",border:y?"none":"2px solid #C00000",borderRadius:y?0:8,padding:12,display:"flex",flexDirection:"column",gap:12,minHeight:y?0:320,paddingBottom:N?148:12,overflowY:"auto"},children:Z.length===0?e.jsx("div",{style:{color:"#AAAAAA",fontSize:14,lineHeight:1.4},children:"No messages."}):Z.map(c=>{const V=c.fromKey===a,r=V?"#C00000":"#444444",m=V?{alignItems:"flex-end"}:{alignItems:"flex-start"};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,width:"100%",...m},children:[(()=>{const E=Dt(c.text??"");return E?e.jsxs("a",{href:E.link,target:"_blank",rel:"noreferrer",style:{display:"grid",gap:6,textDecoration:"none",color:"#fff",background:r,borderRadius:14,padding:8,width:"auto",maxWidth:"80%"},children:[e.jsx("div",{style:{fontSize:12,color:"#d8ecff"},children:"Shared location"}),e.jsx("iframe",{title:"Google Maps location preview",src:`https://www.google.com/maps?q=${E.lat},${E.lng}&z=14&output=embed`,style:{width:"100%",height:140,border:"1px solid rgba(255,255,255,0.18)",borderRadius:10},loading:"lazy",referrerPolicy:"no-referrer-when-downgrade"}),e.jsx("div",{style:{fontSize:12,color:"#3fdfff"},children:"Open in Google Maps"})]}):null})(),e.jsxs("div",{style:{background:r,color:"#FFFFFF",borderRadius:18,padding:"8px 12px",width:"auto",maxWidth:"80%",fontSize:16,lineHeight:1.4,whiteSpace:"pre-wrap",overflowWrap:"anywhere",wordBreak:"break-word"},children:[c.text&&!Dt(c.text)?e.jsx("div",{style:{marginBottom:c.media?8:0},children:Ni(c.text)}):null,c.media?e.jsxs("div",{children:[c.media.kind==="image"?e.jsx("img",{src:O[c.media.objectKey],alt:"Shared",style:{width:"100%",maxWidth:260,borderRadius:10,border:"1px solid rgba(255,255,255,0.18)"}}):null,c.media.kind==="video"?e.jsx("video",{controls:!0,playsInline:!0,src:O[c.media.objectKey],style:{width:"100%",maxWidth:320,borderRadius:10,background:"#000"}}):null,c.media.kind==="audio"?e.jsx("audio",{controls:!0,src:O[c.media.objectKey],style:{width:"100%",maxWidth:260}}):null]}):null]}),e.jsx("div",{style:{fontSize:10,color:"#AAAAAA"},children:Ei(c.createdAtMs)}),V?e.jsx("div",{style:{fontSize:10,color:"#6fdcff"},children:typeof c.readAtMs=="number"?"Read":typeof c.deliveredAtMs=="number"?"Delivered":""}):null]},c.messageId)})}),e.jsxs("form",{onSubmit:c=>{c.preventDefault(),X()},"aria-label":"Message input",style:{background:y?"linear-gradient(180deg, rgba(96,0,12,0.96), rgba(58,0,8,0.98))":"#111111",border:y?"none":"2px solid #C00000",borderRadius:y?0:8,padding:12,display:"grid",gridTemplateColumns:"1fr auto auto",gap:12,alignItems:"start",position:N?"fixed":"static",left:N?0:void 0,right:N?0:void 0,bottom:N?"calc(env(safe-area-inset-bottom, 0px) + 66px)":void 0,zIndex:N?45:void 0},children:[e.jsx("label",{style:{display:"grid"},children:e.jsx("input",{value:R,onChange:c=>U(c.target.value),placeholder:"Type a message",disabled:p,style:{width:"100%",background:"#111111",color:"#FFFFFF",border:"2px solid #444444",borderRadius:8,padding:"10px 12px",fontSize:16,lineHeight:1.4,outline:"none"},"aria-label":"Message text"})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{ref:me,type:"file",accept:"image/*,video/*,audio/*",disabled:p,onChange:c=>void le(c),style:{display:"none"}}),e.jsx("input",{ref:ue,type:"file",accept:"image/*",capture:"environment",disabled:p,onChange:c=>void le(c),style:{display:"none"}}),e.jsx("input",{ref:oe,type:"file",accept:"video/*",capture:"environment",disabled:p,onChange:c=>void le(c),style:{display:"none"}}),e.jsx("button",{type:"button",disabled:p,onClick:()=>_(c=>!c),style:{background:"rgba(0,0,0,0.45)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px",display:"grid",placeItems:"center",cursor:p?"not-allowed":"pointer",color:"#3fdfff",fontWeight:700,height:44,minWidth:44},"aria-label":"More actions",children:"+"}),L?e.jsxs("div",{style:{position:"absolute",right:0,top:N?void 0:48,bottom:N?48:void 0,zIndex:5,minWidth:220,display:"grid",gap:8,padding:10,borderRadius:10,border:"1px solid rgba(255,58,77,0.5)",background:"rgba(10,11,16,0.98)"},children:[e.jsx("button",{type:"button",disabled:p,onClick:()=>{var c;_(!1),(c=ue.current)==null||c.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Take Photo"}),e.jsx("button",{type:"button",disabled:p,onClick:()=>{var c;_(!1),(c=oe.current)==null||c.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Record Video"}),e.jsx("button",{type:"button",disabled:p,onClick:()=>{var c;_(!1),(c=me.current)==null||c.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Choose Media"}),e.jsx("button",{type:"button",disabled:p,onClick:()=>{_(!1),ie()},style:{background:w?"#ff2136":"rgba(0,0,0,0.6)",color:"#fff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:w?"Stop Voice":"Record Voice"}),e.jsx("button",{type:"button",disabled:p,onClick:()=>{_(!1),be()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Send Location"}),g?e.jsxs("div",{style:{display:"grid",gap:8,borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:8},children:[e.jsxs("select",{value:g.selectedKey,onChange:c=>g.onSelect(c.target.value),disabled:g.disabled||g.candidates.length===0,style:{background:"#0b0d12",color:"#fff",border:"1px solid rgba(255,58,77,0.62)",borderRadius:10,padding:"8px 10px"},"aria-label":"Add previous contact to group",children:[g.candidates.length===0?e.jsx("option",{value:"",children:"No previous contacts"}):null,g.candidates.map(c=>e.jsx("option",{value:c.key,children:c.label},c.key))]}),e.jsx("button",{type:"button",onClick:()=>{g.onAdd(),_(!1)},disabled:g.disabled||g.candidates.length===0||!g.selectedKey,style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,58,77,0.62)",borderRadius:10,padding:"8px 10px",fontWeight:700},children:"Add Third User"})]}):null]}):null]}),e.jsx("button",{type:"submit",disabled:p,style:{background:p?"#333333":"#C00000",color:p?"#777777":"#FFFFFF",border:"2px solid #C00000",borderRadius:8,padding:"10px 20px",fontSize:16,fontWeight:600,cursor:p?"not-allowed":"pointer",height:44},"aria-label":"Send message",children:"SEND"})]})]})}const xt="FIRE_SIGNAL|1";function Re(){return{background:"radial-gradient(500px 220px at 10% 0%, rgba(255,28,46,0.15), transparent 58%), linear-gradient(180deg, rgba(8,8,10,0.88), rgba(4,4,5,0.9))",border:"1px solid rgba(255,56,74,0.56)",borderRadius:20,padding:14,boxShadow:"inset 0 1px 0 rgba(255,255,255,0.06), inset 0 0 0 1px rgba(0,0,0,0.28), 0 16px 32px rgba(0,0,0,0.42)"}}function ve(t){return{background:t?"rgba(90,90,90,0.55)":"linear-gradient(180deg, #ff2136, #c60012)",border:"1px solid rgba(255,70,90,0.68)",color:t?"#999999":"#FFFFFF",padding:"10px 18px",borderRadius:12,fontSize:15,fontWeight:700,letterSpacing:"0.04em",cursor:t?"not-allowed":"pointer",textTransform:"uppercase",boxShadow:t?"none":"inset 0 1px 0 rgba(255,255,255,0.2), 0 10px 22px rgba(198,0,18,0.34)"}}function H(t){return{background:"rgba(0,0,0,0.58)",border:"1px solid rgba(255,58,77,0.62)",color:"#3fdfff",padding:"10px 18px",borderRadius:12,fontSize:15,fontWeight:700,letterSpacing:"0.03em",cursor:t?"not-allowed":"pointer",textTransform:"uppercase",opacity:t?.6:1}}function Q(){return{background:"rgba(6,7,10,0.92)",color:"#ffffff",border:"1px solid rgba(255,64,82,0.48)",borderRadius:12,padding:"10px 12px",fontSize:15}}function Pi(t){return typeof t=="string"}function G(t){const i=t;return Pi(i==null?void 0:i.message)?i.message:"Action rejected."}function ft(){const t="__disabled__".trim();if(t==="__disabled__")return"";if(t!==""){if(t.startsWith("ws://")||t.startsWith("wss://"))return t;try{const a=new URL(t);return a.protocol=a.protocol==="https:"?"wss:":"ws:",a.toString()}catch{if(t.startsWith("/")){const a=new URL(t,window.location.origin);return a.protocol=a.protocol==="https:"?"wss:":"ws:",a.toString()}}}const i=new URL("/ws",window.location.origin);return i.protocol=i.protocol==="https:"?"wss:":"ws:",i.toString()}const _t=[Bt,Gt,qt];function Ai(t){let i=0;for(let a=0;a<t.length;a+=1)i=i*31+t.charCodeAt(a)|0;return Math.abs(i)}function He(t){return _t[Ai(t)%_t.length]}function mt(t){if(t.startsWith("user:")){const i=t.slice(5).trim();return i.length>0?i:null}if(t.startsWith("session:")){const i=t.slice(8).trim();return i.length>0?`guest:${i}`:null}return null}function Le(t){if(t.startsWith("guest:")){const i=t.slice(6).trim();return i?`session:${i}`:`user:${t}`}return`user:${t}`}function Te(t){const i=t.trim();if(!i)return i;if(i.startsWith("user:guest:")){const a=i.slice(11).trim();return a?`session:${a}`:i}if(i.startsWith("guest:")){const a=i.slice(6).trim();return a?`session:${a}`:i}return i}function Ri(t){return t.trim()===xt}function ti(t){return Ri(t)?"ðŸ”¥ I'm into you":t}function yt(t,i){const a=F=>F*Math.PI/180,k=a(i.lat-t.lat),u=a(i.lng-t.lng),f=Math.sin(k/2),b=Math.sin(u/2),g=f*f+Math.cos(a(t.lat))*Math.cos(a(i.lat))*b*b;return 6371e3*(2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g)))}function Ui(t){return!Number.isFinite(t)||t<0?"-":t<1e3?`${Math.round(t)} m`:t<1e4?`${(t/1e3).toFixed(1)} km`:`${Math.round(t/1e3)} km`}function $t(){try{const t=localStorage.getItem("reddoor_travel_center");if(!t)return null;const i=JSON.parse(t);return i.enabled!==!0?null:typeof i.lat=="number"&&Number.isFinite(i.lat)&&typeof i.lng=="number"&&Number.isFinite(i.lng)?{lat:i.lat,lng:i.lng}:null}catch{return null}}function zi(){const[t,i]=s.useState(()=>window.matchMedia("(max-width: 900px)").matches);return s.useEffect(()=>{const a=window.matchMedia("(max-width: 900px)"),k=()=>i(a.matches);return k(),a.addEventListener("change",k),()=>a.removeEventListener("change",k)},[]),t}function tt(t){return t==="instant"?"cruise":"date"}function Li({api:t,session:i,settings:a,discoverFilter:k,busy:u,setBusy:f,setLastError:b,isMobile:g,discoverScreen:F,onDiscoverScreenChange:D,onOpenThreadRequested:J,onUnreadCountChange:R}){var U,j,l,p,z,O;const[v,w]=s.useState(F),[C,L]=s.useState(null),[_,ae]=s.useState(null),[q,me]=s.useState(null),[ue,oe]=s.useState([]),[y,S]=s.useState({}),[N,Z]=s.useState([]),[M,X]=s.useState(new Set),[pe,le]=s.useState(new Set),[ie,be]=s.useState({}),[c,V]=s.useState({}),[r,m]=s.useState(null),[E,de]=s.useState(0),[xe,we]=s.useState(!1),[Ie,je]=s.useState([]),[ce,ne]=s.useState(null),[he,Ae]=s.useState(()=>$t()),{state:Pe,lastErrorMessage:Fe}=Xt({wsUrl:ft(),sessionToken:i.sessionToken}),Ke=s.useMemo(()=>Array.from(Pe.byKey.values()),[Pe.byKey]);s.useEffect(()=>{w(F)},[F]),s.useEffect(()=>{const d=()=>{Ae($t())},h=I=>{(I.key===null||I.key==="reddoor_travel_center")&&d()};return d(),window.addEventListener("rd:location-updated",d),window.addEventListener("storage",h),()=>{window.removeEventListener("rd:location-updated",d),window.removeEventListener("storage",h)}},[]);const W=i.userId?`user:${i.userId}`:`session:${i.sessionToken}`,ye=s.useMemo(()=>{const d=new Map;for(const h of ue)d.set(h.key,h);for(const h of Ke){const I=d.get(h.key);(!I||h.updatedAtMs>=I.updatedAtMs)&&d.set(h.key,h)}return Array.from(d.values())},[Ke,ue]),Me=s.useMemo(()=>ye.filter(d=>d.key!==W),[W,ye]),ke=s.useMemo(()=>q?[...Me].sort((d,h)=>yt(q,{lat:d.lat,lng:d.lng})-yt(q,{lat:h.lat,lng:h.lng})):Me,[Me,q]),Oe=s.useMemo(()=>{if(!_)return null;if(_===W)return"0 m";if(!q)return null;const d=ye.find(h=>h.key===_);return d?Ui(yt(q,{lat:d.lat,lng:d.lng})):null},[W,ye,_,q]);s.useEffect(()=>{let d=!1;async function h(){try{const B=await t.listActivePresence(i.sessionToken);if(d)return;const ee=Array.isArray(B.presence)?B.presence:[];oe(ee)}catch{d||oe([])}}h();const I=window.setInterval(()=>{h()},8e3);return()=>{d=!0,window.clearInterval(I)}},[t,i.sessionToken]),s.useEffect(()=>{C||ke.length>0&&L(ke[0].key)},[C,ke]),s.useEffect(()=>{const d=ke.filter(h=>!y[h.key]).map(h=>({key:h.key,profileId:mt(h.key)})).filter(h=>typeof h.profileId=="string");d.length!==0&&Promise.all(d.map(async h=>{var I,B;try{const ee=await t.getPublicProfile(h.profileId);return{key:h.key,displayName:(I=ee.profile)==null?void 0:I.displayName,age:(B=ee.profile)==null?void 0:B.age}}catch{return null}})).then(h=>{S(I=>{const B={...I};for(const ee of h)ee&&(B[ee.key]={displayName:ee.displayName,age:ee.age});return B})})},[t,y,ke]),s.useEffect(()=>{(async()=>{try{let d=await t.getPublicProfiles();if(d.profiles.length===0&&!xe){we(!0);try{const h=q??he??{lat:a.defaultCenterLat,lng:a.defaultCenterLng};await t.seedFakeUsers(12,h.lat,h.lng),d=await t.getPublicProfiles()}catch{}}Z(d.profiles)}catch{Z([])}if(i.userType==="guest"){X(new Set),le(new Set);return}try{const d=await t.getFavorites(i.sessionToken);X(new Set(d.favorites))}catch{X(new Set)}try{const d=await t.listBlocked(i.sessionToken);le(new Set(d.blocked))}catch{le(new Set)}})()},[t,xe,q,i.sessionToken,i.userType,a.defaultCenterLat,a.defaultCenterLng,he]),s.useEffect(()=>{let d=!1;async function h(){try{const B=await t.listCruisingSpots();d||je(B.spots)}catch{d||je([])}}h();const I=window.setInterval(()=>{h()},12e3);return()=>{d=!0,window.clearInterval(I)}},[t]),s.useEffect(()=>{const d=Date.now(),h=N.flatMap(I=>{const B=[];return I.mainPhotoMediaId&&B.push(I.mainPhotoMediaId),Array.isArray(I.galleryMediaIds)&&B.push(...I.galleryMediaIds),I.videoMediaId&&B.push(I.videoMediaId),B}).filter(I=>typeof I=="string"&&I.length>0&&!ie[I]&&d>=(c[I]??0)).slice(0,6);h.length!==0&&Promise.all(h.map(async I=>{try{const B=await t.getPublicMediaUrl(I);return{mediaId:I,url:B.downloadUrl}}catch{return null}})).then(I=>{be(B=>{const ee={...B};for(const te of I)te&&(ee[te.mediaId]=te.url);return ee}),V(B=>{const ee={...B};for(let te=0;te<h.length;te+=1){const fe=h[te];I[te]?ee[fe]&&delete ee[fe]:ee[fe]=Date.now()+3e4}return ee})})},[t,c,ie,N]);async function Se(d){ae(d),de(0);const h=mt(d);if(!h){m(null);return}try{if(d===W){const I=await t.getMyProfile(i.sessionToken);typeof I.profile.mainPhotoMediaId=="string"&&I.profile.mainPhotoMediaId;const B=[I.profile.mainPhotoMediaId,...I.profile.galleryMediaIds??[],I.profile.videoMediaId].filter(ee=>typeof ee=="string"&&ee.length>0);if(B.length>0){const ee=await Promise.all(B.map(async te=>{try{const fe=await t.getPublicMediaUrl(te);return{mediaId:te,downloadUrl:fe.downloadUrl}}catch{return null}}));be(te=>{const fe={...te};for(const Ce of ee)Ce&&(fe[Ce.mediaId]=Ce.downloadUrl);return fe})}m({userId:I.profile.userId,displayName:I.profile.displayName,age:I.profile.age,bio:I.profile.bio,stats:I.profile.stats,discreetMode:I.profile.discreetMode,mainPhotoMediaId:I.profile.mainPhotoMediaId,galleryMediaIds:I.profile.galleryMediaIds,videoMediaId:I.profile.videoMediaId})}else{const I=await t.getPublicProfile(h),B=[I.profile.mainPhotoMediaId,...I.profile.galleryMediaIds??[],I.profile.videoMediaId].filter(ee=>typeof ee=="string"&&ee.length>0);if(B.length>0){const ee=await Promise.all(B.map(async te=>{try{const fe=await t.getPublicMediaUrl(te);return{mediaId:te,downloadUrl:fe.downloadUrl}}catch{return null}}));be(te=>{const fe={...te};for(const Ce of ee)Ce&&(fe[Ce.mediaId]=Ce.downloadUrl);return fe})}m(I.profile)}}catch(I){const B=I;if((B==null?void 0:B.code)==="PROFILE_HIDDEN"){ae(null),m(null);return}m(null),b(G(I))}}async function De(d){if(i.userType==="guest"){b("Guests cannot star users. Register to save favorites.");return}if(!(!i.userId||i.userId===d))try{const h=await t.toggleFavorite(i.sessionToken,d);X(new Set(h.favorites))}catch(h){b(G(h))}}async function Ve(d){const h=Te(d);if(!(!h||h===W))try{await t.sendChat(i.sessionToken,"cruise",h,xt)}catch(I){b(G(I))}}async function We(d){if(!(!d.trim()||d===W)){if(i.userType==="guest"){b("Anonymous users cannot block users.");return}try{pe.has(d)?await t.unblock(i.sessionToken,d):await t.block(i.sessionToken,d);const h=await t.listBlocked(i.sessionToken);le(new Set(h.blocked))}catch(h){b(G(h))}}}async function Ze(){const d=he??{lat:a.defaultCenterLat,lng:a.defaultCenterLng};if(!navigator.geolocation){me(d);try{await t.updatePresence(i.sessionToken,d.lat,d.lng,"online")}catch{}return}try{const h=await new Promise((I,B)=>{navigator.geolocation.getCurrentPosition(I,B,{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e4})});me({lat:h.coords.latitude,lng:h.coords.longitude}),await t.updatePresence(i.sessionToken,h.coords.latitude,h.coords.longitude,"online")}catch(h){me(d);try{await t.updatePresence(i.sessionToken,d.lat,d.lng,"online")}catch{const I=h&&typeof h=="object"&&"message"in h&&typeof h.message=="string"?h.message:null;b(I??G(h))}}}s.useEffect(()=>{Ze();const d=window.setInterval(()=>{Ze()},3e4);return()=>window.clearInterval(d)},[i.sessionToken]),s.useEffect(()=>{const d=h=>{var I,B;const ee=h,te=(I=ee.detail)==null?void 0:I.lat,fe=(B=ee.detail)==null?void 0:B.lng;!Number.isFinite(te)||!Number.isFinite(fe)||(me({lat:te,lng:fe}),t.updatePresence(i.sessionToken,te,fe,"online").catch(()=>{}))};return window.addEventListener("rd:location-updated",d),()=>window.removeEventListener("rd:location-updated",d)},[t,i.sessionToken]);const Be=s.useMemo(()=>{if(ye.some(h=>h.key===W))return ye;const d=q??he??{lat:a.defaultCenterLat,lng:a.defaultCenterLng};return[{key:W,userType:i.userType,lat:d.lat,lng:d.lng,status:"online",updatedAtMs:Date.now()},...ye]},[W,ye,q,i.userType,a.defaultCenterLat,a.defaultCenterLng,he]),Ge=s.useMemo(()=>{const d={};for(const h of N){if(!h.mainPhotoMediaId)continue;const I=ie[h.mainPhotoMediaId];I&&(d[Le(h.userId)]=I)}return d},[ie,N]),it=s.useMemo(()=>Ie.map(d=>({id:`spot:${d.spotId}`,position:{lat:d.lat,lng:d.lng},color:"#26d5ff",markerType:"spot",markerGlyph:"CS",label:`${d.name} | check-ins: ${d.checkInCount??0} | action: ${d.actionCount??0}`,onClick:()=>ne(d.spotId)})),[Ie]),_e=d=>{w(d),D(d)},qe=e.jsx(Kt,{wsUrl:ft(),sessionToken:i.sessionToken,presenceUpdates:Be,realtimeErrorMessage:Fe,onMarkerSelect:d=>void Se(d),avatarByKey:Ge,additionalMarkers:it,defaultCenter:he??{lat:a.defaultCenterLat,lng:a.defaultCenterLng},height:g?"calc(100vh - 340px)":"calc(100dvh - 62px)",visible:!0}),st=e.jsxs("div",{style:{background:"#000",marginInline:-10},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,padding:"8px 10px",borderBottom:"1px solid rgba(255,58,77,0.25)"},children:[e.jsx("button",{type:"button",style:H(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"reset"}}))},children:"GUYS"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"toggle_favorites"}}))},"aria-label":"Toggle favorites only",children:"â˜…"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"open_filters"}})),_e("chat")},children:"FILTER"})]}),e.jsx(Kt,{wsUrl:ft(),sessionToken:i.sessionToken,presenceUpdates:Be,realtimeErrorMessage:Fe,onMarkerSelect:d=>void Se(d),avatarByKey:Ge,additionalMarkers:it,defaultCenter:he??{lat:a.defaultCenterLat,lng:a.defaultCenterLng},height:"calc(100dvh - 220px)",visible:v==="map"})]}),Je=e.jsx(Oi,{api:t,session:i,busy:u,setBusy:f,setLastError:b,onlinePeers:ke,selectedPeerKey:C,setSelectedPeerKey:L,onOpenProfile:d=>void Se(d),isMobile:g,selfCoords:q,peerProfileByKey:y,discoverFilter:k,publicProfiles:N,favorites:M,mediaUrlById:ie,onUnreadCountChange:R});return e.jsxs("div",{style:!g&&v==="map"?{height:"100%"}:{display:"grid",gap:8},children:[g?e.jsx(e.Fragment,{children:v==="map"?st:Je}):e.jsx("div",{style:v==="map"?{display:"grid",height:"100%",alignItems:"stretch"}:{display:"grid",gap:12,alignItems:"start"},children:v==="map"?qe:Je}),_?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:80,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:g?"stretch":"center",padding:g?0:14},role:"dialog","aria-modal":"true","aria-label":"User profile",onClick:()=>ae(null),children:e.jsx("div",{onClick:d=>d.stopPropagation(),style:g?{width:"100%",height:"100dvh",overflow:"auto",background:"linear-gradient(180deg, rgba(7,8,10,0.98), rgba(2,2,4,0.98))",borderRadius:0,border:"none",padding:"calc(env(safe-area-inset-top, 0px) + 56px) 12px calc(env(safe-area-inset-bottom, 0px) + 20px)"}:{...Re(),width:"min(680px, 100%)",maxHeight:"86vh",overflow:"auto"},children:e.jsxs("div",{style:{display:"grid",gap:14},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"106px 1fr auto",gap:12,alignItems:"center"},children:[e.jsxs("div",{style:{position:"relative",width:106,height:106},children:[e.jsx("img",{src:r!=null&&r.mainPhotoMediaId&&ie[r.mainPhotoMediaId]?ie[r.mainPhotoMediaId]:He(_),alt:"Profile avatar",style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"cover",border:"2px solid #ff3047"}}),e.jsx("span",{style:{position:"absolute",right:4,bottom:4,width:14,height:14,borderRadius:"50%",background:"#26d5ff",border:"2px solid #000"}})]}),e.jsxs("div",{style:{display:"grid",gap:6},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:(r==null?void 0:r.displayName)??_}),e.jsx("div",{style:{color:"#26d5ff",fontSize:14},children:"Instant Messaging Available"})]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[r&&r.userId!==(i.userId??"")?e.jsx("button",{type:"button",style:{...H(!1),color:"#26d5ff",borderColor:"rgba(38,213,255,0.62)",minWidth:126},onClick:()=>void De(r.userId),children:M.has(r.userId)?"â˜… STARRED":"â˜† STAR"}):null,r&&r.userId!==(i.userId??"")?e.jsx("button",{type:"button",style:{...H(!1),color:"#ffb347",borderColor:"rgba(255,179,71,0.65)",minWidth:126},onClick:()=>void Ve(Le(r.userId)),children:"ðŸ”¥ FIRE"}):null,r&&r.userId!==(i.userId??"")?e.jsx("button",{type:"button",style:{...H(!1),color:pe.has(Le(r.userId))?"#ff9aa3":"#ffd4d8",borderColor:"rgba(255,120,130,0.62)",minWidth:126},onClick:()=>void We(Le(r.userId)),children:pe.has(Le(r.userId))?"UNBLOCK":"BLOCK"}):null,e.jsx("button",{type:"button",style:H(!1),onClick:()=>ae(null),children:"CLOSE"})]})]}),e.jsxs("div",{style:{color:"#ced3dc",fontSize:14,lineHeight:1.5},children:[e.jsxs("div",{children:["Age: ",(r==null?void 0:r.age)??"-"]}),e.jsxs("div",{children:["Distance: ",Oe??"-"]}),e.jsxs("div",{children:["Race: ",((U=r==null?void 0:r.stats)==null?void 0:U.race)??"-"]}),e.jsxs("div",{children:["Height: ",((j=r==null?void 0:r.stats)==null?void 0:j.heightInches)??"-"]}),e.jsxs("div",{children:["Weight: ",((l=r==null?void 0:r.stats)==null?void 0:l.weightLbs)??"-"]}),e.jsxs("div",{children:["Cock Size: ",((p=r==null?void 0:r.stats)==null?void 0:p.cockSizeInches)??"-"]}),e.jsxs("div",{children:["Cut / Uncut: ",((z=r==null?void 0:r.stats)==null?void 0:z.cutStatus)??"-"]}),e.jsxs("div",{children:["Position: ",((O=r==null?void 0:r.stats)==null?void 0:O.position)??"-"]}),e.jsxs("div",{style:{marginTop:8},children:["Bio: ",(r==null?void 0:r.bio)??"-"]})]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"MEDIA"}),r?e.jsx(e.Fragment,{children:(()=>{const d=[r.mainPhotoMediaId,...r.galleryMediaIds??[],r.videoMediaId].filter(te=>typeof te=="string"&&te.length>0);if(d.length===0)return e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No uploaded media."});const h=Math.max(0,Math.min(E,d.length-1)),I=d[h],B=ie[I],ee=I===r.videoMediaId;return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.4)",borderRadius:12,padding:8},children:ee?e.jsx("video",{controls:!0,playsInline:!0,src:B,style:{width:"100%",maxHeight:260,borderRadius:10,background:"#000"}}):e.jsx("img",{src:B??He(_??r.userId),alt:"Profile media",style:{width:"100%",maxHeight:260,objectFit:"cover",borderRadius:10}})}),e.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:d.map((te,fe)=>{const Ce=ie[te],Xe=te===r.videoMediaId;return e.jsx("button",{type:"button",onClick:()=>de(fe),style:{width:64,height:64,padding:0,borderRadius:8,overflow:"hidden",border:fe===h?"2px solid #26d5ff":"1px solid rgba(255,58,77,0.4)",background:"#000",cursor:"pointer",color:"#fff",fontSize:10},"aria-label":Xe?"Open video":"Open photo",children:Xe?e.jsx("div",{style:{display:"grid",placeItems:"center",width:"100%",height:"100%"},children:Ce?e.jsx("video",{src:Ce,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}):"VIDEO"}):e.jsx("img",{src:Ce??He(_??r.userId),alt:"Media thumbnail",style:{width:"100%",height:"100%",objectFit:"cover"}})},te)})})]})})()}):null]}),e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:e.jsx("button",{type:"button",style:ve(!1),onClick:()=>{_&&J(_),ae(null),de(0)},children:"CHAT"})})]})})}):null,ce?e.jsx(Fi,{api:t,session:i,spot:Ie.find(d=>d.spotId===ce)??null,onClose:()=>ne(null),onUpdated:async()=>{try{const d=await t.listCruisingSpots();je(d.spots)}catch{}},setLastError:b}):null]})}function Fi({api:t,session:i,spot:a,onClose:k,onUpdated:u,setLastError:f}){return a?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},role:"dialog","aria-modal":"true","aria-label":"Cruising spot",onClick:k,children:e.jsxs("div",{onClick:b=>b.stopPropagation(),style:{...Re(),width:"min(520px, 100%)",display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:a.name}),e.jsx("div",{style:{color:"#9fb6bf",fontSize:13},children:a.address}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap"},children:a.description}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:13},children:["Check-ins: ",a.checkInCount??0," | I got action there: ",a.actionCount??0]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:ve(!1),onClick:async()=>{try{await t.checkInCruisingSpot(i.sessionToken,a.spotId),await u()}catch(b){f(G(b))}},children:"CHECK IN"}),e.jsx("button",{type:"button",style:H(!1),onClick:async()=>{try{await t.markCruisingSpotAction(i.sessionToken,a.spotId),await u()}catch(b){f(G(b))}},children:"I GOT ACTION THERE"}),e.jsx("button",{type:"button",style:H(!1),onClick:k,children:"CLOSE"})]})]})}):null}function Oi({api:t,session:i,busy:a,setBusy:k,setLastError:u,onlinePeers:f,selectedPeerKey:b,setSelectedPeerKey:g,onOpenProfile:F,openThreadRequest:D,onThreadRequestConsumed:J,isMobile:R,selfCoords:U,peerProfileByKey:j,discoverFilter:l,publicProfiles:p,favorites:z,mediaUrlById:O,onUnreadCountChange:v}){var w;const[C,L]=s.useState({}),[_,ae]=s.useState({}),[q,me]=s.useState("instant"),[ue,oe]=s.useState("grid"),[y,S]=s.useState(null),[N,Z]=s.useState(""),[M,X]=s.useState(null),[pe,le]=s.useState([]),[ie,be]=s.useState({}),[c,V]=s.useState(null),[r,m]=s.useState({}),[E,de]=s.useState({}),[xe,we]=s.useState(!1),[Ie,je]=s.useState(""),[ce,ne]=s.useState(null),he=s.useRef(!1),Ae=s.useRef(!1),Pe=s.useRef(0),Fe=s.useRef(null),Ke=s.useRef(null),W=s.useRef(null),ye=s.useRef(null),Me=s.useRef(null),ke=s.useRef(0),Oe=s.useRef(new Set),Se=s.useRef(null),De=s.useRef(null),Ve=s.useRef(null),[We,Ze]=s.useState(null),[Be,Ge]=s.useState(l==="favorites"),[it,_e]=s.useState(!1),[qe,st]=s.useState(l==="online"?"online":"all"),[Je,d]=s.useState(!1),[h,I]=s.useState(""),[B,ee]=s.useState(""),[te,fe]=s.useState(""),[Ce,Xe]=s.useState(""),[nt,jt]=s.useState(""),[rt,wt]=s.useState(""),[at,kt]=s.useState(""),[ot,St]=s.useState(""),[lt,It]=s.useState(""),[dt,Ct]=s.useState(""),[ct,Tt]=s.useState(""),Ne=i.userId?`user:${i.userId}`:`session:${i.sessionToken}`,re=y??b??"",si=re?C[re]??[]:[],Mt=s.useMemo(()=>new Map(f.map(n=>[n.key,n])),[f]),Ue=s.useMemo(()=>{const n={};for(const o of p)typeof o.displayName=="string"&&o.displayName.trim()&&(n[Le(o.userId)]=o.displayName);for(const[o,x]of Object.entries(j))typeof x.displayName=="string"&&x.displayName.trim()&&(n[o]=x.displayName);return n},[j,p]),Et=s.useMemo(()=>p.filter(n=>n.userId!==(i.userId??"")).map(n=>{const o=Le(n.userId),x=Mt.get(o);return{key:o,userId:n.userId,displayName:n.displayName,age:n.age,stats:n.stats,meters:x&&U?Math.round(yt(U,{lat:x.lat,lng:x.lng})):null,isOnline:!!x,hasPicture:typeof n.mainPhotoMediaId=="string"&&n.mainPhotoMediaId.trim().length>0,avatarUrl:n.mainPhotoMediaId?O[n.mainPhotoMediaId]:void 0}}),[O,Mt,p,U,i.userId]),Ye=s.useMemo(()=>{const n=h.trim()?Number(h):void 0,o=B.trim()?Number(B):void 0,x=Ce.trim()?Number(Ce):void 0,P=nt.trim()?Number(nt):void 0,T=rt.trim()?Number(rt):void 0,Y=at.trim()?Number(at):void 0,se=ot.trim()?Number(ot):void 0,K=lt.trim()?Number(lt):void 0;return[...Et.filter(A=>{var $,ge,Ee,ze,gt,$e,Lt,Ft,Ot;if(Be&&!z.has(A.userId)||qe==="online"&&!A.isOnline||qe==="offline"&&A.isOnline||Je&&!A.hasPicture||Number.isFinite(n)&&(typeof A.age!="number"||A.age<n)||Number.isFinite(o)&&(typeof A.age!="number"||A.age>o))return!1;const fi=typeof(($=A.stats)==null?void 0:$.race)=="string"?A.stats.race:"";return!(te.trim()&&fi.toLowerCase()!==te.trim().toLowerCase()||Number.isFinite(x)&&(typeof((ge=A.stats)==null?void 0:ge.heightInches)!="number"||A.stats.heightInches<x)||Number.isFinite(P)&&(typeof((Ee=A.stats)==null?void 0:Ee.heightInches)!="number"||A.stats.heightInches>P)||Number.isFinite(T)&&(typeof((ze=A.stats)==null?void 0:ze.weightLbs)!="number"||A.stats.weightLbs<T)||Number.isFinite(Y)&&(typeof((gt=A.stats)==null?void 0:gt.weightLbs)!="number"||A.stats.weightLbs>Y)||Number.isFinite(se)&&(typeof(($e=A.stats)==null?void 0:$e.cockSizeInches)!="number"||A.stats.cockSizeInches<se)||Number.isFinite(K)&&(typeof((Lt=A.stats)==null?void 0:Lt.cockSizeInches)!="number"||A.stats.cockSizeInches>K)||dt&&((Ft=A.stats)==null?void 0:Ft.cutStatus)!==dt||ct&&((Ot=A.stats)==null?void 0:Ot.position)!==ct)})].sort((A,$)=>{const ge=typeof A.meters=="number"&&Number.isFinite(A.meters)?A.meters:Number.POSITIVE_INFINITY,Ee=typeof $.meters=="number"&&Number.isFinite($.meters)?$.meters:Number.POSITIVE_INFINITY;if(ge!==Ee)return ge-Ee;const ze=A.displayName.localeCompare($.displayName);return ze!==0?ze:A.key.localeCompare($.key)})},[Et,z,Be,dt,B,lt,nt,at,h,ot,Ce,rt,ct,te,Je,qe]),ut=s.useMemo(()=>Array.from(new Set(Ye.map(n=>n.key).filter(n=>n.trim().length>0))).slice(0,8),[Ye]),Nt=ut.join("|"),pt=s.useMemo(()=>{const n=new Set(Object.keys(_));return re.trim()&&n.add(re),Array.from(n).sort((o,x)=>{var P,T;return(((P=_[x])==null?void 0:P.lastAt)??0)-(((T=_[o])==null?void 0:T.lastAt)??0)})},[_,re]),Pt=s.useMemo(()=>Object.values(r).reduce((n,o)=>n+(Number.isFinite(o)?o:0),0),[r]);s.useMemo(()=>{var n;return re?Ue[re]??((n=j[re])==null?void 0:n.displayName)??re:""},[Ue,re,j]);const ni=s.useMemo(()=>{if(!re)return;const n=Ye.find(o=>o.key===re);return n==null?void 0:n.avatarUrl},[Ye,re]),Qe=s.useMemo(()=>pt.filter(n=>n!==re&&n!==Ne&&!!_[n]).map(n=>{var o;return{key:n,label:Ue[n]??((o=j[n])==null?void 0:o.displayName)??n}}),[pt,_,Ue,Ne,re,j]);s.useEffect(()=>{typeof v=="function"&&v(Pt)},[v,Pt]),s.useEffect(()=>{const n=Fe.current;n&&(n.srcObject=ce)},[ce]),s.useEffect(()=>{const n=Ke.current;n&&(n.srcObject=We)},[We]),s.useEffect(()=>()=>{if(ce){for(const n of ce.getTracks())n.stop();if(We)for(const n of We.getTracks())n.stop();Se.current&&(Se.current.close(),Se.current=null)}},[ce,We]),s.useEffect(()=>{if(Qe.length===0){Z("");return}Z(n=>n&&Qe.some(o=>o.key===n)?n:Qe[0].key)},[Qe]);const ri=s.useMemo(()=>({async sendMessage(n,o,x,P){const T=Te(o),Y=await t.sendChat(i.sessionToken,n,T,x,P),se=Y==null?void 0:Y.message,K=[se];if(n==="cruise"&&M)try{const A=await t.sendChat(i.sessionToken,n,Te(M),x,P),$=A==null?void 0:A.message;K.push($)}catch(A){u(G(A))}for(const A of K)At(A);return se},async initiateMediaUpload(n,o){const x=await t.initiateChatMediaUpload(i.sessionToken,{mimeType:n,sizeBytes:o});return{objectKey:x.objectKey,uploadUrl:x.uploadUrl}},async uploadToSignedUrl(n,o,x){if(!await bt(n,o,x)&&!(await fetch(n,{method:"PUT",headers:{"content-type":x},body:o})).ok)throw{code:"MEDIA_UPLOAD_INCOMPLETE",message:"Upload failed."}},async getMediaUrl(n){return(await t.getChatMediaUrl(i.sessionToken,n)).downloadUrl}}),[t,Ne,i.sessionToken,u,M]);function et(n){var o,x,P;return n.text&&n.text.trim()?ti(n.text):((o=n.media)==null?void 0:o.kind)==="image"?"[Photo]":((x=n.media)==null?void 0:x.kind)==="video"?"[Video]":((P=n.media)==null?void 0:P.kind)==="audio"?"[Voice]":""}function ai(n){if(!n||Oe.current.has(n))return!1;if(Oe.current.add(n),Oe.current.size>5e3){const o=Array.from(Oe.current).slice(-2500);Oe.current=new Set(o)}return!0}function oi(n,o){var x;const P=Ue[o]??((x=j[o])==null?void 0:x.displayName)??o,T=et(n)||"New activity";if("Notification"in window){if(Notification.permission==="granted"){try{new Notification(`${P}`,{body:T})}catch{}return}Notification.permission==="default"&&Notification.requestPermission()}}function li(n){if(!n.startsWith("GROUP_INVITE_REQUEST|"))return null;const[,o,x,P]=n.split("|");return!o||!x||!P?null:{inviteId:o,inviterKey:x,primaryPeerKey:P}}function di(n){if(!n.startsWith("GROUP_INVITE_ACCEPT|"))return null;const[,o,x]=n.split("|");return!o||!x?null:{inviteId:o,candidateKey:x}}function At(n){if(!ai(n.messageId))return;const o=n.fromKey===Ne?n.toKey:n.fromKey;L(T=>{const Y=T[o]??[];return Y.some(se=>se.messageId===n.messageId)?T:{...T,[o]:[...Y,n].sort((se,K)=>se.createdAtMs-K.createdAtMs)}}),ae(T=>({...T,[o]:{lastAt:n.createdAtMs,lastText:et(n)}})),n.fromKey!==Ne&&(ue==="thread"&&Te(re)===Te(o)?(de(T=>({...T,[o]:Math.max(T[o]??0,n.createdAtMs)})),m(T=>{const Y={...T};return delete Y[o],Y})):m(T=>({...T,[o]:(T[o]??0)+1})),oi(n,o));const x=li(n.text??"");x&&n.toKey===Ne&&le(T=>T.some(Y=>Y.inviteId===x.inviteId)?T:[...T,{...x,createdAtMs:n.createdAtMs}]);const P=di(n.text??"");P&&n.toKey===Ne&&ie[P.inviteId]&&(X(Te(P.candidateKey)),V(`Invite accepted by ${Ue[P.candidateKey]??P.candidateKey}.`),be(T=>{const Y={...T};return delete Y[P.inviteId],Y}))}async function ci(n){const o=Te(n);if(o)try{const x=await t.listChat(i.sessionToken,tt(q),o),P=x==null?void 0:x.messages,T=Array.isArray(P)?P:[];t.markChatRead(i.sessionToken,tt(q),o).catch(()=>{}),L(K=>({...K,[o]:T}));const Y=T.length>0?T[T.length-1]:null;Y&&ae(K=>({...K,[o]:{lastAt:Y.createdAtMs,lastText:et(Y)}}));let se=0;for(const K of T)K.fromKey===o&&K.createdAtMs>se&&(se=K.createdAtMs);se>0&&de(K=>({...K,[o]:Math.max(K[o]??0,se)}))}catch(x){u(G(x))}}s.useEffect(()=>{if(ue!=="thread"||!re.trim())return;let n=!1,o=!1,x=null;const P=async()=>{if(!(n||o)){o=!0;try{await ci(re)}finally{o=!1}n||(x=window.setTimeout(()=>{P()},1200))}};return P(),()=>{n=!0,x!==null&&window.clearTimeout(x)}},[q,re,ue]),s.useEffect(()=>{if(ue!=="grid")return;if(ut.length===0){m({});return}let n=!1;async function o(){if(!he.current&&!document.hidden){he.current=!0;try{const T=tt(q),Y=[],se=[];for(const A of ut){if(n)break;try{const $=Te(A);if(!$)continue;const ge=await t.listChat(i.sessionToken,T,$),Ee=(ge==null?void 0:ge.messages)??[];if(Ee.length>0){const $e=Ee[Ee.length-1];se.push([$,{lastAt:$e.createdAtMs,lastText:et($e)}])}let ze=0;const gt=E[$]??0;for(const $e of Ee)$e.fromKey===$&&$e.createdAtMs>gt&&(ze+=1);Y.push([$,ze])}catch{const $=Te(A);$&&Y.push([$,0])}}if(n)return;se.length>0&&ae(A=>{const $={...A};for(const[ge,Ee]of se)$[ge]=Ee;return $});const K={};for(const[A,$]of Y)$>0&&(K[A]=$);m(K)}finally{he.current=!1}}}const x=window.setTimeout(()=>{o()},1200),P=window.setInterval(()=>{o()},15e3);return()=>{n=!0,he.current=!1,window.clearTimeout(x),window.clearInterval(P)}},[t,q,E,i.sessionToken,Nt,ue]),s.useEffect(()=>{const n=Array.from(new Set([...pt,...ut,re].map(Y=>Te(Y)).filter(Y=>Y.length>0))).slice(0,10);if(n.length===0)return;let o=!1;const x=async()=>{if(!(o||document.hidden||Ae.current)){Ae.current=!0;try{const Y=tt(q),se=[];for(const K of n){if(o)break;try{const A=await t.listChat(i.sessionToken,Y,K),$=(A==null?void 0:A.messages)??[];if($.length===0)continue;const ge=$[$.length-1];se.push([K,{lastAt:ge.createdAtMs,lastText:et(ge)}])}catch{}}if(o||se.length===0)return;ae(K=>{const A={...K};for(const[$,ge]of se)A[$]=ge;return A})}finally{Ae.current=!1}}},P=window.setTimeout(()=>{x()},1e3),T=window.setInterval(()=>{x()},5e3);return()=>{o=!0,window.clearTimeout(P),window.clearInterval(T)}},[t,q,pt,re,i.sessionToken,Nt]);async function ui(){if(ce)return ce;if(!navigator.mediaDevices||typeof navigator.mediaDevices.getUserMedia!="function")throw{code:"UNAUTHORIZED_ACTION",message:"Camera access is not available in this browser."};const n=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});return ne(n),n}function pi(n,o){Se.current&&(Se.current.close(),Se.current=null);const x=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});return Se.current=x,De.current=o,Ve.current=n,x.ontrack=P=>{const T=P.streams[0];T&&Ze(T)},x.onicecandidate=P=>{const T=P.candidate;if(!T)return;const Y=Ve.current,se=De.current;!Y||!se||t.sendCallSignal(i.sessionToken,{toKey:Y,callId:se,signalType:"ice",candidate:JSON.stringify(T.toJSON())}).catch(()=>{})},x}async function Rt(n=!0){const o=Ve.current,x=De.current;if(n&&o&&x)try{await t.sendCallSignal(i.sessionToken,{toKey:o,callId:x,signalType:"hangup"})}catch{}if(ce)for(const P of ce.getTracks())P.stop();if(We)for(const P of We.getTracks())P.stop();ne(null),Ze(null),Se.current&&(Se.current.close(),Se.current=null),De.current=null,Ve.current=null,we(!1)}s.useEffect(()=>{let n=!1;const o=ft();if(!o)return;const x=()=>{ye.current!==null&&(window.clearInterval(ye.current),ye.current=null),Me.current!==null&&(window.clearTimeout(Me.current),Me.current=null)},P=()=>{if(n)return;const T=new WebSocket(o);W.current=T,T.onopen=()=>{ke.current=0,T.send(JSON.stringify({type:"auth",payload:{sessionToken:i.sessionToken}})),ye.current=window.setInterval(()=>{T.readyState===T.OPEN&&T.send(JSON.stringify({type:"heartbeat",payload:{}}))},15e3)},T.onmessage=Y=>{let se=null;try{se=JSON.parse(String(Y.data))}catch{return}if(!se||typeof se.type!="string")return;if(se.type==="chat_message"){const $=se.payload,ge=$==null?void 0:$.message;if(!ge||ge.fromKey!==Ne&&ge.toKey!==Ne)return;At(ge);return}if(se.type!=="call_signal")return;const K=se.payload;if(!K||K.toKey!==Ne||typeof K.fromKey!="string"||!K.callId||!K.signalType)return;const A=Te(K.fromKey);if(K.signalType==="hangup"){Rt(!1);return}if(K.signalType==="offer"){(async()=>{try{ht(A),je(A);const $=await ui(),ge=pi(A,K.callId);for(const ze of $.getTracks())ge.addTrack(ze,$);await ge.setRemoteDescription({type:"offer",sdp:K.sdp??""});const Ee=await ge.createAnswer();await ge.setLocalDescription(Ee),await t.sendCallSignal(i.sessionToken,{toKey:A,callId:K.callId,signalType:"answer",sdp:Ee.sdp??""}),we(!0)}catch($){u(G($))}})();return}if(K.signalType==="answer"){(async()=>{try{if(!Se.current||De.current!==K.callId)return;await Se.current.setRemoteDescription({type:"answer",sdp:K.sdp??""})}catch($){u(G($))}})();return}K.signalType==="ice"&&(async()=>{try{if(!Se.current||De.current!==K.callId||!K.candidate)return;const $=JSON.parse(K.candidate);await Se.current.addIceCandidate($)}catch{}})()},T.onclose=()=>{if(x(),n)return;ke.current+=1;const Y=Math.min(8e3,500*2**Math.min(ke.current,4));Me.current=window.setTimeout(P,Y)},T.onerror=()=>{}};return P(),()=>{var T;n=!0,x(),(T=W.current)==null||T.close(1e3,"chat cleanup"),W.current=null}},[t,Ne,i.sessionToken]);async function gi(){if(N.trim()){if(!re.trim()){u("Select a user first.");return}try{const n=Te(N);if(!n)return;if(!Qe.some(x=>x.key===n)){u("You can only add a third user you have previously messaged.");return}const o=crypto.randomUUID();await t.sendChat(i.sessionToken,"cruise",n,`GROUP_INVITE_REQUEST|${o}|${Ne}|${re.trim()}`),be(x=>({...x,[o]:{candidateKey:n,primaryPeerKey:re.trim()}})),V(`Invite sent to ${Ue[n]??n}. Waiting for acceptance.`)}catch(n){u(G(n))}}}async function Ut(n,o,x){try{await t.sendChat(i.sessionToken,"cruise",o,`GROUP_INVITE_ACCEPT|${n}|${Ne}`),le(P=>P.filter(T=>T.inviteId!==n)),V("Group invite accepted."),ht(x)}catch(P){u(G(P))}}function zt(n){le(o=>o.filter(x=>x.inviteId!==n))}function ht(n){const o=Te(n);g(o),S(o),m(x=>{const P={...x};return delete P[o],P}),de(x=>({...x,[o]:Date.now()})),oe("thread")}function vt(){Ge(!1),st("all"),d(!1),I(""),ee(""),fe(""),Xe(""),jt(""),wt(""),kt(""),St(""),It(""),Ct(""),Tt(""),_e(!1)}if(s.useEffect(()=>{const n=o=>{var x;const P=(x=o.detail)==null?void 0:x.action;if(P==="reset"){vt(),oe("grid");return}if(P==="toggle_favorites"){Ge(T=>!T),oe("grid");return}P==="open_filters"&&(_e(!0),oe("grid"))};return window.addEventListener("rd:discover-control",n),()=>window.removeEventListener("rd:discover-control",n)},[]),s.useEffect(()=>{D&&D.nonce!==Pe.current&&(Pe.current=D.nonce,ht(D.key),typeof J=="function"&&J())},[J,D]),s.useEffect(()=>{const n=o=>{var x;((x=o.detail)==null?void 0:x.tab)==="discover"&&(oe("grid"),S(null),_e(!1))};return window.addEventListener("rd:tab-select",n),()=>window.removeEventListener("rd:tab-select",n)},[]),ue==="thread"&&re.trim()){const n=Ue[re]??((w=j[re])==null?void 0:w.displayName)??re;return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:R?-10:0},children:[pe.length>0?e.jsxs("div",{style:{...Re(),display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"INVITE REQUESTS"}),pe.map(o=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,alignItems:"center"},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:13},children:[Ue[o.inviterKey]??o.inviterKey," invited you to join a conversation."]}),e.jsx("button",{type:"button",style:ve(!1),onClick:()=>void Ut(o.inviteId,o.inviterKey,o.primaryPeerKey),children:"ACCEPT"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>zt(o.inviteId),children:"DECLINE"})]},o.inviteId))]}):null,c?e.jsx("div",{style:{color:"#26d5ff",fontSize:12},children:c}):null,e.jsx(ei,{chatKind:tt(q),peerKey:re,currentUserKey:Ne,messages:si,client:ri,title:`INSTANT THREAD: ${n}`,peerSummary:{displayName:n,avatarUrl:ni},thirdParty:{candidates:Qe,selectedKey:N,onSelect:o=>Z(o),onAdd:()=>void gi(),disabled:a},showHeader:!1,edgeToEdge:R,fillHeight:R}),xe?e.jsx("div",{role:"dialog","aria-modal":"true","aria-label":"Video call",style:{position:"fixed",inset:0,zIndex:60,background:"rgba(0,0,0,0.82)",display:"grid",placeItems:"center",padding:16},children:e.jsxs("div",{style:{...Re(),width:"min(720px, 100%)",display:"grid",gap:10},children:[e.jsxs("div",{style:{fontSize:18,fontWeight:700},children:["VIDEO CALL: ",Ie]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("video",{ref:Fe,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"100%",maxHeight:"52vh",borderRadius:12,background:"#000"}}),e.jsx("video",{ref:Ke,autoPlay:!0,playsInline:!0,style:{width:"100%",maxHeight:"52vh",borderRadius:12,background:"#000"}})]}),e.jsx("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:e.jsx("button",{type:"button",style:H(!1),onClick:()=>void Rt(),children:"END CALL"})})]})}):null]})}return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:R?-10:0},children:[pe.length>0?e.jsxs("div",{style:{...Re(),display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"INVITE REQUESTS"}),pe.map(n=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,alignItems:"center"},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:13},children:[Ue[n.inviterKey]??n.inviterKey," invited you to join a conversation."]}),e.jsx("button",{type:"button",style:ve(!1),onClick:()=>void Ut(n.inviteId,n.inviterKey,n.primaryPeerKey),children:"ACCEPT"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>zt(n.inviteId),children:"DECLINE"})]},n.inviteId))]}):null,c?e.jsx("div",{style:{color:"#26d5ff",fontSize:12},children:c}):null,e.jsx("div",{style:{padding:10,borderBottom:"1px solid rgba(255,58,77,0.28)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8},children:[e.jsx("button",{type:"button",style:H(!1),onClick:vt,children:"GUYS"}),e.jsx("button",{type:"button",style:Be?ve(!1):H(!1),onClick:()=>Ge(n=>!n),"aria-label":"Toggle favorites only",children:"â˜…"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>_e(!0),children:"FILTER"})]})}),it?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},role:"dialog","aria-modal":"true","aria-label":"Discover filters",onClick:()=>_e(!1),children:e.jsx("div",{onClick:n=>n.stopPropagation(),style:{...Re(),width:"min(760px, 100%)",maxHeight:"86vh",overflow:"auto"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"FILTER USERS"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{type:"checkbox",checked:Je,onChange:n=>d(n.target.checked)}),"Has pictures"]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Online status"}),e.jsxs("select",{style:Q(),value:qe,onChange:n=>st(n.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"offline",children:"Offline"})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[e.jsx("input",{style:Q(),placeholder:"Min age",value:h,onChange:n=>I(n.target.value)}),e.jsx("input",{style:Q(),placeholder:"Max age",value:B,onChange:n=>ee(n.target.value)}),e.jsx("input",{style:Q(),placeholder:"Race",value:te,onChange:n=>fe(n.target.value)}),e.jsxs("select",{style:Q(),value:dt,onChange:n=>Ct(n.target.value),children:[e.jsx("option",{value:"",children:"Cut / Uncut"}),e.jsx("option",{value:"cut",children:"Cut"}),e.jsx("option",{value:"uncut",children:"Uncut"})]}),e.jsx("input",{style:Q(),placeholder:"Min height (in)",value:Ce,onChange:n=>Xe(n.target.value)}),e.jsx("input",{style:Q(),placeholder:"Max height (in)",value:nt,onChange:n=>jt(n.target.value)}),e.jsx("input",{style:Q(),placeholder:"Min weight (lbs)",value:rt,onChange:n=>wt(n.target.value)}),e.jsx("input",{style:Q(),placeholder:"Max weight (lbs)",value:at,onChange:n=>kt(n.target.value)}),e.jsx("input",{style:Q(),placeholder:"Min cock size (in)",value:ot,onChange:n=>St(n.target.value)}),e.jsx("input",{style:Q(),placeholder:"Max cock size (in)",value:lt,onChange:n=>It(n.target.value)}),e.jsxs("select",{style:Q(),value:ct,onChange:n=>Tt(n.target.value),children:[e.jsx("option",{value:"",children:"Position"}),e.jsx("option",{value:"top",children:"Top"}),e.jsx("option",{value:"bottom",children:"Bottom"}),e.jsx("option",{value:"side",children:"Side"})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:H(!1),onClick:vt,children:"RESET"}),e.jsx("button",{type:"button",style:ve(!1),onClick:()=>_e(!1),children:"DONE"})]})]})})}):null,e.jsx("div",{style:{display:"grid",gap:0},children:e.jsx("div",{style:{display:"grid",gap:0,gridTemplateColumns:"repeat(3, minmax(0, 1fr))"},children:Ye.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:13,padding:12,gridColumn:"1 / -1"},children:"No users match current filters."}):Ye.map(n=>e.jsx("button",{type:"button",onClick:()=>F(n.key),style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:0,display:"grid",gap:0,color:"#fff",cursor:"pointer"},children:e.jsxs("div",{style:{position:"relative",width:"100%",aspectRatio:"1 / 1"},children:[e.jsx("img",{src:n.avatarUrl??He(n.key),alt:"User avatar",style:{width:"100%",height:"100%",borderRadius:0,objectFit:"cover",border:"1px solid #0fd9ff"}}),n.isOnline?e.jsx("span",{style:{position:"absolute",top:4,left:4,width:10,height:10,borderRadius:"50%",background:"#26d5ff",border:"2px solid #000"}}):null]})},n.key))})})]})}function Wi({api:t,session:i,setLastError:a,openThreadRequest:k,onThreadRequestConsumed:u,isMobile:f}){var b,g,F,D,J,R;const[U,j]=s.useState([]),[l,p]=s.useState(null),[z,O]=s.useState([]),[v,w]=s.useState("messages"),[C,L]=s.useState(null),[_,ae]=s.useState(!1),[q,me]=s.useState(""),[ue,oe]=s.useState(null),[y,S]=s.useState({}),[N,Z]=s.useState(null),M=i.userId?`user:${i.userId}`:`session:${i.sessionToken}`,X="cruise",pe=s.useMemo(()=>U.filter(r=>r.key!==l).map(r=>({key:r.key,label:r.displayName})),[U,l]),le=s.useMemo(()=>U.find(r=>r.key===l)??null,[U,l]);s.useEffect(()=>{if(pe.length===0){me("");return}me(r=>r&&pe.some(m=>m.key===r)?r:pe[0].key)},[pe]),s.useEffect(()=>{let r=!1;async function m(){var de,xe,we;try{const Ie=i.userId?`user:${i.userId}`:`session:${i.sessionToken}`,[je,ce]=await Promise.all([t.getPublicProfiles(),t.listActivePresence(i.sessionToken)]),ne={},he={};for(const W of je.profiles)ne[Le(W.userId)]=W.displayName,typeof W.mainPhotoMediaId=="string"&&W.mainPhotoMediaId.trim()!==""&&(he[Le(W.userId)]=W.mainPhotoMediaId);const Ae=Array.from(new Set([...je.profiles.map(W=>Le(W.userId)),...ce.presence.map(W=>Te(W.key))].filter(W=>W&&W!==Ie))).slice(0,24),Pe=[];for(const W of Ae)try{const ye=await t.listChat(i.sessionToken,"cruise",W),Me=(ye==null?void 0:ye.messages)??[];if(!Array.isArray(Me)||Me.length===0)continue;const ke=Me[Me.length-1],Oe=typeof ke.text=="string"&&ke.text.trim().length>0?ti(ke.text):((de=ke.media)==null?void 0:de.kind)==="image"?"[Photo]":((xe=ke.media)==null?void 0:xe.kind)==="video"?"[Video]":((we=ke.media)==null?void 0:we.kind)==="audio"?"[Voice]":"";Pe.push({key:W,displayName:ne[W]??W,preview:Oe,at:ke.createdAtMs})}catch{}const Fe=await Promise.all(Pe.map(async W=>{const ye=he[W.key];if(!ye)return null;try{const Me=await t.getPublicMediaUrl(ye);return{key:W.key,url:Me.downloadUrl}}catch{return null}})),Ke={};for(const W of Fe)W&&(Ke[W.key]=W.url);for(const W of Pe)W.avatarUrl=Ke[W.key];if(r)return;Pe.sort((W,ye)=>ye.at-W.at),j(Pe)}catch(Ie){r||a(G(Ie))}}m();const E=window.setInterval(()=>{m()},1e4);return()=>{r=!0,window.clearInterval(E)}},[t,l,i.sessionToken,i.userId,a]),s.useEffect(()=>{k!=null&&k.key&&(p(Te(k.key)),w("messages"),typeof u=="function"&&u())},[u,k]),s.useEffect(()=>{const r=m=>{var E;((E=m.detail)==null?void 0:E.tab)==="threads"&&(p(null),w("messages"))};return window.addEventListener("rd:tab-select",r),()=>window.removeEventListener("rd:tab-select",r)},[]),s.useEffect(()=>{if(!l||v!=="profile")return;const r=mt(l);if(!r){L(null);return}let m=!1;return ae(!0),t.getPublicProfile(r).then(E=>{m||L(E.profile)}).catch(E=>{m||(L(null),a(G(E)))}).finally(()=>{m||ae(!1)}),()=>{m=!0}},[t,l,a,v]),s.useEffect(()=>{if(!l){O([]);return}let r=!1;const m=async()=>{try{const de=await t.listChat(i.sessionToken,X,l),xe=(de==null?void 0:de.messages)??[];r||(O(Array.isArray(xe)?xe:[]),t.markChatRead(i.sessionToken,X,l).catch(()=>{}))}catch(de){r||a(G(de))}};m();const E=window.setInterval(()=>{m()},1200);return()=>{r=!0,window.clearInterval(E)}},[t,l,i.sessionToken,a]);function ie(r){if(!r.startsWith("GROUP_INVITE_ACCEPT|"))return null;const[,m,E]=r.split("|");return!m||!E?null:{inviteId:m,candidateKey:E}}const be=s.useMemo(()=>({async sendMessage(r,m,E,de){const xe=await t.sendChat(i.sessionToken,r,m,E,de),we=xe==null?void 0:xe.message,Ie=ie(we.text??"");if(Ie&&we.toKey===M&&y[Ie.inviteId]&&(oe(Ie.candidateKey),Z(`Invite accepted by ${Ie.candidateKey}.`),S(je=>{const ce={...je};return delete ce[Ie.inviteId],ce})),O(je=>[...je,we].sort((ce,ne)=>ce.createdAtMs-ne.createdAtMs)),r==="cruise"&&ue)try{const je=await t.sendChat(i.sessionToken,r,ue,E,de),ce=je==null?void 0:je.message;O(ne=>[...ne,ce].sort((he,Ae)=>he.createdAtMs-Ae.createdAtMs))}catch(je){a(G(je))}return we},async initiateMediaUpload(r,m){const E=await t.initiateChatMediaUpload(i.sessionToken,{mimeType:r,sizeBytes:m});return{objectKey:E.objectKey,uploadUrl:E.uploadUrl}},async uploadToSignedUrl(r,m,E){if(!await bt(r,m,E)&&!(await fetch(r,{method:"PUT",headers:{"content-type":E},body:m})).ok)throw{code:"MEDIA_UPLOAD_INCOMPLETE",message:"Upload failed."}},async getMediaUrl(r){return(await t.getChatMediaUrl(i.sessionToken,r)).downloadUrl}}),[t,M,y,i.sessionToken,a,ue]);async function c(){var r;if(!(!l||!q)){if(!U.some(m=>m.key===q)){a("You can only add a third user you have previously messaged.");return}try{const m=crypto.randomUUID();await t.sendChat(i.sessionToken,"cruise",q,`GROUP_INVITE_REQUEST|${m}|${M}|${l}`),S(E=>({...E,[m]:{candidateKey:q}})),Z(`Invite sent to ${((r=U.find(E=>E.key===q))==null?void 0:r.displayName)??q}.`)}catch(m){a(G(m))}}}async function V(){if(l)try{await t.sendChat(i.sessionToken,"cruise",l,xt),Z("Fire sent.")}catch(r){a(G(r))}}if(l){const r=(le==null?void 0:le.displayName)??l;return e.jsxs("div",{style:{display:"grid",gap:0,minHeight:f?"calc(100dvh - 150px)":void 0,marginInline:f?-10:0,marginBlock:0},children:[e.jsx("div",{style:{position:"sticky",top:0,zIndex:46,background:"rgba(8,8,12,0.96)",borderBottom:"1px solid rgba(255,58,77,0.35)",padding:"6px 10px",display:"flex",justifyContent:"flex-end"},children:e.jsx("button",{type:"button",onClick:()=>w(m=>m==="messages"?"profile":"messages"),style:{background:"transparent",border:0,color:"#26d5ff",fontSize:13,fontWeight:700,letterSpacing:"0.03em",textTransform:"uppercase",padding:0,cursor:"pointer"},children:v==="messages"?"View Profile":"Back to Thread"})}),v==="messages"?e.jsx(ei,{chatKind:"cruise",peerKey:l,currentUserKey:M,messages:z,client:be,title:`INSTANT THREAD: ${r}`,peerSummary:{displayName:r},thirdParty:{candidates:pe,selectedKey:q,onSelect:m=>me(m),onAdd:()=>void c(),disabled:!1},showHeader:!1,edgeToEdge:!0,fillHeight:f}):e.jsxs("div",{style:{padding:12,display:"grid",gap:12},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"88px 1fr",gap:12,alignItems:"center"},children:[e.jsx("img",{src:(le==null?void 0:le.avatarUrl)??He(l),alt:"Profile avatar",style:{width:88,height:88,borderRadius:"50%",objectFit:"cover",border:"2px solid #ff3047"}}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:24,fontWeight:700},children:(C==null?void 0:C.displayName)??r}),e.jsx("div",{style:{color:"#26d5ff",fontSize:14},children:"Instant Messaging Available"})]})]}),_?e.jsx("div",{style:{color:"#9fb6bf",fontSize:14},children:"Loading profile..."}):null,_?null:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:14,lineHeight:1.5},children:[e.jsxs("div",{children:["Age: ",(C==null?void 0:C.age)??"-"]}),e.jsxs("div",{children:["Race: ",((b=C==null?void 0:C.stats)==null?void 0:b.race)??"-"]}),e.jsxs("div",{children:["Height: ",((g=C==null?void 0:C.stats)==null?void 0:g.heightInches)??"-"]}),e.jsxs("div",{children:["Weight: ",((F=C==null?void 0:C.stats)==null?void 0:F.weightLbs)??"-"]}),e.jsxs("div",{children:["Cock Size: ",((D=C==null?void 0:C.stats)==null?void 0:D.cockSizeInches)??"-"]}),e.jsxs("div",{children:["Cut / Uncut: ",((J=C==null?void 0:C.stats)==null?void 0:J.cutStatus)??"-"]}),e.jsxs("div",{children:["Position: ",((R=C==null?void 0:C.stats)==null?void 0:R.position)??"-"]}),e.jsxs("div",{style:{marginTop:8},children:["Bio: ",(C==null?void 0:C.bio)??"-"]})]}),e.jsx("div",{children:e.jsx("button",{type:"button",style:{...H(!1),color:"#ffb347",borderColor:"rgba(255,179,71,0.65)"},onClick:()=>void V(),children:"ðŸ”¥ FIRE"})})]})]})]})}return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:f?-10:0,marginBlock:0},children:[U.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14,padding:14},children:"No conversations yet."}):U.map(r=>e.jsxs("button",{type:"button",onClick:()=>p(r.key),style:{border:0,borderBottom:"1px solid rgba(255,58,77,0.24)",borderRadius:0,padding:"10px 12px",background:"rgba(0,0,0,0.2)",textAlign:"left",color:"#fff",cursor:"pointer",display:"grid",gridTemplateColumns:"52px 1fr",gap:10,alignItems:"center",width:"100%"},children:[e.jsx("img",{src:r.avatarUrl??He(r.key),alt:`${r.displayName} avatar`,style:{width:52,height:52,borderRadius:6,objectFit:"cover",border:"1px solid rgba(38,213,255,0.9)"}}),e.jsxs("div",{style:{display:"grid",gap:3,minWidth:0},children:[e.jsx("div",{style:{fontWeight:700},children:r.displayName}),e.jsx("div",{style:{color:"#b9bec9",fontSize:13,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:r.preview})]})]},r.key)),N?e.jsx("div",{style:{color:"#26d5ff",fontSize:12,padding:10},children:N}):null]})}function Ki({api:t,session:i,isMobile:a,setLastError:k}){const[u,f]=s.useState("ads"),[b,g]=s.useState([]),[F,D]=s.useState([]),[J,R]=s.useState(""),[U,j]=s.useState(""),[l,p]=s.useState(""),[z,O]=s.useState(""),[v,w]=s.useState([]),[C,L]=s.useState(""),[_,ae]=s.useState(""),[q,me]=s.useState(""),[ue,oe]=s.useState([]),[y,S]=s.useState({}),N=!0,Z=i.userType!=="guest";async function M(){try{const[r,m,E,de]=await Promise.all([t.listPublicPostings("ad"),t.listPublicPostings("event"),t.listCruisingSpots(),i.userType==="guest"?Promise.resolve({postings:[]}):t.listEventInvites(i.sessionToken)]);g([...r.postings].sort((xe,we)=>xe.createdAtMs-we.createdAtMs)),D([...m.postings].sort((xe,we)=>xe.createdAtMs-we.createdAtMs)),w(E.spots),oe(de.postings)}catch(r){k(G(r))}}s.useEffect(()=>{M()},[]),s.useEffect(()=>{const r=m=>{var E;((E=m.detail)==null?void 0:E.tab)==="public"&&f("ads")};return window.addEventListener("rd:tab-select",r),()=>window.removeEventListener("rd:tab-select",r)},[]);async function X(r){if(r==="event"&&!Z){k("Anonymous users cannot create event postings.");return}const m=r==="ad"?J:l,E=r==="ad"?U:z;try{await t.createPublicPosting(i.sessionToken,{type:r,title:m,body:E}),r==="ad"?(R(""),j("")):(p(""),O("")),await M()}catch(de){k(G(de))}}async function pe(r){if(!Z){k("Anonymous users cannot invite to events.");return}const m=(y[r]??"").trim();if(!m){k("Target user id is required.");return}try{await t.inviteToEvent(i.sessionToken,{postingId:r,targetUserId:m}),S(E=>({...E,[r]:""})),await M()}catch(E){k(G(E))}}async function le(r,m){if(i.userType==="guest"){k("Anonymous users cannot respond to event invites.");return}try{await t.respondToEventInvite(i.sessionToken,{postingId:r,accept:m}),await M()}catch(E){k(G(E))}}async function ie(){try{await t.createCruisingSpot(i.sessionToken,{name:C,address:_,description:q}),L(""),ae(""),me(""),await M()}catch(r){k(G(r))}}async function be(r){try{await t.checkInCruisingSpot(i.sessionToken,r),await M()}catch(m){k(G(m))}}const c=r=>{const m=r==="ads"?"ADS":"EVENTS",E=r==="ads"?b:F,de=r==="ads"?J:l,xe=r==="ads"?U:z,we=r==="ads"?R:p,Ie=r==="ads"?j:O,je=r==="ads"?"ad":"event",ce=r==="ads"?N:Z;return e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.38)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:m}),e.jsx("input",{value:de,onChange:ne=>we(ne.target.value),placeholder:`${m} title`,style:Q(),"aria-label":`${m} title`,disabled:!ce}),e.jsx("textarea",{value:xe,onChange:ne=>Ie(ne.target.value),placeholder:`Write ${m.toLowerCase()} details`,style:{...Q(),minHeight:86,resize:"vertical"},"aria-label":`${m} details`,disabled:!ce}),e.jsxs("button",{type:"button",onClick:()=>void X(je),style:ce?ve(!1):H(!0),disabled:!ce,children:["POST ",m]}),ce?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can view events but cannot post events."}),e.jsx("div",{style:{display:"grid",gap:8,marginTop:6},children:E.length===0?e.jsxs("div",{style:{color:"#b9bec9",fontSize:14},children:["No ",m.toLowerCase()," yet."]}):E.map(ne=>{var he,Ae;return e.jsxs("div",{style:{borderTop:"1px solid rgba(255,58,77,0.25)",paddingTop:10,paddingBottom:10},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:4},children:ne.title}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12,marginBottom:6},children:["Host: ",ne.authorUserId]}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap"},children:ne.body}),r==="events"?e.jsxs("div",{style:{display:"grid",gap:8,marginTop:8},children:[e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12},children:["Invited: ",((he=ne.invitedUserIds)==null?void 0:he.length)??0," | Accepted: ",((Ae=ne.acceptedUserIds)==null?void 0:Ae.length)??0]}),i.userId&&i.userId===ne.authorUserId?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8},children:[e.jsx("input",{value:y[ne.postingId]??"",onChange:Pe=>S(Fe=>({...Fe,[ne.postingId]:Pe.target.value})),placeholder:"Invite user id",style:Q()}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>void pe(ne.postingId),children:"INVITE"})]}):null,i.userType!=="guest"&&i.userId&&Array.isArray(ne.invitedUserIds)&&ne.invitedUserIds.includes(i.userId)?e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:ve(!1),onClick:()=>void le(ne.postingId,!0),children:"ACCEPT INVITE"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>void le(ne.postingId,!1),children:"DECLINE"})]}):null]}):null]},ne.postingId)})})]})})},V=e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.38)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"CRUISING SPOTS"}),e.jsx("input",{value:C,onChange:r=>L(r.target.value),placeholder:"Spot name",style:Q(),disabled:!1}),e.jsx("input",{value:_,onChange:r=>ae(r.target.value),placeholder:"Spot address",style:Q(),disabled:!1}),e.jsx("textarea",{value:q,onChange:r=>me(r.target.value),placeholder:"Spot description",style:{...Q(),minHeight:80,resize:"vertical"},disabled:!1}),e.jsx("button",{type:"button",style:ve(!1),disabled:!1,onClick:()=>void ie(),children:"CREATE SPOT"}),null,e.jsx("div",{style:{display:"grid",gap:8},children:v.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"No cruising spots yet."}):v.map(r=>e.jsxs("div",{style:{borderTop:"1px solid rgba(255,58,77,0.25)",paddingTop:10,paddingBottom:10},children:[e.jsx("div",{style:{fontWeight:700},children:r.name}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12,marginTop:4},children:["Created by: ",r.creatorUserId]}),e.jsx("div",{style:{color:"#9fb6bf",fontSize:12,marginTop:2},children:r.address}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap",marginTop:6},children:r.description}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:H(!1),onClick:()=>void be(r.spotId),children:"CHECK IN"}),e.jsxs("span",{style:{color:"#9fb6bf",fontSize:12},children:["Checked in: ",r.checkInCount??0]}),e.jsxs("span",{style:{color:"#9fb6bf",fontSize:12},children:["Got action: ",r.actionCount??0]})]})]},r.spotId))})]})});return e.jsx("div",{style:{display:"grid",gap:8,marginInline:a?-10:0},children:a?e.jsxs(e.Fragment,{children:[u==="ads"?c("ads"):null,u==="events"?c("events"):null,u==="spots"?V:null,e.jsx("div",{style:{position:"sticky",bottom:"calc(86px + env(safe-area-inset-bottom, 0px))",zIndex:31,background:"rgba(0,0,0,0.35)",padding:8},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[e.jsx("button",{type:"button",style:u==="ads"?ve(!1):H(!1),onClick:()=>f("ads"),children:"ADS"}),e.jsx("button",{type:"button",style:u==="events"?ve(!1):H(!1),onClick:()=>f("events"),children:"EVENTS"}),e.jsx("button",{type:"button",style:u==="spots"?ve(!1):H(!1),onClick:()=>f("spots"),children:"SPOTS"})]})})]}):e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[c("ads"),c("events"),e.jsx("div",{style:{gridColumn:"1 / -1"},children:V}),i.userType!=="guest"&&ue.length>0?e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.25)",gridColumn:"1 / -1",display:"grid",gap:8,padding:10},children:[e.jsx("div",{style:{fontSize:16,fontWeight:700},children:"EVENT INVITES"}),ue.map(r=>e.jsxs("div",{style:{display:"grid",gap:6,border:"1px solid rgba(255,58,77,0.4)",borderRadius:10,padding:8},children:[e.jsx("div",{style:{fontWeight:700},children:r.title}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13},children:["Host: ",r.authorUserId]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:ve(!1),onClick:()=>void le(r.postingId,!0),children:"ACCEPT"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>void le(r.postingId,!1),children:"DECLINE"})]})]},r.postingId))]}):null]})})}function Di({api:t,session:i,setLastError:a}){const[k,u]=s.useState([]),[f,b]=s.useState(""),[g,F]=s.useState("");async function D(){try{const l=await t.listSubmissions();u([...l.submissions].sort((p,z)=>z.createdAtMs-p.createdAtMs))}catch(l){a(G(l))}}s.useEffect(()=>{D()},[]);async function J(){try{await t.createSubmission(i.sessionToken,{title:f,body:g}),b(""),F(""),await D()}catch(l){a(G(l))}}async function R(l){try{await t.recordSubmissionView(l),await D()}catch(p){a(G(p))}}async function U(l,p){try{await t.rateSubmission(l,p),await D()}catch(z){a(G(z))}}const j=i.userType!=="guest";return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("input",{style:Q(),value:f,onChange:l=>b(l.target.value),placeholder:"Story title",disabled:!j}),e.jsx("textarea",{style:{...Q(),minHeight:120},value:g,onChange:l=>F(l.target.value),placeholder:"Write your story",disabled:!j}),e.jsx("button",{type:"button",style:j?ve(!1):H(!0),disabled:!j,onClick:()=>void J(),children:"PUBLISH STORY"}),j?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can read but cannot publish submissions."})]})}),e.jsx("div",{style:{display:"grid",gap:10},children:k.map(l=>{const p=l.ratingCount>0?(l.ratingSum/l.ratingCount).toFixed(2):"0.00";return e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.28)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:l.title}),e.jsx("div",{style:{color:"#ced3dc",whiteSpace:"pre-wrap",marginTop:6},children:l.body}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13,marginTop:8},children:["Views: ",l.viewCount," | Rating: ",p," (",l.ratingCount,")"]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:H(!1),onClick:()=>void R(l.submissionId),children:"VIEW"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>void U(l.submissionId,1),children:"â˜…1"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>void U(l.submissionId,2),children:"â˜…2"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>void U(l.submissionId,3),children:"â˜…3"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>void U(l.submissionId,4),children:"â˜…4"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>void U(l.submissionId,5),children:"â˜…5"})]})]},l.submissionId)})})]})}function _i({api:t,session:i,setLastError:a}){var k,u,f,b,g,F;const[D,J]=s.useState([]),[R,U]=s.useState({}),[j,l]=s.useState(null),[p,z]=s.useState(2e3),[O,v]=s.useState(""),[w,C]=s.useState(""),[L,_]=s.useState(""),[ae,q]=s.useState(""),[me,ue]=s.useState("Ready."),oe=i.userType!=="guest";async function y(){try{const M=await t.listPromotedProfiles();J([...M.listings].sort((ie,be)=>be.createdAtMs-ie.createdAtMs)),z(M.feeCents);const X=Array.from(new Set(M.listings.map(ie=>ie.userId))).filter(ie=>ie.trim().length>0),pe=await Promise.all(X.map(async ie=>{try{const be=(await t.getPublicProfile(ie)).profile.mainPhotoMediaId;if(!be)return null;const c=await t.getPublicMediaUrl(be);return{userId:ie,url:c.downloadUrl}}catch{return null}})),le={};for(const ie of pe)ie&&(le[ie.userId]=ie.url);U(le)}catch(M){a(G(M))}}s.useEffect(()=>{y()},[]);async function S(){if(!oe){a("Anonymous users cannot create promoted profiles.");return}try{const M=await t.startPromotedPayment(i.sessionToken),X=await t.confirmPromotedPayment(i.sessionToken,M.payment.paymentToken);q(X.payment.paymentToken),ue("Payment confirmed. You can now publish one promoted profile.")}catch(M){const X=G(M);ue(X),a(X)}}async function N(){if(!oe){a("Anonymous users cannot create promoted profiles.");return}try{await t.createPromotedProfile(i.sessionToken,{paymentToken:ae,title:O,body:w,displayName:L}),v(""),C(""),_(""),q(""),ue("Promoted profile published."),await y()}catch(M){const X=G(M);ue(X),a(X)}}async function Z(M){try{const X=await t.getPublicProfile(M);l(X.profile)}catch(X){a(G(X))}}return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"PROMOTED PROFILES"}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:14},children:["Publishing requires a $",Math.round(p/100)," fee per profile."]}),e.jsx("div",{style:{color:"#26d5ff",fontSize:13},children:me})]})}),e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("input",{value:L,onChange:M=>_(M.target.value),placeholder:"Display name",style:Q(),disabled:!oe}),e.jsx("input",{value:O,onChange:M=>v(M.target.value),placeholder:"Headline",style:Q(),disabled:!oe}),e.jsx("textarea",{value:w,onChange:M=>C(M.target.value),placeholder:"Profile description",style:{...Q(),minHeight:92,resize:"vertical"},disabled:!oe}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsxs("button",{type:"button",style:H(!oe),disabled:!oe,onClick:()=>void S(),children:["PAY $",Math.round(p/100)]}),e.jsx("button",{type:"button",style:oe?ve(!1):H(!0),disabled:!oe,onClick:()=>void N(),children:"PUBLISH PROFILE"})]}),oe?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can browse but cannot publish paid profiles."})]})}),e.jsx("div",{style:{display:"grid",gap:10},children:D.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"No promoted profiles yet."}):D.map(M=>e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.25)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"72px 1fr",gap:10,alignItems:"start"},children:[e.jsx("img",{src:R[M.userId]??He(`user:${M.userId}`),alt:`${M.displayName} profile`,style:{width:72,height:72,borderRadius:6,objectFit:"cover",border:"1px solid rgba(38,213,255,0.9)"}}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:M.title}),e.jsx("div",{style:{color:"#26d5ff",fontSize:13},children:M.displayName}),e.jsx("div",{style:{color:"#ced3dc",whiteSpace:"pre-wrap",fontSize:14},children:M.body}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>void Z(M.userId),children:"VIEW PROFILE"})]})]})},M.listingId))}),j?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},onClick:()=>l(null),children:e.jsxs("div",{onClick:M=>M.stopPropagation(),style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:12,width:"min(560px, 100%)",background:"rgba(0,0,0,0.88)"},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:j.displayName}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:6},children:["Age: ",j.age]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Race: ",((k=j.stats)==null?void 0:k.race)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Height: ",((u=j.stats)==null?void 0:u.heightInches)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Weight: ",((f=j.stats)==null?void 0:f.weightLbs)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Cock Size: ",((b=j.stats)==null?void 0:b.cockSizeInches)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Cut / Uncut: ",((g=j.stats)==null?void 0:g.cutStatus)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Position: ",((F=j.stats)==null?void 0:F.position)??"-"]}),e.jsx("div",{style:{color:"#ced3dc",marginTop:10,whiteSpace:"pre-wrap"},children:j.bio}),e.jsx("div",{style:{marginTop:10},children:e.jsx("button",{type:"button",style:H(!1),onClick:()=>l(null),children:"CLOSE"})})]})}):null]})}function $i(){return{displayName:"",age:"",bio:"",heightInches:"",race:"",cockSizeInches:"",cutStatus:"",weightLbs:"",position:"",discreetMode:!1,travelEnabled:!1,travelLat:"",travelLng:"",lookingForMore:""}}function Ht(t){var i,a,k;const u=ii(t.bio);return{displayName:t.displayName,age:String(t.age),bio:u.bio,heightInches:t.stats.heightInches!==void 0?String(t.stats.heightInches):"",race:t.stats.race??"",cockSizeInches:t.stats.cockSizeInches!==void 0?String(t.stats.cockSizeInches):"",cutStatus:t.stats.cutStatus??"",weightLbs:t.stats.weightLbs!==void 0?String(t.stats.weightLbs):"",position:t.stats.position??"",discreetMode:t.discreetMode===!0,travelEnabled:((i=t.travelMode)==null?void 0:i.enabled)===!0,travelLat:typeof((a=t.travelMode)==null?void 0:a.lat)=="number"?String(t.travelMode.lat):"",travelLng:typeof((k=t.travelMode)==null?void 0:k.lng)=="number"?String(t.travelMode.lng):"",lookingForMore:u.lookingForMore}}function ii(t){const i=t.replace(/\r\n/g,`
`).trim(),a="Looking For More:",k=/Looking For More:\s*/g,u=Array.from(i.matchAll(k));if(u.length===0)return{bio:i,lookingForMore:""};const f=u[0],b=u[u.length-1],g=typeof f.index=="number"?f.index:i.indexOf(a),F=(typeof b.index=="number"?b.index:i.lastIndexOf(a))+b[0].length,D=i.slice(0,Math.max(0,g)).trim(),J=i.slice(Math.max(0,F)).trim();return{bio:D,lookingForMore:J}}function Hi(t,i){const a=ii(t).bio.trim(),k=i.trim();return k?a?`${a}

Looking For More: ${k}`:`${k}`:a}function Vt(t){const i=t.trim();if(!i)return;const a=Number(i);return Number.isFinite(a)?Math.trunc(a):void 0}function Vi(t){const i=t.trim();if(!i)return;const a=Number(i);return Number.isFinite(a)?a:void 0}function Bi({api:t,session:i,setLastError:a}){var k,u;const[f,b]=s.useState($i()),[g,F]=s.useState(null),[D,J]=s.useState(!1),[R,U]=s.useState(!1),[j,l]=s.useState(null),[p,z]=s.useState({});async function O(){J(!0);try{const y=await t.getMyProfile(i.sessionToken);F(y.profile),b(Ht(y.profile)),l("Profile loaded.")}catch(y){const S=y;if((S==null?void 0:S.code)==="PROFILE_NOT_FOUND"){F(null),b(N=>({...N,age:N.age||"18"})),l("No profile yet. Fill out the form and save.");return}l(G(y))}finally{J(!1)}}s.useEffect(()=>{O()},[i.sessionToken,i.userType]),s.useEffect(()=>{const y=[g==null?void 0:g.mainPhotoMediaId,...(g==null?void 0:g.galleryMediaIds)??[]].filter(N=>typeof N=="string"&&N.length>0);if(y.length===0)return;const S=y.filter(N=>!p[N]);S.length!==0&&Promise.all(S.map(async N=>{try{const Z=await t.getPublicMediaUrl(N);return{id:N,url:Z.downloadUrl}}catch{return null}})).then(N=>{z(Z=>{const M={...Z};for(const X of N)X&&(M[X.id]=X.url);return M})})},[t,p,g==null?void 0:g.galleryMediaIds,g==null?void 0:g.mainPhotoMediaId]);async function v(){var y,S,N,Z,M;U(!0),a(null);try{const X=Number(f.age),pe=Hi(f.bio,f.lookingForMore),le=f.travelLat.trim()?Number(f.travelLat):void 0,ie=f.travelLng.trim()?Number(f.travelLng):void 0,be={displayName:f.displayName,age:Math.trunc(X),bio:pe,stats:{heightInches:Vt(f.heightInches),race:f.race.trim()||void 0,cockSizeInches:Vi(f.cockSizeInches),cutStatus:f.cutStatus||void 0,weightLbs:Vt(f.weightLbs),position:f.position||void 0},discreetMode:f.discreetMode,travelMode:{enabled:f.travelEnabled,lat:Number.isFinite(le)?le:void 0,lng:Number.isFinite(ie)?ie:void 0}},c=await t.upsertMyProfile(i.sessionToken,be);F(c.profile),b(Ht(c.profile));try{localStorage.setItem("reddoor_travel_center",JSON.stringify({enabled:((y=c.profile.travelMode)==null?void 0:y.enabled)===!0,lat:(S=c.profile.travelMode)==null?void 0:S.lat,lng:(N=c.profile.travelMode)==null?void 0:N.lng})),window.dispatchEvent(new CustomEvent("rd:location-updated",{detail:{lat:(Z=c.profile.travelMode)==null?void 0:Z.lat,lng:(M=c.profile.travelMode)==null?void 0:M.lng}}))}catch{}l("Profile saved.")}catch(X){const pe=G(X);l(pe),a(pe)}finally{U(!1)}}async function w(y,S){if(!S){l("Choose a file first.");return}if(i.userType==="guest"){l("Guest sessions cannot upload media. Register to persist media.");return}U(!0),a(null);try{const N=await t.initiateMediaUpload(i.sessionToken,{kind:y,mimeType:S.type||(y==="video"?"video/mp4":"image/jpeg"),sizeBytes:S.size});if(!await bt(N.uploadUrl,S,S.type||"application/octet-stream")){const Z=await fetch(N.uploadUrl,{method:"PUT",headers:{"content-type":S.type||"application/octet-stream"},body:S});if(!Z.ok)throw{message:`Upload failed (${Z.status}).`}}await t.completeMediaUpload(i.sessionToken,N.mediaId),await O(),l("Media uploaded.")}catch(N){const Z=G(N);l(Z),a(Z)}finally{U(!1)}}const[C,L]=s.useState(null),[_,ae]=s.useState(null),[q,me]=s.useState(null);async function ue(y){if(g){U(!0);try{const S=(g.galleryMediaIds??[]).filter(Z=>Z!==y),N=await t.updateProfileMediaReferences(i.sessionToken,{galleryMediaIds:S});F(N.profile),l("Gallery updated.")}catch(S){const N=G(S);l(N),a(N)}finally{U(!1)}}}async function oe(y){if(g){U(!0);try{const S=await t.updateProfileMediaReferences(i.sessionToken,{galleryMediaIds:g.galleryMediaIds,mainPhotoMediaId:y});F(S.profile),l("Main photo updated.")}catch(S){const N=G(S);l(N),a(N)}finally{U(!1)}}}return e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:Re(),children:e.jsxs("div",{style:{display:"grid",gap:14},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"SETTINGS / PROFILE"}),i.userType==="guest"?e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guest profile data is temporary for this session and is removed when you log out."}):null,j?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:j}):null,e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Display Name"}),e.jsx("input",{value:f.displayName,onChange:y=>b(S=>({...S,displayName:y.target.value})),style:Q()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Age"}),e.jsx("input",{value:f.age,onChange:y=>b(S=>({...S,age:y.target.value})),style:Q(),inputMode:"numeric"})]})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Bio"}),e.jsx("textarea",{value:f.bio,onChange:y=>b(S=>({...S,bio:y.target.value})),style:{...Q(),minHeight:88,resize:"vertical"}})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Looking For More (Optional)"}),e.jsx("textarea",{value:f.lookingForMore,onChange:y=>b(S=>({...S,lookingForMore:y.target.value})),style:{...Q(),minHeight:72,resize:"vertical"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:f.discreetMode,onChange:y=>b(S=>({...S,discreetMode:y.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0,fontSize:13},children:"Discreet Mode (hide profile from others)"})]}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:f.travelEnabled,onChange:y=>b(S=>({...S,travelEnabled:y.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Travel Mode"})]})]}),f.travelEnabled?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Travel Lat"}),e.jsx("input",{value:f.travelLat,onChange:y=>b(S=>({...S,travelLat:y.target.value})),style:Q()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Travel Lng"}),e.jsx("input",{value:f.travelLng,onChange:y=>b(S=>({...S,travelLng:y.target.value})),style:Q()})]})]}):null,e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Height (in)"}),e.jsx("input",{value:f.heightInches,onChange:y=>b(S=>({...S,heightInches:y.target.value})),style:Q(),inputMode:"numeric"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Race"}),e.jsx("input",{value:f.race,onChange:y=>b(S=>({...S,race:y.target.value})),style:Q()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Cock Size (in)"}),e.jsx("input",{value:f.cockSizeInches,onChange:y=>b(S=>({...S,cockSizeInches:y.target.value})),style:Q(),inputMode:"decimal"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Cut / Uncut"}),e.jsxs("select",{value:f.cutStatus,onChange:y=>b(S=>({...S,cutStatus:y.target.value})),style:Q(),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"cut",children:"Cut"}),e.jsx("option",{value:"uncut",children:"Uncut"})]})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Weight (lbs)"}),e.jsx("input",{value:f.weightLbs,onChange:y=>b(S=>({...S,weightLbs:y.target.value})),style:Q(),inputMode:"numeric"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Position"}),e.jsxs("select",{value:f.position,onChange:y=>b(S=>({...S,position:y.target.value})),style:Q(),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"top",children:"Top"}),e.jsx("option",{value:"bottom",children:"Bottom"}),e.jsx("option",{value:"side",children:"Side"})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",onClick:()=>void v(),style:ve(R),disabled:R,children:"SAVE PROFILE"}),e.jsx("button",{type:"button",onClick:()=>void O(),style:H(D),disabled:D,children:"REFRESH"})]})]})}),e.jsx("div",{style:Re(),children:e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"MEDIA"}),e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"Main profile photo, gallery photo, and video uploads."}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Main Photo"}),e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:y=>{var S;return L(((S=y.target.files)==null?void 0:S[0])??null)}})]}),e.jsx("button",{type:"button",style:ve(R),disabled:R,onClick:()=>void w("photo_main",C),children:"UPLOAD MAIN PHOTO"})]}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Gallery Photo"}),e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:y=>{var S;return ae(((S=y.target.files)==null?void 0:S[0])??null)}})]}),e.jsx("button",{type:"button",style:ve(R),disabled:R,onClick:()=>void w("photo_gallery",_),children:"UPLOAD GALLERY PHOTO"})]}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Video"}),e.jsx("input",{className:"rd-input",type:"file",accept:"video/*",onChange:y=>{var S;return me(((S=y.target.files)==null?void 0:S[0])??null)}})]}),e.jsx("button",{type:"button",style:ve(R),disabled:R,onClick:()=>void w("video",q),children:"UPLOAD VIDEO"})]}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13},children:["Main photo media id: ",(g==null?void 0:g.mainPhotoMediaId)??"-",e.jsx("br",{}),"Gallery count: ",((k=g==null?void 0:g.galleryMediaIds)==null?void 0:k.length)??0,e.jsx("br",{}),"Video media id: ",(g==null?void 0:g.videoMediaId)??"-"]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"YOUR GALLERY"}),(u=g==null?void 0:g.galleryMediaIds)!=null&&u.length?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(130px, 1fr))",gap:10},children:g.galleryMediaIds.map(y=>e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.45)",borderRadius:10,padding:8,display:"grid",gap:8},children:[e.jsx("img",{src:p[y]??He(y),alt:"Gallery photo",style:{width:"100%",aspectRatio:"1/1",objectFit:"cover",borderRadius:8,border:"1px solid rgba(255,58,77,0.4)"}}),e.jsx("button",{type:"button",style:H(R),disabled:R,onClick:()=>void oe(y),children:"SET MAIN"}),e.jsx("button",{type:"button",style:H(R),disabled:R,onClick:()=>void ue(y),children:"REMOVE"})]},y))}):e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No gallery photos uploaded yet."})]})]})})]})}function Gi({api:t,session:i,setLastError:a,onLogout:k}){const[u,f]=s.useState({discreetMode:!1,travelEnabled:!1,travelLat:"",travelLng:""}),[b,g]=s.useState("Loading settings..."),[F,D]=s.useState(!1),[J,R]=s.useState([]);async function U(){var v,w,C;try{const L=await t.getMyProfile(i.sessionToken);if(f({discreetMode:L.profile.discreetMode===!0,travelEnabled:((v=L.profile.travelMode)==null?void 0:v.enabled)===!0,travelLat:typeof((w=L.profile.travelMode)==null?void 0:w.lat)=="number"?String(L.profile.travelMode.lat):"",travelLng:typeof((C=L.profile.travelMode)==null?void 0:C.lng)=="number"?String(L.profile.travelMode.lng):""}),g("Settings loaded."),i.userType!=="guest")try{const _=await t.listBlocked(i.sessionToken);R(_.blocked)}catch{R([])}else R([])}catch(L){g(G(L))}}async function j(){try{const v=await fetch("/api/config"),w=await v.json();if(!v.ok)throw w;D(w.mediaStorageConfigured===!0)}catch{D(!1)}}s.useEffect(()=>{U(),j()},[i.sessionToken,i.userType]);async function l(){try{const v=await t.getMyProfile(i.sessionToken),w=u.travelLat.trim()?Number(u.travelLat):void 0,C=u.travelLng.trim()?Number(u.travelLng):void 0;await t.upsertMyProfile(i.sessionToken,{displayName:v.profile.displayName,age:v.profile.age,bio:v.profile.bio,stats:v.profile.stats,discreetMode:u.discreetMode,travelMode:{enabled:u.travelEnabled,lat:Number.isFinite(w)?w:void 0,lng:Number.isFinite(C)?C:void 0}}),g("Privacy settings saved.")}catch(v){const w=G(v);g(w),a(w)}}async function p(){if(!navigator.geolocation){const v="Geolocation is unavailable on this device.";g(v),a(v);return}try{const v=await new Promise((L,_)=>{navigator.geolocation.getCurrentPosition(L,_,{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})}),w=Number(v.coords.latitude.toFixed(6)),C=Number(v.coords.longitude.toFixed(6));f(L=>({...L,travelEnabled:!0,travelLat:String(w),travelLng:String(C)}));try{localStorage.setItem("reddoor_travel_center",JSON.stringify({enabled:!0,lat:w,lng:C}))}catch{}try{await t.updatePresence(i.sessionToken,w,C,"online")}catch{}window.dispatchEvent(new CustomEvent("rd:location-updated",{detail:{lat:w,lng:C}})),g("Actual location detected. Save privacy settings to persist it.")}catch(v){const w=G(v);g(w),a(w)}}async function z(){try{const v=u.travelLat.trim()?Number(u.travelLat):void 0,w=u.travelLng.trim()?Number(u.travelLng):void 0,C=await t.seedFakeUsers(12,Number.isFinite(v)?v:void 0,Number.isFinite(w)?w:void 0);g(`Seeded ${C.seededCount} fake users for testing.`)}catch(v){const w=G(v);g(w),a(w)}}async function O(v){try{await t.unblock(i.sessionToken,v);const w=await t.listBlocked(i.sessionToken);R(w.blocked),g("Blocked users updated.")}catch(w){const C=G(w);g(C),a(C)}}return e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:Re(),children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"SETTINGS"}),e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:b}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:u.discreetMode,onChange:v=>f(w=>({...w,discreetMode:v.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Discreet Mode (hide your profile)"})]}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:u.travelEnabled,onChange:v=>f(w=>({...w,travelEnabled:v.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Travel Mode"})]}),u.travelEnabled?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("input",{value:u.travelLat,onChange:v=>f(w=>({...w,travelLat:v.target.value})),style:Q(),placeholder:"Travel lat"}),e.jsx("input",{value:u.travelLng,onChange:v=>f(w=>({...w,travelLng:v.target.value})),style:Q(),placeholder:"Travel lng"})]}):null,e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:ve(!1),onClick:()=>void l(),children:"SAVE PRIVACY"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>void p(),children:"DETECT ACTUAL LOCATION"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>void z(),children:"SEED FAKE USERS"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>k==null?void 0:k(),children:"LOGOUT"})]})]})}),e.jsx("div",{style:Re(),children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"MEDIA STORAGE"}),e.jsx("div",{style:{color:F?"#26d5ff":"#ff8a95",fontSize:14},children:F?"Configured: uploads enabled.":"Not configured: set S3_BUCKET, S3_REGION, S3_ACCESS_KEY_ID, S3_SECRET_ACCESS_KEY."}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>void j(),children:"REFRESH STORAGE STATUS"})]})}),i.userType!=="guest"?e.jsx("div",{style:Re(),children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"BLOCKED USERS"}),J.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No blocked users."}):J.map(v=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[e.jsx("div",{style:{color:"#ced3dc",fontSize:14},children:v}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>void O(v),children:"UNBLOCK"})]},v))]})}):null]})}function Ji({api:t,session:i,setSession:a,settings:k,activeTab:u,setActiveTab:f,discoverScreen:b,onDiscoverScreenChange:g,discoverFilter:F,busy:D,setBusy:J,setLastError:R,onUnreadCountChange:U,hideModeCard:j,onLogout:l}){const p=zi(),[z,O]=s.useState(null),v=e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx(Bi,{api:t,session:i,setLastError:R}),e.jsx(Gi,{api:t,session:i,setLastError:R,onLogout:l})]});return e.jsxs("div",{style:{display:"grid",gap:12},children:[null,e.jsx("div",{style:{display:u==="discover"?"block":"none"},children:e.jsx(Li,{api:t,session:i,settings:k,discoverFilter:F,busy:D,setBusy:J,setLastError:R,isMobile:p,discoverScreen:b,onDiscoverScreenChange:g,onOpenThreadRequested:w=>{O({key:Te(w),nonce:Date.now()}),f("threads")},onUnreadCountChange:U})}),u==="threads"?e.jsx(Wi,{api:t,session:i,setLastError:R,openThreadRequest:z,onThreadRequestConsumed:()=>O(null),isMobile:p}):null,u==="public"?e.jsx(Ki,{api:t,session:i,isMobile:p,setLastError:R}):null,u==="profile"||u==="settings"?v:null,u==="submissions"?e.jsx(Di,{api:t,session:i,setLastError:R}):null,u==="promoted"?e.jsx(_i,{api:t,session:i,setLastError:R}):null]})}export{Ji as Router};
