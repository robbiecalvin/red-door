const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./maplibre-gl-BBv2PdBF.js","./index-B5V8o1gb.js","./index-CcRnFIlo.css"])))=>i.map(i=>d[i]);
import{r as s,j as e,_ as fn,p as Vt,a as Yt,b as Jt,u as bt}from"./index-B5V8o1gb.js";function Qt(t){return typeof t=="object"&&t!==null}function gn(t){return!(!Qt(t)||typeof t.key!="string"||t.userType!=="guest"&&t.userType!=="registered"&&t.userType!=="subscriber"||typeof t.lat!="number"||!Number.isFinite(t.lat)||typeof t.lng!="number"||!Number.isFinite(t.lng)||typeof t.updatedAtMs!="number"||!Number.isFinite(t.updatedAtMs)||t.status!==void 0&&typeof t.status!="string")}function qt(t){const[n,a]=s.useState(()=>new Map),[f,u]=s.useState(null),v=s.useRef(null),S=s.useRef(null);return s.useEffect(()=>{if(t.disabled===!0||t.wsUrl.trim()===""){a(new Map),u(null),S.current!==null&&(window.clearTimeout(S.current),S.current=null);return}let A=!1,U=0,B=null;const D=()=>{B!==null&&(window.clearInterval(B),B=null)},P=()=>{if(A)return;const o=Math.min(8e3,500*2**Math.min(U,4));S.current=window.setTimeout(()=>{S.current=null,T()},o)},T=()=>{if(A)return;let o;try{o=new WebSocket(t.wsUrl)}catch{U+=1,u("Realtime unavailable in this mode."),P();return}v.current=o;let b=!1;o.onopen=()=>{b=!0,U=0,u(null);const C={};t.sessionToken&&(C.sessionToken=t.sessionToken),t.jwt&&(C.jwt=t.jwt),o.send(JSON.stringify({type:"auth",payload:C})),B=window.setInterval(()=>{o.readyState===o.OPEN&&o.send(JSON.stringify({type:"heartbeat",payload:{}}))},15e3)},o.onmessage=C=>{const O=(()=>{try{return JSON.parse(String(C.data))}catch{return null}})();if(!O||typeof O.type!="string"){u("Invalid server message.");return}if(O.type==="error"&&Qt(O.payload)&&typeof O.payload.message=="string"){u(O.payload.message);return}if(O.type==="presence_update"){const g=O.payload;if(!gn(g)){u("Invalid presence payload.");return}a(j=>{const L=new Map(j);return L.set(g.key,g),L})}},o.onerror=()=>{},o.onclose=C=>{if(D(),!A&&C.code!==1e3){U+=1;const O=typeof C.reason=="string"&&C.reason.trim()!==""?` Reason: ${C.reason}`:"";(U>=2||b)&&u(`Realtime ${b?"disconnected":"failed to connect"} (code ${C.code}). Reconnecting...${O}`),P()}}};return T(),()=>{var o;A=!0,D(),S.current!==null&&(window.clearTimeout(S.current),S.current=null),(o=v.current)==null||o.close(1e3,"Client cleanup"),v.current=null}},[t.disabled,t.jwt,t.sessionToken,t.wsUrl]),{state:s.useMemo(()=>({byKey:n}),[n]),lastErrorMessage:f}}async function yn(){const t=await fn(()=>import("./maplibre-gl-BBv2PdBF.js").then(a=>a.m),__vite__mapDeps([0,1,2]),import.meta.url);return t.default??t}function pn(t){return t.replace(/[&<>"']/g,n=>{switch(n){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return n}})}function hn(){return{version:8,sources:{basemap:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png","https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"Â© OpenStreetMap contributors"}},layers:[{id:"basemap",type:"raster",source:"basemap"}]}}function mn(t){const n=document.createElement("button");return n.type="button",n.setAttribute("aria-label",t.label??"Presence marker"),n.style.width="40px",n.style.height="40px",n.style.borderRadius="999px",n.style.border=`2px solid ${t.color}`,n.style.touchAction="manipulation",n.style.userSelect="none",t.markerType==="spot"?(n.style.background="radial-gradient(circle at 30% 30%, #ff4f60, #a70013)",n.style.display="grid",n.style.placeItems="center",n.style.color="#ffffff",n.style.fontWeight="700",n.style.fontSize="13px",n.textContent=typeof t.markerGlyph=="string"&&t.markerGlyph.trim()?t.markerGlyph.trim().slice(0,2):"SP"):typeof t.imageUrl=="string"&&t.imageUrl.trim()!==""?(n.style.backgroundImage=`url("${t.imageUrl}")`,n.style.backgroundSize="cover",n.style.backgroundPosition="center"):n.style.background="#000000",n.style.padding="0",n.style.cursor=typeof t.onClick=="function"?"pointer":"default",n.style.pointerEvents="auto",n}function bn({initialView:t,markers:n,interactive:a,visible:f}){const u=s.useRef(null),v=s.useRef(null),S=s.useRef(null),I=s.useRef([]),[A,U]=s.useState({kind:"ready"}),B=s.useMemo(()=>t.center,[t.center]),D=a!==!1,P=f!==!1;return s.useEffect(()=>{let T=!1,o=null,b=null,C=null;async function O(){if(u.current&&!S.current)try{v.current||(v.current=await yn());const g=v.current,j=new g.Map({container:u.current,style:hn(),center:[B.lng,B.lat],zoom:t.zoom,interactive:D});j.addControl(new g.NavigationControl({showCompass:!1}),"top-right"),S.current=j;const L=()=>{j.resize()};b=L,C=window.requestAnimationFrame(L),window.addEventListener("resize",L),o=new ResizeObserver(()=>L()),o.observe(u.current),j.on("error",M=>{var ae;const ee=((ae=M.error)==null?void 0:ae.message)??"Map error.";T||ee.toLowerCase().includes("failed to fetch")||ee.toLowerCase().includes("network")||U({kind:"error",message:ee})}),j.once("load",()=>{T||U({kind:"ready"})})}catch(g){if(T)return;U({kind:"error",message:g instanceof Error?g.message:"Map error."})}}return O(),()=>{var g;T=!0,C!==null&&window.cancelAnimationFrame(C),b&&window.removeEventListener("resize",b),o==null||o.disconnect();for(const j of I.current)j.remove();I.current=[],(g=S.current)==null||g.remove(),S.current=null}},[D]),s.useEffect(()=>{const T=S.current;if(!T||!P)return;T.resize();const o=window.setTimeout(()=>{T.resize(),T.setCenter([t.center.lng,t.center.lat]),T.setZoom(t.zoom)},80);return()=>window.clearTimeout(o)},[t.center.lat,t.center.lng,t.zoom,P]),s.useEffect(()=>{const T=S.current;if(!T||!P)return;T.resize();const o=window.setTimeout(()=>T.resize(),120);return()=>window.clearTimeout(o)},[P]),s.useEffect(()=>{const T=S.current,o=v.current;if(!(!T||!o)){for(const b of I.current)b.remove();I.current=[];for(const b of n){const C=typeof b.label=="string"&&b.label.trim()!==""?new o.Popup({closeButton:!1,closeOnClick:!0}).setHTML(`<div style="font-family: var(--ui); font-size: 12px; line-height: 1.35;">
                 <div style="font-weight: 600;">${pn(b.label)}</div>
               </div>`):void 0,O=mn(b);if(typeof b.onClick=="function"){const j=L=>{var M;L.preventDefault(),L.stopPropagation(),(M=b.onClick)==null||M.call(b)};O.addEventListener("click",j),O.addEventListener("touchend",j,{passive:!1}),O.addEventListener("pointerup",j)}const g=new o.Marker({element:O}).setLngLat([b.position.lng,b.position.lat]);C&&g.setPopup(C),g.addTo(T),I.current.push(g)}}},[n]),A.kind==="error"?e.jsxs("div",{style:{background:"#000000",color:"#F22F2F",border:"2px solid #C00000",borderRadius:8,padding:12,fontFamily:"var(--ui)",fontSize:14,lineHeight:1.4},role:"alert","aria-live":"polite",children:["Map error: ",A.message]}):e.jsx("div",{ref:u,className:"rd-maplibre",style:{width:"100%",height:"100%",background:"#000000",borderRadius:8,overflow:"hidden"},"aria-label":"Cruise map"})}const Wt=[Vt,Yt,Jt];function vn(t){let n=0;for(let a=0;a<t.length;a+=1)n=n*31+t.charCodeAt(a)|0;return Math.abs(n)}function xn(t){return Wt[vn(t)%Wt.length]}function jn(t,n,a){return t.map(f=>({id:f.key,position:{lat:f.lat,lng:f.lng},color:"#C00000",label:f.status?`Presence: ${f.status}`:"Presence",imageUrl:(n==null?void 0:n[f.key])??xn(f.key),onClick:a?()=>a(f.key):void 0}))}function Dt({wsUrl:t,sessionToken:n,jwt:a,defaultCenter:f,defaultZoom:u,presenceUpdates:v,realtimeErrorMessage:S,onMarkerSelect:I,avatarByKey:A,additionalMarkers:U,height:B,visible:D}){const P=qt({wsUrl:t,sessionToken:n,jwt:a,disabled:Array.isArray(v)}),T=v?{byKey:new Map(v.map(M=>[M.key,M]))}:P.state,o=S??P.lastErrorMessage,[b,C]=s.useState({kind:"pending"});s.useEffect(()=>{if(!("geolocation"in navigator)||!navigator.geolocation){C({kind:"unavailable"});return}navigator.geolocation.getCurrentPosition(M=>{C({kind:"granted",center:{lat:M.coords.latitude,lng:M.coords.longitude}})},M=>{if(M.code===M.PERMISSION_DENIED){C({kind:"denied"});return}if(M.code===M.TIMEOUT){C({kind:"error",message:"Timed out while trying to read your location. Showing the default map view."});return}C({kind:"error",message:M.message||"Geolocation error."})},{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e4})},[]);const O=s.useMemo(()=>Array.from(T.byKey.values()),[T.byKey]),g=s.useMemo(()=>[...jn(O,A,I),...U??[]],[U,A,I,O]),j=s.useMemo(()=>{const M=typeof u=="number"&&Number.isFinite(u)?u:13;return b.kind==="granted"?{center:b.center,zoom:M}:{center:f,zoom:M}},[f,u,b]),L=s.useMemo(()=>b.kind==="denied"?"Location permission denied. Showing the default map view.":b.kind==="unavailable"?"Geolocation is unavailable. Showing the default map view.":b.kind==="error"?`Geolocation error: ${b.message}`:null,[b]);return e.jsxs("section",{"aria-label":"Cruise mode map",style:{background:"#000000",color:"#FFFFFF",fontFamily:"var(--ui)",display:"grid",gap:8,height:"100%"},children:[L?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"rgba(0,0,0,0.7)",border:"1px solid rgba(255,58,77,0.45)",borderRadius:0,padding:8,color:"#AAAAAA",fontSize:12,lineHeight:1.4},children:L}):null,o?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"rgba(0,0,0,0.7)",border:"1px solid rgba(255,58,77,0.45)",borderRadius:0,padding:8,color:"#F22F2F",fontSize:12,lineHeight:1.4},children:o}):null,e.jsx("div",{style:{background:"#111111",border:0,borderRadius:0,overflow:"hidden",height:typeof B=="number"||typeof B=="string"?B:520},children:e.jsx(bn,{initialView:j,markers:g,visible:D})})]})}const wn="FIRE_SIGNAL|1";function Sn(t){return new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function Bt(t){if(!t.startsWith("LOCATION|"))return null;const[,n,a]=t.split("|"),f=Number(n),u=Number(a);return!Number.isFinite(f)||!Number.isFinite(u)?null:{lat:f,lng:u,link:`https://maps.google.com/?q=${f},${u}`}}function kn(t){return t.trim()===wn?"ðŸ”¥ I'm into you":t}function Xt({chatKind:t,peerKey:n,currentUserKey:a,messages:f,client:u,title:v,peerSummary:S,thirdParty:I,edgeToEdge:A,showHeader:U,fillHeight:B}){const[D,P]=s.useState(""),[T,o]=s.useState(null),[b,C]=s.useState(!1),[O,g]=s.useState({}),[j,L]=s.useState(!1),[M,ee]=s.useState(!1),ae=s.useRef(null),pe=s.useRef([]),ge=s.useRef(null),ce=s.useRef(null),he=s.useRef(null),y=A===!0,p=U!==!1,R=y&&B===!0,ne=s.useMemo(()=>[...f].sort((d,W)=>d.createdAtMs-W.createdAtMs),[f]),E=s.useMemo(()=>Array.from(new Set(ne.map(d=>{var W;return(W=d.media)==null?void 0:W.objectKey}).filter(d=>typeof d=="string"&&d.trim().length>0))),[ne]);s.useEffect(()=>{let d=!1;async function W(){for(const r of E){if(d)return;if(!O[r])try{const m=await u.getMediaUrl(r);if(d)return;g(F=>({...F,[r]:m}))}catch{}}}return W(),()=>{d=!0}},[u,E,O]);async function te(d){const W=D.trim();if(!(W.length===0&&!d)){C(!0),o(null);try{await u.sendMessage(t,n,W,d),P("")}catch(r){const m=r;o(typeof(m==null?void 0:m.message)=="string"?m.message:"Message rejected.")}finally{C(!1)}}}async function k(d){C(!0),o(null);try{const W=await u.initiateMediaUpload(d.type||"application/octet-stream",d.size);await u.uploadToSignedUrl(W.uploadUrl,d,d.type||"application/octet-stream");const m={kind:d.type.startsWith("image/")?"image":d.type.startsWith("video/")?"video":"audio",objectKey:W.objectKey,mimeType:d.type||"application/octet-stream"};await te(m)}catch(W){const r=W;o(typeof(r==null?void 0:r.message)=="string"?r.message:"Upload rejected."),C(!1)}}async function ue(d){var r;const W=(r=d.target.files)==null?void 0:r[0];if(d.target.value="",!!W){if(!W.type.startsWith("image/")&&!W.type.startsWith("video/")&&!W.type.startsWith("audio/")){o("Only image, video, or audio files are supported.");return}await k(W)}}async function oe(){var d;if(j){(d=ae.current)==null||d.stop();return}if(!navigator.mediaDevices||typeof navigator.mediaDevices.getUserMedia!="function"){o("Microphone is not available in this browser.");return}try{const W=await navigator.mediaDevices.getUserMedia({audio:!0}),r=new MediaRecorder(W);pe.current=[],ae.current=r,r.ondataavailable=m=>{m.data.size>0&&pe.current.push(m.data)},r.onstop=()=>{const m=new Blob(pe.current,{type:r.mimeType||"audio/webm"}),F=new File([m],`voice-${Date.now()}.webm`,{type:r.mimeType||"audio/webm"});k(F);for(const se of W.getTracks())se.stop();ae.current=null,L(!1)},r.start(),L(!0)}catch(W){const r=W;o(typeof(r==null?void 0:r.message)=="string"?r.message:"Unable to record voice."),L(!1)}}async function me(){if(!navigator.geolocation){o("Geolocation is not available in this browser.");return}C(!0),o(null);try{const d=await new Promise((F,se)=>{navigator.geolocation.getCurrentPosition(F,se,{enableHighAccuracy:!1,timeout:12e3,maximumAge:3e4})}),W=Number(d.coords.latitude.toFixed(5)),r=Number(d.coords.longitude.toFixed(5)),m=`LOCATION|${W}|${r}`;await u.sendMessage(t,n,m)}catch(d){const W=d;o(typeof(W==null?void 0:W.message)=="string"?W.message:"Unable to send location.")}finally{C(!1)}}return e.jsxs("section",{"aria-label":"Chat",style:{background:y?"transparent":"#000000",color:"#FFFFFF",fontFamily:"Montserrat, sans-serif",padding:y?0:16,display:"grid",gap:y?0:12,gridTemplateRows:p?"auto auto 1fr auto":"1fr auto",minHeight:B?"calc(100dvh - 196px)":void 0},children:[p?e.jsxs("header",{style:{height:56,display:"grid",alignItems:"center",background:"#000000"},children:[e.jsx("div",{style:{textAlign:"center",fontSize:20,fontWeight:600},children:v}),S?e.jsxs("div",{style:{marginTop:4,display:"flex",alignItems:"center",justifyContent:"center",gap:8,color:"#b7d8e0",fontSize:13},children:[e.jsx("span",{children:"Chat with:"}),S.avatarUrl?e.jsx("img",{src:S.avatarUrl,alt:`${S.displayName} avatar`,style:{width:24,height:24,borderRadius:"50%",objectFit:"cover",border:"1px solid rgba(38,213,255,0.8)"}}):e.jsx("span",{"aria-hidden":!0,style:{width:24,height:24,borderRadius:"50%",border:"1px solid rgba(38,213,255,0.8)",background:"rgba(255,255,255,0.08)"}}),e.jsx("span",{style:{color:"#fff",fontWeight:600},children:S.displayName})]}):null,e.jsx("div",{style:{textAlign:"center",fontSize:12,color:"#AAAAAA"},children:t==="cruise"?"CRUISE CHAT (EPHEMERAL)":"DATE CHAT (PERSISTENT)"})]}):null,T?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"#111111",border:"2px solid #C00000",borderRadius:8,padding:12,color:"#F22F2F",fontSize:14,lineHeight:1.4},children:T}):null,e.jsx("div",{"aria-label":"Messages",style:{background:y?"#09090b":"#111111",border:y?"none":"2px solid #C00000",borderRadius:y?0:8,padding:12,display:"flex",flexDirection:"column",gap:12,minHeight:y?0:320,paddingBottom:R?148:12,overflowY:"auto"},children:ne.length===0?e.jsx("div",{style:{color:"#AAAAAA",fontSize:14,lineHeight:1.4},children:"No messages."}):ne.map(d=>{const W=d.fromKey===a,r=W?"#C00000":"#444444",m=W?{alignItems:"flex-end"}:{alignItems:"flex-start"};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,width:"100%",...m},children:[(()=>{const F=Bt(d.text??"");return F?e.jsxs("a",{href:F.link,target:"_blank",rel:"noreferrer",style:{display:"grid",gap:6,textDecoration:"none",color:"#fff",background:r,borderRadius:14,padding:8,width:"auto",maxWidth:"80%"},children:[e.jsx("div",{style:{fontSize:12,color:"#d8ecff"},children:"Shared location"}),e.jsx("iframe",{title:"Google Maps location preview",src:`https://www.google.com/maps?q=${F.lat},${F.lng}&z=14&output=embed`,style:{width:"100%",height:140,border:"1px solid rgba(255,255,255,0.18)",borderRadius:10},loading:"lazy",referrerPolicy:"no-referrer-when-downgrade"}),e.jsx("div",{style:{fontSize:12,color:"#3fdfff"},children:"Open in Google Maps"})]}):null})(),e.jsxs("div",{style:{background:r,color:"#FFFFFF",borderRadius:18,padding:"8px 12px",width:"auto",maxWidth:"80%",fontSize:16,lineHeight:1.4,whiteSpace:"pre-wrap",overflowWrap:"anywhere",wordBreak:"break-word"},children:[d.text&&!Bt(d.text)?e.jsx("div",{style:{marginBottom:d.media?8:0},children:kn(d.text)}):null,d.media?e.jsxs("div",{children:[d.media.kind==="image"?e.jsx("img",{src:O[d.media.objectKey],alt:"Shared",style:{width:"100%",maxWidth:260,borderRadius:10,border:"1px solid rgba(255,255,255,0.18)"}}):null,d.media.kind==="video"?e.jsx("video",{controls:!0,playsInline:!0,src:O[d.media.objectKey],style:{width:"100%",maxWidth:320,borderRadius:10,background:"#000"}}):null,d.media.kind==="audio"?e.jsx("audio",{controls:!0,src:O[d.media.objectKey],style:{width:"100%",maxWidth:260}}):null]}):null]}),e.jsx("div",{style:{fontSize:10,color:"#AAAAAA"},children:Sn(d.createdAtMs)}),W?e.jsx("div",{style:{fontSize:10,color:"#6fdcff"},children:typeof d.readAtMs=="number"?"Read":typeof d.deliveredAtMs=="number"?"Delivered":""}):null]},d.messageId)})}),e.jsxs("form",{onSubmit:d=>{d.preventDefault(),te()},"aria-label":"Message input",style:{background:y?"linear-gradient(180deg, rgba(96,0,12,0.96), rgba(58,0,8,0.98))":"#111111",border:y?"none":"2px solid #C00000",borderRadius:y?0:8,padding:12,display:"grid",gridTemplateColumns:"1fr auto auto",gap:12,alignItems:"start",position:R?"fixed":"static",left:R?0:void 0,right:R?0:void 0,bottom:R?"calc(env(safe-area-inset-bottom, 0px) + 66px)":void 0,zIndex:R?45:void 0},children:[e.jsx("label",{style:{display:"grid"},children:e.jsx("input",{value:D,onChange:d=>P(d.target.value),placeholder:"Type a message",disabled:b,style:{width:"100%",background:"#111111",color:"#FFFFFF",border:"2px solid #444444",borderRadius:8,padding:"10px 12px",fontSize:16,lineHeight:1.4,outline:"none"},"aria-label":"Message text"})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{ref:ge,type:"file",accept:"image/*,video/*,audio/*",disabled:b,onChange:d=>void ue(d),style:{display:"none"}}),e.jsx("input",{ref:ce,type:"file",accept:"image/*",capture:"environment",disabled:b,onChange:d=>void ue(d),style:{display:"none"}}),e.jsx("input",{ref:he,type:"file",accept:"video/*",capture:"environment",disabled:b,onChange:d=>void ue(d),style:{display:"none"}}),e.jsx("button",{type:"button",disabled:b,onClick:()=>ee(d=>!d),style:{background:"rgba(0,0,0,0.45)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px",display:"grid",placeItems:"center",cursor:b?"not-allowed":"pointer",color:"#3fdfff",fontWeight:700,height:44,minWidth:44},"aria-label":"More actions",children:"+"}),M?e.jsxs("div",{style:{position:"absolute",right:0,top:R?void 0:48,bottom:R?48:void 0,zIndex:5,minWidth:220,display:"grid",gap:8,padding:10,borderRadius:10,border:"1px solid rgba(255,58,77,0.5)",background:"rgba(10,11,16,0.98)"},children:[e.jsx("button",{type:"button",disabled:b,onClick:()=>{var d;ee(!1),(d=ce.current)==null||d.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Take Photo"}),e.jsx("button",{type:"button",disabled:b,onClick:()=>{var d;ee(!1),(d=he.current)==null||d.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Record Video"}),e.jsx("button",{type:"button",disabled:b,onClick:()=>{var d;ee(!1),(d=ge.current)==null||d.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Choose Media"}),e.jsx("button",{type:"button",disabled:b,onClick:()=>{ee(!1),oe()},style:{background:j?"#ff2136":"rgba(0,0,0,0.6)",color:"#fff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:j?"Stop Voice":"Record Voice"}),e.jsx("button",{type:"button",disabled:b,onClick:()=>{ee(!1),me()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Send Location"}),I?e.jsxs("div",{style:{display:"grid",gap:8,borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:8},children:[e.jsxs("select",{value:I.selectedKey,onChange:d=>I.onSelect(d.target.value),disabled:I.disabled||I.candidates.length===0,style:{background:"#0b0d12",color:"#fff",border:"1px solid rgba(255,58,77,0.62)",borderRadius:10,padding:"8px 10px"},"aria-label":"Add previous contact to group",children:[I.candidates.length===0?e.jsx("option",{value:"",children:"No previous contacts"}):null,I.candidates.map(d=>e.jsx("option",{value:d.key,children:d.label},d.key))]}),e.jsx("button",{type:"button",onClick:()=>{I.onAdd(),ee(!1)},disabled:I.disabled||I.candidates.length===0||!I.selectedKey,style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,58,77,0.62)",borderRadius:10,padding:"8px 10px",fontWeight:700},children:"Add Third User"})]}):null]}):null]}),e.jsx("button",{type:"submit",disabled:b,style:{background:b?"#333333":"#C00000",color:b?"#777777":"#FFFFFF",border:"2px solid #C00000",borderRadius:8,padding:"10px 20px",fontSize:16,fontWeight:600,cursor:b?"not-allowed":"pointer",height:44},"aria-label":"Send message",children:"SEND"})]})]})}const vt="FIRE_SIGNAL|1";function Ee(){return{background:"radial-gradient(500px 220px at 10% 0%, rgba(255,28,46,0.15), transparent 58%), linear-gradient(180deg, rgba(8,8,10,0.88), rgba(4,4,5,0.9))",border:"1px solid rgba(255,56,74,0.56)",borderRadius:20,padding:14,boxShadow:"inset 0 1px 0 rgba(255,255,255,0.06), inset 0 0 0 1px rgba(0,0,0,0.28), 0 16px 32px rgba(0,0,0,0.42)"}}function ve(t){return{background:t?"rgba(90,90,90,0.55)":"linear-gradient(180deg, #ff2136, #c60012)",border:"1px solid rgba(255,70,90,0.68)",color:t?"#999999":"#FFFFFF",padding:"10px 18px",borderRadius:12,fontSize:15,fontWeight:700,letterSpacing:"0.04em",cursor:t?"not-allowed":"pointer",textTransform:"uppercase",boxShadow:t?"none":"inset 0 1px 0 rgba(255,255,255,0.2), 0 10px 22px rgba(198,0,18,0.34)"}}function _(t){return{background:"rgba(0,0,0,0.58)",border:"1px solid rgba(255,58,77,0.62)",color:"#3fdfff",padding:"10px 18px",borderRadius:12,fontSize:15,fontWeight:700,letterSpacing:"0.03em",cursor:t?"not-allowed":"pointer",textTransform:"uppercase",opacity:t?.6:1}}function Z(){return{background:"rgba(6,7,10,0.92)",color:"#ffffff",border:"1px solid rgba(255,64,82,0.48)",borderRadius:12,padding:"10px 12px",fontSize:15}}function In(t){return typeof t=="string"}function Y(t){const n=t;return In(n==null?void 0:n.message)?n.message:"Action rejected."}function gt(){const t="__disabled__".trim();if(t==="__disabled__")return"";if(t!==""){if(t.startsWith("ws://")||t.startsWith("wss://"))return t;try{const a=new URL(t);return a.protocol=a.protocol==="https:"?"wss:":"ws:",a.toString()}catch{if(t.startsWith("/")){const a=new URL(t,window.location.origin);return a.protocol=a.protocol==="https:"?"wss:":"ws:",a.toString()}}}const n=new URL("/ws",window.location.origin);return n.protocol=n.protocol==="https:"?"wss:":"ws:",n.toString()}const $t=[Vt,Yt,Jt];function Cn(t){let n=0;for(let a=0;a<t.length;a+=1)n=n*31+t.charCodeAt(a)|0;return Math.abs(n)}function Be(t){return $t[Cn(t)%$t.length]}function mt(t){if(t.startsWith("user:")){const n=t.slice(5).trim();return n.length>0?n:null}if(t.startsWith("session:")){const n=t.slice(8).trim();return n.length>0?`guest:${n}`:null}return null}function Ue(t){if(t.startsWith("guest:")){const n=t.slice(6).trim();return n?`session:${n}`:`user:${t}`}return`user:${t}`}function Ce(t){const n=t.trim();if(!n)return n;if(n.startsWith("user:guest:")){const a=n.slice(11).trim();return a?`session:${a}`:n}if(n.startsWith("guest:")){const a=n.slice(6).trim();return a?`session:${a}`:n}return n}function Tn(t){return t.trim()===vt}function Zt(t){return Tn(t)?"ðŸ”¥ I'm into you":t}function yt(t,n){const a=B=>B*Math.PI/180,u=a(n.lat-t.lat),v=a(n.lng-t.lng),S=Math.sin(u/2),I=Math.sin(v/2),A=S*S+Math.cos(a(t.lat))*Math.cos(a(n.lat))*I*I;return 6371e3*(2*Math.atan2(Math.sqrt(A),Math.sqrt(1-A)))}function Mn(t){return!Number.isFinite(t)||t<0?"-":t<1e3?`${Math.round(t)} m`:t<1e4?`${(t/1e3).toFixed(1)} km`:`${Math.round(t/1e3)} km`}function Ht(){try{const t=localStorage.getItem("reddoor_travel_center");if(!t)return null;const n=JSON.parse(t);return n.enabled!==!0?null:typeof n.lat=="number"&&Number.isFinite(n.lat)&&typeof n.lng=="number"&&Number.isFinite(n.lng)?{lat:n.lat,lng:n.lng}:null}catch{return null}}function An(){const[t,n]=s.useState(()=>window.matchMedia("(max-width: 900px)").matches);return s.useEffect(()=>{const a=window.matchMedia("(max-width: 900px)"),f=()=>n(a.matches);return f(),a.addEventListener("change",f),()=>a.removeEventListener("change",f)},[]),t}function tt(t){return t==="instant"?"cruise":"date"}function Rn({api:t,session:n,settings:a,discoverFilter:f,busy:u,setBusy:v,setLastError:S,isMobile:I,discoverScreen:A,onDiscoverScreenChange:U,onOpenThreadRequested:B,onUnreadCountChange:D}){var st,Ke,He,Xe,Ye,Ze;const[P,T]=s.useState(A),[o,b]=s.useState(null),[C,O]=s.useState(null),[g,j]=s.useState(null),[L,M]=s.useState([]),[ee,ae]=s.useState({}),[pe,ge]=s.useState([]),[ce,he]=s.useState(new Set),[y,p]=s.useState(new Set),[R,ne]=s.useState({}),[E,te]=s.useState({}),[k,ue]=s.useState(null),[oe,me]=s.useState(0),[d,W]=s.useState(!1),[r,m]=s.useState([]),[F,se]=s.useState(null),[le,we]=s.useState(()=>Ht()),{state:ke,lastErrorMessage:de}=qt({wsUrl:gt(),sessionToken:n.sessionToken}),xe=s.useMemo(()=>Array.from(ke.byKey.values()),[ke.byKey]);s.useEffect(()=>{T(A)},[A]),s.useEffect(()=>{const c=()=>{we(Ht())},h=w=>{(w.key===null||w.key==="reddoor_travel_center")&&c()};return c(),window.addEventListener("rd:location-updated",c),window.addEventListener("storage",h),()=>{window.removeEventListener("rd:location-updated",c),window.removeEventListener("storage",h)}},[]);const G=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,be=s.useMemo(()=>{const c=new Map;for(const h of L)c.set(h.key,h);for(const h of xe){const w=c.get(h.key);(!w||h.updatedAtMs>=w.updatedAtMs)&&c.set(h.key,h)}return Array.from(c.values())},[xe,L]),Re=s.useMemo(()=>be.filter(c=>c.key!==G),[G,be]),Se=s.useMemo(()=>g?[...Re].sort((c,h)=>yt(g,{lat:c.lat,lng:c.lng})-yt(g,{lat:h.lat,lng:h.lng})):Re,[Re,g]),We=s.useMemo(()=>{if(!C)return null;if(C===G)return"0 m";if(!g)return null;const c=be.find(h=>h.key===C);return c?Mn(yt(g,{lat:c.lat,lng:c.lng})):null},[G,be,C,g]);s.useEffect(()=>{let c=!1;async function h(){try{const $=await t.listActivePresence(n.sessionToken);if(c)return;const Q=Array.isArray($.presence)?$.presence:[];M(Q)}catch{c||M([])}}h();const w=window.setInterval(()=>{h()},8e3);return()=>{c=!0,window.clearInterval(w)}},[t,n.sessionToken]),s.useEffect(()=>{o||Se.length>0&&b(Se[0].key)},[o,Se]),s.useEffect(()=>{const c=Se.filter(h=>!ee[h.key]).map(h=>({key:h.key,profileId:mt(h.key)})).filter(h=>typeof h.profileId=="string");c.length!==0&&Promise.all(c.map(async h=>{var w,$;try{const Q=await t.getPublicProfile(h.profileId);return{key:h.key,displayName:(w=Q.profile)==null?void 0:w.displayName,age:($=Q.profile)==null?void 0:$.age}}catch{return null}})).then(h=>{ae(w=>{const $={...w};for(const Q of h)Q&&($[Q.key]={displayName:Q.displayName,age:Q.age});return $})})},[t,ee,Se]),s.useEffect(()=>{(async()=>{try{let c=await t.getPublicProfiles();if(c.profiles.length===0&&!d){W(!0);try{const h=g??le??{lat:a.defaultCenterLat,lng:a.defaultCenterLng};await t.seedFakeUsers(12,h.lat,h.lng),c=await t.getPublicProfiles()}catch{}}ge(c.profiles)}catch{ge([])}if(n.userType==="guest"){he(new Set),p(new Set);return}try{const c=await t.getFavorites(n.sessionToken);he(new Set(c.favorites))}catch{he(new Set)}try{const c=await t.listBlocked(n.sessionToken);p(new Set(c.blocked))}catch{p(new Set)}})()},[t,d,g,n.sessionToken,n.userType,a.defaultCenterLat,a.defaultCenterLng,le]),s.useEffect(()=>{let c=!1;async function h(){try{const $=await t.listCruisingSpots();c||m($.spots)}catch{c||m([])}}h();const w=window.setInterval(()=>{h()},12e3);return()=>{c=!0,window.clearInterval(w)}},[t]),s.useEffect(()=>{const c=Date.now(),h=pe.flatMap(w=>{const $=[];return w.mainPhotoMediaId&&$.push(w.mainPhotoMediaId),Array.isArray(w.galleryMediaIds)&&$.push(...w.galleryMediaIds),w.videoMediaId&&$.push(w.videoMediaId),$}).filter(w=>typeof w=="string"&&w.length>0&&!R[w]&&c>=(E[w]??0)).slice(0,6);h.length!==0&&Promise.all(h.map(async w=>{try{const $=await t.getPublicMediaUrl(w);return{mediaId:w,url:$.downloadUrl}}catch{return null}})).then(w=>{ne($=>{const Q={...$};for(const ie of w)ie&&(Q[ie.mediaId]=ie.url);return Q}),te($=>{const Q={...$};for(let ie=0;ie<h.length;ie+=1){const fe=h[ie];w[ie]?Q[fe]&&delete Q[fe]:Q[fe]=Date.now()+3e4}return Q})})},[t,E,R,pe]);async function Fe(c){O(c),me(0);const h=mt(c);if(!h){ue(null);return}try{if(c===G){const w=await t.getMyProfile(n.sessionToken);typeof w.profile.mainPhotoMediaId=="string"&&w.profile.mainPhotoMediaId;const $=[w.profile.mainPhotoMediaId,...w.profile.galleryMediaIds??[],w.profile.videoMediaId].filter(Q=>typeof Q=="string"&&Q.length>0);if($.length>0){const Q=await Promise.all($.map(async ie=>{try{const fe=await t.getPublicMediaUrl(ie);return{mediaId:ie,downloadUrl:fe.downloadUrl}}catch{return null}}));ne(ie=>{const fe={...ie};for(const Me of Q)Me&&(fe[Me.mediaId]=Me.downloadUrl);return fe})}ue({userId:w.profile.userId,displayName:w.profile.displayName,age:w.profile.age,bio:w.profile.bio,stats:w.profile.stats,discreetMode:w.profile.discreetMode,mainPhotoMediaId:w.profile.mainPhotoMediaId,galleryMediaIds:w.profile.galleryMediaIds,videoMediaId:w.profile.videoMediaId})}else{const w=await t.getPublicProfile(h),$=[w.profile.mainPhotoMediaId,...w.profile.galleryMediaIds??[],w.profile.videoMediaId].filter(Q=>typeof Q=="string"&&Q.length>0);if($.length>0){const Q=await Promise.all($.map(async ie=>{try{const fe=await t.getPublicMediaUrl(ie);return{mediaId:ie,downloadUrl:fe.downloadUrl}}catch{return null}}));ne(ie=>{const fe={...ie};for(const Me of Q)Me&&(fe[Me.mediaId]=Me.downloadUrl);return fe})}ue(w.profile)}}catch(w){const $=w;if(($==null?void 0:$.code)==="PROFILE_HIDDEN"){O(null),ue(null);return}ue(null),S(Y(w))}}async function X(c){if(n.userType==="guest"){S("Guests cannot star users. Register to save favorites.");return}if(!(!n.userId||n.userId===c))try{const h=await t.toggleFavorite(n.sessionToken,c);he(new Set(h.favorites))}catch(h){S(Y(h))}}async function Te(c){const h=Ce(c);if(!(!h||h===G))try{await t.sendChat(n.sessionToken,"cruise",h,vt)}catch(w){S(Y(w))}}async function Ne(c){if(!(!c.trim()||c===G)){if(n.userType==="guest"){S("Anonymous users cannot block users.");return}try{y.has(c)?await t.unblock(n.sessionToken,c):await t.block(n.sessionToken,c);const h=await t.listBlocked(n.sessionToken);p(new Set(h.blocked))}catch(h){S(Y(h))}}}async function Ie(){const c=le??{lat:a.defaultCenterLat,lng:a.defaultCenterLng};if(!navigator.geolocation){j(c);try{await t.updatePresence(n.sessionToken,c.lat,c.lng,"online")}catch{}return}try{const h=await new Promise((w,$)=>{navigator.geolocation.getCurrentPosition(w,$,{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e4})});j({lat:h.coords.latitude,lng:h.coords.longitude}),await t.updatePresence(n.sessionToken,h.coords.latitude,h.coords.longitude,"online")}catch(h){j(c);try{await t.updatePresence(n.sessionToken,c.lat,c.lng,"online")}catch{const w=h&&typeof h=="object"&&"message"in h&&typeof h.message=="string"?h.message:null;S(w??Y(h))}}}s.useEffect(()=>{Ie();const c=window.setInterval(()=>{Ie()},3e4);return()=>window.clearInterval(c)},[n.sessionToken]),s.useEffect(()=>{const c=h=>{var ie,fe;const w=h,$=(ie=w.detail)==null?void 0:ie.lat,Q=(fe=w.detail)==null?void 0:fe.lng;!Number.isFinite($)||!Number.isFinite(Q)||(j({lat:$,lng:Q}),t.updatePresence(n.sessionToken,$,Q,"online").catch(()=>{}))};return window.addEventListener("rd:location-updated",c),()=>window.removeEventListener("rd:location-updated",c)},[t,n.sessionToken]);const je=s.useMemo(()=>{if(be.some($=>$.key===G))return be;const h=g??le??{lat:a.defaultCenterLat,lng:a.defaultCenterLng};return[{key:G,userType:n.userType,lat:h.lat,lng:h.lng,status:"online",updatedAtMs:Date.now()},...be]},[G,be,g,n.userType,a.defaultCenterLat,a.defaultCenterLng,le]),Le=s.useMemo(()=>{const c={};for(const h of pe){if(!h.mainPhotoMediaId)continue;const w=R[h.mainPhotoMediaId];w&&(c[Ue(h.userId)]=w)}return c},[R,pe]),$e=s.useMemo(()=>r.map(c=>({id:`spot:${c.spotId}`,position:{lat:c.lat,lng:c.lng},color:"#26d5ff",markerType:"spot",markerGlyph:"CS",label:`${c.name} | check-ins: ${c.checkInCount??0} | action: ${c.actionCount??0}`,onClick:()=>se(c.spotId)})),[r]),Oe=c=>{T(c),U(c)},nt=e.jsx(Dt,{wsUrl:gt(),sessionToken:n.sessionToken,presenceUpdates:je,realtimeErrorMessage:de,onMarkerSelect:c=>void Fe(c),avatarByKey:Le,additionalMarkers:$e,defaultCenter:le??{lat:a.defaultCenterLat,lng:a.defaultCenterLng},height:I?"calc(100vh - 340px)":600,visible:!0}),qe=e.jsxs("div",{style:{background:"#000",marginInline:-10},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,padding:"8px 10px",borderBottom:"1px solid rgba(255,58,77,0.25)"},children:[e.jsx("button",{type:"button",style:_(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"reset"}}))},children:"GUYS"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"toggle_favorites"}}))},"aria-label":"Toggle favorites only",children:"â˜…"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"open_filters"}})),Oe("chat")},children:"FILTER"})]}),e.jsx(Dt,{wsUrl:gt(),sessionToken:n.sessionToken,presenceUpdates:je,realtimeErrorMessage:de,onMarkerSelect:c=>void Fe(c),avatarByKey:Le,additionalMarkers:$e,defaultCenter:le??{lat:a.defaultCenterLat,lng:a.defaultCenterLng},height:"calc(100dvh - 220px)",visible:P==="map"})]}),Ve=e.jsx(Pn,{api:t,session:n,busy:u,setBusy:v,setLastError:S,onlinePeers:Se,selectedPeerKey:o,setSelectedPeerKey:b,onOpenProfile:c=>void Fe(c),isMobile:I,selfCoords:g,peerProfileByKey:ee,discoverFilter:f,publicProfiles:pe,favorites:ce,mediaUrlById:R,onUnreadCountChange:D});return e.jsxs("div",{style:{display:"grid",gap:8},children:[I?e.jsx(e.Fragment,{children:P==="map"?qe:Ve}):e.jsx("div",{style:{display:"grid",gap:12,alignItems:"start"},children:P==="map"?nt:Ve}),C?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:80,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:I?"stretch":"center",padding:I?0:14},role:"dialog","aria-modal":"true","aria-label":"User profile",onClick:()=>O(null),children:e.jsx("div",{onClick:c=>c.stopPropagation(),style:I?{width:"100%",height:"100dvh",overflow:"auto",background:"linear-gradient(180deg, rgba(7,8,10,0.98), rgba(2,2,4,0.98))",borderRadius:0,border:"none",padding:"calc(env(safe-area-inset-top, 0px) + 56px) 12px calc(env(safe-area-inset-bottom, 0px) + 20px)"}:{...Ee(),width:"min(680px, 100%)",maxHeight:"86vh",overflow:"auto"},children:e.jsxs("div",{style:{display:"grid",gap:14},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"106px 1fr auto",gap:12,alignItems:"center"},children:[e.jsxs("div",{style:{position:"relative",width:106,height:106},children:[e.jsx("img",{src:k!=null&&k.mainPhotoMediaId&&R[k.mainPhotoMediaId]?R[k.mainPhotoMediaId]:Be(C),alt:"Profile avatar",style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"cover",border:"2px solid #ff3047"}}),e.jsx("span",{style:{position:"absolute",right:4,bottom:4,width:14,height:14,borderRadius:"50%",background:"#26d5ff",border:"2px solid #000"}})]}),e.jsxs("div",{style:{display:"grid",gap:6},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:(k==null?void 0:k.displayName)??C}),e.jsx("div",{style:{color:"#26d5ff",fontSize:14},children:"Instant Messaging Available"})]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[k&&k.userId!==(n.userId??"")?e.jsx("button",{type:"button",style:{..._(!1),color:"#26d5ff",borderColor:"rgba(38,213,255,0.62)",minWidth:126},onClick:()=>void X(k.userId),children:ce.has(k.userId)?"â˜… STARRED":"â˜† STAR"}):null,k&&k.userId!==(n.userId??"")?e.jsx("button",{type:"button",style:{..._(!1),color:"#ffb347",borderColor:"rgba(255,179,71,0.65)",minWidth:126},onClick:()=>void Te(Ue(k.userId)),children:"ðŸ”¥ FIRE"}):null,k&&k.userId!==(n.userId??"")?e.jsx("button",{type:"button",style:{..._(!1),color:y.has(Ue(k.userId))?"#ff9aa3":"#ffd4d8",borderColor:"rgba(255,120,130,0.62)",minWidth:126},onClick:()=>void Ne(Ue(k.userId)),children:y.has(Ue(k.userId))?"UNBLOCK":"BLOCK"}):null,e.jsx("button",{type:"button",style:_(!1),onClick:()=>O(null),children:"CLOSE"})]})]}),e.jsxs("div",{style:{color:"#ced3dc",fontSize:14,lineHeight:1.5},children:[e.jsxs("div",{children:["Age: ",(k==null?void 0:k.age)??"-"]}),e.jsxs("div",{children:["Distance: ",We??"-"]}),e.jsxs("div",{children:["Race: ",((st=k==null?void 0:k.stats)==null?void 0:st.race)??"-"]}),e.jsxs("div",{children:["Height: ",((Ke=k==null?void 0:k.stats)==null?void 0:Ke.heightInches)??"-"]}),e.jsxs("div",{children:["Weight: ",((He=k==null?void 0:k.stats)==null?void 0:He.weightLbs)??"-"]}),e.jsxs("div",{children:["Cock Size: ",((Xe=k==null?void 0:k.stats)==null?void 0:Xe.cockSizeInches)??"-"]}),e.jsxs("div",{children:["Cut / Uncut: ",((Ye=k==null?void 0:k.stats)==null?void 0:Ye.cutStatus)??"-"]}),e.jsxs("div",{children:["Position: ",((Ze=k==null?void 0:k.stats)==null?void 0:Ze.position)??"-"]}),e.jsxs("div",{style:{marginTop:8},children:["Bio: ",(k==null?void 0:k.bio)??"-"]})]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"MEDIA"}),k?e.jsx(e.Fragment,{children:(()=>{const c=[k.mainPhotoMediaId,...k.galleryMediaIds??[],k.videoMediaId].filter(ie=>typeof ie=="string"&&ie.length>0);if(c.length===0)return e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No uploaded media."});const h=Math.max(0,Math.min(oe,c.length-1)),w=c[h],$=R[w],Q=w===k.videoMediaId;return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.4)",borderRadius:12,padding:8},children:Q?e.jsx("video",{controls:!0,playsInline:!0,src:$,style:{width:"100%",maxHeight:260,borderRadius:10,background:"#000"}}):e.jsx("img",{src:$??Be(C??k.userId),alt:"Profile media",style:{width:"100%",maxHeight:260,objectFit:"cover",borderRadius:10}})}),e.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:c.map((ie,fe)=>{const Me=R[ie],_e=ie===k.videoMediaId;return e.jsx("button",{type:"button",onClick:()=>me(fe),style:{width:64,height:64,padding:0,borderRadius:8,overflow:"hidden",border:fe===h?"2px solid #26d5ff":"1px solid rgba(255,58,77,0.4)",background:"#000",cursor:"pointer",color:"#fff",fontSize:10},"aria-label":_e?"Open video":"Open photo",children:_e?e.jsx("div",{style:{display:"grid",placeItems:"center",width:"100%",height:"100%"},children:Me?e.jsx("video",{src:Me,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}):"VIDEO"}):e.jsx("img",{src:Me??Be(C??k.userId),alt:"Media thumbnail",style:{width:"100%",height:"100%",objectFit:"cover"}})},ie)})})]})})()}):null]}),e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:e.jsx("button",{type:"button",style:ve(!1),onClick:()=>{C&&B(C),O(null),me(0)},children:"CHAT"})})]})})}):null,F?e.jsx(Nn,{api:t,session:n,spot:r.find(c=>c.spotId===F)??null,onClose:()=>se(null),onUpdated:async()=>{try{const c=await t.listCruisingSpots();m(c.spots)}catch{}},setLastError:S}):null]})}function Nn({api:t,session:n,spot:a,onClose:f,onUpdated:u,setLastError:v}){return a?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},role:"dialog","aria-modal":"true","aria-label":"Cruising spot",onClick:f,children:e.jsxs("div",{onClick:S=>S.stopPropagation(),style:{...Ee(),width:"min(520px, 100%)",display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:a.name}),e.jsx("div",{style:{color:"#9fb6bf",fontSize:13},children:a.address}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap"},children:a.description}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:13},children:["Check-ins: ",a.checkInCount??0," | I got action there: ",a.actionCount??0]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:ve(!1),onClick:async()=>{try{await t.checkInCruisingSpot(n.sessionToken,a.spotId),await u()}catch(S){v(Y(S))}},children:"CHECK IN"}),e.jsx("button",{type:"button",style:_(!1),onClick:async()=>{try{await t.markCruisingSpotAction(n.sessionToken,a.spotId),await u()}catch(S){v(Y(S))}},children:"I GOT ACTION THERE"}),e.jsx("button",{type:"button",style:_(!1),onClick:f,children:"CLOSE"})]})]})}):null}function Pn({api:t,session:n,busy:a,setBusy:f,setLastError:u,onlinePeers:v,selectedPeerKey:S,setSelectedPeerKey:I,onOpenProfile:A,openThreadRequest:U,onThreadRequestConsumed:B,isMobile:D,selfCoords:P,peerProfileByKey:T,discoverFilter:o,publicProfiles:b,favorites:C,mediaUrlById:O,onUnreadCountChange:g}){var zt;const[j,L]=s.useState({}),[M,ee]=s.useState({}),[ae,pe]=s.useState("instant"),[ge,ce]=s.useState("grid"),[he,y]=s.useState(null),[p,R]=s.useState(""),[ne,E]=s.useState(null),[te,k]=s.useState([]),[ue,oe]=s.useState({}),[me,d]=s.useState(null),[W,r]=s.useState({}),[m,F]=s.useState({}),[se,le]=s.useState(!1),[we,ke]=s.useState(""),[de,xe]=s.useState(null),G=s.useRef(!1),be=s.useRef(!1),Re=s.useRef(0),Se=s.useRef(null),We=s.useRef(null),Fe=s.useRef(null),X=s.useRef(null),Te=s.useRef(null),Ne=s.useRef(0),Ie=s.useRef(new Set),je=s.useRef(null),Le=s.useRef(null),$e=s.useRef(null),[Oe,nt]=s.useState(null),[qe,Ve]=s.useState(o==="favorites"),[st,Ke]=s.useState(!1),[He,Xe]=s.useState(o==="online"?"online":"all"),[Ye,Ze]=s.useState(!1),[c,h]=s.useState(""),[w,$]=s.useState(""),[Q,ie]=s.useState(""),[fe,Me]=s.useState(""),[_e,xt]=s.useState(""),[it,jt]=s.useState(""),[rt,wt]=s.useState(""),[at,St]=s.useState(""),[ot,kt]=s.useState(""),[lt,It]=s.useState(""),[dt,Ct]=s.useState(""),Ae=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,re=he??S??"",en=re?j[re]??[]:[],Tt=s.useMemo(()=>new Map(v.map(i=>[i.key,i])),[v]),ze=s.useMemo(()=>{const i={};for(const l of b)typeof l.displayName=="string"&&l.displayName.trim()&&(i[Ue(l.userId)]=l.displayName);for(const[l,x]of Object.entries(T))typeof x.displayName=="string"&&x.displayName.trim()&&(i[l]=x.displayName);return i},[T,b]),Mt=s.useMemo(()=>b.filter(i=>i.userId!==(n.userId??"")).map(i=>{const l=Ue(i.userId),x=Tt.get(l);return{key:l,userId:i.userId,displayName:i.displayName,age:i.age,stats:i.stats,meters:x&&P?Math.round(yt(P,{lat:x.lat,lng:x.lng})):null,isOnline:!!x,hasPicture:typeof i.mainPhotoMediaId=="string"&&i.mainPhotoMediaId.trim().length>0,avatarUrl:i.mainPhotoMediaId?O[i.mainPhotoMediaId]:void 0}}),[O,Tt,b,P,n.userId]),Je=s.useMemo(()=>{const i=c.trim()?Number(c):void 0,l=w.trim()?Number(w):void 0,x=fe.trim()?Number(fe):void 0,N=_e.trim()?Number(_e):void 0,z=it.trim()?Number(it):void 0,V=rt.trim()?Number(rt):void 0,J=at.trim()?Number(at):void 0,H=ot.trim()?Number(ot):void 0;return Mt.filter(K=>{var ye,Pe,Ge,ft,De,Ut,Lt,Ot,Kt;if(qe&&!C.has(K.userId)||He==="online"&&!K.isOnline||He==="offline"&&K.isOnline||Ye&&!K.hasPicture||Number.isFinite(i)&&(typeof K.age!="number"||K.age<i)||Number.isFinite(l)&&(typeof K.age!="number"||K.age>l))return!1;const q=typeof((ye=K.stats)==null?void 0:ye.race)=="string"?K.stats.race:"";return!(Q.trim()&&q.toLowerCase()!==Q.trim().toLowerCase()||Number.isFinite(x)&&(typeof((Pe=K.stats)==null?void 0:Pe.heightInches)!="number"||K.stats.heightInches<x)||Number.isFinite(N)&&(typeof((Ge=K.stats)==null?void 0:Ge.heightInches)!="number"||K.stats.heightInches>N)||Number.isFinite(z)&&(typeof((ft=K.stats)==null?void 0:ft.weightLbs)!="number"||K.stats.weightLbs<z)||Number.isFinite(V)&&(typeof((De=K.stats)==null?void 0:De.weightLbs)!="number"||K.stats.weightLbs>V)||Number.isFinite(J)&&(typeof((Ut=K.stats)==null?void 0:Ut.cockSizeInches)!="number"||K.stats.cockSizeInches<J)||Number.isFinite(H)&&(typeof((Lt=K.stats)==null?void 0:Lt.cockSizeInches)!="number"||K.stats.cockSizeInches>H)||lt&&((Ot=K.stats)==null?void 0:Ot.cutStatus)!==lt||dt&&((Kt=K.stats)==null?void 0:Kt.position)!==dt)})},[Mt,C,qe,lt,w,ot,_e,rt,c,at,fe,it,dt,Q,Ye,He]),ct=s.useMemo(()=>Array.from(new Set(Je.map(i=>i.key).filter(i=>i.trim().length>0))).slice(0,8),[Je]),At=ct.join("|"),ut=s.useMemo(()=>{const i=new Set(Object.keys(M));return re.trim()&&i.add(re),Array.from(i).sort((l,x)=>{var N,z;return(((N=M[x])==null?void 0:N.lastAt)??0)-(((z=M[l])==null?void 0:z.lastAt)??0)})},[M,re]),Rt=s.useMemo(()=>Object.values(W).reduce((i,l)=>i+(Number.isFinite(l)?l:0),0),[W]);s.useMemo(()=>{var i;return re?ze[re]??((i=T[re])==null?void 0:i.displayName)??re:""},[ze,re,T]);const tn=s.useMemo(()=>{if(!re)return;const i=Je.find(l=>l.key===re);return i==null?void 0:i.avatarUrl},[Je,re]),Qe=s.useMemo(()=>ut.filter(i=>i!==re&&i!==Ae&&!!M[i]).map(i=>{var l;return{key:i,label:ze[i]??((l=T[i])==null?void 0:l.displayName)??i}}),[ut,M,ze,Ae,re,T]);s.useEffect(()=>{typeof g=="function"&&g(Rt)},[g,Rt]),s.useEffect(()=>{const i=Se.current;i&&(i.srcObject=de)},[de]),s.useEffect(()=>{const i=We.current;i&&(i.srcObject=Oe)},[Oe]),s.useEffect(()=>()=>{if(de){for(const i of de.getTracks())i.stop();if(Oe)for(const i of Oe.getTracks())i.stop();je.current&&(je.current.close(),je.current=null)}},[de,Oe]),s.useEffect(()=>{if(Qe.length===0){R("");return}R(i=>i&&Qe.some(l=>l.key===i)?i:Qe[0].key)},[Qe]);const nn=s.useMemo(()=>({async sendMessage(i,l,x,N){const z=Ce(l),V=await t.sendChat(n.sessionToken,i,z,x,N),J=V==null?void 0:V.message,H=[J];if(i==="cruise"&&ne)try{const K=await t.sendChat(n.sessionToken,i,Ce(ne),x,N),q=K==null?void 0:K.message;H.push(q)}catch(K){u(Y(K))}for(const K of H)Nt(K);return J},async initiateMediaUpload(i,l){const x=await t.initiateChatMediaUpload(n.sessionToken,{mimeType:i,sizeBytes:l});return{objectKey:x.objectKey,uploadUrl:x.uploadUrl}},async uploadToSignedUrl(i,l,x){if(await bt(i,l,x))return;if(!(await fetch(i,{method:"PUT",headers:{"content-type":x},body:l})).ok)throw{code:"MEDIA_UPLOAD_INCOMPLETE",message:"Upload failed."}},async getMediaUrl(i){return(await t.getChatMediaUrl(n.sessionToken,i)).downloadUrl}}),[t,Ae,n.sessionToken,u,ne]);function et(i){var l,x,N;return i.text&&i.text.trim()?Zt(i.text):((l=i.media)==null?void 0:l.kind)==="image"?"[Photo]":((x=i.media)==null?void 0:x.kind)==="video"?"[Video]":((N=i.media)==null?void 0:N.kind)==="audio"?"[Voice]":""}function sn(i){if(!i||Ie.current.has(i))return!1;if(Ie.current.add(i),Ie.current.size>5e3){const l=Array.from(Ie.current).slice(-2500);Ie.current=new Set(l)}return!0}function rn(i,l){var z;const x=ze[l]??((z=T[l])==null?void 0:z.displayName)??l,N=et(i)||"New activity";if("Notification"in window){if(Notification.permission==="granted"){try{new Notification(`${x}`,{body:N})}catch{}return}Notification.permission==="default"&&Notification.requestPermission()}}function an(i){if(!i.startsWith("GROUP_INVITE_REQUEST|"))return null;const[,l,x,N]=i.split("|");return!l||!x||!N?null:{inviteId:l,inviterKey:x,primaryPeerKey:N}}function on(i){if(!i.startsWith("GROUP_INVITE_ACCEPT|"))return null;const[,l,x]=i.split("|");return!l||!x?null:{inviteId:l,candidateKey:x}}function Nt(i){if(!sn(i.messageId))return;const l=i.fromKey===Ae?i.toKey:i.fromKey;L(z=>{const V=z[l]??[];return V.some(J=>J.messageId===i.messageId)?z:{...z,[l]:[...V,i].sort((J,H)=>J.createdAtMs-H.createdAtMs)}}),ee(z=>({...z,[l]:{lastAt:i.createdAtMs,lastText:et(i)}})),i.fromKey!==Ae&&(ge==="thread"&&Ce(re)===Ce(l)?(F(V=>({...V,[l]:Math.max(V[l]??0,i.createdAtMs)})),r(V=>{const J={...V};return delete J[l],J})):r(V=>({...V,[l]:(V[l]??0)+1})),rn(i,l));const x=an(i.text??"");x&&i.toKey===Ae&&k(z=>z.some(V=>V.inviteId===x.inviteId)?z:[...z,{...x,createdAtMs:i.createdAtMs}]);const N=on(i.text??"");N&&i.toKey===Ae&&ue[N.inviteId]&&(E(Ce(N.candidateKey)),d(`Invite accepted by ${ze[N.candidateKey]??N.candidateKey}.`),oe(V=>{const J={...V};return delete J[N.inviteId],J}))}async function ln(i){const l=Ce(i);if(l)try{const x=await t.listChat(n.sessionToken,tt(ae),l),N=x==null?void 0:x.messages,z=Array.isArray(N)?N:[];t.markChatRead(n.sessionToken,tt(ae),l).catch(()=>{}),L(H=>({...H,[l]:z}));const V=z.length>0?z[z.length-1]:null;V&&ee(H=>({...H,[l]:{lastAt:V.createdAtMs,lastText:et(V)}}));let J=0;for(const H of z)H.fromKey===l&&H.createdAtMs>J&&(J=H.createdAtMs);J>0&&F(H=>({...H,[l]:Math.max(H[l]??0,J)}))}catch(x){u(Y(x))}}s.useEffect(()=>{if(ge!=="thread"||!re.trim())return;let i=!1,l=!1,x=null;const N=async()=>{if(!(i||l)){l=!0;try{await ln(re)}finally{l=!1}i||(x=window.setTimeout(()=>{N()},1200))}};return N(),()=>{i=!0,x!==null&&window.clearTimeout(x)}},[ae,re,ge]),s.useEffect(()=>{if(ge!=="grid")return;if(ct.length===0){r({});return}let i=!1;async function l(){if(!G.current&&!document.hidden){G.current=!0;try{const z=tt(ae),V=[],J=[];for(const K of ct){if(i)break;try{const q=Ce(K);if(!q)continue;const ye=await t.listChat(n.sessionToken,z,q),Pe=(ye==null?void 0:ye.messages)??[];if(Pe.length>0){const De=Pe[Pe.length-1];J.push([q,{lastAt:De.createdAtMs,lastText:et(De)}])}let Ge=0;const ft=m[q]??0;for(const De of Pe)De.fromKey===q&&De.createdAtMs>ft&&(Ge+=1);V.push([q,Ge])}catch{const q=Ce(K);q&&V.push([q,0])}}if(i)return;J.length>0&&ee(K=>{const q={...K};for(const[ye,Pe]of J)q[ye]=Pe;return q});const H={};for(const[K,q]of V)q>0&&(H[K]=q);r(H)}finally{G.current=!1}}}const x=window.setTimeout(()=>{l()},1200),N=window.setInterval(()=>{l()},15e3);return()=>{i=!0,G.current=!1,window.clearTimeout(x),window.clearInterval(N)}},[t,ae,m,n.sessionToken,At,ge]),s.useEffect(()=>{const i=Array.from(new Set([...ut,...ct,re].map(V=>Ce(V)).filter(V=>V.length>0))).slice(0,10);if(i.length===0)return;let l=!1;const x=async()=>{if(!(l||document.hidden||be.current)){be.current=!0;try{const V=tt(ae),J=[];for(const H of i){if(l)break;try{const K=await t.listChat(n.sessionToken,V,H),q=(K==null?void 0:K.messages)??[];if(q.length===0)continue;const ye=q[q.length-1];J.push([H,{lastAt:ye.createdAtMs,lastText:et(ye)}])}catch{}}if(l||J.length===0)return;ee(H=>{const K={...H};for(const[q,ye]of J)K[q]=ye;return K})}finally{be.current=!1}}},N=window.setTimeout(()=>{x()},1e3),z=window.setInterval(()=>{x()},5e3);return()=>{l=!0,window.clearTimeout(N),window.clearInterval(z)}},[t,ae,ut,re,n.sessionToken,At]);async function dn(){if(de)return de;if(!navigator.mediaDevices||typeof navigator.mediaDevices.getUserMedia!="function")throw{code:"UNAUTHORIZED_ACTION",message:"Camera access is not available in this browser."};const i=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});return xe(i),i}function cn(i,l){je.current&&(je.current.close(),je.current=null);const x=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});return je.current=x,Le.current=l,$e.current=i,x.ontrack=N=>{const z=N.streams[0];z&&nt(z)},x.onicecandidate=N=>{const z=N.candidate;if(!z)return;const V=$e.current,J=Le.current;!V||!J||t.sendCallSignal(n.sessionToken,{toKey:V,callId:J,signalType:"ice",candidate:JSON.stringify(z.toJSON())}).catch(()=>{})},x}async function Pt(i=!0){const l=$e.current,x=Le.current;if(i&&l&&x)try{await t.sendCallSignal(n.sessionToken,{toKey:l,callId:x,signalType:"hangup"})}catch{}if(de)for(const N of de.getTracks())N.stop();if(Oe)for(const N of Oe.getTracks())N.stop();xe(null),nt(null),je.current&&(je.current.close(),je.current=null),Le.current=null,$e.current=null,le(!1)}s.useEffect(()=>{let i=!1;const l=gt();if(!l)return;const x=()=>{X.current!==null&&(window.clearInterval(X.current),X.current=null),Te.current!==null&&(window.clearTimeout(Te.current),Te.current=null)},N=()=>{if(i)return;const z=new WebSocket(l);Fe.current=z,z.onopen=()=>{Ne.current=0,z.send(JSON.stringify({type:"auth",payload:{sessionToken:n.sessionToken}})),X.current=window.setInterval(()=>{z.readyState===z.OPEN&&z.send(JSON.stringify({type:"heartbeat",payload:{}}))},15e3)},z.onmessage=V=>{let J=null;try{J=JSON.parse(String(V.data))}catch{return}if(!J||typeof J.type!="string")return;if(J.type==="chat_message"){const q=J.payload,ye=q==null?void 0:q.message;if(!ye||ye.fromKey!==Ae&&ye.toKey!==Ae)return;Nt(ye);return}if(J.type!=="call_signal")return;const H=J.payload;if(!H||H.toKey!==Ae||typeof H.fromKey!="string"||!H.callId||!H.signalType)return;const K=Ce(H.fromKey);if(H.signalType==="hangup"){Pt(!1);return}if(H.signalType==="offer"){(async()=>{try{pt(K),ke(K);const q=await dn(),ye=cn(K,H.callId);for(const Ge of q.getTracks())ye.addTrack(Ge,q);await ye.setRemoteDescription({type:"offer",sdp:H.sdp??""});const Pe=await ye.createAnswer();await ye.setLocalDescription(Pe),await t.sendCallSignal(n.sessionToken,{toKey:K,callId:H.callId,signalType:"answer",sdp:Pe.sdp??""}),le(!0)}catch(q){u(Y(q))}})();return}if(H.signalType==="answer"){(async()=>{try{if(!je.current||Le.current!==H.callId)return;await je.current.setRemoteDescription({type:"answer",sdp:H.sdp??""})}catch(q){u(Y(q))}})();return}H.signalType==="ice"&&(async()=>{try{if(!je.current||Le.current!==H.callId||!H.candidate)return;const q=JSON.parse(H.candidate);await je.current.addIceCandidate(q)}catch{}})()},z.onclose=()=>{if(x(),i)return;Ne.current+=1;const V=Math.min(8e3,500*2**Math.min(Ne.current,4));Te.current=window.setTimeout(N,V)},z.onerror=()=>{}};return N(),()=>{var z;i=!0,x(),(z=Fe.current)==null||z.close(1e3,"chat cleanup"),Fe.current=null}},[t,Ae,n.sessionToken]);async function un(){if(p.trim()){if(!re.trim()){u("Select a user first.");return}try{const i=Ce(p);if(!i)return;if(!Qe.some(x=>x.key===i)){u("You can only add a third user you have previously messaged.");return}const l=crypto.randomUUID();await t.sendChat(n.sessionToken,"cruise",i,`GROUP_INVITE_REQUEST|${l}|${Ae}|${re.trim()}`),oe(x=>({...x,[l]:{candidateKey:i,primaryPeerKey:re.trim()}})),d(`Invite sent to ${ze[i]??i}. Waiting for acceptance.`)}catch(i){u(Y(i))}}}async function Et(i,l,x){try{await t.sendChat(n.sessionToken,"cruise",l,`GROUP_INVITE_ACCEPT|${i}|${Ae}`),k(N=>N.filter(z=>z.inviteId!==i)),d("Group invite accepted."),pt(x)}catch(N){u(Y(N))}}function Ft(i){k(l=>l.filter(x=>x.inviteId!==i))}function pt(i){const l=Ce(i);I(l),y(l),r(x=>{const N={...x};return delete N[l],N}),F(x=>({...x,[l]:Date.now()})),ce("thread")}function ht(){Ve(!1),Xe("all"),Ze(!1),h(""),$(""),ie(""),Me(""),xt(""),jt(""),wt(""),St(""),kt(""),It(""),Ct(""),Ke(!1)}if(s.useEffect(()=>{const i=l=>{var z;const N=(z=l.detail)==null?void 0:z.action;if(N==="reset"){ht(),ce("grid");return}if(N==="toggle_favorites"){Ve(V=>!V),ce("grid");return}N==="open_filters"&&(Ke(!0),ce("grid"))};return window.addEventListener("rd:discover-control",i),()=>window.removeEventListener("rd:discover-control",i)},[]),s.useEffect(()=>{U&&U.nonce!==Re.current&&(Re.current=U.nonce,pt(U.key),typeof B=="function"&&B())},[B,U]),s.useEffect(()=>{const i=l=>{var N;((N=l.detail)==null?void 0:N.tab)==="discover"&&(ce("grid"),y(null),Ke(!1))};return window.addEventListener("rd:tab-select",i),()=>window.removeEventListener("rd:tab-select",i)},[]),ge==="thread"&&re.trim()){const i=ze[re]??((zt=T[re])==null?void 0:zt.displayName)??re;return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:D?-10:0},children:[te.length>0?e.jsxs("div",{style:{...Ee(),display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"INVITE REQUESTS"}),te.map(l=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,alignItems:"center"},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:13},children:[ze[l.inviterKey]??l.inviterKey," invited you to join a conversation."]}),e.jsx("button",{type:"button",style:ve(!1),onClick:()=>void Et(l.inviteId,l.inviterKey,l.primaryPeerKey),children:"ACCEPT"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>Ft(l.inviteId),children:"DECLINE"})]},l.inviteId))]}):null,me?e.jsx("div",{style:{color:"#26d5ff",fontSize:12},children:me}):null,e.jsx(Xt,{chatKind:tt(ae),peerKey:re,currentUserKey:Ae,messages:en,client:nn,title:`INSTANT THREAD: ${i}`,peerSummary:{displayName:i,avatarUrl:tn},thirdParty:{candidates:Qe,selectedKey:p,onSelect:l=>R(l),onAdd:()=>void un(),disabled:a},showHeader:!1,edgeToEdge:D,fillHeight:D}),se?e.jsx("div",{role:"dialog","aria-modal":"true","aria-label":"Video call",style:{position:"fixed",inset:0,zIndex:60,background:"rgba(0,0,0,0.82)",display:"grid",placeItems:"center",padding:16},children:e.jsxs("div",{style:{...Ee(),width:"min(720px, 100%)",display:"grid",gap:10},children:[e.jsxs("div",{style:{fontSize:18,fontWeight:700},children:["VIDEO CALL: ",we]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("video",{ref:Se,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"100%",maxHeight:"52vh",borderRadius:12,background:"#000"}}),e.jsx("video",{ref:We,autoPlay:!0,playsInline:!0,style:{width:"100%",maxHeight:"52vh",borderRadius:12,background:"#000"}})]}),e.jsx("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:e.jsx("button",{type:"button",style:_(!1),onClick:()=>void Pt(),children:"END CALL"})})]})}):null]})}return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:D?-10:0},children:[te.length>0?e.jsxs("div",{style:{...Ee(),display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"INVITE REQUESTS"}),te.map(i=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,alignItems:"center"},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:13},children:[ze[i.inviterKey]??i.inviterKey," invited you to join a conversation."]}),e.jsx("button",{type:"button",style:ve(!1),onClick:()=>void Et(i.inviteId,i.inviterKey,i.primaryPeerKey),children:"ACCEPT"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>Ft(i.inviteId),children:"DECLINE"})]},i.inviteId))]}):null,me?e.jsx("div",{style:{color:"#26d5ff",fontSize:12},children:me}):null,e.jsx("div",{style:{padding:10,borderBottom:"1px solid rgba(255,58,77,0.28)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8},children:[e.jsx("button",{type:"button",style:_(!1),onClick:ht,children:"GUYS"}),e.jsx("button",{type:"button",style:qe?ve(!1):_(!1),onClick:()=>Ve(i=>!i),"aria-label":"Toggle favorites only",children:"â˜…"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>Ke(!0),children:"FILTER"})]})}),st?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},role:"dialog","aria-modal":"true","aria-label":"Discover filters",onClick:()=>Ke(!1),children:e.jsx("div",{onClick:i=>i.stopPropagation(),style:{...Ee(),width:"min(760px, 100%)",maxHeight:"86vh",overflow:"auto"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"FILTER USERS"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{type:"checkbox",checked:Ye,onChange:i=>Ze(i.target.checked)}),"Has pictures"]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Online status"}),e.jsxs("select",{style:Z(),value:He,onChange:i=>Xe(i.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"offline",children:"Offline"})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[e.jsx("input",{style:Z(),placeholder:"Min age",value:c,onChange:i=>h(i.target.value)}),e.jsx("input",{style:Z(),placeholder:"Max age",value:w,onChange:i=>$(i.target.value)}),e.jsx("input",{style:Z(),placeholder:"Race",value:Q,onChange:i=>ie(i.target.value)}),e.jsxs("select",{style:Z(),value:lt,onChange:i=>It(i.target.value),children:[e.jsx("option",{value:"",children:"Cut / Uncut"}),e.jsx("option",{value:"cut",children:"Cut"}),e.jsx("option",{value:"uncut",children:"Uncut"})]}),e.jsx("input",{style:Z(),placeholder:"Min height (in)",value:fe,onChange:i=>Me(i.target.value)}),e.jsx("input",{style:Z(),placeholder:"Max height (in)",value:_e,onChange:i=>xt(i.target.value)}),e.jsx("input",{style:Z(),placeholder:"Min weight (lbs)",value:it,onChange:i=>jt(i.target.value)}),e.jsx("input",{style:Z(),placeholder:"Max weight (lbs)",value:rt,onChange:i=>wt(i.target.value)}),e.jsx("input",{style:Z(),placeholder:"Min cock size (in)",value:at,onChange:i=>St(i.target.value)}),e.jsx("input",{style:Z(),placeholder:"Max cock size (in)",value:ot,onChange:i=>kt(i.target.value)}),e.jsxs("select",{style:Z(),value:dt,onChange:i=>Ct(i.target.value),children:[e.jsx("option",{value:"",children:"Position"}),e.jsx("option",{value:"top",children:"Top"}),e.jsx("option",{value:"bottom",children:"Bottom"}),e.jsx("option",{value:"side",children:"Side"})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:_(!1),onClick:ht,children:"RESET"}),e.jsx("button",{type:"button",style:ve(!1),onClick:()=>Ke(!1),children:"DONE"})]})]})})}):null,e.jsx("div",{style:{display:"grid",gap:0},children:e.jsx("div",{style:{display:"grid",gap:0,gridTemplateColumns:"repeat(3, minmax(0, 1fr))"},children:Je.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:13,padding:12,gridColumn:"1 / -1"},children:"No users match current filters."}):Je.map(i=>e.jsx("button",{type:"button",onClick:()=>A(i.key),style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:0,display:"grid",gap:0,color:"#fff",cursor:"pointer"},children:e.jsxs("div",{style:{position:"relative",width:"100%",aspectRatio:"1 / 1"},children:[e.jsx("img",{src:i.avatarUrl??Be(i.key),alt:"User avatar",style:{width:"100%",height:"100%",borderRadius:0,objectFit:"cover",border:"1px solid #0fd9ff"}}),i.isOnline?e.jsx("span",{style:{position:"absolute",top:4,left:4,width:10,height:10,borderRadius:"50%",background:"#26d5ff",border:"2px solid #000"}}):null]})},i.key))})})]})}function En({api:t,session:n,setLastError:a,openThreadRequest:f,onThreadRequestConsumed:u,isMobile:v}){var k,ue,oe,me,d,W;const[S,I]=s.useState([]),[A,U]=s.useState(null),[B,D]=s.useState([]),[P,T]=s.useState("messages"),[o,b]=s.useState(null),[C,O]=s.useState(!1),[g,j]=s.useState(""),[L,M]=s.useState(null),[ee,ae]=s.useState({}),[pe,ge]=s.useState(null),ce=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,he="cruise",y=s.useMemo(()=>S.filter(r=>r.key!==A).map(r=>({key:r.key,label:r.displayName})),[S,A]),p=s.useMemo(()=>S.find(r=>r.key===A)??null,[S,A]);s.useEffect(()=>{if(y.length===0){j("");return}j(r=>r&&y.some(m=>m.key===r)?r:y[0].key)},[y]),s.useEffect(()=>{let r=!1;async function m(){var se,le,we;try{const ke=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,[de,xe]=await Promise.all([t.getPublicProfiles(),t.listActivePresence(n.sessionToken)]),G={},be={};for(const X of de.profiles)G[Ue(X.userId)]=X.displayName,typeof X.mainPhotoMediaId=="string"&&X.mainPhotoMediaId.trim()!==""&&(be[Ue(X.userId)]=X.mainPhotoMediaId);const Re=Array.from(new Set([...de.profiles.map(X=>Ue(X.userId)),...xe.presence.map(X=>Ce(X.key))].filter(X=>X&&X!==ke))).slice(0,24),Se=[];for(const X of Re)try{const Te=await t.listChat(n.sessionToken,"cruise",X),Ne=(Te==null?void 0:Te.messages)??[];if(!Array.isArray(Ne)||Ne.length===0)continue;const Ie=Ne[Ne.length-1],je=typeof Ie.text=="string"&&Ie.text.trim().length>0?Zt(Ie.text):((se=Ie.media)==null?void 0:se.kind)==="image"?"[Photo]":((le=Ie.media)==null?void 0:le.kind)==="video"?"[Video]":((we=Ie.media)==null?void 0:we.kind)==="audio"?"[Voice]":"";Se.push({key:X,displayName:G[X]??X,preview:je,at:Ie.createdAtMs})}catch{}const We=await Promise.all(Se.map(async X=>{const Te=be[X.key];if(!Te)return null;try{const Ne=await t.getPublicMediaUrl(Te);return{key:X.key,url:Ne.downloadUrl}}catch{return null}})),Fe={};for(const X of We)X&&(Fe[X.key]=X.url);for(const X of Se)X.avatarUrl=Fe[X.key];if(r)return;Se.sort((X,Te)=>Te.at-X.at),I(Se)}catch(ke){r||a(Y(ke))}}m();const F=window.setInterval(()=>{m()},1e4);return()=>{r=!0,window.clearInterval(F)}},[t,A,n.sessionToken,n.userId,a]),s.useEffect(()=>{f!=null&&f.key&&(U(Ce(f.key)),T("messages"),typeof u=="function"&&u())},[u,f]),s.useEffect(()=>{const r=m=>{var se;((se=m.detail)==null?void 0:se.tab)==="threads"&&(U(null),T("messages"))};return window.addEventListener("rd:tab-select",r),()=>window.removeEventListener("rd:tab-select",r)},[]),s.useEffect(()=>{if(!A||P!=="profile")return;const r=mt(A);if(!r){b(null);return}let m=!1;return O(!0),t.getPublicProfile(r).then(F=>{m||b(F.profile)}).catch(F=>{m||(b(null),a(Y(F)))}).finally(()=>{m||O(!1)}),()=>{m=!0}},[t,A,a,P]),s.useEffect(()=>{if(!A){D([]);return}let r=!1;const m=async()=>{try{const se=await t.listChat(n.sessionToken,he,A),le=(se==null?void 0:se.messages)??[];r||(D(Array.isArray(le)?le:[]),t.markChatRead(n.sessionToken,he,A).catch(()=>{}))}catch(se){r||a(Y(se))}};m();const F=window.setInterval(()=>{m()},1200);return()=>{r=!0,window.clearInterval(F)}},[t,A,n.sessionToken,a]);function R(r){if(!r.startsWith("GROUP_INVITE_ACCEPT|"))return null;const[,m,F]=r.split("|");return!m||!F?null:{inviteId:m,candidateKey:F}}const ne=s.useMemo(()=>({async sendMessage(r,m,F,se){const le=await t.sendChat(n.sessionToken,r,m,F,se),we=le==null?void 0:le.message,ke=R(we.text??"");if(ke&&we.toKey===ce&&ee[ke.inviteId]&&(M(ke.candidateKey),ge(`Invite accepted by ${ke.candidateKey}.`),ae(xe=>{const G={...xe};return delete G[ke.inviteId],G})),D(de=>[...de,we].sort((xe,G)=>xe.createdAtMs-G.createdAtMs)),r==="cruise"&&L)try{const de=await t.sendChat(n.sessionToken,r,L,F,se),xe=de==null?void 0:de.message;D(G=>[...G,xe].sort((be,Re)=>be.createdAtMs-Re.createdAtMs))}catch(de){a(Y(de))}return we},async initiateMediaUpload(r,m){const F=await t.initiateChatMediaUpload(n.sessionToken,{mimeType:r,sizeBytes:m});return{objectKey:F.objectKey,uploadUrl:F.uploadUrl}},async uploadToSignedUrl(r,m,F){if(await bt(r,m,F))return;if(!(await fetch(r,{method:"PUT",headers:{"content-type":F},body:m})).ok)throw{code:"MEDIA_UPLOAD_INCOMPLETE",message:"Upload failed."}},async getMediaUrl(r){return(await t.getChatMediaUrl(n.sessionToken,r)).downloadUrl}}),[t,ce,ee,n.sessionToken,a,L]);async function E(){var r;if(!(!A||!g)){if(!S.some(m=>m.key===g)){a("You can only add a third user you have previously messaged.");return}try{const m=crypto.randomUUID();await t.sendChat(n.sessionToken,"cruise",g,`GROUP_INVITE_REQUEST|${m}|${ce}|${A}`),ae(F=>({...F,[m]:{candidateKey:g}})),ge(`Invite sent to ${((r=S.find(F=>F.key===g))==null?void 0:r.displayName)??g}.`)}catch(m){a(Y(m))}}}async function te(){if(A)try{await t.sendChat(n.sessionToken,"cruise",A,vt),ge("Fire sent.")}catch(r){a(Y(r))}}if(A){const r=(p==null?void 0:p.displayName)??A;return e.jsxs("div",{style:{display:"grid",gap:0,minHeight:v?"calc(100dvh - 150px)":void 0,marginInline:v?-10:0,marginBlock:0},children:[e.jsx("div",{style:{position:"sticky",top:0,zIndex:46,background:"rgba(8,8,12,0.96)",borderBottom:"1px solid rgba(255,58,77,0.35)",padding:"6px 10px",display:"flex",justifyContent:"flex-end"},children:e.jsx("button",{type:"button",onClick:()=>T(m=>m==="messages"?"profile":"messages"),style:{background:"transparent",border:0,color:"#26d5ff",fontSize:13,fontWeight:700,letterSpacing:"0.03em",textTransform:"uppercase",padding:0,cursor:"pointer"},children:P==="messages"?"View Profile":"Back to Thread"})}),P==="messages"?e.jsx(Xt,{chatKind:"cruise",peerKey:A,currentUserKey:ce,messages:B,client:ne,title:`INSTANT THREAD: ${r}`,peerSummary:{displayName:r},thirdParty:{candidates:y,selectedKey:g,onSelect:m=>j(m),onAdd:()=>void E(),disabled:!1},showHeader:!1,edgeToEdge:!0,fillHeight:v}):e.jsxs("div",{style:{padding:12,display:"grid",gap:12},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"88px 1fr",gap:12,alignItems:"center"},children:[e.jsx("img",{src:(p==null?void 0:p.avatarUrl)??Be(A),alt:"Profile avatar",style:{width:88,height:88,borderRadius:"50%",objectFit:"cover",border:"2px solid #ff3047"}}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:24,fontWeight:700},children:(o==null?void 0:o.displayName)??r}),e.jsx("div",{style:{color:"#26d5ff",fontSize:14},children:"Instant Messaging Available"})]})]}),C?e.jsx("div",{style:{color:"#9fb6bf",fontSize:14},children:"Loading profile..."}):null,C?null:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:14,lineHeight:1.5},children:[e.jsxs("div",{children:["Age: ",(o==null?void 0:o.age)??"-"]}),e.jsxs("div",{children:["Race: ",((k=o==null?void 0:o.stats)==null?void 0:k.race)??"-"]}),e.jsxs("div",{children:["Height: ",((ue=o==null?void 0:o.stats)==null?void 0:ue.heightInches)??"-"]}),e.jsxs("div",{children:["Weight: ",((oe=o==null?void 0:o.stats)==null?void 0:oe.weightLbs)??"-"]}),e.jsxs("div",{children:["Cock Size: ",((me=o==null?void 0:o.stats)==null?void 0:me.cockSizeInches)??"-"]}),e.jsxs("div",{children:["Cut / Uncut: ",((d=o==null?void 0:o.stats)==null?void 0:d.cutStatus)??"-"]}),e.jsxs("div",{children:["Position: ",((W=o==null?void 0:o.stats)==null?void 0:W.position)??"-"]}),e.jsxs("div",{style:{marginTop:8},children:["Bio: ",(o==null?void 0:o.bio)??"-"]})]}),e.jsx("div",{children:e.jsx("button",{type:"button",style:{..._(!1),color:"#ffb347",borderColor:"rgba(255,179,71,0.65)"},onClick:()=>void te(),children:"ðŸ”¥ FIRE"})})]})]})]})}return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:v?-10:0,marginBlock:0},children:[S.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14,padding:14},children:"No conversations yet."}):S.map(r=>e.jsxs("button",{type:"button",onClick:()=>U(r.key),style:{border:0,borderBottom:"1px solid rgba(255,58,77,0.24)",borderRadius:0,padding:"10px 12px",background:"rgba(0,0,0,0.2)",textAlign:"left",color:"#fff",cursor:"pointer",display:"grid",gridTemplateColumns:"52px 1fr",gap:10,alignItems:"center",width:"100%"},children:[e.jsx("img",{src:r.avatarUrl??Be(r.key),alt:`${r.displayName} avatar`,style:{width:52,height:52,borderRadius:6,objectFit:"cover",border:"1px solid rgba(38,213,255,0.9)"}}),e.jsxs("div",{style:{display:"grid",gap:3,minWidth:0},children:[e.jsx("div",{style:{fontWeight:700},children:r.displayName}),e.jsx("div",{style:{color:"#b9bec9",fontSize:13,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:r.preview})]})]},r.key)),pe?e.jsx("div",{style:{color:"#26d5ff",fontSize:12,padding:10},children:pe}):null]})}function Fn({api:t,session:n,isMobile:a,setLastError:f}){const[u,v]=s.useState("ads"),[S,I]=s.useState([]),[A,U]=s.useState([]),[B,D]=s.useState(""),[P,T]=s.useState(""),[o,b]=s.useState(""),[C,O]=s.useState(""),[g,j]=s.useState([]),[L,M]=s.useState(""),[ee,ae]=s.useState(""),[pe,ge]=s.useState(""),[ce,he]=s.useState([]),[y,p]=s.useState({}),R=!0,ne=n.userType!=="guest";async function E(){try{const[r,m,F,se]=await Promise.all([t.listPublicPostings("ad"),t.listPublicPostings("event"),t.listCruisingSpots(),n.userType==="guest"?Promise.resolve({postings:[]}):t.listEventInvites(n.sessionToken)]);I([...r.postings].sort((le,we)=>le.createdAtMs-we.createdAtMs)),U([...m.postings].sort((le,we)=>le.createdAtMs-we.createdAtMs)),j(F.spots),he(se.postings)}catch(r){f(Y(r))}}s.useEffect(()=>{E()},[]),s.useEffect(()=>{const r=m=>{var se;((se=m.detail)==null?void 0:se.tab)==="public"&&v("ads")};return window.addEventListener("rd:tab-select",r),()=>window.removeEventListener("rd:tab-select",r)},[]);async function te(r){if(r==="event"&&!ne){f("Anonymous users cannot create event postings.");return}const m=r==="ad"?B:o,F=r==="ad"?P:C;try{await t.createPublicPosting(n.sessionToken,{type:r,title:m,body:F}),r==="ad"?(D(""),T("")):(b(""),O("")),await E()}catch(se){f(Y(se))}}async function k(r){if(!ne){f("Anonymous users cannot invite to events.");return}const m=(y[r]??"").trim();if(!m){f("Target user id is required.");return}try{await t.inviteToEvent(n.sessionToken,{postingId:r,targetUserId:m}),p(F=>({...F,[r]:""})),await E()}catch(F){f(Y(F))}}async function ue(r,m){if(n.userType==="guest"){f("Anonymous users cannot respond to event invites.");return}try{await t.respondToEventInvite(n.sessionToken,{postingId:r,accept:m}),await E()}catch(F){f(Y(F))}}async function oe(){try{await t.createCruisingSpot(n.sessionToken,{name:L,address:ee,description:pe}),M(""),ae(""),ge(""),await E()}catch(r){f(Y(r))}}async function me(r){try{await t.checkInCruisingSpot(n.sessionToken,r),await E()}catch(m){f(Y(m))}}const d=r=>{const m=r==="ads"?"ADS":"EVENTS",F=r==="ads"?S:A,se=r==="ads"?B:o,le=r==="ads"?P:C,we=r==="ads"?D:b,ke=r==="ads"?T:O,de=r==="ads"?"ad":"event",xe=r==="ads"?R:ne;return e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.38)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:m}),e.jsx("input",{value:se,onChange:G=>we(G.target.value),placeholder:`${m} title`,style:Z(),"aria-label":`${m} title`,disabled:!xe}),e.jsx("textarea",{value:le,onChange:G=>ke(G.target.value),placeholder:`Write ${m.toLowerCase()} details`,style:{...Z(),minHeight:86,resize:"vertical"},"aria-label":`${m} details`,disabled:!xe}),e.jsxs("button",{type:"button",onClick:()=>void te(de),style:xe?ve(!1):_(!0),disabled:!xe,children:["POST ",m]}),xe?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can view events but cannot post events."}),e.jsx("div",{style:{display:"grid",gap:8,marginTop:6},children:F.length===0?e.jsxs("div",{style:{color:"#b9bec9",fontSize:14},children:["No ",m.toLowerCase()," yet."]}):F.map(G=>{var be,Re;return e.jsxs("div",{style:{borderTop:"1px solid rgba(255,58,77,0.25)",paddingTop:10,paddingBottom:10},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:4},children:G.title}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12,marginBottom:6},children:["Host: ",G.authorUserId]}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap"},children:G.body}),r==="events"?e.jsxs("div",{style:{display:"grid",gap:8,marginTop:8},children:[e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12},children:["Invited: ",((be=G.invitedUserIds)==null?void 0:be.length)??0," | Accepted: ",((Re=G.acceptedUserIds)==null?void 0:Re.length)??0]}),n.userId&&n.userId===G.authorUserId?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8},children:[e.jsx("input",{value:y[G.postingId]??"",onChange:Se=>p(We=>({...We,[G.postingId]:Se.target.value})),placeholder:"Invite user id",style:Z()}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>void k(G.postingId),children:"INVITE"})]}):null,n.userType!=="guest"&&n.userId&&Array.isArray(G.invitedUserIds)&&G.invitedUserIds.includes(n.userId)?e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:ve(!1),onClick:()=>void ue(G.postingId,!0),children:"ACCEPT INVITE"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>void ue(G.postingId,!1),children:"DECLINE"})]}):null]}):null]},G.postingId)})})]})})},W=e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.38)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"CRUISING SPOTS"}),e.jsx("input",{value:L,onChange:r=>M(r.target.value),placeholder:"Spot name",style:Z(),disabled:!1}),e.jsx("input",{value:ee,onChange:r=>ae(r.target.value),placeholder:"Spot address",style:Z(),disabled:!1}),e.jsx("textarea",{value:pe,onChange:r=>ge(r.target.value),placeholder:"Spot description",style:{...Z(),minHeight:80,resize:"vertical"},disabled:!1}),e.jsx("button",{type:"button",style:ve(!1),disabled:!1,onClick:()=>void oe(),children:"CREATE SPOT"}),null,e.jsx("div",{style:{display:"grid",gap:8},children:g.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"No cruising spots yet."}):g.map(r=>e.jsxs("div",{style:{borderTop:"1px solid rgba(255,58,77,0.25)",paddingTop:10,paddingBottom:10},children:[e.jsx("div",{style:{fontWeight:700},children:r.name}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12,marginTop:4},children:["Created by: ",r.creatorUserId]}),e.jsx("div",{style:{color:"#9fb6bf",fontSize:12,marginTop:2},children:r.address}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap",marginTop:6},children:r.description}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:_(!1),onClick:()=>void me(r.spotId),children:"CHECK IN"}),e.jsxs("span",{style:{color:"#9fb6bf",fontSize:12},children:["Checked in: ",r.checkInCount??0]}),e.jsxs("span",{style:{color:"#9fb6bf",fontSize:12},children:["Got action: ",r.actionCount??0]})]})]},r.spotId))})]})});return e.jsx("div",{style:{display:"grid",gap:8,marginInline:a?-10:0},children:a?e.jsxs(e.Fragment,{children:[u==="ads"?d("ads"):null,u==="events"?d("events"):null,u==="spots"?W:null,e.jsx("div",{style:{position:"sticky",bottom:"calc(86px + env(safe-area-inset-bottom, 0px))",zIndex:31,background:"rgba(0,0,0,0.35)",padding:8},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[e.jsx("button",{type:"button",style:u==="ads"?ve(!1):_(!1),onClick:()=>v("ads"),children:"ADS"}),e.jsx("button",{type:"button",style:u==="events"?ve(!1):_(!1),onClick:()=>v("events"),children:"EVENTS"}),e.jsx("button",{type:"button",style:u==="spots"?ve(!1):_(!1),onClick:()=>v("spots"),children:"SPOTS"})]})})]}):e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[d("ads"),d("events"),e.jsx("div",{style:{gridColumn:"1 / -1"},children:W}),n.userType!=="guest"&&ce.length>0?e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.25)",gridColumn:"1 / -1",display:"grid",gap:8,padding:10},children:[e.jsx("div",{style:{fontSize:16,fontWeight:700},children:"EVENT INVITES"}),ce.map(r=>e.jsxs("div",{style:{display:"grid",gap:6,border:"1px solid rgba(255,58,77,0.4)",borderRadius:10,padding:8},children:[e.jsx("div",{style:{fontWeight:700},children:r.title}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13},children:["Host: ",r.authorUserId]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:ve(!1),onClick:()=>void ue(r.postingId,!0),children:"ACCEPT"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>void ue(r.postingId,!1),children:"DECLINE"})]})]},r.postingId))]}):null]})})}function zn({api:t,session:n,setLastError:a}){const[f,u]=s.useState([]),[v,S]=s.useState(""),[I,A]=s.useState("");async function U(){try{const o=await t.listSubmissions();u([...o.submissions].sort((b,C)=>C.createdAtMs-b.createdAtMs))}catch(o){a(Y(o))}}s.useEffect(()=>{U()},[]);async function B(){try{await t.createSubmission(n.sessionToken,{title:v,body:I}),S(""),A(""),await U()}catch(o){a(Y(o))}}async function D(o){try{await t.recordSubmissionView(o),await U()}catch(b){a(Y(b))}}async function P(o,b){try{await t.rateSubmission(o,b),await U()}catch(C){a(Y(C))}}const T=n.userType!=="guest";return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("input",{style:Z(),value:v,onChange:o=>S(o.target.value),placeholder:"Story title",disabled:!T}),e.jsx("textarea",{style:{...Z(),minHeight:120},value:I,onChange:o=>A(o.target.value),placeholder:"Write your story",disabled:!T}),e.jsx("button",{type:"button",style:T?ve(!1):_(!0),disabled:!T,onClick:()=>void B(),children:"PUBLISH STORY"}),T?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can read but cannot publish submissions."})]})}),e.jsx("div",{style:{display:"grid",gap:10},children:f.map(o=>{const b=o.ratingCount>0?(o.ratingSum/o.ratingCount).toFixed(2):"0.00";return e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.28)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:o.title}),e.jsx("div",{style:{color:"#ced3dc",whiteSpace:"pre-wrap",marginTop:6},children:o.body}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13,marginTop:8},children:["Views: ",o.viewCount," | Rating: ",b," (",o.ratingCount,")"]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:_(!1),onClick:()=>void D(o.submissionId),children:"VIEW"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>void P(o.submissionId,1),children:"â˜…1"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>void P(o.submissionId,2),children:"â˜…2"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>void P(o.submissionId,3),children:"â˜…3"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>void P(o.submissionId,4),children:"â˜…4"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>void P(o.submissionId,5),children:"â˜…5"})]})]},o.submissionId)})})]})}function Un({api:t,session:n,setLastError:a}){var ce,he,y,p,R,ne;const[f,u]=s.useState([]),[v,S]=s.useState({}),[I,A]=s.useState(null),[U,B]=s.useState(2e3),[D,P]=s.useState(""),[T,o]=s.useState(""),[b,C]=s.useState(""),[O,g]=s.useState(""),[j,L]=s.useState("Ready."),M=n.userType!=="guest";async function ee(){try{const E=await t.listPromotedProfiles();u([...E.listings].sort((oe,me)=>me.createdAtMs-oe.createdAtMs)),B(E.feeCents);const te=Array.from(new Set(E.listings.map(oe=>oe.userId))).filter(oe=>oe.trim().length>0),k=await Promise.all(te.map(async oe=>{try{const d=(await t.getPublicProfile(oe)).profile.mainPhotoMediaId;if(!d)return null;const W=await t.getPublicMediaUrl(d);return{userId:oe,url:W.downloadUrl}}catch{return null}})),ue={};for(const oe of k)oe&&(ue[oe.userId]=oe.url);S(ue)}catch(E){a(Y(E))}}s.useEffect(()=>{ee()},[]);async function ae(){if(!M){a("Anonymous users cannot create promoted profiles.");return}try{const E=await t.startPromotedPayment(n.sessionToken),te=await t.confirmPromotedPayment(n.sessionToken,E.payment.paymentToken);g(te.payment.paymentToken),L("Payment confirmed. You can now publish one promoted profile.")}catch(E){const te=Y(E);L(te),a(te)}}async function pe(){if(!M){a("Anonymous users cannot create promoted profiles.");return}try{await t.createPromotedProfile(n.sessionToken,{paymentToken:O,title:D,body:T,displayName:b}),P(""),o(""),C(""),g(""),L("Promoted profile published."),await ee()}catch(E){const te=Y(E);L(te),a(te)}}async function ge(E){try{const te=await t.getPublicProfile(E);A(te.profile)}catch(te){a(Y(te))}}return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"PROMOTED PROFILES"}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:14},children:["Publishing requires a $",Math.round(U/100)," fee per profile."]}),e.jsx("div",{style:{color:"#26d5ff",fontSize:13},children:j})]})}),e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("input",{value:b,onChange:E=>C(E.target.value),placeholder:"Display name",style:Z(),disabled:!M}),e.jsx("input",{value:D,onChange:E=>P(E.target.value),placeholder:"Headline",style:Z(),disabled:!M}),e.jsx("textarea",{value:T,onChange:E=>o(E.target.value),placeholder:"Profile description",style:{...Z(),minHeight:92,resize:"vertical"},disabled:!M}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsxs("button",{type:"button",style:_(!M),disabled:!M,onClick:()=>void ae(),children:["PAY $",Math.round(U/100)]}),e.jsx("button",{type:"button",style:M?ve(!1):_(!0),disabled:!M,onClick:()=>void pe(),children:"PUBLISH PROFILE"})]}),M?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can browse but cannot publish paid profiles."})]})}),e.jsx("div",{style:{display:"grid",gap:10},children:f.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"No promoted profiles yet."}):f.map(E=>e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.25)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"72px 1fr",gap:10,alignItems:"start"},children:[e.jsx("img",{src:v[E.userId]??Be(`user:${E.userId}`),alt:`${E.displayName} profile`,style:{width:72,height:72,borderRadius:6,objectFit:"cover",border:"1px solid rgba(38,213,255,0.9)"}}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:E.title}),e.jsx("div",{style:{color:"#26d5ff",fontSize:13},children:E.displayName}),e.jsx("div",{style:{color:"#ced3dc",whiteSpace:"pre-wrap",fontSize:14},children:E.body}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>void ge(E.userId),children:"VIEW PROFILE"})]})]})},E.listingId))}),I?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},onClick:()=>A(null),children:e.jsxs("div",{onClick:E=>E.stopPropagation(),style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:12,width:"min(560px, 100%)",background:"rgba(0,0,0,0.88)"},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:I.displayName}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:6},children:["Age: ",I.age]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Race: ",((ce=I.stats)==null?void 0:ce.race)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Height: ",((he=I.stats)==null?void 0:he.heightInches)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Weight: ",((y=I.stats)==null?void 0:y.weightLbs)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Cock Size: ",((p=I.stats)==null?void 0:p.cockSizeInches)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Cut / Uncut: ",((R=I.stats)==null?void 0:R.cutStatus)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Position: ",((ne=I.stats)==null?void 0:ne.position)??"-"]}),e.jsx("div",{style:{color:"#ced3dc",marginTop:10,whiteSpace:"pre-wrap"},children:I.bio}),e.jsx("div",{style:{marginTop:10},children:e.jsx("button",{type:"button",style:_(!1),onClick:()=>A(null),children:"CLOSE"})})]})}):null]})}function Ln(){return{displayName:"",age:"",bio:"",heightInches:"",race:"",cockSizeInches:"",cutStatus:"",weightLbs:"",position:"",discreetMode:!1,travelEnabled:!1,travelLat:"",travelLng:"",lookingForMore:""}}function _t(t){var n,a,f;return{displayName:t.displayName,age:String(t.age),bio:t.bio,heightInches:t.stats.heightInches!==void 0?String(t.stats.heightInches):"",race:t.stats.race??"",cockSizeInches:t.stats.cockSizeInches!==void 0?String(t.stats.cockSizeInches):"",cutStatus:t.stats.cutStatus??"",weightLbs:t.stats.weightLbs!==void 0?String(t.stats.weightLbs):"",position:t.stats.position??"",discreetMode:t.discreetMode===!0,travelEnabled:((n=t.travelMode)==null?void 0:n.enabled)===!0,travelLat:typeof((a=t.travelMode)==null?void 0:a.lat)=="number"?String(t.travelMode.lat):"",travelLng:typeof((f=t.travelMode)==null?void 0:f.lng)=="number"?String(t.travelMode.lng):"",lookingForMore:t.bio}}function Gt(t){const n=t.trim();if(!n)return;const a=Number(n);return Number.isFinite(a)?Math.trunc(a):void 0}function On(t){const n=t.trim();if(!n)return;const a=Number(n);return Number.isFinite(a)?a:void 0}function Kn({api:t,session:n,setLastError:a}){var ce,he;const[f,u]=s.useState(Ln()),[v,S]=s.useState(null),[I,A]=s.useState(!1),[U,B]=s.useState(!1),[D,P]=s.useState(null),[T,o]=s.useState({});async function b(){A(!0);try{const y=await t.getMyProfile(n.sessionToken);S(y.profile),u(_t(y.profile)),P("Profile loaded.")}catch(y){const p=y;if((p==null?void 0:p.code)==="PROFILE_NOT_FOUND"){S(null),u(R=>({...R,age:R.age||"18"})),P("No profile yet. Fill out the form and save.");return}P(Y(y))}finally{A(!1)}}s.useEffect(()=>{b()},[n.sessionToken,n.userType]),s.useEffect(()=>{const y=[v==null?void 0:v.mainPhotoMediaId,...(v==null?void 0:v.galleryMediaIds)??[]].filter(R=>typeof R=="string"&&R.length>0);if(y.length===0)return;const p=y.filter(R=>!T[R]);p.length!==0&&Promise.all(p.map(async R=>{try{const ne=await t.getPublicMediaUrl(R);return{id:R,url:ne.downloadUrl}}catch{return null}})).then(R=>{o(ne=>{const E={...ne};for(const te of R)te&&(E[te.id]=te.url);return E})})},[t,T,v==null?void 0:v.galleryMediaIds,v==null?void 0:v.mainPhotoMediaId]);async function C(){var y,p,R,ne,E;B(!0),a(null);try{const te=Number(f.age),k=f.lookingForMore.trim()?`${f.bio.trim()}

Looking For More: ${f.lookingForMore.trim()}`.trim():f.bio,ue=f.travelLat.trim()?Number(f.travelLat):void 0,oe=f.travelLng.trim()?Number(f.travelLng):void 0,me={displayName:f.displayName,age:Math.trunc(te),bio:k,stats:{heightInches:Gt(f.heightInches),race:f.race.trim()||void 0,cockSizeInches:On(f.cockSizeInches),cutStatus:f.cutStatus||void 0,weightLbs:Gt(f.weightLbs),position:f.position||void 0},discreetMode:f.discreetMode,travelMode:{enabled:f.travelEnabled,lat:Number.isFinite(ue)?ue:void 0,lng:Number.isFinite(oe)?oe:void 0}},d=await t.upsertMyProfile(n.sessionToken,me);S(d.profile),u(_t(d.profile));try{localStorage.setItem("reddoor_travel_center",JSON.stringify({enabled:((y=d.profile.travelMode)==null?void 0:y.enabled)===!0,lat:(p=d.profile.travelMode)==null?void 0:p.lat,lng:(R=d.profile.travelMode)==null?void 0:R.lng})),window.dispatchEvent(new CustomEvent("rd:location-updated",{detail:{lat:(ne=d.profile.travelMode)==null?void 0:ne.lat,lng:(E=d.profile.travelMode)==null?void 0:E.lng}}))}catch{}P("Profile saved.")}catch(te){const k=Y(te);P(k),a(k)}finally{B(!1)}}async function O(y,p){if(!p){P("Choose a file first.");return}if(n.userType==="guest"){P("Guest sessions cannot upload media. Register to persist media.");return}B(!0),a(null);try{const R=await t.initiateMediaUpload(n.sessionToken,{kind:y,mimeType:p.type||(y==="video"?"video/mp4":"image/jpeg"),sizeBytes:p.size});if(!await bt(R.uploadUrl,p,p.type||"application/octet-stream")){const E=await fetch(R.uploadUrl,{method:"PUT",headers:{"content-type":p.type||"application/octet-stream"},body:p});if(!E.ok)throw{message:`Upload failed (${E.status}).`}}await t.completeMediaUpload(n.sessionToken,R.mediaId),await b(),P("Media uploaded.")}catch(R){const ne=Y(R);P(ne),a(ne)}finally{B(!1)}}const[g,j]=s.useState(null),[L,M]=s.useState(null),[ee,ae]=s.useState(null);async function pe(y){if(v){B(!0);try{const p=(v.galleryMediaIds??[]).filter(ne=>ne!==y),R=await t.updateProfileMediaReferences(n.sessionToken,{galleryMediaIds:p});S(R.profile),P("Gallery updated.")}catch(p){const R=Y(p);P(R),a(R)}finally{B(!1)}}}async function ge(y){if(v){B(!0);try{const p=await t.updateProfileMediaReferences(n.sessionToken,{galleryMediaIds:v.galleryMediaIds,mainPhotoMediaId:y});S(p.profile),P("Main photo updated.")}catch(p){const R=Y(p);P(R),a(R)}finally{B(!1)}}}return e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:14},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"SETTINGS / PROFILE"}),n.userType==="guest"?e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guest profile data is temporary for this session and is removed when you log out."}):null,D?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:D}):null,e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Display Name"}),e.jsx("input",{value:f.displayName,onChange:y=>u(p=>({...p,displayName:y.target.value})),style:Z()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Age"}),e.jsx("input",{value:f.age,onChange:y=>u(p=>({...p,age:y.target.value})),style:Z(),inputMode:"numeric"})]})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Bio"}),e.jsx("textarea",{value:f.bio,onChange:y=>u(p=>({...p,bio:y.target.value})),style:{...Z(),minHeight:88,resize:"vertical"}})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Looking For More (Optional)"}),e.jsx("textarea",{value:f.lookingForMore,onChange:y=>u(p=>({...p,lookingForMore:y.target.value})),style:{...Z(),minHeight:72,resize:"vertical"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:f.discreetMode,onChange:y=>u(p=>({...p,discreetMode:y.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0,fontSize:13},children:"Discreet Mode (hide profile from others)"})]}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:f.travelEnabled,onChange:y=>u(p=>({...p,travelEnabled:y.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Travel Mode"})]})]}),f.travelEnabled?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Travel Lat"}),e.jsx("input",{value:f.travelLat,onChange:y=>u(p=>({...p,travelLat:y.target.value})),style:Z()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Travel Lng"}),e.jsx("input",{value:f.travelLng,onChange:y=>u(p=>({...p,travelLng:y.target.value})),style:Z()})]})]}):null,e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Height (in)"}),e.jsx("input",{value:f.heightInches,onChange:y=>u(p=>({...p,heightInches:y.target.value})),style:Z(),inputMode:"numeric"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Race"}),e.jsx("input",{value:f.race,onChange:y=>u(p=>({...p,race:y.target.value})),style:Z()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Cock Size (in)"}),e.jsx("input",{value:f.cockSizeInches,onChange:y=>u(p=>({...p,cockSizeInches:y.target.value})),style:Z(),inputMode:"decimal"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Cut / Uncut"}),e.jsxs("select",{value:f.cutStatus,onChange:y=>u(p=>({...p,cutStatus:y.target.value})),style:Z(),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"cut",children:"Cut"}),e.jsx("option",{value:"uncut",children:"Uncut"})]})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Weight (lbs)"}),e.jsx("input",{value:f.weightLbs,onChange:y=>u(p=>({...p,weightLbs:y.target.value})),style:Z(),inputMode:"numeric"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Position"}),e.jsxs("select",{value:f.position,onChange:y=>u(p=>({...p,position:y.target.value})),style:Z(),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"top",children:"Top"}),e.jsx("option",{value:"bottom",children:"Bottom"}),e.jsx("option",{value:"side",children:"Side"})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",onClick:()=>void C(),style:ve(U),disabled:U,children:"SAVE PROFILE"}),e.jsx("button",{type:"button",onClick:()=>void b(),style:_(I),disabled:I,children:"REFRESH"})]})]})}),e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"MEDIA"}),e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"Main profile photo, gallery photo, and video uploads."}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Main Photo"}),e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:y=>{var p;return j(((p=y.target.files)==null?void 0:p[0])??null)}})]}),e.jsx("button",{type:"button",style:ve(U),disabled:U,onClick:()=>void O("photo_main",g),children:"UPLOAD MAIN PHOTO"})]}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Gallery Photo"}),e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:y=>{var p;return M(((p=y.target.files)==null?void 0:p[0])??null)}})]}),e.jsx("button",{type:"button",style:ve(U),disabled:U,onClick:()=>void O("photo_gallery",L),children:"UPLOAD GALLERY PHOTO"})]}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Video"}),e.jsx("input",{className:"rd-input",type:"file",accept:"video/*",onChange:y=>{var p;return ae(((p=y.target.files)==null?void 0:p[0])??null)}})]}),e.jsx("button",{type:"button",style:ve(U),disabled:U,onClick:()=>void O("video",ee),children:"UPLOAD VIDEO"})]}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13},children:["Main photo media id: ",(v==null?void 0:v.mainPhotoMediaId)??"-",e.jsx("br",{}),"Gallery count: ",((ce=v==null?void 0:v.galleryMediaIds)==null?void 0:ce.length)??0,e.jsx("br",{}),"Video media id: ",(v==null?void 0:v.videoMediaId)??"-"]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"YOUR GALLERY"}),(he=v==null?void 0:v.galleryMediaIds)!=null&&he.length?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(130px, 1fr))",gap:10},children:v.galleryMediaIds.map(y=>e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.45)",borderRadius:10,padding:8,display:"grid",gap:8},children:[e.jsx("img",{src:T[y]??Be(y),alt:"Gallery photo",style:{width:"100%",aspectRatio:"1/1",objectFit:"cover",borderRadius:8,border:"1px solid rgba(255,58,77,0.4)"}}),e.jsx("button",{type:"button",style:_(U),disabled:U,onClick:()=>void ge(y),children:"SET MAIN"}),e.jsx("button",{type:"button",style:_(U),disabled:U,onClick:()=>void pe(y),children:"REMOVE"})]},y))}):e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No gallery photos uploaded yet."})]})]})})]})}function Wn({api:t,session:n,setLastError:a,onLogout:f}){const[u,v]=s.useState({discreetMode:!1,travelEnabled:!1,travelLat:"",travelLng:""}),[S,I]=s.useState("Loading settings..."),[A,U]=s.useState(!1),[B,D]=s.useState([]);async function P(){var g,j,L;try{const M=await t.getMyProfile(n.sessionToken);if(v({discreetMode:M.profile.discreetMode===!0,travelEnabled:((g=M.profile.travelMode)==null?void 0:g.enabled)===!0,travelLat:typeof((j=M.profile.travelMode)==null?void 0:j.lat)=="number"?String(M.profile.travelMode.lat):"",travelLng:typeof((L=M.profile.travelMode)==null?void 0:L.lng)=="number"?String(M.profile.travelMode.lng):""}),I("Settings loaded."),n.userType!=="guest")try{const ee=await t.listBlocked(n.sessionToken);D(ee.blocked)}catch{D([])}else D([])}catch(M){I(Y(M))}}async function T(){try{const g=await fetch("/api/config"),j=await g.json();if(!g.ok)throw j;U(j.mediaStorageConfigured===!0)}catch{U(!1)}}s.useEffect(()=>{P(),T()},[n.sessionToken,n.userType]);async function o(){try{const g=await t.getMyProfile(n.sessionToken),j=u.travelLat.trim()?Number(u.travelLat):void 0,L=u.travelLng.trim()?Number(u.travelLng):void 0;await t.upsertMyProfile(n.sessionToken,{displayName:g.profile.displayName,age:g.profile.age,bio:g.profile.bio,stats:g.profile.stats,discreetMode:u.discreetMode,travelMode:{enabled:u.travelEnabled,lat:Number.isFinite(j)?j:void 0,lng:Number.isFinite(L)?L:void 0}}),I("Privacy settings saved.")}catch(g){const j=Y(g);I(j),a(j)}}async function b(){if(!navigator.geolocation){const g="Geolocation is unavailable on this device.";I(g),a(g);return}try{const g=await new Promise((M,ee)=>{navigator.geolocation.getCurrentPosition(M,ee,{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})}),j=Number(g.coords.latitude.toFixed(6)),L=Number(g.coords.longitude.toFixed(6));v(M=>({...M,travelEnabled:!0,travelLat:String(j),travelLng:String(L)}));try{localStorage.setItem("reddoor_travel_center",JSON.stringify({enabled:!0,lat:j,lng:L}))}catch{}try{await t.updatePresence(n.sessionToken,j,L,"online")}catch{}window.dispatchEvent(new CustomEvent("rd:location-updated",{detail:{lat:j,lng:L}})),I("Actual location detected. Save privacy settings to persist it.")}catch(g){const j=Y(g);I(j),a(j)}}async function C(){try{const g=u.travelLat.trim()?Number(u.travelLat):void 0,j=u.travelLng.trim()?Number(u.travelLng):void 0,L=await t.seedFakeUsers(12,Number.isFinite(g)?g:void 0,Number.isFinite(j)?j:void 0);I(`Seeded ${L.seededCount} fake users for testing.`)}catch(g){const j=Y(g);I(j),a(j)}}async function O(g){try{await t.unblock(n.sessionToken,g);const j=await t.listBlocked(n.sessionToken);D(j.blocked),I("Blocked users updated.")}catch(j){const L=Y(j);I(L),a(L)}}return e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"SETTINGS"}),e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:S}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:u.discreetMode,onChange:g=>v(j=>({...j,discreetMode:g.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Discreet Mode (hide your profile)"})]}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:u.travelEnabled,onChange:g=>v(j=>({...j,travelEnabled:g.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Travel Mode"})]}),u.travelEnabled?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("input",{value:u.travelLat,onChange:g=>v(j=>({...j,travelLat:g.target.value})),style:Z(),placeholder:"Travel lat"}),e.jsx("input",{value:u.travelLng,onChange:g=>v(j=>({...j,travelLng:g.target.value})),style:Z(),placeholder:"Travel lng"})]}):null,e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:ve(!1),onClick:()=>void o(),children:"SAVE PRIVACY"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>void b(),children:"DETECT ACTUAL LOCATION"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>void C(),children:"SEED FAKE USERS"}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>f==null?void 0:f(),children:"LOGOUT"})]})]})}),e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"MEDIA STORAGE"}),e.jsx("div",{style:{color:A?"#26d5ff":"#ff8a95",fontSize:14},children:A?"Configured: uploads enabled.":"Not configured: set S3_BUCKET, S3_REGION, S3_ACCESS_KEY_ID, S3_SECRET_ACCESS_KEY."}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>void T(),children:"REFRESH STORAGE STATUS"})]})}),n.userType!=="guest"?e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"BLOCKED USERS"}),B.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No blocked users."}):B.map(g=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[e.jsx("div",{style:{color:"#ced3dc",fontSize:14},children:g}),e.jsx("button",{type:"button",style:_(!1),onClick:()=>void O(g),children:"UNBLOCK"})]},g))]})}):null]})}function Bn({api:t,session:n,setSession:a,settings:f,activeTab:u,setActiveTab:v,discoverScreen:S,onDiscoverScreenChange:I,discoverFilter:A,busy:U,setBusy:B,setLastError:D,onUnreadCountChange:P,hideModeCard:T,onLogout:o}){const b=An(),[C,O]=s.useState(null),g=e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx(Kn,{api:t,session:n,setLastError:D}),e.jsx(Wn,{api:t,session:n,setLastError:D,onLogout:o})]});return e.jsxs("div",{style:{display:"grid",gap:12},children:[null,e.jsx("div",{style:{display:u==="discover"?"block":"none"},children:e.jsx(Rn,{api:t,session:n,settings:f,discoverFilter:A,busy:U,setBusy:B,setLastError:D,isMobile:b,discoverScreen:S,onDiscoverScreenChange:I,onOpenThreadRequested:j=>{O({key:Ce(j),nonce:Date.now()}),v("threads")},onUnreadCountChange:P})}),u==="threads"?e.jsx(En,{api:t,session:n,setLastError:D,openThreadRequest:C,onThreadRequestConsumed:()=>O(null),isMobile:b}):null,u==="public"?e.jsx(Fn,{api:t,session:n,isMobile:b,setLastError:D}):null,u==="profile"||u==="settings"?g:null,u==="submissions"?e.jsx(zn,{api:t,session:n,setLastError:D}):null,u==="promoted"?e.jsx(Un,{api:t,session:n,setLastError:D}):null]})}export{Bn as Router};
