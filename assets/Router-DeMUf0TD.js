const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./maplibre-gl-CC99_dYH.js","./index-DEci1qS2.js","./index-D_xfmmRC.css"])))=>i.map(i=>d[i]);
import{r as s,j as e,_ as hn,p as Qt,a as qt,b as Xt,u as vt}from"./index-DEci1qS2.js";function Zt(t){return typeof t=="object"&&t!==null}function mn(t){return!(!Zt(t)||typeof t.key!="string"||t.userType!=="guest"&&t.userType!=="registered"&&t.userType!=="subscriber"||typeof t.lat!="number"||!Number.isFinite(t.lat)||typeof t.lng!="number"||!Number.isFinite(t.lng)||typeof t.updatedAtMs!="number"||!Number.isFinite(t.updatedAtMs)||t.status!==void 0&&typeof t.status!="string")}function en(t){const[n,a]=s.useState(()=>new Map),[f,l]=s.useState(null),b=s.useRef(null),w=s.useRef(null);return s.useEffect(()=>{if(t.disabled===!0||t.wsUrl.trim()===""){a(new Map),l(null),w.current!==null&&(window.clearTimeout(w.current),w.current=null);return}let A=!1,R=0,W=null;const H=()=>{W!==null&&(window.clearInterval(W),W=null)},N=()=>{if(A)return;const o=Math.min(8e3,500*2**Math.min(R,4));w.current=window.setTimeout(()=>{w.current=null,T()},o)},T=()=>{if(A)return;let o;try{o=new WebSocket(t.wsUrl)}catch{R+=1,l("Realtime unavailable in this mode."),N();return}b.current=o;let h=!1;o.onopen=()=>{h=!0,R=0,l(null);const M={};t.sessionToken&&(M.sessionToken=t.sessionToken),t.jwt&&(M.jwt=t.jwt),o.send(JSON.stringify({type:"auth",payload:M})),W=window.setInterval(()=>{o.readyState===o.OPEN&&o.send(JSON.stringify({type:"heartbeat",payload:{}}))},15e3)},o.onmessage=M=>{const L=(()=>{try{return JSON.parse(String(M.data))}catch{return null}})();if(!L||typeof L.type!="string"){l("Invalid server message.");return}if(L.type==="error"&&Zt(L.payload)&&typeof L.payload.message=="string"){l(L.payload.message);return}if(L.type==="presence_update"){const F=L.payload;if(!mn(F)){l("Invalid presence payload.");return}a(J=>{const Q=new Map(J);return Q.set(F.key,F),Q})}},o.onerror=()=>{},o.onclose=M=>{if(H(),!A&&M.code!==1e3){R+=1;const L=typeof M.reason=="string"&&M.reason.trim()!==""?` Reason: ${M.reason}`:"";(R>=2||h)&&l(`Realtime ${h?"disconnected":"failed to connect"} (code ${M.code}). Reconnecting...${L}`),N()}}};return T(),()=>{var o;A=!0,H(),w.current!==null&&(window.clearTimeout(w.current),w.current=null),(o=b.current)==null||o.close(1e3,"Client cleanup"),b.current=null}},[t.disabled,t.jwt,t.sessionToken,t.wsUrl]),{state:s.useMemo(()=>({byKey:n}),[n]),lastErrorMessage:f}}async function bn(){const t=await hn(()=>import("./maplibre-gl-CC99_dYH.js").then(a=>a.m),__vite__mapDeps([0,1,2]),import.meta.url);return t.default??t}function vn(t){return t.replace(/[&<>"']/g,n=>{switch(n){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return n}})}function xn(){return{version:8,sources:{basemap:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png","https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"Â© OpenStreetMap contributors"}},layers:[{id:"basemap",type:"raster",source:"basemap"}]}}function jn(t){const n=document.createElement("button");return n.type="button",n.setAttribute("aria-label",t.label??"Presence marker"),n.style.width="40px",n.style.height="40px",n.style.borderRadius="999px",n.style.border=`2px solid ${t.color}`,n.style.touchAction="manipulation",n.style.userSelect="none",t.markerType==="spot"?(n.style.background="radial-gradient(circle at 30% 30%, #ff4f60, #a70013)",n.style.display="grid",n.style.placeItems="center",n.style.color="#ffffff",n.style.fontWeight="700",n.style.fontSize="13px",n.textContent=typeof t.markerGlyph=="string"&&t.markerGlyph.trim()?t.markerGlyph.trim().slice(0,2):"SP"):typeof t.imageUrl=="string"&&t.imageUrl.trim()!==""?(n.style.backgroundImage=`url("${t.imageUrl}")`,n.style.backgroundSize="cover",n.style.backgroundPosition="center"):n.style.background="#000000",n.style.padding="0",n.style.cursor=typeof t.onClick=="function"?"pointer":"default",n.style.pointerEvents="auto",n}function wn({initialView:t,markers:n,interactive:a,visible:f}){const l=s.useRef(null),b=s.useRef(null),w=s.useRef(null),S=s.useRef([]),[A,R]=s.useState({kind:"ready"}),W=s.useMemo(()=>t.center,[t.center]),H=a!==!1,N=f!==!1;return s.useEffect(()=>{let T=!1,o=null,h=null,M=null;async function L(){if(l.current&&!w.current)try{b.current||(b.current=await bn());const F=b.current,J=new F.Map({container:l.current,style:xn(),center:[W.lng,W.lat],zoom:t.zoom,interactive:H});J.addControl(new F.NavigationControl({showCompass:!1}),"top-right"),w.current=J;const Q=()=>{J.resize()};h=Q,M=window.requestAnimationFrame(Q),window.addEventListener("resize",Q),o=new ResizeObserver(()=>Q()),o.observe(l.current),J.on("error",K=>{var k;const v=((k=K.error)==null?void 0:k.message)??"Map error.";T||v.toLowerCase().includes("failed to fetch")||v.toLowerCase().includes("network")||R({kind:"error",message:v})}),J.once("load",()=>{T||R({kind:"ready"})})}catch(F){if(T)return;R({kind:"error",message:F instanceof Error?F.message:"Map error."})}}return L(),()=>{var F;T=!0,M!==null&&window.cancelAnimationFrame(M),h&&window.removeEventListener("resize",h),o==null||o.disconnect();for(const J of S.current)J.remove();S.current=[],(F=w.current)==null||F.remove(),w.current=null}},[H]),s.useEffect(()=>{const T=w.current;if(!T||!N)return;T.resize();const o=window.setTimeout(()=>{T.resize(),T.setCenter([t.center.lng,t.center.lat]),T.setZoom(t.zoom)},80);return()=>window.clearTimeout(o)},[t.center.lat,t.center.lng,t.zoom,N]),s.useEffect(()=>{const T=w.current;if(!T||!N)return;T.resize();const o=window.setTimeout(()=>T.resize(),120);return()=>window.clearTimeout(o)},[N]),s.useEffect(()=>{const T=w.current,o=b.current;if(!(!T||!o)){for(const h of S.current)h.remove();S.current=[];for(const h of n){const M=typeof h.label=="string"&&h.label.trim()!==""?new o.Popup({closeButton:!1,closeOnClick:!0}).setHTML(`<div style="font-family: var(--ui); font-size: 12px; line-height: 1.35;">
                 <div style="font-weight: 600;">${vn(h.label)}</div>
               </div>`):void 0,L=jn(h);if(typeof h.onClick=="function"){const J=Q=>{var K;Q.preventDefault(),Q.stopPropagation(),(K=h.onClick)==null||K.call(h)};L.addEventListener("click",J),L.addEventListener("touchend",J,{passive:!1}),L.addEventListener("pointerup",J)}const F=new o.Marker({element:L}).setLngLat([h.position.lng,h.position.lat]);M&&F.setPopup(M),F.addTo(T),S.current.push(F)}}},[n]),A.kind==="error"?e.jsxs("div",{style:{background:"#000000",color:"#F22F2F",border:"2px solid #C00000",borderRadius:8,padding:12,fontFamily:"var(--ui)",fontSize:14,lineHeight:1.4},role:"alert","aria-live":"polite",children:["Map error: ",A.message]}):e.jsx("div",{ref:l,className:"rd-maplibre",style:{width:"100%",height:"100%",background:"#000000",borderRadius:8,overflow:"hidden"},"aria-label":"Cruise map"})}const Dt=[Qt,qt,Xt];function Sn(t){let n=0;for(let a=0;a<t.length;a+=1)n=n*31+t.charCodeAt(a)|0;return Math.abs(n)}function kn(t){return Dt[Sn(t)%Dt.length]}function In(t,n,a){return t.map(f=>({id:f.key,position:{lat:f.lat,lng:f.lng},color:"#C00000",label:f.status?`Presence: ${f.status}`:"Presence",imageUrl:(n==null?void 0:n[f.key])??kn(f.key),onClick:a?()=>a(f.key):void 0}))}function Bt({wsUrl:t,sessionToken:n,jwt:a,defaultCenter:f,defaultZoom:l,presenceUpdates:b,realtimeErrorMessage:w,onMarkerSelect:S,avatarByKey:A,additionalMarkers:R,height:W,visible:H}){const N=en({wsUrl:t,sessionToken:n,jwt:a,disabled:Array.isArray(b)}),T=b?{byKey:new Map(b.map(K=>[K.key,K]))}:N.state,o=w??N.lastErrorMessage,[h,M]=s.useState({kind:"pending"});s.useEffect(()=>{if(!("geolocation"in navigator)||!navigator.geolocation){M({kind:"unavailable"});return}navigator.geolocation.getCurrentPosition(K=>{M({kind:"granted",center:{lat:K.coords.latitude,lng:K.coords.longitude}})},K=>{if(K.code===K.PERMISSION_DENIED){M({kind:"denied"});return}if(K.code===K.TIMEOUT){M({kind:"error",message:"Timed out while trying to read your location. Showing the default map view."});return}M({kind:"error",message:K.message||"Geolocation error."})},{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e4})},[]);const L=s.useMemo(()=>Array.from(T.byKey.values()),[T.byKey]),F=s.useMemo(()=>[...In(L,A,S),...R??[]],[R,A,S,L]),J=s.useMemo(()=>{const K=typeof l=="number"&&Number.isFinite(l)?l:13;return h.kind==="granted"?{center:h.center,zoom:K}:{center:f,zoom:K}},[f,l,h]),Q=s.useMemo(()=>h.kind==="denied"?"Location permission denied. Showing the default map view.":h.kind==="unavailable"?"Geolocation is unavailable. Showing the default map view.":h.kind==="error"?`Geolocation error: ${h.message}`:null,[h]);return e.jsxs("section",{"aria-label":"Cruise mode map",style:{background:"#000000",color:"#FFFFFF",fontFamily:"var(--ui)",display:"grid",gap:8,height:"100%"},children:[Q?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"rgba(0,0,0,0.7)",border:"1px solid rgba(255,58,77,0.45)",borderRadius:0,padding:8,color:"#AAAAAA",fontSize:12,lineHeight:1.4},children:Q}):null,o?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"rgba(0,0,0,0.7)",border:"1px solid rgba(255,58,77,0.45)",borderRadius:0,padding:8,color:"#F22F2F",fontSize:12,lineHeight:1.4},children:o}):null,e.jsx("div",{style:{background:"#111111",border:0,borderRadius:0,overflow:"hidden",height:typeof W=="number"||typeof W=="string"?W:520},children:e.jsx(wn,{initialView:J,markers:F,visible:H})})]})}const Cn="FIRE_SIGNAL|1";function Tn(t){return new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function $t(t){if(!t.startsWith("LOCATION|"))return null;const[,n,a]=t.split("|"),f=Number(n),l=Number(a);return!Number.isFinite(f)||!Number.isFinite(l)?null:{lat:f,lng:l,link:`https://maps.google.com/?q=${f},${l}`}}function Mn(t){return t.trim()===Cn?"ðŸ”¥ I'm into you":t}function tn({chatKind:t,peerKey:n,currentUserKey:a,messages:f,client:l,title:b,peerSummary:w,thirdParty:S,edgeToEdge:A,showHeader:R,fillHeight:W}){const[H,N]=s.useState(""),[T,o]=s.useState(null),[h,M]=s.useState(!1),[L,F]=s.useState({}),[J,Q]=s.useState(!1),[K,v]=s.useState(!1),k=s.useRef(null),te=s.useRef([]),ne=s.useRef(null),ae=s.useRef(null),he=s.useRef(null),g=A===!0,p=R!==!1,P=g&&W===!0,ie=s.useMemo(()=>[...f].sort((c,_)=>c.createdAtMs-_.createdAtMs),[f]),z=s.useMemo(()=>Array.from(new Set(ie.map(c=>{var _;return(_=c.media)==null?void 0:_.objectKey}).filter(c=>typeof c=="string"&&c.trim().length>0))),[ie]);s.useEffect(()=>{let c=!1;async function _(){for(const r of z){if(c)return;if(!L[r])try{const m=await l.getMediaUrl(r);if(c)return;F(U=>({...U,[r]:m}))}catch{}}}return _(),()=>{c=!0}},[l,z,L]);async function se(c){const _=H.trim();if(!(_.length===0&&!c)){M(!0),o(null);try{await l.sendMessage(t,n,_,c),N("")}catch(r){const m=r;o(typeof(m==null?void 0:m.message)=="string"?m.message:"Message rejected.")}finally{M(!1)}}}async function I(c){M(!0),o(null);try{const _=await l.initiateMediaUpload(c.type||"application/octet-stream",c.size);await l.uploadToSignedUrl(_.uploadUrl,c,c.type||"application/octet-stream");const m={kind:c.type.startsWith("image/")?"image":c.type.startsWith("video/")?"video":"audio",objectKey:_.objectKey,mimeType:c.type||"application/octet-stream"};await se(m)}catch(_){const r=_;o(typeof(r==null?void 0:r.message)=="string"?r.message:"Upload rejected."),M(!1)}}async function pe(c){var r;const _=(r=c.target.files)==null?void 0:r[0];if(c.target.value="",!!_){if(!_.type.startsWith("image/")&&!_.type.startsWith("video/")&&!_.type.startsWith("audio/")){o("Only image, video, or audio files are supported.");return}await I(_)}}async function ce(){var c;if(J){(c=k.current)==null||c.stop();return}if(!navigator.mediaDevices||typeof navigator.mediaDevices.getUserMedia!="function"){o("Microphone is not available in this browser.");return}try{const _=await navigator.mediaDevices.getUserMedia({audio:!0}),r=new MediaRecorder(_);te.current=[],k.current=r,r.ondataavailable=m=>{m.data.size>0&&te.current.push(m.data)},r.onstop=()=>{const m=new Blob(te.current,{type:r.mimeType||"audio/webm"}),U=new File([m],`voice-${Date.now()}.webm`,{type:r.mimeType||"audio/webm"});I(U);for(const re of _.getTracks())re.stop();k.current=null,Q(!1)},r.start(),Q(!0)}catch(_){const r=_;o(typeof(r==null?void 0:r.message)=="string"?r.message:"Unable to record voice."),Q(!1)}}async function be(){if(!navigator.geolocation){o("Geolocation is not available in this browser.");return}M(!0),o(null);try{const c=await new Promise((U,re)=>{navigator.geolocation.getCurrentPosition(U,re,{enableHighAccuracy:!1,timeout:12e3,maximumAge:3e4})}),_=Number(c.coords.latitude.toFixed(5)),r=Number(c.coords.longitude.toFixed(5)),m=`LOCATION|${_}|${r}`;await l.sendMessage(t,n,m)}catch(c){const _=c;o(typeof(_==null?void 0:_.message)=="string"?_.message:"Unable to send location.")}finally{M(!1)}}return e.jsxs("section",{"aria-label":"Chat",style:{background:g?"transparent":"#000000",color:"#FFFFFF",fontFamily:"Montserrat, sans-serif",padding:g?0:16,display:"grid",gap:g?0:12,gridTemplateRows:p?"auto auto 1fr auto":"1fr auto",minHeight:W?"calc(100dvh - 196px)":void 0},children:[p?e.jsxs("header",{style:{height:56,display:"grid",alignItems:"center",background:"#000000"},children:[e.jsx("div",{style:{textAlign:"center",fontSize:20,fontWeight:600},children:b}),w?e.jsxs("div",{style:{marginTop:4,display:"flex",alignItems:"center",justifyContent:"center",gap:8,color:"#b7d8e0",fontSize:13},children:[e.jsx("span",{children:"Chat with:"}),w.avatarUrl?e.jsx("img",{src:w.avatarUrl,alt:`${w.displayName} avatar`,style:{width:24,height:24,borderRadius:"50%",objectFit:"cover",border:"1px solid rgba(38,213,255,0.8)"}}):e.jsx("span",{"aria-hidden":!0,style:{width:24,height:24,borderRadius:"50%",border:"1px solid rgba(38,213,255,0.8)",background:"rgba(255,255,255,0.08)"}}),e.jsx("span",{style:{color:"#fff",fontWeight:600},children:w.displayName})]}):null,e.jsx("div",{style:{textAlign:"center",fontSize:12,color:"#AAAAAA"},children:t==="cruise"?"CRUISE CHAT (EPHEMERAL)":"DATE CHAT (PERSISTENT)"})]}):null,T?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"#111111",border:"2px solid #C00000",borderRadius:8,padding:12,color:"#F22F2F",fontSize:14,lineHeight:1.4},children:T}):null,e.jsx("div",{"aria-label":"Messages",style:{background:g?"#09090b":"#111111",border:g?"none":"2px solid #C00000",borderRadius:g?0:8,padding:12,display:"flex",flexDirection:"column",gap:12,minHeight:g?0:320,paddingBottom:P?148:12,overflowY:"auto"},children:ie.length===0?e.jsx("div",{style:{color:"#AAAAAA",fontSize:14,lineHeight:1.4},children:"No messages."}):ie.map(c=>{const _=c.fromKey===a,r=_?"#C00000":"#444444",m=_?{alignItems:"flex-end"}:{alignItems:"flex-start"};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,width:"100%",...m},children:[(()=>{const U=$t(c.text??"");return U?e.jsxs("a",{href:U.link,target:"_blank",rel:"noreferrer",style:{display:"grid",gap:6,textDecoration:"none",color:"#fff",background:r,borderRadius:14,padding:8,width:"auto",maxWidth:"80%"},children:[e.jsx("div",{style:{fontSize:12,color:"#d8ecff"},children:"Shared location"}),e.jsx("iframe",{title:"Google Maps location preview",src:`https://www.google.com/maps?q=${U.lat},${U.lng}&z=14&output=embed`,style:{width:"100%",height:140,border:"1px solid rgba(255,255,255,0.18)",borderRadius:10},loading:"lazy",referrerPolicy:"no-referrer-when-downgrade"}),e.jsx("div",{style:{fontSize:12,color:"#3fdfff"},children:"Open in Google Maps"})]}):null})(),e.jsxs("div",{style:{background:r,color:"#FFFFFF",borderRadius:18,padding:"8px 12px",width:"auto",maxWidth:"80%",fontSize:16,lineHeight:1.4,whiteSpace:"pre-wrap",overflowWrap:"anywhere",wordBreak:"break-word"},children:[c.text&&!$t(c.text)?e.jsx("div",{style:{marginBottom:c.media?8:0},children:Mn(c.text)}):null,c.media?e.jsxs("div",{children:[c.media.kind==="image"?e.jsx("img",{src:L[c.media.objectKey],alt:"Shared",style:{width:"100%",maxWidth:260,borderRadius:10,border:"1px solid rgba(255,255,255,0.18)"}}):null,c.media.kind==="video"?e.jsx("video",{controls:!0,playsInline:!0,src:L[c.media.objectKey],style:{width:"100%",maxWidth:320,borderRadius:10,background:"#000"}}):null,c.media.kind==="audio"?e.jsx("audio",{controls:!0,src:L[c.media.objectKey],style:{width:"100%",maxWidth:260}}):null]}):null]}),e.jsx("div",{style:{fontSize:10,color:"#AAAAAA"},children:Tn(c.createdAtMs)}),_?e.jsx("div",{style:{fontSize:10,color:"#6fdcff"},children:typeof c.readAtMs=="number"?"Read":typeof c.deliveredAtMs=="number"?"Delivered":""}):null]},c.messageId)})}),e.jsxs("form",{onSubmit:c=>{c.preventDefault(),se()},"aria-label":"Message input",style:{background:g?"linear-gradient(180deg, rgba(96,0,12,0.96), rgba(58,0,8,0.98))":"#111111",border:g?"none":"2px solid #C00000",borderRadius:g?0:8,padding:12,display:"grid",gridTemplateColumns:"1fr auto auto",gap:12,alignItems:"start",position:P?"fixed":"static",left:P?0:void 0,right:P?0:void 0,bottom:P?"calc(env(safe-area-inset-bottom, 0px) + 66px)":void 0,zIndex:P?45:void 0},children:[e.jsx("label",{style:{display:"grid"},children:e.jsx("input",{value:H,onChange:c=>N(c.target.value),placeholder:"Type a message",disabled:h,style:{width:"100%",background:"#111111",color:"#FFFFFF",border:"2px solid #444444",borderRadius:8,padding:"10px 12px",fontSize:16,lineHeight:1.4,outline:"none"},"aria-label":"Message text"})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{ref:ne,type:"file",accept:"image/*,video/*,audio/*",disabled:h,onChange:c=>void pe(c),style:{display:"none"}}),e.jsx("input",{ref:ae,type:"file",accept:"image/*",capture:"environment",disabled:h,onChange:c=>void pe(c),style:{display:"none"}}),e.jsx("input",{ref:he,type:"file",accept:"video/*",capture:"environment",disabled:h,onChange:c=>void pe(c),style:{display:"none"}}),e.jsx("button",{type:"button",disabled:h,onClick:()=>v(c=>!c),style:{background:"rgba(0,0,0,0.45)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px",display:"grid",placeItems:"center",cursor:h?"not-allowed":"pointer",color:"#3fdfff",fontWeight:700,height:44,minWidth:44},"aria-label":"More actions",children:"+"}),K?e.jsxs("div",{style:{position:"absolute",right:0,top:P?void 0:48,bottom:P?48:void 0,zIndex:5,minWidth:220,display:"grid",gap:8,padding:10,borderRadius:10,border:"1px solid rgba(255,58,77,0.5)",background:"rgba(10,11,16,0.98)"},children:[e.jsx("button",{type:"button",disabled:h,onClick:()=>{var c;v(!1),(c=ae.current)==null||c.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Take Photo"}),e.jsx("button",{type:"button",disabled:h,onClick:()=>{var c;v(!1),(c=he.current)==null||c.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Record Video"}),e.jsx("button",{type:"button",disabled:h,onClick:()=>{var c;v(!1),(c=ne.current)==null||c.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Choose Media"}),e.jsx("button",{type:"button",disabled:h,onClick:()=>{v(!1),ce()},style:{background:J?"#ff2136":"rgba(0,0,0,0.6)",color:"#fff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:J?"Stop Voice":"Record Voice"}),e.jsx("button",{type:"button",disabled:h,onClick:()=>{v(!1),be()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Send Location"}),S?e.jsxs("div",{style:{display:"grid",gap:8,borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:8},children:[e.jsxs("select",{value:S.selectedKey,onChange:c=>S.onSelect(c.target.value),disabled:S.disabled||S.candidates.length===0,style:{background:"#0b0d12",color:"#fff",border:"1px solid rgba(255,58,77,0.62)",borderRadius:10,padding:"8px 10px"},"aria-label":"Add previous contact to group",children:[S.candidates.length===0?e.jsx("option",{value:"",children:"No previous contacts"}):null,S.candidates.map(c=>e.jsx("option",{value:c.key,children:c.label},c.key))]}),e.jsx("button",{type:"button",onClick:()=>{S.onAdd(),v(!1)},disabled:S.disabled||S.candidates.length===0||!S.selectedKey,style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,58,77,0.62)",borderRadius:10,padding:"8px 10px",fontWeight:700},children:"Add Third User"})]}):null]}):null]}),e.jsx("button",{type:"submit",disabled:h,style:{background:h?"#333333":"#C00000",color:h?"#777777":"#FFFFFF",border:"2px solid #C00000",borderRadius:8,padding:"10px 20px",fontSize:16,fontWeight:600,cursor:h?"not-allowed":"pointer",height:44},"aria-label":"Send message",children:"SEND"})]})]})}const xt="FIRE_SIGNAL|1";function Ee(){return{background:"radial-gradient(500px 220px at 10% 0%, rgba(255,28,46,0.15), transparent 58%), linear-gradient(180deg, rgba(8,8,10,0.88), rgba(4,4,5,0.9))",border:"1px solid rgba(255,56,74,0.56)",borderRadius:20,padding:14,boxShadow:"inset 0 1px 0 rgba(255,255,255,0.06), inset 0 0 0 1px rgba(0,0,0,0.28), 0 16px 32px rgba(0,0,0,0.42)"}}function me(t){return{background:t?"rgba(90,90,90,0.55)":"linear-gradient(180deg, #ff2136, #c60012)",border:"1px solid rgba(255,70,90,0.68)",color:t?"#999999":"#FFFFFF",padding:"10px 18px",borderRadius:12,fontSize:15,fontWeight:700,letterSpacing:"0.04em",cursor:t?"not-allowed":"pointer",textTransform:"uppercase",boxShadow:t?"none":"inset 0 1px 0 rgba(255,255,255,0.2), 0 10px 22px rgba(198,0,18,0.34)"}}function D(t){return{background:"rgba(0,0,0,0.58)",border:"1px solid rgba(255,58,77,0.62)",color:"#3fdfff",padding:"10px 18px",borderRadius:12,fontSize:15,fontWeight:700,letterSpacing:"0.03em",cursor:t?"not-allowed":"pointer",textTransform:"uppercase",opacity:t?.6:1}}function Z(){return{background:"rgba(6,7,10,0.92)",color:"#ffffff",border:"1px solid rgba(255,64,82,0.48)",borderRadius:12,padding:"10px 12px",fontSize:15}}function An(t){return typeof t=="string"}function Y(t){const n=t;return An(n==null?void 0:n.message)?n.message:"Action rejected."}function gt(){const t="__disabled__".trim();if(t==="__disabled__")return"";if(t!==""){if(t.startsWith("ws://")||t.startsWith("wss://"))return t;try{const a=new URL(t);return a.protocol=a.protocol==="https:"?"wss:":"ws:",a.toString()}catch{if(t.startsWith("/")){const a=new URL(t,window.location.origin);return a.protocol=a.protocol==="https:"?"wss:":"ws:",a.toString()}}}const n=new URL("/ws",window.location.origin);return n.protocol=n.protocol==="https:"?"wss:":"ws:",n.toString()}const Ht=[Qt,qt,Xt];function Rn(t){let n=0;for(let a=0;a<t.length;a+=1)n=n*31+t.charCodeAt(a)|0;return Math.abs(n)}function Be(t){return Ht[Rn(t)%Ht.length]}function bt(t){if(t.startsWith("user:")){const n=t.slice(5).trim();return n.length>0?n:null}if(t.startsWith("session:")){const n=t.slice(8).trim();return n.length>0?`guest:${n}`:null}return null}function Oe(t){if(t.startsWith("guest:")){const n=t.slice(6).trim();return n?`session:${n}`:`user:${t}`}return`user:${t}`}function Ce(t){const n=t.trim();if(!n)return n;if(n.startsWith("user:guest:")){const a=n.slice(11).trim();return a?`session:${a}`:n}if(n.startsWith("guest:")){const a=n.slice(6).trim();return a?`session:${a}`:n}return n}function Nn(t){return t.trim()===xt}function nn(t){return Nn(t)?"ðŸ”¥ I'm into you":t}function pt(t,n){const a=W=>W*Math.PI/180,l=a(n.lat-t.lat),b=a(n.lng-t.lng),w=Math.sin(l/2),S=Math.sin(b/2),A=w*w+Math.cos(a(t.lat))*Math.cos(a(n.lat))*S*S;return 6371e3*(2*Math.atan2(Math.sqrt(A),Math.sqrt(1-A)))}function Pn(t){return!Number.isFinite(t)||t<0?"-":t<1e3?`${Math.round(t)} m`:t<1e4?`${(t/1e3).toFixed(1)} km`:`${Math.round(t/1e3)} km`}function Gt(){try{const t=localStorage.getItem("reddoor_travel_center");if(!t)return null;const n=JSON.parse(t);return n.enabled!==!0?null:typeof n.lat=="number"&&Number.isFinite(n.lat)&&typeof n.lng=="number"&&Number.isFinite(n.lng)?{lat:n.lat,lng:n.lng}:null}catch{return null}}function En(){const[t,n]=s.useState(()=>window.matchMedia("(max-width: 900px)").matches);return s.useEffect(()=>{const a=window.matchMedia("(max-width: 900px)"),f=()=>n(a.matches);return f(),a.addEventListener("change",f),()=>a.removeEventListener("change",f)},[]),t}function nt(t){return t==="instant"?"cruise":"date"}function Fn({api:t,session:n,settings:a,discoverFilter:f,busy:l,setBusy:b,setLastError:w,isMobile:S,discoverScreen:A,onDiscoverScreenChange:R,onOpenThreadRequested:W,onUnreadCountChange:H}){var it,_e,He,Ze,Je,et;const[N,T]=s.useState(A),[o,h]=s.useState(null),[M,L]=s.useState(null),[F,J]=s.useState(null),[Q,K]=s.useState([]),[v,k]=s.useState({}),[te,ne]=s.useState([]),[ae,he]=s.useState(new Set),[g,p]=s.useState(new Set),[P,ie]=s.useState({}),[z,se]=s.useState({}),[I,pe]=s.useState(null),[ce,be]=s.useState(0),[c,_]=s.useState(!1),[r,m]=s.useState([]),[U,re]=s.useState(null),[fe,we]=s.useState(()=>Gt()),{state:ke,lastErrorMessage:ge}=en({wsUrl:gt(),sessionToken:n.sessionToken}),xe=s.useMemo(()=>Array.from(ke.byKey.values()),[ke.byKey]);s.useEffect(()=>{T(A)},[A]),s.useEffect(()=>{const u=()=>{we(Gt())},y=j=>{(j.key===null||j.key==="reddoor_travel_center")&&u()};return u(),window.addEventListener("rd:location-updated",u),window.addEventListener("storage",y),()=>{window.removeEventListener("rd:location-updated",u),window.removeEventListener("storage",y)}},[]);const G=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,ve=s.useMemo(()=>{const u=new Map;for(const y of Q)u.set(y.key,y);for(const y of xe){const j=u.get(y.key);(!j||y.updatedAtMs>=j.updatedAtMs)&&u.set(y.key,y)}return Array.from(u.values())},[xe,Q]),Ne=s.useMemo(()=>ve.filter(u=>u.key!==G),[G,ve]),Se=s.useMemo(()=>F?[...Ne].sort((u,y)=>pt(F,{lat:u.lat,lng:u.lng})-pt(F,{lat:y.lat,lng:y.lng})):Ne,[Ne,F]),We=s.useMemo(()=>{if(!M)return null;if(M===G)return"0 m";if(!F)return null;const u=ve.find(y=>y.key===M);return u?Pn(pt(F,{lat:u.lat,lng:u.lng})):null},[G,ve,M,F]);s.useEffect(()=>{let u=!1;async function y(){try{const B=await t.listActivePresence(n.sessionToken);if(u)return;const X=Array.isArray(B.presence)?B.presence:[];K(X)}catch{u||K([])}}y();const j=window.setInterval(()=>{y()},8e3);return()=>{u=!0,window.clearInterval(j)}},[t,n.sessionToken]),s.useEffect(()=>{o||Se.length>0&&h(Se[0].key)},[o,Se]),s.useEffect(()=>{const u=Se.filter(y=>!v[y.key]).map(y=>({key:y.key,profileId:bt(y.key)})).filter(y=>typeof y.profileId=="string");u.length!==0&&Promise.all(u.map(async y=>{var j,B;try{const X=await t.getPublicProfile(y.profileId);return{key:y.key,displayName:(j=X.profile)==null?void 0:j.displayName,age:(B=X.profile)==null?void 0:B.age}}catch{return null}})).then(y=>{k(j=>{const B={...j};for(const X of y)X&&(B[X.key]={displayName:X.displayName,age:X.age});return B})})},[t,v,Se]),s.useEffect(()=>{(async()=>{try{let u=await t.getPublicProfiles();if(u.profiles.length===0&&!c){_(!0);try{const y=F??fe??{lat:a.defaultCenterLat,lng:a.defaultCenterLng};await t.seedFakeUsers(12,y.lat,y.lng),u=await t.getPublicProfiles()}catch{}}ne(u.profiles)}catch{ne([])}if(n.userType==="guest"){he(new Set),p(new Set);return}try{const u=await t.getFavorites(n.sessionToken);he(new Set(u.favorites))}catch{he(new Set)}try{const u=await t.listBlocked(n.sessionToken);p(new Set(u.blocked))}catch{p(new Set)}})()},[t,c,F,n.sessionToken,n.userType,a.defaultCenterLat,a.defaultCenterLng,fe]),s.useEffect(()=>{let u=!1;async function y(){try{const B=await t.listCruisingSpots();u||m(B.spots)}catch{u||m([])}}y();const j=window.setInterval(()=>{y()},12e3);return()=>{u=!0,window.clearInterval(j)}},[t]),s.useEffect(()=>{const u=Date.now(),y=te.flatMap(j=>{const B=[];return j.mainPhotoMediaId&&B.push(j.mainPhotoMediaId),Array.isArray(j.galleryMediaIds)&&B.push(...j.galleryMediaIds),j.videoMediaId&&B.push(j.videoMediaId),B}).filter(j=>typeof j=="string"&&j.length>0&&!P[j]&&u>=(z[j]??0)).slice(0,6);y.length!==0&&Promise.all(y.map(async j=>{try{const B=await t.getPublicMediaUrl(j);return{mediaId:j,url:B.downloadUrl}}catch{return null}})).then(j=>{ie(B=>{const X={...B};for(const oe of j)oe&&(X[oe.mediaId]=oe.url);return X}),se(B=>{const X={...B};for(let oe=0;oe<y.length;oe+=1){const ye=y[oe];j[oe]?X[ye]&&delete X[ye]:X[ye]=Date.now()+3e4}return X})})},[t,z,P,te]);async function Fe(u){L(u),be(0);const y=bt(u);if(!y){pe(null);return}try{if(u===G){const j=await t.getMyProfile(n.sessionToken);typeof j.profile.mainPhotoMediaId=="string"&&j.profile.mainPhotoMediaId;const B=[j.profile.mainPhotoMediaId,...j.profile.galleryMediaIds??[],j.profile.videoMediaId].filter(X=>typeof X=="string"&&X.length>0);if(B.length>0){const X=await Promise.all(B.map(async oe=>{try{const ye=await t.getPublicMediaUrl(oe);return{mediaId:oe,downloadUrl:ye.downloadUrl}}catch{return null}}));ie(oe=>{const ye={...oe};for(const Ae of X)Ae&&(ye[Ae.mediaId]=Ae.downloadUrl);return ye})}pe({userId:j.profile.userId,displayName:j.profile.displayName,age:j.profile.age,bio:j.profile.bio,stats:j.profile.stats,discreetMode:j.profile.discreetMode,mainPhotoMediaId:j.profile.mainPhotoMediaId,galleryMediaIds:j.profile.galleryMediaIds,videoMediaId:j.profile.videoMediaId})}else{const j=await t.getPublicProfile(y),B=[j.profile.mainPhotoMediaId,...j.profile.galleryMediaIds??[],j.profile.videoMediaId].filter(X=>typeof X=="string"&&X.length>0);if(B.length>0){const X=await Promise.all(B.map(async oe=>{try{const ye=await t.getPublicMediaUrl(oe);return{mediaId:oe,downloadUrl:ye.downloadUrl}}catch{return null}}));ie(oe=>{const ye={...oe};for(const Ae of X)Ae&&(ye[Ae.mediaId]=Ae.downloadUrl);return ye})}pe(j.profile)}}catch(j){const B=j;if((B==null?void 0:B.code)==="PROFILE_HIDDEN"){L(null),pe(null);return}pe(null),w(Y(j))}}async function ee(u){if(n.userType==="guest"){w("Guests cannot star users. Register to save favorites.");return}if(!(!n.userId||n.userId===u))try{const y=await t.toggleFavorite(n.sessionToken,u);he(new Set(y.favorites))}catch(y){w(Y(y))}}async function Te(u){const y=Ce(u);if(!(!y||y===G))try{await t.sendChat(n.sessionToken,"cruise",y,xt)}catch(j){w(Y(j))}}async function Pe(u){if(!(!u.trim()||u===G)){if(n.userType==="guest"){w("Anonymous users cannot block users.");return}try{g.has(u)?await t.unblock(n.sessionToken,u):await t.block(n.sessionToken,u);const y=await t.listBlocked(n.sessionToken);p(new Set(y.blocked))}catch(y){w(Y(y))}}}async function Ie(){const u=fe??{lat:a.defaultCenterLat,lng:a.defaultCenterLng};if(!navigator.geolocation){J(u);try{await t.updatePresence(n.sessionToken,u.lat,u.lng,"online")}catch{}return}try{const y=await new Promise((j,B)=>{navigator.geolocation.getCurrentPosition(j,B,{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e4})});J({lat:y.coords.latitude,lng:y.coords.longitude}),await t.updatePresence(n.sessionToken,y.coords.latitude,y.coords.longitude,"online")}catch(y){J(u);try{await t.updatePresence(n.sessionToken,u.lat,u.lng,"online")}catch{const j=y&&typeof y=="object"&&"message"in y&&typeof y.message=="string"?y.message:null;w(j??Y(y))}}}s.useEffect(()=>{Ie();const u=window.setInterval(()=>{Ie()},3e4);return()=>window.clearInterval(u)},[n.sessionToken]),s.useEffect(()=>{const u=y=>{var oe,ye;const j=y,B=(oe=j.detail)==null?void 0:oe.lat,X=(ye=j.detail)==null?void 0:ye.lng;!Number.isFinite(B)||!Number.isFinite(X)||(J({lat:B,lng:X}),t.updatePresence(n.sessionToken,B,X,"online").catch(()=>{}))};return window.addEventListener("rd:location-updated",u),()=>window.removeEventListener("rd:location-updated",u)},[t,n.sessionToken]);const je=s.useMemo(()=>{if(ve.some(B=>B.key===G))return ve;const y=F??fe??{lat:a.defaultCenterLat,lng:a.defaultCenterLng};return[{key:G,userType:n.userType,lat:y.lat,lng:y.lng,status:"online",updatedAtMs:Date.now()},...ve]},[G,ve,F,n.userType,a.defaultCenterLat,a.defaultCenterLng,fe]),Le=s.useMemo(()=>{const u={};for(const y of te){if(!y.mainPhotoMediaId)continue;const j=P[y.mainPhotoMediaId];j&&(u[Oe(y.userId)]=j)}return u},[P,te]),$e=s.useMemo(()=>r.map(u=>({id:`spot:${u.spotId}`,position:{lat:u.lat,lng:u.lng},color:"#26d5ff",markerType:"spot",markerGlyph:"CS",label:`${u.name} | check-ins: ${u.checkInCount??0} | action: ${u.actionCount??0}`,onClick:()=>re(u.spotId)})),[r]),Ke=u=>{T(u),R(u)},st=e.jsx(Bt,{wsUrl:gt(),sessionToken:n.sessionToken,presenceUpdates:je,realtimeErrorMessage:ge,onMarkerSelect:u=>void Fe(u),avatarByKey:Le,additionalMarkers:$e,defaultCenter:fe??{lat:a.defaultCenterLat,lng:a.defaultCenterLng},height:S?"calc(100vh - 340px)":"calc(100dvh - 62px)",visible:!0}),Xe=e.jsxs("div",{style:{background:"#000",marginInline:-10},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,padding:"8px 10px",borderBottom:"1px solid rgba(255,58,77,0.25)"},children:[e.jsx("button",{type:"button",style:D(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"reset"}}))},children:"GUYS"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"toggle_favorites"}}))},"aria-label":"Toggle favorites only",children:"â˜…"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"open_filters"}})),Ke("chat")},children:"FILTER"})]}),e.jsx(Bt,{wsUrl:gt(),sessionToken:n.sessionToken,presenceUpdates:je,realtimeErrorMessage:ge,onMarkerSelect:u=>void Fe(u),avatarByKey:Le,additionalMarkers:$e,defaultCenter:fe??{lat:a.defaultCenterLat,lng:a.defaultCenterLng},height:"calc(100dvh - 220px)",visible:N==="map"})]}),Ye=e.jsx(Un,{api:t,session:n,busy:l,setBusy:b,setLastError:w,onlinePeers:Se,selectedPeerKey:o,setSelectedPeerKey:h,onOpenProfile:u=>void Fe(u),isMobile:S,selfCoords:F,peerProfileByKey:v,discoverFilter:f,publicProfiles:te,favorites:ae,mediaUrlById:P,onUnreadCountChange:H});return e.jsxs("div",{style:!S&&N==="map"?{height:"100%"}:{display:"grid",gap:8},children:[S?e.jsx(e.Fragment,{children:N==="map"?Xe:Ye}):e.jsx("div",{style:N==="map"?{display:"grid",height:"100%",alignItems:"stretch"}:{display:"grid",gap:12,alignItems:"start"},children:N==="map"?st:Ye}),M?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:80,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:S?"stretch":"center",padding:S?0:14},role:"dialog","aria-modal":"true","aria-label":"User profile",onClick:()=>L(null),children:e.jsx("div",{onClick:u=>u.stopPropagation(),style:S?{width:"100%",height:"100dvh",overflow:"auto",background:"linear-gradient(180deg, rgba(7,8,10,0.98), rgba(2,2,4,0.98))",borderRadius:0,border:"none",padding:"calc(env(safe-area-inset-top, 0px) + 56px) 12px calc(env(safe-area-inset-bottom, 0px) + 20px)"}:{...Ee(),width:"min(680px, 100%)",maxHeight:"86vh",overflow:"auto"},children:e.jsxs("div",{style:{display:"grid",gap:14},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"106px 1fr auto",gap:12,alignItems:"center"},children:[e.jsxs("div",{style:{position:"relative",width:106,height:106},children:[e.jsx("img",{src:I!=null&&I.mainPhotoMediaId&&P[I.mainPhotoMediaId]?P[I.mainPhotoMediaId]:Be(M),alt:"Profile avatar",style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"cover",border:"2px solid #ff3047"}}),e.jsx("span",{style:{position:"absolute",right:4,bottom:4,width:14,height:14,borderRadius:"50%",background:"#26d5ff",border:"2px solid #000"}})]}),e.jsxs("div",{style:{display:"grid",gap:6},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:(I==null?void 0:I.displayName)??M}),e.jsx("div",{style:{color:"#26d5ff",fontSize:14},children:"Instant Messaging Available"})]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[I&&I.userId!==(n.userId??"")?e.jsx("button",{type:"button",style:{...D(!1),color:"#26d5ff",borderColor:"rgba(38,213,255,0.62)",minWidth:126},onClick:()=>void ee(I.userId),children:ae.has(I.userId)?"â˜… STARRED":"â˜† STAR"}):null,I&&I.userId!==(n.userId??"")?e.jsx("button",{type:"button",style:{...D(!1),color:"#ffb347",borderColor:"rgba(255,179,71,0.65)",minWidth:126},onClick:()=>void Te(Oe(I.userId)),children:"ðŸ”¥ FIRE"}):null,I&&I.userId!==(n.userId??"")?e.jsx("button",{type:"button",style:{...D(!1),color:g.has(Oe(I.userId))?"#ff9aa3":"#ffd4d8",borderColor:"rgba(255,120,130,0.62)",minWidth:126},onClick:()=>void Pe(Oe(I.userId)),children:g.has(Oe(I.userId))?"UNBLOCK":"BLOCK"}):null,e.jsx("button",{type:"button",style:D(!1),onClick:()=>L(null),children:"CLOSE"})]})]}),e.jsxs("div",{style:{color:"#ced3dc",fontSize:14,lineHeight:1.5},children:[e.jsxs("div",{children:["Age: ",(I==null?void 0:I.age)??"-"]}),e.jsxs("div",{children:["Distance: ",We??"-"]}),e.jsxs("div",{children:["Race: ",((it=I==null?void 0:I.stats)==null?void 0:it.race)??"-"]}),e.jsxs("div",{children:["Height: ",((_e=I==null?void 0:I.stats)==null?void 0:_e.heightInches)??"-"]}),e.jsxs("div",{children:["Weight: ",((He=I==null?void 0:I.stats)==null?void 0:He.weightLbs)??"-"]}),e.jsxs("div",{children:["Cock Size: ",((Ze=I==null?void 0:I.stats)==null?void 0:Ze.cockSizeInches)??"-"]}),e.jsxs("div",{children:["Cut / Uncut: ",((Je=I==null?void 0:I.stats)==null?void 0:Je.cutStatus)??"-"]}),e.jsxs("div",{children:["Position: ",((et=I==null?void 0:I.stats)==null?void 0:et.position)??"-"]}),e.jsxs("div",{style:{marginTop:8},children:["Bio: ",(I==null?void 0:I.bio)??"-"]})]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"MEDIA"}),I?e.jsx(e.Fragment,{children:(()=>{const u=[I.mainPhotoMediaId,...I.galleryMediaIds??[],I.videoMediaId].filter(oe=>typeof oe=="string"&&oe.length>0);if(u.length===0)return e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No uploaded media."});const y=Math.max(0,Math.min(ce,u.length-1)),j=u[y],B=P[j],X=j===I.videoMediaId;return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.4)",borderRadius:12,padding:8},children:X?e.jsx("video",{controls:!0,playsInline:!0,src:B,style:{width:"100%",maxHeight:260,borderRadius:10,background:"#000"}}):e.jsx("img",{src:B??Be(M??I.userId),alt:"Profile media",style:{width:"100%",maxHeight:260,objectFit:"cover",borderRadius:10}})}),e.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:u.map((oe,ye)=>{const Ae=P[oe],Ge=oe===I.videoMediaId;return e.jsx("button",{type:"button",onClick:()=>be(ye),style:{width:64,height:64,padding:0,borderRadius:8,overflow:"hidden",border:ye===y?"2px solid #26d5ff":"1px solid rgba(255,58,77,0.4)",background:"#000",cursor:"pointer",color:"#fff",fontSize:10},"aria-label":Ge?"Open video":"Open photo",children:Ge?e.jsx("div",{style:{display:"grid",placeItems:"center",width:"100%",height:"100%"},children:Ae?e.jsx("video",{src:Ae,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}):"VIDEO"}):e.jsx("img",{src:Ae??Be(M??I.userId),alt:"Media thumbnail",style:{width:"100%",height:"100%",objectFit:"cover"}})},oe)})})]})})()}):null]}),e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:e.jsx("button",{type:"button",style:me(!1),onClick:()=>{M&&W(M),L(null),be(0)},children:"CHAT"})})]})})}):null,U?e.jsx(zn,{api:t,session:n,spot:r.find(u=>u.spotId===U)??null,onClose:()=>re(null),onUpdated:async()=>{try{const u=await t.listCruisingSpots();m(u.spots)}catch{}},setLastError:w}):null]})}function zn({api:t,session:n,spot:a,onClose:f,onUpdated:l,setLastError:b}){return a?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},role:"dialog","aria-modal":"true","aria-label":"Cruising spot",onClick:f,children:e.jsxs("div",{onClick:w=>w.stopPropagation(),style:{...Ee(),width:"min(520px, 100%)",display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:a.name}),e.jsx("div",{style:{color:"#9fb6bf",fontSize:13},children:a.address}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap"},children:a.description}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:13},children:["Check-ins: ",a.checkInCount??0," | I got action there: ",a.actionCount??0]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:me(!1),onClick:async()=>{try{await t.checkInCruisingSpot(n.sessionToken,a.spotId),await l()}catch(w){b(Y(w))}},children:"CHECK IN"}),e.jsx("button",{type:"button",style:D(!1),onClick:async()=>{try{await t.markCruisingSpotAction(n.sessionToken,a.spotId),await l()}catch(w){b(Y(w))}},children:"I GOT ACTION THERE"}),e.jsx("button",{type:"button",style:D(!1),onClick:f,children:"CLOSE"})]})]})}):null}function Un({api:t,session:n,busy:a,setBusy:f,setLastError:l,onlinePeers:b,selectedPeerKey:w,setSelectedPeerKey:S,onOpenProfile:A,openThreadRequest:R,onThreadRequestConsumed:W,isMobile:H,selfCoords:N,peerProfileByKey:T,discoverFilter:o,publicProfiles:h,favorites:M,mediaUrlById:L,onUnreadCountChange:F}){var Ut;const[J,Q]=s.useState({}),[K,v]=s.useState({}),[k,te]=s.useState("instant"),[ne,ae]=s.useState("grid"),[he,g]=s.useState(null),[p,P]=s.useState(""),[ie,z]=s.useState(null),[se,I]=s.useState([]),[pe,ce]=s.useState({}),[be,c]=s.useState(null),[_,r]=s.useState({}),[m,U]=s.useState({}),[re,fe]=s.useState(!1),[we,ke]=s.useState(""),[ge,xe]=s.useState(null),G=s.useRef(!1),ve=s.useRef(!1),Ne=s.useRef(0),Se=s.useRef(null),We=s.useRef(null),Fe=s.useRef(null),ee=s.useRef(null),Te=s.useRef(null),Pe=s.useRef(0),Ie=s.useRef(new Set),je=s.useRef(null),Le=s.useRef(null),$e=s.useRef(null),[Ke,st]=s.useState(null),[Xe,Ye]=s.useState(o==="favorites"),[it,_e]=s.useState(!1),[He,Ze]=s.useState(o==="online"?"online":"all"),[Je,et]=s.useState(!1),[u,y]=s.useState(""),[j,B]=s.useState(""),[X,oe]=s.useState(""),[ye,Ae]=s.useState(""),[Ge,jt]=s.useState(""),[rt,wt]=s.useState(""),[at,St]=s.useState(""),[ot,kt]=s.useState(""),[lt,It]=s.useState(""),[dt,Ct]=s.useState(""),[ct,Tt]=s.useState(""),Re=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,le=he??w??"",rn=le?J[le]??[]:[],Mt=s.useMemo(()=>new Map(b.map(i=>[i.key,i])),[b]),ze=s.useMemo(()=>{const i={};for(const d of h)typeof d.displayName=="string"&&d.displayName.trim()&&(i[Oe(d.userId)]=d.displayName);for(const[d,x]of Object.entries(T))typeof x.displayName=="string"&&x.displayName.trim()&&(i[d]=x.displayName);return i},[T,h]),At=s.useMemo(()=>h.filter(i=>i.userId!==(n.userId??"")).map(i=>{const d=Oe(i.userId),x=Mt.get(d);return{key:d,userId:i.userId,displayName:i.displayName,age:i.age,stats:i.stats,meters:x&&N?Math.round(pt(N,{lat:x.lat,lng:x.lng})):null,isOnline:!!x,hasPicture:typeof i.mainPhotoMediaId=="string"&&i.mainPhotoMediaId.trim().length>0,avatarUrl:i.mainPhotoMediaId?L[i.mainPhotoMediaId]:void 0}}),[L,Mt,h,N,n.userId]),Qe=s.useMemo(()=>{const i=u.trim()?Number(u):void 0,d=j.trim()?Number(j):void 0,x=ye.trim()?Number(ye):void 0,E=Ge.trim()?Number(Ge):void 0,O=rt.trim()?Number(rt):void 0,V=at.trim()?Number(at):void 0,q=ot.trim()?Number(ot):void 0,$=lt.trim()?Number(lt):void 0;return[...At.filter(C=>{var Me,Ue,Ve,De,Ot,Lt,Kt,_t,Wt;if(Xe&&!M.has(C.userId)||He==="online"&&!C.isOnline||He==="offline"&&C.isOnline||Je&&!C.hasPicture||Number.isFinite(i)&&(typeof C.age!="number"||C.age<i)||Number.isFinite(d)&&(typeof C.age!="number"||C.age>d))return!1;const de=typeof((Me=C.stats)==null?void 0:Me.race)=="string"?C.stats.race:"";return!(X.trim()&&de.toLowerCase()!==X.trim().toLowerCase()||Number.isFinite(x)&&(typeof((Ue=C.stats)==null?void 0:Ue.heightInches)!="number"||C.stats.heightInches<x)||Number.isFinite(E)&&(typeof((Ve=C.stats)==null?void 0:Ve.heightInches)!="number"||C.stats.heightInches>E)||Number.isFinite(O)&&(typeof((De=C.stats)==null?void 0:De.weightLbs)!="number"||C.stats.weightLbs<O)||Number.isFinite(V)&&(typeof((Ot=C.stats)==null?void 0:Ot.weightLbs)!="number"||C.stats.weightLbs>V)||Number.isFinite(q)&&(typeof((Lt=C.stats)==null?void 0:Lt.cockSizeInches)!="number"||C.stats.cockSizeInches<q)||Number.isFinite($)&&(typeof((Kt=C.stats)==null?void 0:Kt.cockSizeInches)!="number"||C.stats.cockSizeInches>$)||dt&&((_t=C.stats)==null?void 0:_t.cutStatus)!==dt||ct&&((Wt=C.stats)==null?void 0:Wt.position)!==ct)})].sort((C,de)=>{const Me=typeof C.meters=="number"&&Number.isFinite(C.meters)?C.meters:Number.POSITIVE_INFINITY,Ue=typeof de.meters=="number"&&Number.isFinite(de.meters)?de.meters:Number.POSITIVE_INFINITY;if(Me!==Ue)return Me-Ue;const Ve=C.displayName.localeCompare(de.displayName);return Ve!==0?Ve:C.key.localeCompare(de.key)})},[At,M,Xe,dt,j,lt,Ge,at,u,ot,ye,rt,ct,X,Je,He]),ut=s.useMemo(()=>Array.from(new Set(Qe.map(i=>i.key).filter(i=>i.trim().length>0))).slice(0,8),[Qe]),Rt=ut.join("|"),ft=s.useMemo(()=>{const i=new Set(Object.keys(K));return le.trim()&&i.add(le),Array.from(i).sort((d,x)=>{var E,O;return(((E=K[x])==null?void 0:E.lastAt)??0)-(((O=K[d])==null?void 0:O.lastAt)??0)})},[K,le]),Nt=s.useMemo(()=>Object.values(_).reduce((i,d)=>i+(Number.isFinite(d)?d:0),0),[_]);s.useMemo(()=>{var i;return le?ze[le]??((i=T[le])==null?void 0:i.displayName)??le:""},[ze,le,T]);const an=s.useMemo(()=>{if(!le)return;const i=Qe.find(d=>d.key===le);return i==null?void 0:i.avatarUrl},[Qe,le]),qe=s.useMemo(()=>ft.filter(i=>i!==le&&i!==Re&&!!K[i]).map(i=>{var d;return{key:i,label:ze[i]??((d=T[i])==null?void 0:d.displayName)??i}}),[ft,K,ze,Re,le,T]);s.useEffect(()=>{typeof F=="function"&&F(Nt)},[F,Nt]),s.useEffect(()=>{const i=Se.current;i&&(i.srcObject=ge)},[ge]),s.useEffect(()=>{const i=We.current;i&&(i.srcObject=Ke)},[Ke]),s.useEffect(()=>()=>{if(ge){for(const i of ge.getTracks())i.stop();if(Ke)for(const i of Ke.getTracks())i.stop();je.current&&(je.current.close(),je.current=null)}},[ge,Ke]),s.useEffect(()=>{if(qe.length===0){P("");return}P(i=>i&&qe.some(d=>d.key===i)?i:qe[0].key)},[qe]);const on=s.useMemo(()=>({async sendMessage(i,d,x,E){const O=Ce(d),V=await t.sendChat(n.sessionToken,i,O,x,E),q=V==null?void 0:V.message,$=[q];if(i==="cruise"&&ie)try{const ue=await t.sendChat(n.sessionToken,i,Ce(ie),x,E),C=ue==null?void 0:ue.message;$.push(C)}catch(ue){l(Y(ue))}for(const ue of $)Pt(ue);return q},async initiateMediaUpload(i,d){const x=await t.initiateChatMediaUpload(n.sessionToken,{mimeType:i,sizeBytes:d});return{objectKey:x.objectKey,uploadUrl:x.uploadUrl}},async uploadToSignedUrl(i,d,x){if(await vt(i,d,x))return;if(!(await fetch(i,{method:"PUT",headers:{"content-type":x},body:d})).ok)throw{code:"MEDIA_UPLOAD_INCOMPLETE",message:"Upload failed."}},async getMediaUrl(i){return(await t.getChatMediaUrl(n.sessionToken,i)).downloadUrl}}),[t,Re,n.sessionToken,l,ie]);function tt(i){var d,x,E;return i.text&&i.text.trim()?nn(i.text):((d=i.media)==null?void 0:d.kind)==="image"?"[Photo]":((x=i.media)==null?void 0:x.kind)==="video"?"[Video]":((E=i.media)==null?void 0:E.kind)==="audio"?"[Voice]":""}function ln(i){if(!i||Ie.current.has(i))return!1;if(Ie.current.add(i),Ie.current.size>5e3){const d=Array.from(Ie.current).slice(-2500);Ie.current=new Set(d)}return!0}function dn(i,d){var O;const x=ze[d]??((O=T[d])==null?void 0:O.displayName)??d,E=tt(i)||"New activity";if("Notification"in window){if(Notification.permission==="granted"){try{new Notification(`${x}`,{body:E})}catch{}return}Notification.permission==="default"&&Notification.requestPermission()}}function cn(i){if(!i.startsWith("GROUP_INVITE_REQUEST|"))return null;const[,d,x,E]=i.split("|");return!d||!x||!E?null:{inviteId:d,inviterKey:x,primaryPeerKey:E}}function un(i){if(!i.startsWith("GROUP_INVITE_ACCEPT|"))return null;const[,d,x]=i.split("|");return!d||!x?null:{inviteId:d,candidateKey:x}}function Pt(i){if(!ln(i.messageId))return;const d=i.fromKey===Re?i.toKey:i.fromKey;Q(O=>{const V=O[d]??[];return V.some(q=>q.messageId===i.messageId)?O:{...O,[d]:[...V,i].sort((q,$)=>q.createdAtMs-$.createdAtMs)}}),v(O=>({...O,[d]:{lastAt:i.createdAtMs,lastText:tt(i)}})),i.fromKey!==Re&&(ne==="thread"&&Ce(le)===Ce(d)?(U(V=>({...V,[d]:Math.max(V[d]??0,i.createdAtMs)})),r(V=>{const q={...V};return delete q[d],q})):r(V=>({...V,[d]:(V[d]??0)+1})),dn(i,d));const x=cn(i.text??"");x&&i.toKey===Re&&I(O=>O.some(V=>V.inviteId===x.inviteId)?O:[...O,{...x,createdAtMs:i.createdAtMs}]);const E=un(i.text??"");E&&i.toKey===Re&&pe[E.inviteId]&&(z(Ce(E.candidateKey)),c(`Invite accepted by ${ze[E.candidateKey]??E.candidateKey}.`),ce(V=>{const q={...V};return delete q[E.inviteId],q}))}async function fn(i){const d=Ce(i);if(d)try{const x=await t.listChat(n.sessionToken,nt(k),d),E=x==null?void 0:x.messages,O=Array.isArray(E)?E:[];t.markChatRead(n.sessionToken,nt(k),d).catch(()=>{}),Q($=>({...$,[d]:O}));const V=O.length>0?O[O.length-1]:null;V&&v($=>({...$,[d]:{lastAt:V.createdAtMs,lastText:tt(V)}}));let q=0;for(const $ of O)$.fromKey===d&&$.createdAtMs>q&&(q=$.createdAtMs);q>0&&U($=>({...$,[d]:Math.max($[d]??0,q)}))}catch(x){l(Y(x))}}s.useEffect(()=>{if(ne!=="thread"||!le.trim())return;let i=!1,d=!1,x=null;const E=async()=>{if(!(i||d)){d=!0;try{await fn(le)}finally{d=!1}i||(x=window.setTimeout(()=>{E()},1200))}};return E(),()=>{i=!0,x!==null&&window.clearTimeout(x)}},[k,le,ne]),s.useEffect(()=>{if(ne!=="grid")return;if(ut.length===0){r({});return}let i=!1;async function d(){if(!G.current&&!document.hidden){G.current=!0;try{const O=nt(k),V=[],q=[];for(const ue of ut){if(i)break;try{const C=Ce(ue);if(!C)continue;const de=await t.listChat(n.sessionToken,O,C),Me=(de==null?void 0:de.messages)??[];if(Me.length>0){const De=Me[Me.length-1];q.push([C,{lastAt:De.createdAtMs,lastText:tt(De)}])}let Ue=0;const Ve=m[C]??0;for(const De of Me)De.fromKey===C&&De.createdAtMs>Ve&&(Ue+=1);V.push([C,Ue])}catch{const C=Ce(ue);C&&V.push([C,0])}}if(i)return;q.length>0&&v(ue=>{const C={...ue};for(const[de,Me]of q)C[de]=Me;return C});const $={};for(const[ue,C]of V)C>0&&($[ue]=C);r($)}finally{G.current=!1}}}const x=window.setTimeout(()=>{d()},1200),E=window.setInterval(()=>{d()},15e3);return()=>{i=!0,G.current=!1,window.clearTimeout(x),window.clearInterval(E)}},[t,k,m,n.sessionToken,Rt,ne]),s.useEffect(()=>{const i=Array.from(new Set([...ft,...ut,le].map(V=>Ce(V)).filter(V=>V.length>0))).slice(0,10);if(i.length===0)return;let d=!1;const x=async()=>{if(!(d||document.hidden||ve.current)){ve.current=!0;try{const V=nt(k),q=[];for(const $ of i){if(d)break;try{const ue=await t.listChat(n.sessionToken,V,$),C=(ue==null?void 0:ue.messages)??[];if(C.length===0)continue;const de=C[C.length-1];q.push([$,{lastAt:de.createdAtMs,lastText:tt(de)}])}catch{}}if(d||q.length===0)return;v($=>{const ue={...$};for(const[C,de]of q)ue[C]=de;return ue})}finally{ve.current=!1}}},E=window.setTimeout(()=>{x()},1e3),O=window.setInterval(()=>{x()},5e3);return()=>{d=!0,window.clearTimeout(E),window.clearInterval(O)}},[t,k,ft,le,n.sessionToken,Rt]);async function gn(){if(ge)return ge;if(!navigator.mediaDevices||typeof navigator.mediaDevices.getUserMedia!="function")throw{code:"UNAUTHORIZED_ACTION",message:"Camera access is not available in this browser."};const i=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});return xe(i),i}function pn(i,d){je.current&&(je.current.close(),je.current=null);const x=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});return je.current=x,Le.current=d,$e.current=i,x.ontrack=E=>{const O=E.streams[0];O&&st(O)},x.onicecandidate=E=>{const O=E.candidate;if(!O)return;const V=$e.current,q=Le.current;!V||!q||t.sendCallSignal(n.sessionToken,{toKey:V,callId:q,signalType:"ice",candidate:JSON.stringify(O.toJSON())}).catch(()=>{})},x}async function Et(i=!0){const d=$e.current,x=Le.current;if(i&&d&&x)try{await t.sendCallSignal(n.sessionToken,{toKey:d,callId:x,signalType:"hangup"})}catch{}if(ge)for(const E of ge.getTracks())E.stop();if(Ke)for(const E of Ke.getTracks())E.stop();xe(null),st(null),je.current&&(je.current.close(),je.current=null),Le.current=null,$e.current=null,fe(!1)}s.useEffect(()=>{let i=!1;const d=gt();if(!d)return;const x=()=>{ee.current!==null&&(window.clearInterval(ee.current),ee.current=null),Te.current!==null&&(window.clearTimeout(Te.current),Te.current=null)},E=()=>{if(i)return;const O=new WebSocket(d);Fe.current=O,O.onopen=()=>{Pe.current=0,O.send(JSON.stringify({type:"auth",payload:{sessionToken:n.sessionToken}})),ee.current=window.setInterval(()=>{O.readyState===O.OPEN&&O.send(JSON.stringify({type:"heartbeat",payload:{}}))},15e3)},O.onmessage=V=>{let q=null;try{q=JSON.parse(String(V.data))}catch{return}if(!q||typeof q.type!="string")return;if(q.type==="chat_message"){const C=q.payload,de=C==null?void 0:C.message;if(!de||de.fromKey!==Re&&de.toKey!==Re)return;Pt(de);return}if(q.type!=="call_signal")return;const $=q.payload;if(!$||$.toKey!==Re||typeof $.fromKey!="string"||!$.callId||!$.signalType)return;const ue=Ce($.fromKey);if($.signalType==="hangup"){Et(!1);return}if($.signalType==="offer"){(async()=>{try{yt(ue),ke(ue);const C=await gn(),de=pn(ue,$.callId);for(const Ue of C.getTracks())de.addTrack(Ue,C);await de.setRemoteDescription({type:"offer",sdp:$.sdp??""});const Me=await de.createAnswer();await de.setLocalDescription(Me),await t.sendCallSignal(n.sessionToken,{toKey:ue,callId:$.callId,signalType:"answer",sdp:Me.sdp??""}),fe(!0)}catch(C){l(Y(C))}})();return}if($.signalType==="answer"){(async()=>{try{if(!je.current||Le.current!==$.callId)return;await je.current.setRemoteDescription({type:"answer",sdp:$.sdp??""})}catch(C){l(Y(C))}})();return}$.signalType==="ice"&&(async()=>{try{if(!je.current||Le.current!==$.callId||!$.candidate)return;const C=JSON.parse($.candidate);await je.current.addIceCandidate(C)}catch{}})()},O.onclose=()=>{if(x(),i)return;Pe.current+=1;const V=Math.min(8e3,500*2**Math.min(Pe.current,4));Te.current=window.setTimeout(E,V)},O.onerror=()=>{}};return E(),()=>{var O;i=!0,x(),(O=Fe.current)==null||O.close(1e3,"chat cleanup"),Fe.current=null}},[t,Re,n.sessionToken]);async function yn(){if(p.trim()){if(!le.trim()){l("Select a user first.");return}try{const i=Ce(p);if(!i)return;if(!qe.some(x=>x.key===i)){l("You can only add a third user you have previously messaged.");return}const d=crypto.randomUUID();await t.sendChat(n.sessionToken,"cruise",i,`GROUP_INVITE_REQUEST|${d}|${Re}|${le.trim()}`),ce(x=>({...x,[d]:{candidateKey:i,primaryPeerKey:le.trim()}})),c(`Invite sent to ${ze[i]??i}. Waiting for acceptance.`)}catch(i){l(Y(i))}}}async function Ft(i,d,x){try{await t.sendChat(n.sessionToken,"cruise",d,`GROUP_INVITE_ACCEPT|${i}|${Re}`),I(E=>E.filter(O=>O.inviteId!==i)),c("Group invite accepted."),yt(x)}catch(E){l(Y(E))}}function zt(i){I(d=>d.filter(x=>x.inviteId!==i))}function yt(i){const d=Ce(i);S(d),g(d),r(x=>{const E={...x};return delete E[d],E}),U(x=>({...x,[d]:Date.now()})),ae("thread")}function ht(){Ye(!1),Ze("all"),et(!1),y(""),B(""),oe(""),Ae(""),jt(""),wt(""),St(""),kt(""),It(""),Ct(""),Tt(""),_e(!1)}if(s.useEffect(()=>{const i=d=>{var O;const E=(O=d.detail)==null?void 0:O.action;if(E==="reset"){ht(),ae("grid");return}if(E==="toggle_favorites"){Ye(V=>!V),ae("grid");return}E==="open_filters"&&(_e(!0),ae("grid"))};return window.addEventListener("rd:discover-control",i),()=>window.removeEventListener("rd:discover-control",i)},[]),s.useEffect(()=>{R&&R.nonce!==Ne.current&&(Ne.current=R.nonce,yt(R.key),typeof W=="function"&&W())},[W,R]),s.useEffect(()=>{const i=d=>{var E;((E=d.detail)==null?void 0:E.tab)==="discover"&&(ae("grid"),g(null),_e(!1))};return window.addEventListener("rd:tab-select",i),()=>window.removeEventListener("rd:tab-select",i)},[]),ne==="thread"&&le.trim()){const i=ze[le]??((Ut=T[le])==null?void 0:Ut.displayName)??le;return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:H?-10:0},children:[se.length>0?e.jsxs("div",{style:{...Ee(),display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"INVITE REQUESTS"}),se.map(d=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,alignItems:"center"},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:13},children:[ze[d.inviterKey]??d.inviterKey," invited you to join a conversation."]}),e.jsx("button",{type:"button",style:me(!1),onClick:()=>void Ft(d.inviteId,d.inviterKey,d.primaryPeerKey),children:"ACCEPT"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>zt(d.inviteId),children:"DECLINE"})]},d.inviteId))]}):null,be?e.jsx("div",{style:{color:"#26d5ff",fontSize:12},children:be}):null,e.jsx(tn,{chatKind:nt(k),peerKey:le,currentUserKey:Re,messages:rn,client:on,title:`INSTANT THREAD: ${i}`,peerSummary:{displayName:i,avatarUrl:an},thirdParty:{candidates:qe,selectedKey:p,onSelect:d=>P(d),onAdd:()=>void yn(),disabled:a},showHeader:!1,edgeToEdge:H,fillHeight:H}),re?e.jsx("div",{role:"dialog","aria-modal":"true","aria-label":"Video call",style:{position:"fixed",inset:0,zIndex:60,background:"rgba(0,0,0,0.82)",display:"grid",placeItems:"center",padding:16},children:e.jsxs("div",{style:{...Ee(),width:"min(720px, 100%)",display:"grid",gap:10},children:[e.jsxs("div",{style:{fontSize:18,fontWeight:700},children:["VIDEO CALL: ",we]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("video",{ref:Se,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"100%",maxHeight:"52vh",borderRadius:12,background:"#000"}}),e.jsx("video",{ref:We,autoPlay:!0,playsInline:!0,style:{width:"100%",maxHeight:"52vh",borderRadius:12,background:"#000"}})]}),e.jsx("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:e.jsx("button",{type:"button",style:D(!1),onClick:()=>void Et(),children:"END CALL"})})]})}):null]})}return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:H?-10:0},children:[se.length>0?e.jsxs("div",{style:{...Ee(),display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"INVITE REQUESTS"}),se.map(i=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,alignItems:"center"},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:13},children:[ze[i.inviterKey]??i.inviterKey," invited you to join a conversation."]}),e.jsx("button",{type:"button",style:me(!1),onClick:()=>void Ft(i.inviteId,i.inviterKey,i.primaryPeerKey),children:"ACCEPT"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>zt(i.inviteId),children:"DECLINE"})]},i.inviteId))]}):null,be?e.jsx("div",{style:{color:"#26d5ff",fontSize:12},children:be}):null,e.jsx("div",{style:{padding:10,borderBottom:"1px solid rgba(255,58,77,0.28)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8},children:[e.jsx("button",{type:"button",style:D(!1),onClick:ht,children:"GUYS"}),e.jsx("button",{type:"button",style:Xe?me(!1):D(!1),onClick:()=>Ye(i=>!i),"aria-label":"Toggle favorites only",children:"â˜…"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>_e(!0),children:"FILTER"})]})}),it?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},role:"dialog","aria-modal":"true","aria-label":"Discover filters",onClick:()=>_e(!1),children:e.jsx("div",{onClick:i=>i.stopPropagation(),style:{...Ee(),width:"min(760px, 100%)",maxHeight:"86vh",overflow:"auto"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"FILTER USERS"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{type:"checkbox",checked:Je,onChange:i=>et(i.target.checked)}),"Has pictures"]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Online status"}),e.jsxs("select",{style:Z(),value:He,onChange:i=>Ze(i.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"offline",children:"Offline"})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[e.jsx("input",{style:Z(),placeholder:"Min age",value:u,onChange:i=>y(i.target.value)}),e.jsx("input",{style:Z(),placeholder:"Max age",value:j,onChange:i=>B(i.target.value)}),e.jsx("input",{style:Z(),placeholder:"Race",value:X,onChange:i=>oe(i.target.value)}),e.jsxs("select",{style:Z(),value:dt,onChange:i=>Ct(i.target.value),children:[e.jsx("option",{value:"",children:"Cut / Uncut"}),e.jsx("option",{value:"cut",children:"Cut"}),e.jsx("option",{value:"uncut",children:"Uncut"})]}),e.jsx("input",{style:Z(),placeholder:"Min height (in)",value:ye,onChange:i=>Ae(i.target.value)}),e.jsx("input",{style:Z(),placeholder:"Max height (in)",value:Ge,onChange:i=>jt(i.target.value)}),e.jsx("input",{style:Z(),placeholder:"Min weight (lbs)",value:rt,onChange:i=>wt(i.target.value)}),e.jsx("input",{style:Z(),placeholder:"Max weight (lbs)",value:at,onChange:i=>St(i.target.value)}),e.jsx("input",{style:Z(),placeholder:"Min cock size (in)",value:ot,onChange:i=>kt(i.target.value)}),e.jsx("input",{style:Z(),placeholder:"Max cock size (in)",value:lt,onChange:i=>It(i.target.value)}),e.jsxs("select",{style:Z(),value:ct,onChange:i=>Tt(i.target.value),children:[e.jsx("option",{value:"",children:"Position"}),e.jsx("option",{value:"top",children:"Top"}),e.jsx("option",{value:"bottom",children:"Bottom"}),e.jsx("option",{value:"side",children:"Side"})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:D(!1),onClick:ht,children:"RESET"}),e.jsx("button",{type:"button",style:me(!1),onClick:()=>_e(!1),children:"DONE"})]})]})})}):null,e.jsx("div",{style:{display:"grid",gap:0},children:e.jsx("div",{style:{display:"grid",gap:0,gridTemplateColumns:"repeat(3, minmax(0, 1fr))"},children:Qe.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:13,padding:12,gridColumn:"1 / -1"},children:"No users match current filters."}):Qe.map(i=>e.jsx("button",{type:"button",onClick:()=>A(i.key),style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:0,display:"grid",gap:0,color:"#fff",cursor:"pointer"},children:e.jsxs("div",{style:{position:"relative",width:"100%",aspectRatio:"1 / 1"},children:[e.jsx("img",{src:i.avatarUrl??Be(i.key),alt:"User avatar",style:{width:"100%",height:"100%",borderRadius:0,objectFit:"cover",border:"1px solid #0fd9ff"}}),i.isOnline?e.jsx("span",{style:{position:"absolute",top:4,left:4,width:10,height:10,borderRadius:"50%",background:"#26d5ff",border:"2px solid #000"}}):null]})},i.key))})})]})}function On({api:t,session:n,setLastError:a,openThreadRequest:f,onThreadRequestConsumed:l,isMobile:b}){var I,pe,ce,be,c,_;const[w,S]=s.useState([]),[A,R]=s.useState(null),[W,H]=s.useState([]),[N,T]=s.useState("messages"),[o,h]=s.useState(null),[M,L]=s.useState(!1),[F,J]=s.useState(""),[Q,K]=s.useState(null),[v,k]=s.useState({}),[te,ne]=s.useState(null),ae=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,he="cruise",g=s.useMemo(()=>w.filter(r=>r.key!==A).map(r=>({key:r.key,label:r.displayName})),[w,A]),p=s.useMemo(()=>w.find(r=>r.key===A)??null,[w,A]);s.useEffect(()=>{if(g.length===0){J("");return}J(r=>r&&g.some(m=>m.key===r)?r:g[0].key)},[g]),s.useEffect(()=>{let r=!1;async function m(){var re,fe,we;try{const ke=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,[ge,xe]=await Promise.all([t.getPublicProfiles(),t.listActivePresence(n.sessionToken)]),G={},ve={};for(const ee of ge.profiles)G[Oe(ee.userId)]=ee.displayName,typeof ee.mainPhotoMediaId=="string"&&ee.mainPhotoMediaId.trim()!==""&&(ve[Oe(ee.userId)]=ee.mainPhotoMediaId);const Ne=Array.from(new Set([...ge.profiles.map(ee=>Oe(ee.userId)),...xe.presence.map(ee=>Ce(ee.key))].filter(ee=>ee&&ee!==ke))).slice(0,24),Se=[];for(const ee of Ne)try{const Te=await t.listChat(n.sessionToken,"cruise",ee),Pe=(Te==null?void 0:Te.messages)??[];if(!Array.isArray(Pe)||Pe.length===0)continue;const Ie=Pe[Pe.length-1],je=typeof Ie.text=="string"&&Ie.text.trim().length>0?nn(Ie.text):((re=Ie.media)==null?void 0:re.kind)==="image"?"[Photo]":((fe=Ie.media)==null?void 0:fe.kind)==="video"?"[Video]":((we=Ie.media)==null?void 0:we.kind)==="audio"?"[Voice]":"";Se.push({key:ee,displayName:G[ee]??ee,preview:je,at:Ie.createdAtMs})}catch{}const We=await Promise.all(Se.map(async ee=>{const Te=ve[ee.key];if(!Te)return null;try{const Pe=await t.getPublicMediaUrl(Te);return{key:ee.key,url:Pe.downloadUrl}}catch{return null}})),Fe={};for(const ee of We)ee&&(Fe[ee.key]=ee.url);for(const ee of Se)ee.avatarUrl=Fe[ee.key];if(r)return;Se.sort((ee,Te)=>Te.at-ee.at),S(Se)}catch(ke){r||a(Y(ke))}}m();const U=window.setInterval(()=>{m()},1e4);return()=>{r=!0,window.clearInterval(U)}},[t,A,n.sessionToken,n.userId,a]),s.useEffect(()=>{f!=null&&f.key&&(R(Ce(f.key)),T("messages"),typeof l=="function"&&l())},[l,f]),s.useEffect(()=>{const r=m=>{var re;((re=m.detail)==null?void 0:re.tab)==="threads"&&(R(null),T("messages"))};return window.addEventListener("rd:tab-select",r),()=>window.removeEventListener("rd:tab-select",r)},[]),s.useEffect(()=>{if(!A||N!=="profile")return;const r=bt(A);if(!r){h(null);return}let m=!1;return L(!0),t.getPublicProfile(r).then(U=>{m||h(U.profile)}).catch(U=>{m||(h(null),a(Y(U)))}).finally(()=>{m||L(!1)}),()=>{m=!0}},[t,A,a,N]),s.useEffect(()=>{if(!A){H([]);return}let r=!1;const m=async()=>{try{const re=await t.listChat(n.sessionToken,he,A),fe=(re==null?void 0:re.messages)??[];r||(H(Array.isArray(fe)?fe:[]),t.markChatRead(n.sessionToken,he,A).catch(()=>{}))}catch(re){r||a(Y(re))}};m();const U=window.setInterval(()=>{m()},1200);return()=>{r=!0,window.clearInterval(U)}},[t,A,n.sessionToken,a]);function P(r){if(!r.startsWith("GROUP_INVITE_ACCEPT|"))return null;const[,m,U]=r.split("|");return!m||!U?null:{inviteId:m,candidateKey:U}}const ie=s.useMemo(()=>({async sendMessage(r,m,U,re){const fe=await t.sendChat(n.sessionToken,r,m,U,re),we=fe==null?void 0:fe.message,ke=P(we.text??"");if(ke&&we.toKey===ae&&v[ke.inviteId]&&(K(ke.candidateKey),ne(`Invite accepted by ${ke.candidateKey}.`),k(xe=>{const G={...xe};return delete G[ke.inviteId],G})),H(ge=>[...ge,we].sort((xe,G)=>xe.createdAtMs-G.createdAtMs)),r==="cruise"&&Q)try{const ge=await t.sendChat(n.sessionToken,r,Q,U,re),xe=ge==null?void 0:ge.message;H(G=>[...G,xe].sort((ve,Ne)=>ve.createdAtMs-Ne.createdAtMs))}catch(ge){a(Y(ge))}return we},async initiateMediaUpload(r,m){const U=await t.initiateChatMediaUpload(n.sessionToken,{mimeType:r,sizeBytes:m});return{objectKey:U.objectKey,uploadUrl:U.uploadUrl}},async uploadToSignedUrl(r,m,U){if(await vt(r,m,U))return;if(!(await fetch(r,{method:"PUT",headers:{"content-type":U},body:m})).ok)throw{code:"MEDIA_UPLOAD_INCOMPLETE",message:"Upload failed."}},async getMediaUrl(r){return(await t.getChatMediaUrl(n.sessionToken,r)).downloadUrl}}),[t,ae,v,n.sessionToken,a,Q]);async function z(){var r;if(!(!A||!F)){if(!w.some(m=>m.key===F)){a("You can only add a third user you have previously messaged.");return}try{const m=crypto.randomUUID();await t.sendChat(n.sessionToken,"cruise",F,`GROUP_INVITE_REQUEST|${m}|${ae}|${A}`),k(U=>({...U,[m]:{candidateKey:F}})),ne(`Invite sent to ${((r=w.find(U=>U.key===F))==null?void 0:r.displayName)??F}.`)}catch(m){a(Y(m))}}}async function se(){if(A)try{await t.sendChat(n.sessionToken,"cruise",A,xt),ne("Fire sent.")}catch(r){a(Y(r))}}if(A){const r=(p==null?void 0:p.displayName)??A;return e.jsxs("div",{style:{display:"grid",gap:0,minHeight:b?"calc(100dvh - 150px)":void 0,marginInline:b?-10:0,marginBlock:0},children:[e.jsx("div",{style:{position:"sticky",top:0,zIndex:46,background:"rgba(8,8,12,0.96)",borderBottom:"1px solid rgba(255,58,77,0.35)",padding:"6px 10px",display:"flex",justifyContent:"flex-end"},children:e.jsx("button",{type:"button",onClick:()=>T(m=>m==="messages"?"profile":"messages"),style:{background:"transparent",border:0,color:"#26d5ff",fontSize:13,fontWeight:700,letterSpacing:"0.03em",textTransform:"uppercase",padding:0,cursor:"pointer"},children:N==="messages"?"View Profile":"Back to Thread"})}),N==="messages"?e.jsx(tn,{chatKind:"cruise",peerKey:A,currentUserKey:ae,messages:W,client:ie,title:`INSTANT THREAD: ${r}`,peerSummary:{displayName:r},thirdParty:{candidates:g,selectedKey:F,onSelect:m=>J(m),onAdd:()=>void z(),disabled:!1},showHeader:!1,edgeToEdge:!0,fillHeight:b}):e.jsxs("div",{style:{padding:12,display:"grid",gap:12},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"88px 1fr",gap:12,alignItems:"center"},children:[e.jsx("img",{src:(p==null?void 0:p.avatarUrl)??Be(A),alt:"Profile avatar",style:{width:88,height:88,borderRadius:"50%",objectFit:"cover",border:"2px solid #ff3047"}}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:24,fontWeight:700},children:(o==null?void 0:o.displayName)??r}),e.jsx("div",{style:{color:"#26d5ff",fontSize:14},children:"Instant Messaging Available"})]})]}),M?e.jsx("div",{style:{color:"#9fb6bf",fontSize:14},children:"Loading profile..."}):null,M?null:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:14,lineHeight:1.5},children:[e.jsxs("div",{children:["Age: ",(o==null?void 0:o.age)??"-"]}),e.jsxs("div",{children:["Race: ",((I=o==null?void 0:o.stats)==null?void 0:I.race)??"-"]}),e.jsxs("div",{children:["Height: ",((pe=o==null?void 0:o.stats)==null?void 0:pe.heightInches)??"-"]}),e.jsxs("div",{children:["Weight: ",((ce=o==null?void 0:o.stats)==null?void 0:ce.weightLbs)??"-"]}),e.jsxs("div",{children:["Cock Size: ",((be=o==null?void 0:o.stats)==null?void 0:be.cockSizeInches)??"-"]}),e.jsxs("div",{children:["Cut / Uncut: ",((c=o==null?void 0:o.stats)==null?void 0:c.cutStatus)??"-"]}),e.jsxs("div",{children:["Position: ",((_=o==null?void 0:o.stats)==null?void 0:_.position)??"-"]}),e.jsxs("div",{style:{marginTop:8},children:["Bio: ",(o==null?void 0:o.bio)??"-"]})]}),e.jsx("div",{children:e.jsx("button",{type:"button",style:{...D(!1),color:"#ffb347",borderColor:"rgba(255,179,71,0.65)"},onClick:()=>void se(),children:"ðŸ”¥ FIRE"})})]})]})]})}return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:b?-10:0,marginBlock:0},children:[w.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14,padding:14},children:"No conversations yet."}):w.map(r=>e.jsxs("button",{type:"button",onClick:()=>R(r.key),style:{border:0,borderBottom:"1px solid rgba(255,58,77,0.24)",borderRadius:0,padding:"10px 12px",background:"rgba(0,0,0,0.2)",textAlign:"left",color:"#fff",cursor:"pointer",display:"grid",gridTemplateColumns:"52px 1fr",gap:10,alignItems:"center",width:"100%"},children:[e.jsx("img",{src:r.avatarUrl??Be(r.key),alt:`${r.displayName} avatar`,style:{width:52,height:52,borderRadius:6,objectFit:"cover",border:"1px solid rgba(38,213,255,0.9)"}}),e.jsxs("div",{style:{display:"grid",gap:3,minWidth:0},children:[e.jsx("div",{style:{fontWeight:700},children:r.displayName}),e.jsx("div",{style:{color:"#b9bec9",fontSize:13,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:r.preview})]})]},r.key)),te?e.jsx("div",{style:{color:"#26d5ff",fontSize:12,padding:10},children:te}):null]})}function Ln({api:t,session:n,isMobile:a,setLastError:f}){const[l,b]=s.useState("ads"),[w,S]=s.useState([]),[A,R]=s.useState([]),[W,H]=s.useState(""),[N,T]=s.useState(""),[o,h]=s.useState(""),[M,L]=s.useState(""),[F,J]=s.useState([]),[Q,K]=s.useState(""),[v,k]=s.useState(""),[te,ne]=s.useState(""),[ae,he]=s.useState([]),[g,p]=s.useState({}),P=!0,ie=n.userType!=="guest";async function z(){try{const[r,m,U,re]=await Promise.all([t.listPublicPostings("ad"),t.listPublicPostings("event"),t.listCruisingSpots(),n.userType==="guest"?Promise.resolve({postings:[]}):t.listEventInvites(n.sessionToken)]);S([...r.postings].sort((fe,we)=>fe.createdAtMs-we.createdAtMs)),R([...m.postings].sort((fe,we)=>fe.createdAtMs-we.createdAtMs)),J(U.spots),he(re.postings)}catch(r){f(Y(r))}}s.useEffect(()=>{z()},[]),s.useEffect(()=>{const r=m=>{var re;((re=m.detail)==null?void 0:re.tab)==="public"&&b("ads")};return window.addEventListener("rd:tab-select",r),()=>window.removeEventListener("rd:tab-select",r)},[]);async function se(r){if(r==="event"&&!ie){f("Anonymous users cannot create event postings.");return}const m=r==="ad"?W:o,U=r==="ad"?N:M;try{await t.createPublicPosting(n.sessionToken,{type:r,title:m,body:U}),r==="ad"?(H(""),T("")):(h(""),L("")),await z()}catch(re){f(Y(re))}}async function I(r){if(!ie){f("Anonymous users cannot invite to events.");return}const m=(g[r]??"").trim();if(!m){f("Target user id is required.");return}try{await t.inviteToEvent(n.sessionToken,{postingId:r,targetUserId:m}),p(U=>({...U,[r]:""})),await z()}catch(U){f(Y(U))}}async function pe(r,m){if(n.userType==="guest"){f("Anonymous users cannot respond to event invites.");return}try{await t.respondToEventInvite(n.sessionToken,{postingId:r,accept:m}),await z()}catch(U){f(Y(U))}}async function ce(){try{await t.createCruisingSpot(n.sessionToken,{name:Q,address:v,description:te}),K(""),k(""),ne(""),await z()}catch(r){f(Y(r))}}async function be(r){try{await t.checkInCruisingSpot(n.sessionToken,r),await z()}catch(m){f(Y(m))}}const c=r=>{const m=r==="ads"?"ADS":"EVENTS",U=r==="ads"?w:A,re=r==="ads"?W:o,fe=r==="ads"?N:M,we=r==="ads"?H:h,ke=r==="ads"?T:L,ge=r==="ads"?"ad":"event",xe=r==="ads"?P:ie;return e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.38)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:m}),e.jsx("input",{value:re,onChange:G=>we(G.target.value),placeholder:`${m} title`,style:Z(),"aria-label":`${m} title`,disabled:!xe}),e.jsx("textarea",{value:fe,onChange:G=>ke(G.target.value),placeholder:`Write ${m.toLowerCase()} details`,style:{...Z(),minHeight:86,resize:"vertical"},"aria-label":`${m} details`,disabled:!xe}),e.jsxs("button",{type:"button",onClick:()=>void se(ge),style:xe?me(!1):D(!0),disabled:!xe,children:["POST ",m]}),xe?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can view events but cannot post events."}),e.jsx("div",{style:{display:"grid",gap:8,marginTop:6},children:U.length===0?e.jsxs("div",{style:{color:"#b9bec9",fontSize:14},children:["No ",m.toLowerCase()," yet."]}):U.map(G=>{var ve,Ne;return e.jsxs("div",{style:{borderTop:"1px solid rgba(255,58,77,0.25)",paddingTop:10,paddingBottom:10},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:4},children:G.title}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12,marginBottom:6},children:["Host: ",G.authorUserId]}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap"},children:G.body}),r==="events"?e.jsxs("div",{style:{display:"grid",gap:8,marginTop:8},children:[e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12},children:["Invited: ",((ve=G.invitedUserIds)==null?void 0:ve.length)??0," | Accepted: ",((Ne=G.acceptedUserIds)==null?void 0:Ne.length)??0]}),n.userId&&n.userId===G.authorUserId?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8},children:[e.jsx("input",{value:g[G.postingId]??"",onChange:Se=>p(We=>({...We,[G.postingId]:Se.target.value})),placeholder:"Invite user id",style:Z()}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void I(G.postingId),children:"INVITE"})]}):null,n.userType!=="guest"&&n.userId&&Array.isArray(G.invitedUserIds)&&G.invitedUserIds.includes(n.userId)?e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:me(!1),onClick:()=>void pe(G.postingId,!0),children:"ACCEPT INVITE"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void pe(G.postingId,!1),children:"DECLINE"})]}):null]}):null]},G.postingId)})})]})})},_=e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.38)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"CRUISING SPOTS"}),e.jsx("input",{value:Q,onChange:r=>K(r.target.value),placeholder:"Spot name",style:Z(),disabled:!1}),e.jsx("input",{value:v,onChange:r=>k(r.target.value),placeholder:"Spot address",style:Z(),disabled:!1}),e.jsx("textarea",{value:te,onChange:r=>ne(r.target.value),placeholder:"Spot description",style:{...Z(),minHeight:80,resize:"vertical"},disabled:!1}),e.jsx("button",{type:"button",style:me(!1),disabled:!1,onClick:()=>void ce(),children:"CREATE SPOT"}),null,e.jsx("div",{style:{display:"grid",gap:8},children:F.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"No cruising spots yet."}):F.map(r=>e.jsxs("div",{style:{borderTop:"1px solid rgba(255,58,77,0.25)",paddingTop:10,paddingBottom:10},children:[e.jsx("div",{style:{fontWeight:700},children:r.name}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12,marginTop:4},children:["Created by: ",r.creatorUserId]}),e.jsx("div",{style:{color:"#9fb6bf",fontSize:12,marginTop:2},children:r.address}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap",marginTop:6},children:r.description}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:D(!1),onClick:()=>void be(r.spotId),children:"CHECK IN"}),e.jsxs("span",{style:{color:"#9fb6bf",fontSize:12},children:["Checked in: ",r.checkInCount??0]}),e.jsxs("span",{style:{color:"#9fb6bf",fontSize:12},children:["Got action: ",r.actionCount??0]})]})]},r.spotId))})]})});return e.jsx("div",{style:{display:"grid",gap:8,marginInline:a?-10:0},children:a?e.jsxs(e.Fragment,{children:[l==="ads"?c("ads"):null,l==="events"?c("events"):null,l==="spots"?_:null,e.jsx("div",{style:{position:"sticky",bottom:"calc(86px + env(safe-area-inset-bottom, 0px))",zIndex:31,background:"rgba(0,0,0,0.35)",padding:8},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[e.jsx("button",{type:"button",style:l==="ads"?me(!1):D(!1),onClick:()=>b("ads"),children:"ADS"}),e.jsx("button",{type:"button",style:l==="events"?me(!1):D(!1),onClick:()=>b("events"),children:"EVENTS"}),e.jsx("button",{type:"button",style:l==="spots"?me(!1):D(!1),onClick:()=>b("spots"),children:"SPOTS"})]})})]}):e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[c("ads"),c("events"),e.jsx("div",{style:{gridColumn:"1 / -1"},children:_}),n.userType!=="guest"&&ae.length>0?e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.25)",gridColumn:"1 / -1",display:"grid",gap:8,padding:10},children:[e.jsx("div",{style:{fontSize:16,fontWeight:700},children:"EVENT INVITES"}),ae.map(r=>e.jsxs("div",{style:{display:"grid",gap:6,border:"1px solid rgba(255,58,77,0.4)",borderRadius:10,padding:8},children:[e.jsx("div",{style:{fontWeight:700},children:r.title}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13},children:["Host: ",r.authorUserId]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:me(!1),onClick:()=>void pe(r.postingId,!0),children:"ACCEPT"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void pe(r.postingId,!1),children:"DECLINE"})]})]},r.postingId))]}):null]})})}function Kn({api:t,session:n,setLastError:a}){const[f,l]=s.useState([]),[b,w]=s.useState(""),[S,A]=s.useState("");async function R(){try{const o=await t.listSubmissions();l([...o.submissions].sort((h,M)=>M.createdAtMs-h.createdAtMs))}catch(o){a(Y(o))}}s.useEffect(()=>{R()},[]);async function W(){try{await t.createSubmission(n.sessionToken,{title:b,body:S}),w(""),A(""),await R()}catch(o){a(Y(o))}}async function H(o){try{await t.recordSubmissionView(o),await R()}catch(h){a(Y(h))}}async function N(o,h){try{await t.rateSubmission(o,h),await R()}catch(M){a(Y(M))}}const T=n.userType!=="guest";return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("input",{style:Z(),value:b,onChange:o=>w(o.target.value),placeholder:"Story title",disabled:!T}),e.jsx("textarea",{style:{...Z(),minHeight:120},value:S,onChange:o=>A(o.target.value),placeholder:"Write your story",disabled:!T}),e.jsx("button",{type:"button",style:T?me(!1):D(!0),disabled:!T,onClick:()=>void W(),children:"PUBLISH STORY"}),T?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can read but cannot publish submissions."})]})}),e.jsx("div",{style:{display:"grid",gap:10},children:f.map(o=>{const h=o.ratingCount>0?(o.ratingSum/o.ratingCount).toFixed(2):"0.00";return e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.28)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:o.title}),e.jsx("div",{style:{color:"#ced3dc",whiteSpace:"pre-wrap",marginTop:6},children:o.body}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13,marginTop:8},children:["Views: ",o.viewCount," | Rating: ",h," (",o.ratingCount,")"]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:D(!1),onClick:()=>void H(o.submissionId),children:"VIEW"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void N(o.submissionId,1),children:"â˜…1"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void N(o.submissionId,2),children:"â˜…2"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void N(o.submissionId,3),children:"â˜…3"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void N(o.submissionId,4),children:"â˜…4"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void N(o.submissionId,5),children:"â˜…5"})]})]},o.submissionId)})})]})}function _n({api:t,session:n,setLastError:a}){var ae,he,g,p,P,ie;const[f,l]=s.useState([]),[b,w]=s.useState({}),[S,A]=s.useState(null),[R,W]=s.useState(2e3),[H,N]=s.useState(""),[T,o]=s.useState(""),[h,M]=s.useState(""),[L,F]=s.useState(""),[J,Q]=s.useState("Ready."),K=n.userType!=="guest";async function v(){try{const z=await t.listPromotedProfiles();l([...z.listings].sort((ce,be)=>be.createdAtMs-ce.createdAtMs)),W(z.feeCents);const se=Array.from(new Set(z.listings.map(ce=>ce.userId))).filter(ce=>ce.trim().length>0),I=await Promise.all(se.map(async ce=>{try{const c=(await t.getPublicProfile(ce)).profile.mainPhotoMediaId;if(!c)return null;const _=await t.getPublicMediaUrl(c);return{userId:ce,url:_.downloadUrl}}catch{return null}})),pe={};for(const ce of I)ce&&(pe[ce.userId]=ce.url);w(pe)}catch(z){a(Y(z))}}s.useEffect(()=>{v()},[]);async function k(){if(!K){a("Anonymous users cannot create promoted profiles.");return}try{const z=await t.startPromotedPayment(n.sessionToken),se=await t.confirmPromotedPayment(n.sessionToken,z.payment.paymentToken);F(se.payment.paymentToken),Q("Payment confirmed. You can now publish one promoted profile.")}catch(z){const se=Y(z);Q(se),a(se)}}async function te(){if(!K){a("Anonymous users cannot create promoted profiles.");return}try{await t.createPromotedProfile(n.sessionToken,{paymentToken:L,title:H,body:T,displayName:h}),N(""),o(""),M(""),F(""),Q("Promoted profile published."),await v()}catch(z){const se=Y(z);Q(se),a(se)}}async function ne(z){try{const se=await t.getPublicProfile(z);A(se.profile)}catch(se){a(Y(se))}}return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"PROMOTED PROFILES"}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:14},children:["Publishing requires a $",Math.round(R/100)," fee per profile."]}),e.jsx("div",{style:{color:"#26d5ff",fontSize:13},children:J})]})}),e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("input",{value:h,onChange:z=>M(z.target.value),placeholder:"Display name",style:Z(),disabled:!K}),e.jsx("input",{value:H,onChange:z=>N(z.target.value),placeholder:"Headline",style:Z(),disabled:!K}),e.jsx("textarea",{value:T,onChange:z=>o(z.target.value),placeholder:"Profile description",style:{...Z(),minHeight:92,resize:"vertical"},disabled:!K}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsxs("button",{type:"button",style:D(!K),disabled:!K,onClick:()=>void k(),children:["PAY $",Math.round(R/100)]}),e.jsx("button",{type:"button",style:K?me(!1):D(!0),disabled:!K,onClick:()=>void te(),children:"PUBLISH PROFILE"})]}),K?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can browse but cannot publish paid profiles."})]})}),e.jsx("div",{style:{display:"grid",gap:10},children:f.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"No promoted profiles yet."}):f.map(z=>e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.25)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"72px 1fr",gap:10,alignItems:"start"},children:[e.jsx("img",{src:b[z.userId]??Be(`user:${z.userId}`),alt:`${z.displayName} profile`,style:{width:72,height:72,borderRadius:6,objectFit:"cover",border:"1px solid rgba(38,213,255,0.9)"}}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:z.title}),e.jsx("div",{style:{color:"#26d5ff",fontSize:13},children:z.displayName}),e.jsx("div",{style:{color:"#ced3dc",whiteSpace:"pre-wrap",fontSize:14},children:z.body}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void ne(z.userId),children:"VIEW PROFILE"})]})]})},z.listingId))}),S?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},onClick:()=>A(null),children:e.jsxs("div",{onClick:z=>z.stopPropagation(),style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:12,width:"min(560px, 100%)",background:"rgba(0,0,0,0.88)"},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:S.displayName}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:6},children:["Age: ",S.age]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Race: ",((ae=S.stats)==null?void 0:ae.race)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Height: ",((he=S.stats)==null?void 0:he.heightInches)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Weight: ",((g=S.stats)==null?void 0:g.weightLbs)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Cock Size: ",((p=S.stats)==null?void 0:p.cockSizeInches)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Cut / Uncut: ",((P=S.stats)==null?void 0:P.cutStatus)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Position: ",((ie=S.stats)==null?void 0:ie.position)??"-"]}),e.jsx("div",{style:{color:"#ced3dc",marginTop:10,whiteSpace:"pre-wrap"},children:S.bio}),e.jsx("div",{style:{marginTop:10},children:e.jsx("button",{type:"button",style:D(!1),onClick:()=>A(null),children:"CLOSE"})})]})}):null]})}function Wn(){return{displayName:"",age:"",bio:"",heightInches:"",race:"",cockSizeInches:"",cutStatus:"",weightLbs:"",position:"",discreetMode:!1,travelEnabled:!1,travelLat:"",travelLng:"",lookingForMore:""}}function Vt(t){var a,f,l;const n=sn(t.bio);return{displayName:t.displayName,age:String(t.age),bio:n.bio,heightInches:t.stats.heightInches!==void 0?String(t.stats.heightInches):"",race:t.stats.race??"",cockSizeInches:t.stats.cockSizeInches!==void 0?String(t.stats.cockSizeInches):"",cutStatus:t.stats.cutStatus??"",weightLbs:t.stats.weightLbs!==void 0?String(t.stats.weightLbs):"",position:t.stats.position??"",discreetMode:t.discreetMode===!0,travelEnabled:((a=t.travelMode)==null?void 0:a.enabled)===!0,travelLat:typeof((f=t.travelMode)==null?void 0:f.lat)=="number"?String(t.travelMode.lat):"",travelLng:typeof((l=t.travelMode)==null?void 0:l.lng)=="number"?String(t.travelMode.lng):"",lookingForMore:n.lookingForMore}}function sn(t){const n=t.replace(/\r\n/g,`
`).trim(),a="Looking For More:",f=/Looking For More:\s*/g,l=Array.from(n.matchAll(f));if(l.length===0)return{bio:n,lookingForMore:""};const b=l[0],w=l[l.length-1],S=typeof b.index=="number"?b.index:n.indexOf(a),A=(typeof w.index=="number"?w.index:n.lastIndexOf(a))+w[0].length,R=n.slice(0,Math.max(0,S)).trim(),W=n.slice(Math.max(0,A)).trim();return{bio:R,lookingForMore:W}}function Dn(t,n){const f=sn(t).bio.trim(),l=n.trim();return l?f?`${f}

Looking For More: ${l}`:`${l}`:f}function Yt(t){const n=t.trim();if(!n)return;const a=Number(n);return Number.isFinite(a)?Math.trunc(a):void 0}function Bn(t){const n=t.trim();if(!n)return;const a=Number(n);return Number.isFinite(a)?a:void 0}const mt="reddoor_api_base_path";function Jt(t){const n=t.trim();if(!n)return null;const a=n.toLowerCase();return a==="__local__"||a==="local"||a==="rdlocal"?"__local__":n.startsWith("/")&&!n.startsWith("//")?n.replace(/\/+$/,""):a.startsWith("http://")||a.startsWith("https://")?n.replace(/\/+$/,""):null}function $n({api:t,session:n,setLastError:a}){var ae,he;const[f,l]=s.useState(Wn()),[b,w]=s.useState(null),[S,A]=s.useState(!1),[R,W]=s.useState(!1),[H,N]=s.useState(null),[T,o]=s.useState({});async function h(){A(!0);try{const g=await t.getMyProfile(n.sessionToken);w(g.profile),l(Vt(g.profile)),N("Profile loaded.")}catch(g){const p=g;if((p==null?void 0:p.code)==="PROFILE_NOT_FOUND"){w(null),l(P=>({...P,age:P.age||"18"})),N("No profile yet. Fill out the form and save.");return}N(Y(g))}finally{A(!1)}}s.useEffect(()=>{h()},[n.sessionToken,n.userType]),s.useEffect(()=>{const g=[b==null?void 0:b.mainPhotoMediaId,...(b==null?void 0:b.galleryMediaIds)??[]].filter(P=>typeof P=="string"&&P.length>0);if(g.length===0)return;const p=g.filter(P=>!T[P]);p.length!==0&&Promise.all(p.map(async P=>{try{const ie=await t.getPublicMediaUrl(P);return{id:P,url:ie.downloadUrl}}catch{return null}})).then(P=>{o(ie=>{const z={...ie};for(const se of P)se&&(z[se.id]=se.url);return z})})},[t,T,b==null?void 0:b.galleryMediaIds,b==null?void 0:b.mainPhotoMediaId]);async function M(){var g,p,P,ie,z;W(!0),a(null);try{const se=Number(f.age),I=Dn(f.bio,f.lookingForMore),pe=f.travelLat.trim()?Number(f.travelLat):void 0,ce=f.travelLng.trim()?Number(f.travelLng):void 0,be={displayName:f.displayName,age:Math.trunc(se),bio:I,stats:{heightInches:Yt(f.heightInches),race:f.race.trim()||void 0,cockSizeInches:Bn(f.cockSizeInches),cutStatus:f.cutStatus||void 0,weightLbs:Yt(f.weightLbs),position:f.position||void 0},discreetMode:f.discreetMode,travelMode:{enabled:f.travelEnabled,lat:Number.isFinite(pe)?pe:void 0,lng:Number.isFinite(ce)?ce:void 0}},c=await t.upsertMyProfile(n.sessionToken,be);w(c.profile),l(Vt(c.profile));try{localStorage.setItem("reddoor_travel_center",JSON.stringify({enabled:((g=c.profile.travelMode)==null?void 0:g.enabled)===!0,lat:(p=c.profile.travelMode)==null?void 0:p.lat,lng:(P=c.profile.travelMode)==null?void 0:P.lng})),window.dispatchEvent(new CustomEvent("rd:location-updated",{detail:{lat:(ie=c.profile.travelMode)==null?void 0:ie.lat,lng:(z=c.profile.travelMode)==null?void 0:z.lng}}))}catch{}N("Profile saved.")}catch(se){const I=Y(se);N(I),a(I)}finally{W(!1)}}async function L(g,p){if(!p){N("Choose a file first.");return}if(n.userType==="guest"){N("Guest sessions cannot upload media. Register to persist media.");return}W(!0),a(null);try{const P=await t.initiateMediaUpload(n.sessionToken,{kind:g,mimeType:p.type||(g==="video"?"video/mp4":"image/jpeg"),sizeBytes:p.size});if(!await vt(P.uploadUrl,p,p.type||"application/octet-stream")){const z=await fetch(P.uploadUrl,{method:"PUT",headers:{"content-type":p.type||"application/octet-stream"},body:p});if(!z.ok)throw{message:`Upload failed (${z.status}).`}}await t.completeMediaUpload(n.sessionToken,P.mediaId),await h(),N("Media uploaded.")}catch(P){const ie=Y(P);N(ie),a(ie)}finally{W(!1)}}const[F,J]=s.useState(null),[Q,K]=s.useState(null),[v,k]=s.useState(null);async function te(g){if(b){W(!0);try{const p=(b.galleryMediaIds??[]).filter(ie=>ie!==g),P=await t.updateProfileMediaReferences(n.sessionToken,{galleryMediaIds:p});w(P.profile),N("Gallery updated.")}catch(p){const P=Y(p);N(P),a(P)}finally{W(!1)}}}async function ne(g){if(b){W(!0);try{const p=await t.updateProfileMediaReferences(n.sessionToken,{galleryMediaIds:b.galleryMediaIds,mainPhotoMediaId:g});w(p.profile),N("Main photo updated.")}catch(p){const P=Y(p);N(P),a(P)}finally{W(!1)}}}return e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:14},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"SETTINGS / PROFILE"}),n.userType==="guest"?e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guest profile data is temporary for this session and is removed when you log out."}):null,H?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:H}):null,e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Display Name"}),e.jsx("input",{value:f.displayName,onChange:g=>l(p=>({...p,displayName:g.target.value})),style:Z()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Age"}),e.jsx("input",{value:f.age,onChange:g=>l(p=>({...p,age:g.target.value})),style:Z(),inputMode:"numeric"})]})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Bio"}),e.jsx("textarea",{value:f.bio,onChange:g=>l(p=>({...p,bio:g.target.value})),style:{...Z(),minHeight:88,resize:"vertical"}})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Looking For More (Optional)"}),e.jsx("textarea",{value:f.lookingForMore,onChange:g=>l(p=>({...p,lookingForMore:g.target.value})),style:{...Z(),minHeight:72,resize:"vertical"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:f.discreetMode,onChange:g=>l(p=>({...p,discreetMode:g.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0,fontSize:13},children:"Discreet Mode (hide profile from others)"})]}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:f.travelEnabled,onChange:g=>l(p=>({...p,travelEnabled:g.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Travel Mode"})]})]}),f.travelEnabled?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Travel Lat"}),e.jsx("input",{value:f.travelLat,onChange:g=>l(p=>({...p,travelLat:g.target.value})),style:Z()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Travel Lng"}),e.jsx("input",{value:f.travelLng,onChange:g=>l(p=>({...p,travelLng:g.target.value})),style:Z()})]})]}):null,e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Height (in)"}),e.jsx("input",{value:f.heightInches,onChange:g=>l(p=>({...p,heightInches:g.target.value})),style:Z(),inputMode:"numeric"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Race"}),e.jsx("input",{value:f.race,onChange:g=>l(p=>({...p,race:g.target.value})),style:Z()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Cock Size (in)"}),e.jsx("input",{value:f.cockSizeInches,onChange:g=>l(p=>({...p,cockSizeInches:g.target.value})),style:Z(),inputMode:"decimal"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Cut / Uncut"}),e.jsxs("select",{value:f.cutStatus,onChange:g=>l(p=>({...p,cutStatus:g.target.value})),style:Z(),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"cut",children:"Cut"}),e.jsx("option",{value:"uncut",children:"Uncut"})]})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Weight (lbs)"}),e.jsx("input",{value:f.weightLbs,onChange:g=>l(p=>({...p,weightLbs:g.target.value})),style:Z(),inputMode:"numeric"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Position"}),e.jsxs("select",{value:f.position,onChange:g=>l(p=>({...p,position:g.target.value})),style:Z(),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"top",children:"Top"}),e.jsx("option",{value:"bottom",children:"Bottom"}),e.jsx("option",{value:"side",children:"Side"})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",onClick:()=>void M(),style:me(R),disabled:R,children:"SAVE PROFILE"}),e.jsx("button",{type:"button",onClick:()=>void h(),style:D(S),disabled:S,children:"REFRESH"})]})]})}),e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"MEDIA"}),e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"Main profile photo, gallery photo, and video uploads."}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Main Photo"}),e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:g=>{var p;return J(((p=g.target.files)==null?void 0:p[0])??null)}})]}),e.jsx("button",{type:"button",style:me(R),disabled:R,onClick:()=>void L("photo_main",F),children:"UPLOAD MAIN PHOTO"})]}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Gallery Photo"}),e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:g=>{var p;return K(((p=g.target.files)==null?void 0:p[0])??null)}})]}),e.jsx("button",{type:"button",style:me(R),disabled:R,onClick:()=>void L("photo_gallery",Q),children:"UPLOAD GALLERY PHOTO"})]}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Video"}),e.jsx("input",{className:"rd-input",type:"file",accept:"video/*",onChange:g=>{var p;return k(((p=g.target.files)==null?void 0:p[0])??null)}})]}),e.jsx("button",{type:"button",style:me(R),disabled:R,onClick:()=>void L("video",v),children:"UPLOAD VIDEO"})]}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13},children:["Main photo media id: ",(b==null?void 0:b.mainPhotoMediaId)??"-",e.jsx("br",{}),"Gallery count: ",((ae=b==null?void 0:b.galleryMediaIds)==null?void 0:ae.length)??0,e.jsx("br",{}),"Video media id: ",(b==null?void 0:b.videoMediaId)??"-"]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"YOUR GALLERY"}),(he=b==null?void 0:b.galleryMediaIds)!=null&&he.length?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(130px, 1fr))",gap:10},children:b.galleryMediaIds.map(g=>e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.45)",borderRadius:10,padding:8,display:"grid",gap:8},children:[e.jsx("img",{src:T[g]??Be(g),alt:"Gallery photo",style:{width:"100%",aspectRatio:"1/1",objectFit:"cover",borderRadius:8,border:"1px solid rgba(255,58,77,0.4)"}}),e.jsx("button",{type:"button",style:D(R),disabled:R,onClick:()=>void ne(g),children:"SET MAIN"}),e.jsx("button",{type:"button",style:D(R),disabled:R,onClick:()=>void te(g),children:"REMOVE"})]},g))}):e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No gallery photos uploaded yet."})]})]})})]})}function Hn({api:t,session:n,setLastError:a,onLogout:f}){const[l,b]=s.useState({discreetMode:!1,travelEnabled:!1,travelLat:"",travelLng:""}),[w,S]=s.useState("Loading settings..."),[A,R]=s.useState("__local__"),[W,H]=s.useState(!1),[N,T]=s.useState([]);async function o(){var v,k,te;try{const ne=await t.getMyProfile(n.sessionToken);b({discreetMode:ne.profile.discreetMode===!0,travelEnabled:((v=ne.profile.travelMode)==null?void 0:v.enabled)===!0,travelLat:typeof((k=ne.profile.travelMode)==null?void 0:k.lat)=="number"?String(ne.profile.travelMode.lat):"",travelLng:typeof((te=ne.profile.travelMode)==null?void 0:te.lng)=="number"?String(ne.profile.travelMode.lng):""}),S("Settings loaded.");try{const ae=localStorage.getItem(mt)??"",he=Jt(ae);R(he??"__local__")}catch{R("__local__")}if(n.userType!=="guest")try{const ae=await t.listBlocked(n.sessionToken);T(ae.blocked)}catch{T([])}else T([])}catch(ne){S(Y(ne))}}async function h(){try{const v=await fetch("/api/config"),k=await v.json();if(!v.ok)throw k;H(k.mediaStorageConfigured===!0)}catch{H(!1)}}s.useEffect(()=>{o(),h()},[n.sessionToken,n.userType]);async function M(){try{const v=await t.getMyProfile(n.sessionToken),k=l.travelLat.trim()?Number(l.travelLat):void 0,te=l.travelLng.trim()?Number(l.travelLng):void 0;await t.upsertMyProfile(n.sessionToken,{displayName:v.profile.displayName,age:v.profile.age,bio:v.profile.bio,stats:v.profile.stats,discreetMode:l.discreetMode,travelMode:{enabled:l.travelEnabled,lat:Number.isFinite(k)?k:void 0,lng:Number.isFinite(te)?te:void 0}}),S("Privacy settings saved.")}catch(v){const k=Y(v);S(k),a(k)}}async function L(){if(!navigator.geolocation){const v="Geolocation is unavailable on this device.";S(v),a(v);return}try{const v=await new Promise((ne,ae)=>{navigator.geolocation.getCurrentPosition(ne,ae,{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})}),k=Number(v.coords.latitude.toFixed(6)),te=Number(v.coords.longitude.toFixed(6));b(ne=>({...ne,travelEnabled:!0,travelLat:String(k),travelLng:String(te)}));try{localStorage.setItem("reddoor_travel_center",JSON.stringify({enabled:!0,lat:k,lng:te}))}catch{}try{await t.updatePresence(n.sessionToken,k,te,"online")}catch{}window.dispatchEvent(new CustomEvent("rd:location-updated",{detail:{lat:k,lng:te}})),S("Actual location detected. Save privacy settings to persist it.")}catch(v){const k=Y(v);S(k),a(k)}}async function F(){try{const v=l.travelLat.trim()?Number(l.travelLat):void 0,k=l.travelLng.trim()?Number(l.travelLng):void 0,te=await t.seedFakeUsers(12,Number.isFinite(v)?v:void 0,Number.isFinite(k)?k:void 0);S(`Seeded ${te.seededCount} fake users for testing.`)}catch(v){const k=Y(v);S(k),a(k)}}function J(){const v=Jt(A);if(!v){const k="Invalid API base path. Use __local__, /api, or a full https:// URL.";S(k),a(k);return}try{localStorage.setItem(mt,v)}catch{const k="Unable to store API setting in this browser.";S(k),a(k);return}S(`Saved API mode (${v}). Reloading...`),window.setTimeout(()=>window.location.reload(),150)}function Q(){try{localStorage.removeItem(mt)}catch{}R("__local__"),S("API mode reset to local for this site. Reloading..."),window.setTimeout(()=>window.location.reload(),150)}async function K(v){try{await t.unblock(n.sessionToken,v);const k=await t.listBlocked(n.sessionToken);T(k.blocked),S("Blocked users updated.")}catch(k){const te=Y(k);S(te),a(te)}}return e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"SETTINGS"}),e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:w}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:l.discreetMode,onChange:v=>b(k=>({...k,discreetMode:v.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Discreet Mode (hide your profile)"})]}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:l.travelEnabled,onChange:v=>b(k=>({...k,travelEnabled:v.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Travel Mode"})]}),l.travelEnabled?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("input",{value:l.travelLat,onChange:v=>b(k=>({...k,travelLat:v.target.value})),style:Z(),placeholder:"Travel lat"}),e.jsx("input",{value:l.travelLng,onChange:v=>b(k=>({...k,travelLng:v.target.value})),style:Z(),placeholder:"Travel lng"})]}):null,e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:me(!1),onClick:()=>void M(),children:"SAVE PRIVACY"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void L(),children:"DETECT ACTUAL LOCATION"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void F(),children:"SEED FAKE USERS"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>f==null?void 0:f(),children:"LOGOUT"})]})]})}),e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"DATA MODE"}),e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Local mode keeps ads/spots only in this browser. To share data for everyone, set a shared backend API URL."}),e.jsx("input",{value:A,onChange:v=>R(v.target.value),style:Z(),placeholder:"__local__ or https://api.example.com"}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:me(!1),onClick:J,children:"SAVE DATA MODE"}),e.jsx("button",{type:"button",style:D(!1),onClick:Q,children:"RESET TO LOCAL"})]})]})}),e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"MEDIA STORAGE"}),e.jsx("div",{style:{color:W?"#26d5ff":"#ff8a95",fontSize:14},children:W?"Configured: uploads enabled.":"Not configured: set S3_BUCKET, S3_REGION, S3_ACCESS_KEY_ID, S3_SECRET_ACCESS_KEY."}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void h(),children:"REFRESH STORAGE STATUS"})]})}),n.userType!=="guest"?e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"BLOCKED USERS"}),N.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No blocked users."}):N.map(v=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[e.jsx("div",{style:{color:"#ced3dc",fontSize:14},children:v}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void K(v),children:"UNBLOCK"})]},v))]})}):null]})}function Vn({api:t,session:n,setSession:a,settings:f,activeTab:l,setActiveTab:b,discoverScreen:w,onDiscoverScreenChange:S,discoverFilter:A,busy:R,setBusy:W,setLastError:H,onUnreadCountChange:N,hideModeCard:T,onLogout:o}){const h=En(),[M,L]=s.useState(null),F=e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx($n,{api:t,session:n,setLastError:H}),e.jsx(Hn,{api:t,session:n,setLastError:H,onLogout:o})]});return e.jsxs("div",{style:{display:"grid",gap:12},children:[null,e.jsx("div",{style:{display:l==="discover"?"block":"none"},children:e.jsx(Fn,{api:t,session:n,settings:f,discoverFilter:A,busy:R,setBusy:W,setLastError:H,isMobile:h,discoverScreen:w,onDiscoverScreenChange:S,onOpenThreadRequested:J=>{L({key:Ce(J),nonce:Date.now()}),b("threads")},onUnreadCountChange:N})}),l==="threads"?e.jsx(On,{api:t,session:n,setLastError:H,openThreadRequest:M,onThreadRequestConsumed:()=>L(null),isMobile:h}):null,l==="public"?e.jsx(Ln,{api:t,session:n,isMobile:h,setLastError:H}):null,l==="profile"||l==="settings"?F:null,l==="submissions"?e.jsx(Kn,{api:t,session:n,setLastError:H}):null,l==="promoted"?e.jsx(_n,{api:t,session:n,setLastError:H}):null]})}export{Vn as Router};
