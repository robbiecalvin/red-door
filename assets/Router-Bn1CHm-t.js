const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./maplibre-gl-DBXL5tb4.js","./index-C6gsQwpl.js","./index-D_xfmmRC.css"])))=>i.map(i=>d[i]);
import{r as s,j as e,_ as pn,p as Yt,a as Jt,b as qt,u as pt}from"./index-C6gsQwpl.js";function Qt(t){return typeof t=="object"&&t!==null}function yn(t){return!(!Qt(t)||typeof t.key!="string"||t.userType!=="guest"&&t.userType!=="registered"&&t.userType!=="subscriber"||typeof t.lat!="number"||!Number.isFinite(t.lat)||typeof t.lng!="number"||!Number.isFinite(t.lng)||typeof t.updatedAtMs!="number"||!Number.isFinite(t.updatedAtMs)||t.status!==void 0&&typeof t.status!="string")}function Xt(t){const[n,r]=s.useState(()=>new Map),[d,l]=s.useState(null),v=s.useRef(null),S=s.useRef(null);return s.useEffect(()=>{if(t.disabled===!0||t.wsUrl.trim()===""){r(new Map),l(null),S.current!==null&&(window.clearTimeout(S.current),S.current=null);return}let R=!1,z=0,H=null;const _=()=>{H!==null&&(window.clearInterval(H),H=null)},F=()=>{if(R)return;const a=Math.min(8e3,500*2**Math.min(z,4));S.current=window.setTimeout(()=>{S.current=null,P()},a)},P=()=>{if(R)return;let a;try{a=new WebSocket(t.wsUrl)}catch{z+=1,l("Realtime unavailable in this mode."),F();return}v.current=a;let x=!1;a.onopen=()=>{x=!0,z=0,l(null);const M={};t.sessionToken&&(M.sessionToken=t.sessionToken),t.jwt&&(M.jwt=t.jwt),a.send(JSON.stringify({type:"auth",payload:M})),H=window.setInterval(()=>{a.readyState===a.OPEN&&a.send(JSON.stringify({type:"heartbeat",payload:{}}))},15e3)},a.onmessage=M=>{const b=(()=>{try{return JSON.parse(String(M.data))}catch{return null}})();if(!b||typeof b.type!="string"){l("Invalid server message.");return}if(b.type==="error"&&Qt(b.payload)&&typeof b.payload.message=="string"){l(b.payload.message);return}if(b.type==="presence_update"){const m=b.payload;if(!yn(m)){l("Invalid presence payload.");return}r(L=>{const W=new Map(L);return W.set(m.key,m),W})}},a.onerror=()=>{},a.onclose=M=>{if(_(),!R&&M.code!==1e3){z+=1;const b=typeof M.reason=="string"&&M.reason.trim()!==""?` Reason: ${M.reason}`:"";(z>=2||x)&&l(`Realtime ${x?"disconnected":"failed to connect"} (code ${M.code}). Reconnecting...${b}`),F()}}};return P(),()=>{var a;R=!0,_(),S.current!==null&&(window.clearTimeout(S.current),S.current=null),(a=v.current)==null||a.close(1e3,"Client cleanup"),v.current=null}},[t.disabled,t.jwt,t.sessionToken,t.wsUrl]),{state:s.useMemo(()=>({byKey:n}),[n]),lastErrorMessage:d}}async function hn(){const t=await pn(()=>import("./maplibre-gl-DBXL5tb4.js").then(r=>r.m),__vite__mapDeps([0,1,2]),import.meta.url);return t.default??t}function mn(t){return t.replace(/[&<>"']/g,n=>{switch(n){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return n}})}function bn(){return{version:8,sources:{basemap:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png","https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"Â© OpenStreetMap contributors"}},layers:[{id:"basemap",type:"raster",source:"basemap"}]}}function vn(t){const n=document.createElement("button");return n.type="button",n.setAttribute("aria-label",t.label??"Presence marker"),n.style.width="40px",n.style.height="40px",n.style.borderRadius="999px",n.style.border=`2px solid ${t.color}`,n.style.touchAction="manipulation",n.style.userSelect="none",t.markerType==="spot"?(n.style.background="radial-gradient(circle at 30% 30%, #ff4f60, #a70013)",n.style.display="grid",n.style.placeItems="center",n.style.color="#ffffff",n.style.fontWeight="700",n.style.fontSize="13px",n.textContent=typeof t.markerGlyph=="string"&&t.markerGlyph.trim()?t.markerGlyph.trim().slice(0,2):"SP"):typeof t.imageUrl=="string"&&t.imageUrl.trim()!==""?(n.style.backgroundImage=`url("${t.imageUrl}")`,n.style.backgroundSize="cover",n.style.backgroundPosition="center"):n.style.background="#000000",n.style.padding="0",n.style.cursor=typeof t.onClick=="function"?"pointer":"default",n.style.pointerEvents="auto",n}function xn({initialView:t,markers:n,interactive:r,visible:d}){const l=s.useRef(null),v=s.useRef(null),S=s.useRef(null),C=s.useRef([]),[R,z]=s.useState({kind:"ready"}),H=s.useMemo(()=>t.center,[t.center]),_=r!==!1,F=d!==!1;return s.useEffect(()=>{let P=!1,a=null,x=null,M=null;async function b(){if(l.current&&!S.current)try{v.current||(v.current=await hn());const m=v.current,L=new m.Map({container:l.current,style:bn(),center:[H.lng,H.lat],zoom:t.zoom,interactive:_});L.addControl(new m.NavigationControl({showCompass:!1}),"top-right"),S.current=L;const W=()=>{L.resize()};x=W,M=window.requestAnimationFrame(W),window.addEventListener("resize",W),a=new ResizeObserver(()=>W()),a.observe(l.current),L.on("error",O=>{var ce;const ae=((ce=O.error)==null?void 0:ce.message)??"Map error.";P||ae.toLowerCase().includes("failed to fetch")||ae.toLowerCase().includes("network")||z({kind:"error",message:ae})}),L.once("load",()=>{P||z({kind:"ready"})})}catch(m){if(P)return;z({kind:"error",message:m instanceof Error?m.message:"Map error."})}}return b(),()=>{var m;P=!0,M!==null&&window.cancelAnimationFrame(M),x&&window.removeEventListener("resize",x),a==null||a.disconnect();for(const L of C.current)L.remove();C.current=[],(m=S.current)==null||m.remove(),S.current=null}},[_]),s.useEffect(()=>{const P=S.current;if(!P||!F)return;P.resize();const a=window.setTimeout(()=>{P.resize(),P.setCenter([t.center.lng,t.center.lat]),P.setZoom(t.zoom)},80);return()=>window.clearTimeout(a)},[t.center.lat,t.center.lng,t.zoom,F]),s.useEffect(()=>{const P=S.current;if(!P||!F)return;P.resize();const a=window.setTimeout(()=>P.resize(),120);return()=>window.clearTimeout(a)},[F]),s.useEffect(()=>{const P=S.current,a=v.current;if(!(!P||!a)){for(const x of C.current)x.remove();C.current=[];for(const x of n){const M=typeof x.label=="string"&&x.label.trim()!==""?new a.Popup({closeButton:!1,closeOnClick:!0}).setHTML(`<div style="font-family: var(--ui); font-size: 12px; line-height: 1.35;">
                 <div style="font-weight: 600;">${mn(x.label)}</div>
               </div>`):void 0,b=vn(x);if(typeof x.onClick=="function"){const L=W=>{var O;W.preventDefault(),W.stopPropagation(),(O=x.onClick)==null||O.call(x)};b.addEventListener("click",L),b.addEventListener("touchend",L,{passive:!1}),b.addEventListener("pointerup",L)}const m=new a.Marker({element:b}).setLngLat([x.position.lng,x.position.lat]);M&&m.setPopup(M),m.addTo(P),C.current.push(m)}}},[n]),R.kind==="error"?e.jsxs("div",{style:{background:"#000000",color:"#F22F2F",border:"2px solid #C00000",borderRadius:8,padding:12,fontFamily:"var(--ui)",fontSize:14,lineHeight:1.4},role:"alert","aria-live":"polite",children:["Map error: ",R.message]}):e.jsx("div",{ref:l,className:"rd-maplibre",style:{width:"100%",height:"100%",background:"#000000",borderRadius:8,overflow:"hidden"},"aria-label":"Cruise map"})}const Dt=[Yt,Jt,qt];function jn(t){let n=0;for(let r=0;r<t.length;r+=1)n=n*31+t.charCodeAt(r)|0;return Math.abs(n)}function wn(t){return Dt[jn(t)%Dt.length]}function Sn(t,n,r){return t.map(d=>({id:d.key,position:{lat:d.lat,lng:d.lng},color:"#C00000",label:d.status?`Presence: ${d.status}`:"Presence",imageUrl:(n==null?void 0:n[d.key])??wn(d.key),onClick:r?()=>r(d.key):void 0}))}function Bt({wsUrl:t,sessionToken:n,jwt:r,defaultCenter:d,defaultZoom:l,presenceUpdates:v,realtimeErrorMessage:S,onMarkerSelect:C,avatarByKey:R,additionalMarkers:z,height:H,visible:_}){const F=Xt({wsUrl:t,sessionToken:n,jwt:r,disabled:Array.isArray(v)}),P=v?{byKey:new Map(v.map(O=>[O.key,O]))}:F.state,a=S??F.lastErrorMessage,[x,M]=s.useState({kind:"pending"});s.useEffect(()=>{if(!("geolocation"in navigator)||!navigator.geolocation){M({kind:"unavailable"});return}navigator.geolocation.getCurrentPosition(O=>{M({kind:"granted",center:{lat:O.coords.latitude,lng:O.coords.longitude}})},O=>{if(O.code===O.PERMISSION_DENIED){M({kind:"denied"});return}if(O.code===O.TIMEOUT){M({kind:"error",message:"Timed out while trying to read your location. Showing the default map view."});return}M({kind:"error",message:O.message||"Geolocation error."})},{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e4})},[]);const b=s.useMemo(()=>Array.from(P.byKey.values()),[P.byKey]),m=s.useMemo(()=>[...Sn(b,R,C),...z??[]],[z,R,C,b]),L=s.useMemo(()=>{const O=typeof l=="number"&&Number.isFinite(l)?l:13;return x.kind==="granted"?{center:x.center,zoom:O}:{center:d,zoom:O}},[d,l,x]),W=s.useMemo(()=>x.kind==="denied"?"Location permission denied. Showing the default map view.":x.kind==="unavailable"?"Geolocation is unavailable. Showing the default map view.":x.kind==="error"?`Geolocation error: ${x.message}`:null,[x]);return e.jsxs("section",{"aria-label":"Cruise mode map",style:{background:"#000000",color:"#FFFFFF",fontFamily:"var(--ui)",display:"grid",gap:8,height:"100%"},children:[W?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"rgba(0,0,0,0.7)",border:"1px solid rgba(255,58,77,0.45)",borderRadius:0,padding:8,color:"#AAAAAA",fontSize:12,lineHeight:1.4},children:W}):null,a?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"rgba(0,0,0,0.7)",border:"1px solid rgba(255,58,77,0.45)",borderRadius:0,padding:8,color:"#F22F2F",fontSize:12,lineHeight:1.4},children:a}):null,e.jsx("div",{style:{background:"#111111",border:0,borderRadius:0,overflow:"hidden",height:typeof H=="number"||typeof H=="string"?H:520},children:e.jsx(xn,{initialView:L,markers:m,visible:_})})]})}const kn="FIRE_SIGNAL|1";function In(t){return new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function $t(t){if(!t.startsWith("LOCATION|"))return null;const[,n,r]=t.split("|"),d=Number(n),l=Number(r);return!Number.isFinite(d)||!Number.isFinite(l)?null:{lat:d,lng:l,link:`https://maps.google.com/?q=${d},${l}`}}function Cn(t){return t.trim()===kn?"ðŸ”¥ I'm into you":t}function Zt({chatKind:t,peerKey:n,currentUserKey:r,messages:d,client:l,title:v,peerSummary:S,thirdParty:C,edgeToEdge:R,showHeader:z,fillHeight:H}){const[_,F]=s.useState(""),[P,a]=s.useState(null),[x,M]=s.useState(!1),[b,m]=s.useState({}),[L,W]=s.useState(!1),[O,ae]=s.useState(!1),ce=s.useRef(null),Se=s.useRef([]),he=s.useRef(null),ge=s.useRef(null),xe=s.useRef(null),p=R===!0,h=z!==!1,N=p&&H===!0,ne=s.useMemo(()=>[...d].sort((c,D)=>c.createdAtMs-D.createdAtMs),[d]),K=s.useMemo(()=>Array.from(new Set(ne.map(c=>{var D;return(D=c.media)==null?void 0:D.objectKey}).filter(c=>typeof c=="string"&&c.trim().length>0))),[ne]);s.useEffect(()=>{let c=!1;async function D(){for(const f of K){if(c)return;if(!b[f])try{const A=await l.getMediaUrl(f);if(c)return;m($=>({...$,[f]:A}))}catch{}}}return D(),()=>{c=!0}},[l,K,b]);async function Z(c){const D=_.trim();if(!(D.length===0&&!c)){M(!0),a(null);try{await l.sendMessage(t,n,D,c),F("")}catch(f){const A=f;a(typeof(A==null?void 0:A.message)=="string"?A.message:"Message rejected.")}finally{M(!1)}}}async function k(c){M(!0),a(null);try{const D=await l.initiateMediaUpload(c.type||"application/octet-stream",c.size);await l.uploadToSignedUrl(D.uploadUrl,c,c.type||"application/octet-stream");const A={kind:c.type.startsWith("image/")?"image":c.type.startsWith("video/")?"video":"audio",objectKey:D.objectKey,mimeType:c.type||"application/octet-stream"};await Z(A)}catch(D){const f=D;a(typeof(f==null?void 0:f.message)=="string"?f.message:"Upload rejected."),M(!1)}}async function ye(c){var f;const D=(f=c.target.files)==null?void 0:f[0];if(c.target.value="",!!D){if(!D.type.startsWith("image/")&&!D.type.startsWith("video/")&&!D.type.startsWith("audio/")){a("Only image, video, or audio files are supported.");return}await k(D)}}async function oe(){var c;if(L){(c=ce.current)==null||c.stop();return}if(!navigator.mediaDevices||typeof navigator.mediaDevices.getUserMedia!="function"){a("Microphone is not available in this browser.");return}try{const D=await navigator.mediaDevices.getUserMedia({audio:!0}),f=new MediaRecorder(D);Se.current=[],ce.current=f,f.ondataavailable=A=>{A.data.size>0&&Se.current.push(A.data)},f.onstop=()=>{const A=new Blob(Se.current,{type:f.mimeType||"audio/webm"}),$=new File([A],`voice-${Date.now()}.webm`,{type:f.mimeType||"audio/webm"});k($);for(const pe of D.getTracks())pe.stop();ce.current=null,W(!1)},f.start(),W(!0)}catch(D){const f=D;a(typeof(f==null?void 0:f.message)=="string"?f.message:"Unable to record voice."),W(!1)}}async function me(){if(!navigator.geolocation){a("Geolocation is not available in this browser.");return}M(!0),a(null);try{const c=await new Promise(($,pe)=>{navigator.geolocation.getCurrentPosition($,pe,{enableHighAccuracy:!1,timeout:12e3,maximumAge:3e4})}),D=Number(c.coords.latitude.toFixed(5)),f=Number(c.coords.longitude.toFixed(5)),A=`LOCATION|${D}|${f}`;await l.sendMessage(t,n,A)}catch(c){const D=c;a(typeof(D==null?void 0:D.message)=="string"?D.message:"Unable to send location.")}finally{M(!1)}}return e.jsxs("section",{"aria-label":"Chat",style:{background:p?"transparent":"#000000",color:"#FFFFFF",fontFamily:"Montserrat, sans-serif",padding:p?0:16,display:"grid",gap:p?0:12,gridTemplateRows:h?"auto auto 1fr auto":"1fr auto",minHeight:H?"calc(100dvh - 196px)":void 0},children:[h?e.jsxs("header",{style:{height:56,display:"grid",alignItems:"center",background:"#000000"},children:[e.jsx("div",{style:{textAlign:"center",fontSize:20,fontWeight:600},children:v}),S?e.jsxs("div",{style:{marginTop:4,display:"flex",alignItems:"center",justifyContent:"center",gap:8,color:"#b7d8e0",fontSize:13},children:[e.jsx("span",{children:"Chat with:"}),S.avatarUrl?e.jsx("img",{src:S.avatarUrl,alt:`${S.displayName} avatar`,style:{width:24,height:24,borderRadius:"50%",objectFit:"cover",border:"1px solid rgba(38,213,255,0.8)"}}):e.jsx("span",{"aria-hidden":!0,style:{width:24,height:24,borderRadius:"50%",border:"1px solid rgba(38,213,255,0.8)",background:"rgba(255,255,255,0.08)"}}),e.jsx("span",{style:{color:"#fff",fontWeight:600},children:S.displayName})]}):null,e.jsx("div",{style:{textAlign:"center",fontSize:12,color:"#AAAAAA"},children:t==="cruise"?"CRUISE CHAT (EPHEMERAL)":"DATE CHAT (PERSISTENT)"})]}):null,P?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"#111111",border:"2px solid #C00000",borderRadius:8,padding:12,color:"#F22F2F",fontSize:14,lineHeight:1.4},children:P}):null,e.jsx("div",{"aria-label":"Messages",style:{background:p?"#09090b":"#111111",border:p?"none":"2px solid #C00000",borderRadius:p?0:8,padding:12,display:"flex",flexDirection:"column",gap:12,minHeight:p?0:320,paddingBottom:N?148:12,overflowY:"auto"},children:ne.length===0?e.jsx("div",{style:{color:"#AAAAAA",fontSize:14,lineHeight:1.4},children:"No messages."}):ne.map(c=>{const D=c.fromKey===r,f=D?"#C00000":"#444444",A=D?{alignItems:"flex-end"}:{alignItems:"flex-start"};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,width:"100%",...A},children:[(()=>{const $=$t(c.text??"");return $?e.jsxs("a",{href:$.link,target:"_blank",rel:"noreferrer",style:{display:"grid",gap:6,textDecoration:"none",color:"#fff",background:f,borderRadius:14,padding:8,width:"auto",maxWidth:"80%"},children:[e.jsx("div",{style:{fontSize:12,color:"#d8ecff"},children:"Shared location"}),e.jsx("iframe",{title:"Google Maps location preview",src:`https://www.google.com/maps?q=${$.lat},${$.lng}&z=14&output=embed`,style:{width:"100%",height:140,border:"1px solid rgba(255,255,255,0.18)",borderRadius:10},loading:"lazy",referrerPolicy:"no-referrer-when-downgrade"}),e.jsx("div",{style:{fontSize:12,color:"#3fdfff"},children:"Open in Google Maps"})]}):null})(),e.jsxs("div",{style:{background:f,color:"#FFFFFF",borderRadius:18,padding:"8px 12px",width:"auto",maxWidth:"80%",fontSize:16,lineHeight:1.4,whiteSpace:"pre-wrap",overflowWrap:"anywhere",wordBreak:"break-word"},children:[c.text&&!$t(c.text)?e.jsx("div",{style:{marginBottom:c.media?8:0},children:Cn(c.text)}):null,c.media?e.jsxs("div",{children:[c.media.kind==="image"?e.jsx("img",{src:b[c.media.objectKey],alt:"Shared",style:{width:"100%",maxWidth:260,borderRadius:10,border:"1px solid rgba(255,255,255,0.18)"}}):null,c.media.kind==="video"?e.jsx("video",{controls:!0,playsInline:!0,src:b[c.media.objectKey],style:{width:"100%",maxWidth:320,borderRadius:10,background:"#000"}}):null,c.media.kind==="audio"?e.jsx("audio",{controls:!0,src:b[c.media.objectKey],style:{width:"100%",maxWidth:260}}):null]}):null]}),e.jsx("div",{style:{fontSize:10,color:"#AAAAAA"},children:In(c.createdAtMs)}),D?e.jsx("div",{style:{fontSize:10,color:"#6fdcff"},children:typeof c.readAtMs=="number"?"Read":typeof c.deliveredAtMs=="number"?"Delivered":""}):null]},c.messageId)})}),e.jsxs("form",{onSubmit:c=>{c.preventDefault(),Z()},"aria-label":"Message input",style:{background:p?"linear-gradient(180deg, rgba(96,0,12,0.96), rgba(58,0,8,0.98))":"#111111",border:p?"none":"2px solid #C00000",borderRadius:p?0:8,padding:12,display:"grid",gridTemplateColumns:"1fr auto auto",gap:12,alignItems:"start",position:N?"fixed":"static",left:N?0:void 0,right:N?0:void 0,bottom:N?"calc(env(safe-area-inset-bottom, 0px) + 66px)":void 0,zIndex:N?45:void 0},children:[e.jsx("label",{style:{display:"grid"},children:e.jsx("input",{value:_,onChange:c=>F(c.target.value),placeholder:"Type a message",disabled:x,style:{width:"100%",background:"#111111",color:"#FFFFFF",border:"2px solid #444444",borderRadius:8,padding:"10px 12px",fontSize:16,lineHeight:1.4,outline:"none"},"aria-label":"Message text"})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{ref:he,type:"file",accept:"image/*,video/*,audio/*",disabled:x,onChange:c=>void ye(c),style:{display:"none"}}),e.jsx("input",{ref:ge,type:"file",accept:"image/*",capture:"environment",disabled:x,onChange:c=>void ye(c),style:{display:"none"}}),e.jsx("input",{ref:xe,type:"file",accept:"video/*",capture:"environment",disabled:x,onChange:c=>void ye(c),style:{display:"none"}}),e.jsx("button",{type:"button",disabled:x,onClick:()=>ae(c=>!c),style:{background:"rgba(0,0,0,0.45)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px",display:"grid",placeItems:"center",cursor:x?"not-allowed":"pointer",color:"#3fdfff",fontWeight:700,height:44,minWidth:44},"aria-label":"More actions",children:"+"}),O?e.jsxs("div",{style:{position:"absolute",right:0,top:N?void 0:48,bottom:N?48:void 0,zIndex:5,minWidth:220,display:"grid",gap:8,padding:10,borderRadius:10,border:"1px solid rgba(255,58,77,0.5)",background:"rgba(10,11,16,0.98)"},children:[e.jsx("button",{type:"button",disabled:x,onClick:()=>{var c;ae(!1),(c=ge.current)==null||c.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Take Photo"}),e.jsx("button",{type:"button",disabled:x,onClick:()=>{var c;ae(!1),(c=xe.current)==null||c.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Record Video"}),e.jsx("button",{type:"button",disabled:x,onClick:()=>{var c;ae(!1),(c=he.current)==null||c.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Choose Media"}),e.jsx("button",{type:"button",disabled:x,onClick:()=>{ae(!1),oe()},style:{background:L?"#ff2136":"rgba(0,0,0,0.6)",color:"#fff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:L?"Stop Voice":"Record Voice"}),e.jsx("button",{type:"button",disabled:x,onClick:()=>{ae(!1),me()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Send Location"}),C?e.jsxs("div",{style:{display:"grid",gap:8,borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:8},children:[e.jsxs("select",{value:C.selectedKey,onChange:c=>C.onSelect(c.target.value),disabled:C.disabled||C.candidates.length===0,style:{background:"#0b0d12",color:"#fff",border:"1px solid rgba(255,58,77,0.62)",borderRadius:10,padding:"8px 10px"},"aria-label":"Add previous contact to group",children:[C.candidates.length===0?e.jsx("option",{value:"",children:"No previous contacts"}):null,C.candidates.map(c=>e.jsx("option",{value:c.key,children:c.label},c.key))]}),e.jsx("button",{type:"button",onClick:()=>{C.onAdd(),ae(!1)},disabled:C.disabled||C.candidates.length===0||!C.selectedKey,style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,58,77,0.62)",borderRadius:10,padding:"8px 10px",fontWeight:700},children:"Add Third User"})]}):null]}):null]}),e.jsx("button",{type:"submit",disabled:x,style:{background:x?"#333333":"#C00000",color:x?"#777777":"#FFFFFF",border:"2px solid #C00000",borderRadius:8,padding:"10px 20px",fontSize:16,fontWeight:600,cursor:x?"not-allowed":"pointer",height:44},"aria-label":"Send message",children:"SEND"})]})]})}const bt="FIRE_SIGNAL|1";function Be(){return{background:"radial-gradient(500px 220px at 10% 0%, rgba(255,28,46,0.15), transparent 58%), linear-gradient(180deg, rgba(8,8,10,0.88), rgba(4,4,5,0.9))",border:"1px solid rgba(255,56,74,0.56)",borderRadius:20,padding:14,boxShadow:"inset 0 1px 0 rgba(255,255,255,0.06), inset 0 0 0 1px rgba(0,0,0,0.28), 0 16px 32px rgba(0,0,0,0.42)"}}function ke(t){return{background:t?"rgba(90,90,90,0.55)":"linear-gradient(180deg, #ff2136, #c60012)",border:"1px solid rgba(255,70,90,0.68)",color:t?"#999999":"#FFFFFF",padding:"10px 18px",borderRadius:12,fontSize:15,fontWeight:700,letterSpacing:"0.04em",cursor:t?"not-allowed":"pointer",textTransform:"uppercase",boxShadow:t?"none":"inset 0 1px 0 rgba(255,255,255,0.2), 0 10px 22px rgba(198,0,18,0.34)"}}function B(t){return{background:"rgba(0,0,0,0.58)",border:"1px solid rgba(255,58,77,0.62)",color:"#3fdfff",padding:"10px 18px",borderRadius:12,fontSize:15,fontWeight:700,letterSpacing:"0.03em",cursor:t?"not-allowed":"pointer",textTransform:"uppercase",opacity:t?.6:1}}function ee(){return{background:"rgba(6,7,10,0.92)",color:"#ffffff",border:"1px solid rgba(255,64,82,0.48)",borderRadius:12,padding:"10px 12px",fontSize:15}}function Tn(t){return typeof t=="string"}function q(t){const n=t;return Tn(n==null?void 0:n.message)?n.message:"Action rejected."}function ft(){const t="__disabled__".trim();if(t==="__disabled__")return"";if(t!==""){if(t.startsWith("ws://")||t.startsWith("wss://"))return t;try{const r=new URL(t);return r.protocol=r.protocol==="https:"?"wss:":"ws:",r.toString()}catch{if(t.startsWith("/")){const r=new URL(t,window.location.origin);return r.protocol=r.protocol==="https:"?"wss:":"ws:",r.toString()}}}const n=new URL("/ws",window.location.origin);return n.protocol=n.protocol==="https:"?"wss:":"ws:",n.toString()}const Ht=[Yt,Jt,qt];function Mn(t){let n=0;for(let r=0;r<t.length;r+=1)n=n*31+t.charCodeAt(r)|0;return Math.abs(n)}function Oe(t){return Ht[Mn(t)%Ht.length]}function mt(t){if(t.startsWith("user:")){const n=t.slice(5).trim();return n.length>0?n:null}if(t.startsWith("session:")){const n=t.slice(8).trim();return n.length>0?`guest:${n}`:null}return null}function Ve(t){if(t.startsWith("guest:")){const n=t.slice(6).trim();return n?`session:${n}`:`user:${t}`}return`user:${t}`}function Ne(t){const n=t.trim();if(!n)return n;if(n.startsWith("user:guest:")){const r=n.slice(11).trim();return r?`session:${r}`:n}if(n.startsWith("guest:")){const r=n.slice(6).trim();return r?`session:${r}`:n}return n}function Pn(t){return t.trim()===bt}function en(t){return Pn(t)?"ðŸ”¥ I'm into you":t}function gt(t,n){const r=H=>H*Math.PI/180,l=r(n.lat-t.lat),v=r(n.lng-t.lng),S=Math.sin(l/2),C=Math.sin(v/2),R=S*S+Math.cos(r(t.lat))*Math.cos(r(n.lat))*C*C;return 6371e3*(2*Math.atan2(Math.sqrt(R),Math.sqrt(1-R)))}function An(t){return!Number.isFinite(t)||t<0?"-":t<1e3?`${Math.round(t)} m`:t<1e4?`${(t/1e3).toFixed(1)} km`:`${Math.round(t/1e3)} km`}function _t(){try{const t=localStorage.getItem("reddoor_travel_center");if(!t)return null;const n=JSON.parse(t);return n.enabled!==!0?null:typeof n.lat=="number"&&Number.isFinite(n.lat)&&typeof n.lng=="number"&&Number.isFinite(n.lng)?{lat:n.lat,lng:n.lng}:null}catch{return null}}function Rn(){const[t,n]=s.useState(()=>window.matchMedia("(max-width: 900px)").matches);return s.useEffect(()=>{const r=window.matchMedia("(max-width: 900px)"),d=()=>n(r.matches);return d(),r.addEventListener("change",d),()=>r.removeEventListener("change",d)},[]),t}function nt(t){return t==="instant"?"cruise":"date"}function Nn({api:t,session:n,settings:r,discoverFilter:d,busy:l,setBusy:v,setLastError:S,isMobile:C,discoverScreen:R,onDiscoverScreenChange:z,onOpenThreadRequested:H,onUnreadCountChange:_}){var Pe,Le,Xe,Ke,We,Je;const[F,P]=s.useState(R),[a,x]=s.useState(null),[M,b]=s.useState(null),[m,L]=s.useState(null),[W,O]=s.useState([]),[ae,ce]=s.useState({}),[Se,he]=s.useState([]),[ge,xe]=s.useState(new Set),[p,h]=s.useState(new Set),[N,ne]=s.useState({}),[K,Z]=s.useState({}),[k,ye]=s.useState(null),[oe,me]=s.useState(0),[c,D]=s.useState([]),[f,A]=s.useState(null),[$,pe]=s.useState(()=>_t()),{state:Te,lastErrorMessage:Ee}=Xt({wsUrl:ft(),sessionToken:n.sessionToken}),Ae=s.useMemo(()=>Array.from(Te.byKey.values()),[Te.byKey]);s.useEffect(()=>{P(R)},[R]),s.useEffect(()=>{const u=()=>{pe(_t())},y=j=>{(j.key===null||j.key==="reddoor_travel_center")&&u()};return u(),window.addEventListener("rd:location-updated",u),window.addEventListener("storage",y),()=>{window.removeEventListener("rd:location-updated",u),window.removeEventListener("storage",y)}},[]);const te=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,be=s.useMemo(()=>{const u=new Map;for(const y of W)u.set(y.key,y);for(const y of Ae){const j=u.get(y.key);(!j||y.updatedAtMs>=j.updatedAtMs)&&u.set(y.key,y)}return Array.from(u.values())},[Ae,W]),je=s.useMemo(()=>be.filter(u=>u.key!==te),[te,be]),ve=s.useMemo(()=>m?[...je].sort((u,y)=>gt(m,{lat:u.lat,lng:u.lng})-gt(m,{lat:y.lat,lng:y.lng})):je,[je,m]),$e=s.useMemo(()=>{if(!M)return null;if(M===te)return"0 m";if(!m)return null;const u=be.find(y=>y.key===M);return u?An(gt(m,{lat:u.lat,lng:u.lng})):null},[te,be,M,m]);s.useEffect(()=>{let u=!1;async function y(){try{const I=await t.listActivePresence(n.sessionToken);if(u)return;const Y=Array.isArray(I.presence)?I.presence:[];O(Y)}catch{u||O([])}}y();const j=window.setInterval(()=>{y()},8e3);return()=>{u=!0,window.clearInterval(j)}},[t,n.sessionToken]),s.useEffect(()=>{a||ve.length>0&&x(ve[0].key)},[a,ve]),s.useEffect(()=>{const u=ve.filter(y=>!ae[y.key]).map(y=>({key:y.key,profileId:mt(y.key)})).filter(y=>typeof y.profileId=="string");u.length!==0&&Promise.all(u.map(async y=>{var j,I;try{const Y=await t.getPublicProfile(y.profileId);return{key:y.key,displayName:(j=Y.profile)==null?void 0:j.displayName,age:(I=Y.profile)==null?void 0:I.age}}catch{return null}})).then(y=>{ce(j=>{const I={...j};for(const Y of y)Y&&(I[Y.key]={displayName:Y.displayName,age:Y.age});return I})})},[t,ae,ve]),s.useEffect(()=>{(async()=>{try{const u=await t.getPublicProfiles();he(u.profiles)}catch{he([])}if(n.userType==="guest"){xe(new Set),h(new Set);return}try{const u=await t.getFavorites(n.sessionToken);xe(new Set(u.favorites))}catch{xe(new Set)}try{const u=await t.listBlocked(n.sessionToken);h(new Set(u.blocked))}catch{h(new Set)}})()},[t,n.sessionToken,n.userType]),s.useEffect(()=>{let u=!1;async function y(){try{const I=await t.listCruisingSpots();u||D(I.spots)}catch{u||D([])}}y();const j=window.setInterval(()=>{y()},12e3);return()=>{u=!0,window.clearInterval(j)}},[t]),s.useEffect(()=>{const u=Date.now(),y=Se.flatMap(j=>{const I=[];return j.mainPhotoMediaId&&I.push(j.mainPhotoMediaId),Array.isArray(j.galleryMediaIds)&&I.push(...j.galleryMediaIds),j.videoMediaId&&I.push(j.videoMediaId),I}).filter(j=>typeof j=="string"&&j.length>0&&!N[j]&&u>=(K[j]??0)).slice(0,6);y.length!==0&&Promise.all(y.map(async j=>{try{const I=await t.getPublicMediaUrl(j);return{mediaId:j,url:I.downloadUrl}}catch{return null}})).then(j=>{ne(I=>{const Y={...I};for(const ie of j)ie&&(Y[ie.mediaId]=ie.url);return Y}),Z(I=>{const Y={...I};for(let ie=0;ie<y.length;ie+=1){const fe=y[ie];j[ie]?Y[fe]&&delete Y[fe]:Y[fe]=Date.now()+3e4}return Y})})},[t,K,N,Se]);async function ze(u){b(u),me(0);const y=mt(u);if(!y){ye(null);return}try{if(u===te){const j=await t.getMyProfile(n.sessionToken);typeof j.profile.mainPhotoMediaId=="string"&&j.profile.mainPhotoMediaId;const I=[j.profile.mainPhotoMediaId,...j.profile.galleryMediaIds??[],j.profile.videoMediaId].filter(Y=>typeof Y=="string"&&Y.length>0);if(I.length>0){const Y=await Promise.all(I.map(async ie=>{try{const fe=await t.getPublicMediaUrl(ie);return{mediaId:ie,downloadUrl:fe.downloadUrl}}catch{return null}}));ne(ie=>{const fe={...ie};for(const Re of Y)Re&&(fe[Re.mediaId]=Re.downloadUrl);return fe})}ye({userId:j.profile.userId,displayName:j.profile.displayName,age:j.profile.age,bio:j.profile.bio,stats:j.profile.stats,discreetMode:j.profile.discreetMode,mainPhotoMediaId:j.profile.mainPhotoMediaId,galleryMediaIds:j.profile.galleryMediaIds,videoMediaId:j.profile.videoMediaId})}else{const j=await t.getPublicProfile(y),I=[j.profile.mainPhotoMediaId,...j.profile.galleryMediaIds??[],j.profile.videoMediaId].filter(Y=>typeof Y=="string"&&Y.length>0);if(I.length>0){const Y=await Promise.all(I.map(async ie=>{try{const fe=await t.getPublicMediaUrl(ie);return{mediaId:ie,downloadUrl:fe.downloadUrl}}catch{return null}}));ne(ie=>{const fe={...ie};for(const Re of Y)Re&&(fe[Re.mediaId]=Re.downloadUrl);return fe})}ye(j.profile)}}catch(j){const I=j;if((I==null?void 0:I.code)==="PROFILE_HIDDEN"){b(null),ye(null);return}ye(null),S(q(j))}}async function De(u){if(n.userType==="guest"){S("Guests cannot star users. Register to save favorites.");return}if(!(!n.userId||n.userId===u))try{const y=await t.toggleFavorite(n.sessionToken,u);xe(new Set(y.favorites))}catch(y){S(q(y))}}async function He(u){const y=Ne(u);if(!(!y||y===te))try{await t.sendChat(n.sessionToken,"cruise",y,bt)}catch(j){S(q(j))}}async function Q(u){if(!(!u.trim()||u===te)){if(n.userType==="guest"){S("Anonymous users cannot block users.");return}try{p.has(u)?await t.unblock(n.sessionToken,u):await t.block(n.sessionToken,u);const y=await t.listBlocked(n.sessionToken);h(new Set(y.blocked))}catch(y){S(q(y))}}}async function Ie(){const u=$??{lat:r.defaultCenterLat,lng:r.defaultCenterLng};if(!navigator.geolocation){L(u);try{await t.updatePresence(n.sessionToken,u.lat,u.lng,"online")}catch{}return}try{const y=await new Promise((j,I)=>{navigator.geolocation.getCurrentPosition(j,I,{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e4})});L({lat:y.coords.latitude,lng:y.coords.longitude}),await t.updatePresence(n.sessionToken,y.coords.latitude,y.coords.longitude,"online")}catch(y){L(u);try{await t.updatePresence(n.sessionToken,u.lat,u.lng,"online")}catch{const j=y&&typeof y=="object"&&"message"in y&&typeof y.message=="string"?y.message:null;S(j??q(y))}}}s.useEffect(()=>{Ie();const u=window.setInterval(()=>{Ie()},3e4);return()=>window.clearInterval(u)},[n.sessionToken]),s.useEffect(()=>{const u=y=>{var ie,fe;const j=y,I=(ie=j.detail)==null?void 0:ie.lat,Y=(fe=j.detail)==null?void 0:fe.lng;!Number.isFinite(I)||!Number.isFinite(Y)||(L({lat:I,lng:Y}),t.updatePresence(n.sessionToken,I,Y,"online").catch(()=>{}))};return window.addEventListener("rd:location-updated",u),()=>window.removeEventListener("rd:location-updated",u)},[t,n.sessionToken]);const Me=s.useMemo(()=>{if(be.some(I=>I.key===te))return be;const y=m??$??{lat:r.defaultCenterLat,lng:r.defaultCenterLng};return[{key:te,userType:n.userType,lat:y.lat,lng:y.lng,status:"online",updatedAtMs:Date.now()},...be]},[te,be,m,n.userType,r.defaultCenterLat,r.defaultCenterLng,$]),Ce=s.useMemo(()=>{const u={};for(const y of Se){if(!y.mainPhotoMediaId)continue;const j=N[y.mainPhotoMediaId];j&&(u[Ve(y.userId)]=j)}return u},[N,Se]),g=s.useMemo(()=>c.map(u=>({id:`spot:${u.spotId}`,position:{lat:u.lat,lng:u.lng},color:"#26d5ff",markerType:"spot",markerGlyph:"CS",label:`${u.name} | check-ins: ${u.checkInCount??0} | action: ${u.actionCount??0}`,onClick:()=>A(u.spotId)})),[c]),G=u=>{P(u),z(u)},se=e.jsx(Bt,{wsUrl:ft(),sessionToken:n.sessionToken,presenceUpdates:Me,realtimeErrorMessage:Ee,onMarkerSelect:u=>void ze(u),avatarByKey:Ce,additionalMarkers:g,defaultCenter:$??{lat:r.defaultCenterLat,lng:r.defaultCenterLng},height:C?"calc(100vh - 340px)":"calc(100dvh - 62px)",visible:!0}),we=e.jsxs("div",{style:{background:"#000",marginInline:-10},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,padding:"8px 10px",borderBottom:"1px solid rgba(255,58,77,0.25)"},children:[e.jsx("button",{type:"button",style:B(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"reset"}}))},children:"GUYS"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"toggle_favorites"}}))},"aria-label":"Toggle favorites only",children:"â˜…"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"open_filters"}})),G("chat")},children:"FILTER"})]}),e.jsx(Bt,{wsUrl:ft(),sessionToken:n.sessionToken,presenceUpdates:Me,realtimeErrorMessage:Ee,onMarkerSelect:u=>void ze(u),avatarByKey:Ce,additionalMarkers:g,defaultCenter:$??{lat:r.defaultCenterLat,lng:r.defaultCenterLng},height:"calc(100dvh - 220px)",visible:F==="map"})]}),re=e.jsx(Fn,{api:t,session:n,busy:l,setBusy:v,setLastError:S,onlinePeers:ve,selectedPeerKey:a,setSelectedPeerKey:x,onOpenProfile:u=>void ze(u),isMobile:C,selfCoords:m,peerProfileByKey:ae,discoverFilter:d,publicProfiles:Se,favorites:ge,mediaUrlById:N,onUnreadCountChange:_});return e.jsxs("div",{style:!C&&F==="map"?{height:"100%"}:{display:"grid",gap:8},children:[C?e.jsx(e.Fragment,{children:F==="map"?we:re}):e.jsx("div",{style:F==="map"?{display:"grid",height:"100%",alignItems:"stretch"}:{display:"grid",gap:12,alignItems:"start"},children:F==="map"?se:re}),M?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:80,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:C?"stretch":"center",padding:C?0:14},role:"dialog","aria-modal":"true","aria-label":"User profile",onClick:()=>b(null),children:e.jsx("div",{onClick:u=>u.stopPropagation(),style:C?{width:"100%",height:"100dvh",overflow:"auto",background:"linear-gradient(180deg, rgba(7,8,10,0.98), rgba(2,2,4,0.98))",borderRadius:0,border:"none",padding:"calc(env(safe-area-inset-top, 0px) + 56px) 12px calc(env(safe-area-inset-bottom, 0px) + 20px)"}:{...Be(),width:"min(680px, 100%)",maxHeight:"86vh",overflow:"auto"},children:e.jsxs("div",{style:{display:"grid",gap:14},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"106px 1fr auto",gap:12,alignItems:"center"},children:[e.jsxs("div",{style:{position:"relative",width:106,height:106},children:[e.jsx("img",{src:k!=null&&k.mainPhotoMediaId&&N[k.mainPhotoMediaId]?N[k.mainPhotoMediaId]:Oe(M),alt:"Profile avatar",style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"cover",border:"2px solid #ff3047"}}),e.jsx("span",{style:{position:"absolute",right:4,bottom:4,width:14,height:14,borderRadius:"50%",background:"#26d5ff",border:"2px solid #000"}})]}),e.jsxs("div",{style:{display:"grid",gap:6},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:(k==null?void 0:k.displayName)??M}),e.jsx("div",{style:{color:"#26d5ff",fontSize:14},children:"Instant Messaging Available"})]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[k&&k.userId!==(n.userId??"")?e.jsx("button",{type:"button",style:{...B(!1),color:"#26d5ff",borderColor:"rgba(38,213,255,0.62)",minWidth:126},onClick:()=>void De(k.userId),children:ge.has(k.userId)?"â˜… STARRED":"â˜† STAR"}):null,k&&k.userId!==(n.userId??"")?e.jsx("button",{type:"button",style:{...B(!1),color:"#ffb347",borderColor:"rgba(255,179,71,0.65)",minWidth:126},onClick:()=>void He(Ve(k.userId)),children:"ðŸ”¥ FIRE"}):null,k&&k.userId!==(n.userId??"")?e.jsx("button",{type:"button",style:{...B(!1),color:p.has(Ve(k.userId))?"#ff9aa3":"#ffd4d8",borderColor:"rgba(255,120,130,0.62)",minWidth:126},onClick:()=>void Q(Ve(k.userId)),children:p.has(Ve(k.userId))?"UNBLOCK":"BLOCK"}):null,e.jsx("button",{type:"button",style:B(!1),onClick:()=>b(null),children:"CLOSE"})]})]}),e.jsxs("div",{style:{color:"#ced3dc",fontSize:14,lineHeight:1.5},children:[e.jsxs("div",{children:["Age: ",(k==null?void 0:k.age)??"-"]}),e.jsxs("div",{children:["Distance: ",$e??"-"]}),e.jsxs("div",{children:["Race: ",((Pe=k==null?void 0:k.stats)==null?void 0:Pe.race)??"-"]}),e.jsxs("div",{children:["Height: ",((Le=k==null?void 0:k.stats)==null?void 0:Le.heightInches)??"-"]}),e.jsxs("div",{children:["Weight: ",((Xe=k==null?void 0:k.stats)==null?void 0:Xe.weightLbs)??"-"]}),e.jsxs("div",{children:["Cock Size: ",((Ke=k==null?void 0:k.stats)==null?void 0:Ke.cockSizeInches)??"-"]}),e.jsxs("div",{children:["Cut / Uncut: ",((We=k==null?void 0:k.stats)==null?void 0:We.cutStatus)??"-"]}),e.jsxs("div",{children:["Position: ",((Je=k==null?void 0:k.stats)==null?void 0:Je.position)??"-"]}),e.jsxs("div",{style:{marginTop:8},children:["Bio: ",(k==null?void 0:k.bio)??"-"]})]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"MEDIA"}),k?e.jsx(e.Fragment,{children:(()=>{const u=[k.mainPhotoMediaId,...k.galleryMediaIds??[],k.videoMediaId].filter(ie=>typeof ie=="string"&&ie.length>0);if(u.length===0)return e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No uploaded media."});const y=Math.max(0,Math.min(oe,u.length-1)),j=u[y],I=N[j],Y=j===k.videoMediaId;return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.4)",borderRadius:12,padding:8},children:Y?e.jsx("video",{controls:!0,playsInline:!0,src:I,style:{width:"100%",maxHeight:260,borderRadius:10,background:"#000"}}):e.jsx("img",{src:I??Oe(M??k.userId),alt:"Profile media",style:{width:"100%",maxHeight:260,objectFit:"cover",borderRadius:10}})}),e.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:u.map((ie,fe)=>{const Re=N[ie],qe=ie===k.videoMediaId;return e.jsx("button",{type:"button",onClick:()=>me(fe),style:{width:64,height:64,padding:0,borderRadius:8,overflow:"hidden",border:fe===y?"2px solid #26d5ff":"1px solid rgba(255,58,77,0.4)",background:"#000",cursor:"pointer",color:"#fff",fontSize:10},"aria-label":qe?"Open video":"Open photo",children:qe?e.jsx("div",{style:{display:"grid",placeItems:"center",width:"100%",height:"100%"},children:Re?e.jsx("video",{src:Re,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}):"VIDEO"}):e.jsx("img",{src:Re??Oe(M??k.userId),alt:"Media thumbnail",style:{width:"100%",height:"100%",objectFit:"cover"}})},ie)})})]})})()}):null]}),e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:e.jsx("button",{type:"button",style:ke(!1),onClick:()=>{M&&H(M),b(null),me(0)},children:"CHAT"})})]})})}):null,f?e.jsx(En,{api:t,session:n,spot:c.find(u=>u.spotId===f)??null,onClose:()=>A(null),onUpdated:async()=>{try{const u=await t.listCruisingSpots();D(u.spots)}catch{}},setLastError:S}):null]})}function En({api:t,session:n,spot:r,onClose:d,onUpdated:l,setLastError:v}){return r?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},role:"dialog","aria-modal":"true","aria-label":"Cruising spot",onClick:d,children:e.jsxs("div",{onClick:S=>S.stopPropagation(),style:{...Be(),width:"min(520px, 100%)",display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:r.name}),e.jsx("div",{style:{color:"#9fb6bf",fontSize:13},children:r.address}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap"},children:r.description}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:13},children:["Check-ins: ",r.checkInCount??0," | I got action there: ",r.actionCount??0]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:ke(!1),onClick:async()=>{try{await t.checkInCruisingSpot(n.sessionToken,r.spotId),await l()}catch(S){v(q(S))}},children:"CHECK IN"}),e.jsx("button",{type:"button",style:B(!1),onClick:async()=>{try{await t.markCruisingSpotAction(n.sessionToken,r.spotId),await l()}catch(S){v(q(S))}},children:"I GOT ACTION THERE"}),e.jsx("button",{type:"button",style:B(!1),onClick:d,children:"CLOSE"})]})]})}):null}function Fn({api:t,session:n,busy:r,setBusy:d,setLastError:l,onlinePeers:v,selectedPeerKey:S,setSelectedPeerKey:C,onOpenProfile:R,openThreadRequest:z,onThreadRequestConsumed:H,isMobile:_,selfCoords:F,peerProfileByKey:P,discoverFilter:a,publicProfiles:x,favorites:M,mediaUrlById:b,onUnreadCountChange:m}){var zt;const[L,W]=s.useState({}),[O,ae]=s.useState({}),[ce,Se]=s.useState("instant"),[he,ge]=s.useState("grid"),[xe,p]=s.useState(null),[h,N]=s.useState(""),[ne,K]=s.useState(null),[Z,k]=s.useState([]),[ye,oe]=s.useState({}),[me,c]=s.useState(null),[D,f]=s.useState({}),[A,$]=s.useState({}),[pe,Te]=s.useState(!1),[Ee,Ae]=s.useState(""),[te,be]=s.useState(null),je=s.useRef(!1),ve=s.useRef(!1),$e=s.useRef(0),ze=s.useRef(null),De=s.useRef(null),He=s.useRef(null),Q=s.useRef(null),Ie=s.useRef(null),Me=s.useRef(0),Ce=s.useRef(new Set),g=s.useRef(null),G=s.useRef(null),se=s.useRef(null),[we,re]=s.useState(null),[Pe,Le]=s.useState(a==="favorites"),[Xe,Ke]=s.useState(!1),[We,Je]=s.useState(a==="online"?"online":"all"),[u,y]=s.useState(!1),[j,I]=s.useState(""),[Y,ie]=s.useState(""),[fe,Re]=s.useState(""),[qe,vt]=s.useState(""),[st,xt]=s.useState(""),[it,jt]=s.useState(""),[rt,wt]=s.useState(""),[at,St]=s.useState(""),[ot,kt]=s.useState(""),[lt,It]=s.useState(""),[dt,Ct]=s.useState(""),Ue=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,le=xe??S??"",nn=le?L[le]??[]:[],Tt=s.useMemo(()=>new Map(v.map(i=>[i.key,i])),[v]),_e=s.useMemo(()=>{const i={};for(const o of x)typeof o.displayName=="string"&&o.displayName.trim()&&(i[Ve(o.userId)]=o.displayName);for(const[o,w]of Object.entries(P))typeof w.displayName=="string"&&w.displayName.trim()&&(i[o]=w.displayName);return i},[P,x]),Mt=s.useMemo(()=>x.filter(i=>i.userId!==(n.userId??"")).map(i=>{const o=Ve(i.userId),w=Tt.get(o);return{key:o,userId:i.userId,displayName:i.displayName,age:i.age,stats:i.stats,meters:w&&F?Math.round(gt(F,{lat:w.lat,lng:w.lng})):null,isOnline:!!w,hasPicture:typeof i.mainPhotoMediaId=="string"&&i.mainPhotoMediaId.trim().length>0,avatarUrl:i.mainPhotoMediaId?b[i.mainPhotoMediaId]:void 0}}),[b,Tt,x,F,n.userId]),Ze=s.useMemo(()=>{const i=j.trim()?Number(j):void 0,o=Y.trim()?Number(Y):void 0,w=qe.trim()?Number(qe):void 0,E=st.trim()?Number(st):void 0,U=it.trim()?Number(it):void 0,J=rt.trim()?Number(rt):void 0,X=at.trim()?Number(at):void 0,V=ot.trim()?Number(ot):void 0;return[...Mt.filter(T=>{var Fe,Ge,Qe,Ye,Ut,Ot,Lt,Kt,Wt;if(Pe&&!M.has(T.userId)||We==="online"&&!T.isOnline||We==="offline"&&T.isOnline||u&&!T.hasPicture||Number.isFinite(i)&&(typeof T.age!="number"||T.age<i)||Number.isFinite(o)&&(typeof T.age!="number"||T.age>o))return!1;const de=typeof((Fe=T.stats)==null?void 0:Fe.race)=="string"?T.stats.race:"";return!(fe.trim()&&de.toLowerCase()!==fe.trim().toLowerCase()||Number.isFinite(w)&&(typeof((Ge=T.stats)==null?void 0:Ge.heightInches)!="number"||T.stats.heightInches<w)||Number.isFinite(E)&&(typeof((Qe=T.stats)==null?void 0:Qe.heightInches)!="number"||T.stats.heightInches>E)||Number.isFinite(U)&&(typeof((Ye=T.stats)==null?void 0:Ye.weightLbs)!="number"||T.stats.weightLbs<U)||Number.isFinite(J)&&(typeof((Ut=T.stats)==null?void 0:Ut.weightLbs)!="number"||T.stats.weightLbs>J)||Number.isFinite(X)&&(typeof((Ot=T.stats)==null?void 0:Ot.cockSizeInches)!="number"||T.stats.cockSizeInches<X)||Number.isFinite(V)&&(typeof((Lt=T.stats)==null?void 0:Lt.cockSizeInches)!="number"||T.stats.cockSizeInches>V)||lt&&((Kt=T.stats)==null?void 0:Kt.cutStatus)!==lt||dt&&((Wt=T.stats)==null?void 0:Wt.position)!==dt)})].sort((T,de)=>{const Fe=typeof T.meters=="number"&&Number.isFinite(T.meters)?T.meters:Number.POSITIVE_INFINITY,Ge=typeof de.meters=="number"&&Number.isFinite(de.meters)?de.meters:Number.POSITIVE_INFINITY;if(Fe!==Ge)return Fe-Ge;const Qe=T.displayName.localeCompare(de.displayName);return Qe!==0?Qe:T.key.localeCompare(de.key)})},[Mt,M,Pe,lt,Y,ot,st,rt,j,at,qe,it,dt,fe,u,We]),ct=s.useMemo(()=>Array.from(new Set(Ze.map(i=>i.key).filter(i=>i.trim().length>0))).slice(0,8),[Ze]),Pt=ct.join("|"),ut=s.useMemo(()=>{const i=new Set(Object.keys(O));return le.trim()&&i.add(le),Array.from(i).sort((o,w)=>{var E,U;return(((E=O[w])==null?void 0:E.lastAt)??0)-(((U=O[o])==null?void 0:U.lastAt)??0)})},[O,le]),At=s.useMemo(()=>Object.values(D).reduce((i,o)=>i+(Number.isFinite(o)?o:0),0),[D]);s.useMemo(()=>{var i;return le?_e[le]??((i=P[le])==null?void 0:i.displayName)??le:""},[_e,le,P]);const sn=s.useMemo(()=>{if(!le)return;const i=Ze.find(o=>o.key===le);return i==null?void 0:i.avatarUrl},[Ze,le]),et=s.useMemo(()=>ut.filter(i=>i!==le&&i!==Ue&&!!O[i]).map(i=>{var o;return{key:i,label:_e[i]??((o=P[i])==null?void 0:o.displayName)??i}}),[ut,O,_e,Ue,le,P]);s.useEffect(()=>{typeof m=="function"&&m(At)},[m,At]),s.useEffect(()=>{const i=ze.current;i&&(i.srcObject=te)},[te]),s.useEffect(()=>{const i=De.current;i&&(i.srcObject=we)},[we]),s.useEffect(()=>()=>{if(te){for(const i of te.getTracks())i.stop();if(we)for(const i of we.getTracks())i.stop();g.current&&(g.current.close(),g.current=null)}},[te,we]),s.useEffect(()=>{if(et.length===0){N("");return}N(i=>i&&et.some(o=>o.key===i)?i:et[0].key)},[et]);const rn=s.useMemo(()=>({async sendMessage(i,o,w,E){const U=Ne(o),J=await t.sendChat(n.sessionToken,i,U,w,E),X=J==null?void 0:J.message,V=[X];if(i==="cruise"&&ne)try{const ue=await t.sendChat(n.sessionToken,i,Ne(ne),w,E),T=ue==null?void 0:ue.message;V.push(T)}catch(ue){l(q(ue))}for(const ue of V)Rt(ue);return X},async initiateMediaUpload(i,o){const w=await t.initiateChatMediaUpload(n.sessionToken,{mimeType:i,sizeBytes:o});return{objectKey:w.objectKey,uploadUrl:w.uploadUrl}},async uploadToSignedUrl(i,o,w){if(await pt(i,o,w))return;if(!(await fetch(i,{method:"PUT",headers:{"content-type":w},body:o})).ok)throw{code:"MEDIA_UPLOAD_INCOMPLETE",message:"Upload failed."}},async getMediaUrl(i){return(await t.getChatMediaUrl(n.sessionToken,i)).downloadUrl}}),[t,Ue,n.sessionToken,l,ne]);function tt(i){var o,w,E;return i.text&&i.text.trim()?en(i.text):((o=i.media)==null?void 0:o.kind)==="image"?"[Photo]":((w=i.media)==null?void 0:w.kind)==="video"?"[Video]":((E=i.media)==null?void 0:E.kind)==="audio"?"[Voice]":""}function an(i){if(!i||Ce.current.has(i))return!1;if(Ce.current.add(i),Ce.current.size>5e3){const o=Array.from(Ce.current).slice(-2500);Ce.current=new Set(o)}return!0}function on(i,o){var U;const w=_e[o]??((U=P[o])==null?void 0:U.displayName)??o,E=tt(i)||"New activity";if("Notification"in window){if(Notification.permission==="granted"){try{new Notification(`${w}`,{body:E})}catch{}return}Notification.permission==="default"&&Notification.requestPermission()}}function ln(i){if(!i.startsWith("GROUP_INVITE_REQUEST|"))return null;const[,o,w,E]=i.split("|");return!o||!w||!E?null:{inviteId:o,inviterKey:w,primaryPeerKey:E}}function dn(i){if(!i.startsWith("GROUP_INVITE_ACCEPT|"))return null;const[,o,w]=i.split("|");return!o||!w?null:{inviteId:o,candidateKey:w}}function Rt(i){if(!an(i.messageId))return;const o=i.fromKey===Ue?i.toKey:i.fromKey;W(U=>{const J=U[o]??[];return J.some(X=>X.messageId===i.messageId)?U:{...U,[o]:[...J,i].sort((X,V)=>X.createdAtMs-V.createdAtMs)}}),ae(U=>({...U,[o]:{lastAt:i.createdAtMs,lastText:tt(i)}})),i.fromKey!==Ue&&(he==="thread"&&Ne(le)===Ne(o)?($(J=>({...J,[o]:Math.max(J[o]??0,i.createdAtMs)})),f(J=>{const X={...J};return delete X[o],X})):f(J=>({...J,[o]:(J[o]??0)+1})),on(i,o));const w=ln(i.text??"");w&&i.toKey===Ue&&k(U=>U.some(J=>J.inviteId===w.inviteId)?U:[...U,{...w,createdAtMs:i.createdAtMs}]);const E=dn(i.text??"");E&&i.toKey===Ue&&ye[E.inviteId]&&(K(Ne(E.candidateKey)),c(`Invite accepted by ${_e[E.candidateKey]??E.candidateKey}.`),oe(J=>{const X={...J};return delete X[E.inviteId],X}))}async function cn(i){const o=Ne(i);if(o)try{const w=await t.listChat(n.sessionToken,nt(ce),o),E=w==null?void 0:w.messages,U=Array.isArray(E)?E:[];t.markChatRead(n.sessionToken,nt(ce),o).catch(()=>{}),W(V=>({...V,[o]:U}));const J=U.length>0?U[U.length-1]:null;J&&ae(V=>({...V,[o]:{lastAt:J.createdAtMs,lastText:tt(J)}}));let X=0;for(const V of U)V.fromKey===o&&V.createdAtMs>X&&(X=V.createdAtMs);X>0&&$(V=>({...V,[o]:Math.max(V[o]??0,X)}))}catch(w){l(q(w))}}s.useEffect(()=>{if(he!=="thread"||!le.trim())return;let i=!1,o=!1,w=null;const E=async()=>{if(!(i||o)){o=!0;try{await cn(le)}finally{o=!1}i||(w=window.setTimeout(()=>{E()},1200))}};return E(),()=>{i=!0,w!==null&&window.clearTimeout(w)}},[ce,le,he]),s.useEffect(()=>{if(he!=="grid")return;if(ct.length===0){f({});return}let i=!1;async function o(){if(!je.current&&!document.hidden){je.current=!0;try{const U=nt(ce),J=[],X=[];for(const ue of ct){if(i)break;try{const T=Ne(ue);if(!T)continue;const de=await t.listChat(n.sessionToken,U,T),Fe=(de==null?void 0:de.messages)??[];if(Fe.length>0){const Ye=Fe[Fe.length-1];X.push([T,{lastAt:Ye.createdAtMs,lastText:tt(Ye)}])}let Ge=0;const Qe=A[T]??0;for(const Ye of Fe)Ye.fromKey===T&&Ye.createdAtMs>Qe&&(Ge+=1);J.push([T,Ge])}catch{const T=Ne(ue);T&&J.push([T,0])}}if(i)return;X.length>0&&ae(ue=>{const T={...ue};for(const[de,Fe]of X)T[de]=Fe;return T});const V={};for(const[ue,T]of J)T>0&&(V[ue]=T);f(V)}finally{je.current=!1}}}const w=window.setTimeout(()=>{o()},1200),E=window.setInterval(()=>{o()},15e3);return()=>{i=!0,je.current=!1,window.clearTimeout(w),window.clearInterval(E)}},[t,ce,A,n.sessionToken,Pt,he]),s.useEffect(()=>{const i=Array.from(new Set([...ut,...ct,le].map(J=>Ne(J)).filter(J=>J.length>0))).slice(0,10);if(i.length===0)return;let o=!1;const w=async()=>{if(!(o||document.hidden||ve.current)){ve.current=!0;try{const J=nt(ce),X=[];for(const V of i){if(o)break;try{const ue=await t.listChat(n.sessionToken,J,V),T=(ue==null?void 0:ue.messages)??[];if(T.length===0)continue;const de=T[T.length-1];X.push([V,{lastAt:de.createdAtMs,lastText:tt(de)}])}catch{}}if(o||X.length===0)return;ae(V=>{const ue={...V};for(const[T,de]of X)ue[T]=de;return ue})}finally{ve.current=!1}}},E=window.setTimeout(()=>{w()},1e3),U=window.setInterval(()=>{w()},5e3);return()=>{o=!0,window.clearTimeout(E),window.clearInterval(U)}},[t,ce,ut,le,n.sessionToken,Pt]);async function un(){if(te)return te;if(!navigator.mediaDevices||typeof navigator.mediaDevices.getUserMedia!="function")throw{code:"UNAUTHORIZED_ACTION",message:"Camera access is not available in this browser."};const i=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});return be(i),i}function fn(i,o){g.current&&(g.current.close(),g.current=null);const w=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});return g.current=w,G.current=o,se.current=i,w.ontrack=E=>{const U=E.streams[0];U&&re(U)},w.onicecandidate=E=>{const U=E.candidate;if(!U)return;const J=se.current,X=G.current;!J||!X||t.sendCallSignal(n.sessionToken,{toKey:J,callId:X,signalType:"ice",candidate:JSON.stringify(U.toJSON())}).catch(()=>{})},w}async function Nt(i=!0){const o=se.current,w=G.current;if(i&&o&&w)try{await t.sendCallSignal(n.sessionToken,{toKey:o,callId:w,signalType:"hangup"})}catch{}if(te)for(const E of te.getTracks())E.stop();if(we)for(const E of we.getTracks())E.stop();be(null),re(null),g.current&&(g.current.close(),g.current=null),G.current=null,se.current=null,Te(!1)}s.useEffect(()=>{let i=!1;const o=ft();if(!o)return;const w=()=>{Q.current!==null&&(window.clearInterval(Q.current),Q.current=null),Ie.current!==null&&(window.clearTimeout(Ie.current),Ie.current=null)},E=()=>{if(i)return;const U=new WebSocket(o);He.current=U,U.onopen=()=>{Me.current=0,U.send(JSON.stringify({type:"auth",payload:{sessionToken:n.sessionToken}})),Q.current=window.setInterval(()=>{U.readyState===U.OPEN&&U.send(JSON.stringify({type:"heartbeat",payload:{}}))},15e3)},U.onmessage=J=>{let X=null;try{X=JSON.parse(String(J.data))}catch{return}if(!X||typeof X.type!="string")return;if(X.type==="chat_message"){const T=X.payload,de=T==null?void 0:T.message;if(!de||de.fromKey!==Ue&&de.toKey!==Ue)return;Rt(de);return}if(X.type!=="call_signal")return;const V=X.payload;if(!V||V.toKey!==Ue||typeof V.fromKey!="string"||!V.callId||!V.signalType)return;const ue=Ne(V.fromKey);if(V.signalType==="hangup"){Nt(!1);return}if(V.signalType==="offer"){(async()=>{try{yt(ue),Ae(ue);const T=await un(),de=fn(ue,V.callId);for(const Ge of T.getTracks())de.addTrack(Ge,T);await de.setRemoteDescription({type:"offer",sdp:V.sdp??""});const Fe=await de.createAnswer();await de.setLocalDescription(Fe),await t.sendCallSignal(n.sessionToken,{toKey:ue,callId:V.callId,signalType:"answer",sdp:Fe.sdp??""}),Te(!0)}catch(T){l(q(T))}})();return}if(V.signalType==="answer"){(async()=>{try{if(!g.current||G.current!==V.callId)return;await g.current.setRemoteDescription({type:"answer",sdp:V.sdp??""})}catch(T){l(q(T))}})();return}V.signalType==="ice"&&(async()=>{try{if(!g.current||G.current!==V.callId||!V.candidate)return;const T=JSON.parse(V.candidate);await g.current.addIceCandidate(T)}catch{}})()},U.onclose=()=>{if(w(),i)return;Me.current+=1;const J=Math.min(8e3,500*2**Math.min(Me.current,4));Ie.current=window.setTimeout(E,J)},U.onerror=()=>{}};return E(),()=>{var U;i=!0,w(),(U=He.current)==null||U.close(1e3,"chat cleanup"),He.current=null}},[t,Ue,n.sessionToken]);async function gn(){if(h.trim()){if(!le.trim()){l("Select a user first.");return}try{const i=Ne(h);if(!i)return;if(!et.some(w=>w.key===i)){l("You can only add a third user you have previously messaged.");return}const o=crypto.randomUUID();await t.sendChat(n.sessionToken,"cruise",i,`GROUP_INVITE_REQUEST|${o}|${Ue}|${le.trim()}`),oe(w=>({...w,[o]:{candidateKey:i,primaryPeerKey:le.trim()}})),c(`Invite sent to ${_e[i]??i}. Waiting for acceptance.`)}catch(i){l(q(i))}}}async function Et(i,o,w){try{await t.sendChat(n.sessionToken,"cruise",o,`GROUP_INVITE_ACCEPT|${i}|${Ue}`),k(E=>E.filter(U=>U.inviteId!==i)),c("Group invite accepted."),yt(w)}catch(E){l(q(E))}}function Ft(i){k(o=>o.filter(w=>w.inviteId!==i))}function yt(i){const o=Ne(i);C(o),p(o),f(w=>{const E={...w};return delete E[o],E}),$(w=>({...w,[o]:Date.now()})),ge("thread")}function ht(){Le(!1),Je("all"),y(!1),I(""),ie(""),Re(""),vt(""),xt(""),jt(""),wt(""),St(""),kt(""),It(""),Ct(""),Ke(!1)}if(s.useEffect(()=>{const i=o=>{var U;const E=(U=o.detail)==null?void 0:U.action;if(E==="reset"){ht(),ge("grid");return}if(E==="toggle_favorites"){Le(J=>!J),ge("grid");return}E==="open_filters"&&(Ke(!0),ge("grid"))};return window.addEventListener("rd:discover-control",i),()=>window.removeEventListener("rd:discover-control",i)},[]),s.useEffect(()=>{z&&z.nonce!==$e.current&&($e.current=z.nonce,yt(z.key),typeof H=="function"&&H())},[H,z]),s.useEffect(()=>{const i=o=>{var E;((E=o.detail)==null?void 0:E.tab)==="discover"&&(ge("grid"),p(null),Ke(!1))};return window.addEventListener("rd:tab-select",i),()=>window.removeEventListener("rd:tab-select",i)},[]),he==="thread"&&le.trim()){const i=_e[le]??((zt=P[le])==null?void 0:zt.displayName)??le;return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:_?-10:0},children:[Z.length>0?e.jsxs("div",{style:{...Be(),display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"INVITE REQUESTS"}),Z.map(o=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,alignItems:"center"},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:13},children:[_e[o.inviterKey]??o.inviterKey," invited you to join a conversation."]}),e.jsx("button",{type:"button",style:ke(!1),onClick:()=>void Et(o.inviteId,o.inviterKey,o.primaryPeerKey),children:"ACCEPT"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>Ft(o.inviteId),children:"DECLINE"})]},o.inviteId))]}):null,me?e.jsx("div",{style:{color:"#26d5ff",fontSize:12},children:me}):null,e.jsx(Zt,{chatKind:nt(ce),peerKey:le,currentUserKey:Ue,messages:nn,client:rn,title:`INSTANT THREAD: ${i}`,peerSummary:{displayName:i,avatarUrl:sn},thirdParty:{candidates:et,selectedKey:h,onSelect:o=>N(o),onAdd:()=>void gn(),disabled:r},showHeader:!1,edgeToEdge:_,fillHeight:_}),pe?e.jsx("div",{role:"dialog","aria-modal":"true","aria-label":"Video call",style:{position:"fixed",inset:0,zIndex:60,background:"rgba(0,0,0,0.82)",display:"grid",placeItems:"center",padding:16},children:e.jsxs("div",{style:{...Be(),width:"min(720px, 100%)",display:"grid",gap:10},children:[e.jsxs("div",{style:{fontSize:18,fontWeight:700},children:["VIDEO CALL: ",Ee]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("video",{ref:ze,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"100%",maxHeight:"52vh",borderRadius:12,background:"#000"}}),e.jsx("video",{ref:De,autoPlay:!0,playsInline:!0,style:{width:"100%",maxHeight:"52vh",borderRadius:12,background:"#000"}})]}),e.jsx("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:e.jsx("button",{type:"button",style:B(!1),onClick:()=>void Nt(),children:"END CALL"})})]})}):null]})}return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:_?-10:0},children:[Z.length>0?e.jsxs("div",{style:{...Be(),display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"INVITE REQUESTS"}),Z.map(i=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,alignItems:"center"},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:13},children:[_e[i.inviterKey]??i.inviterKey," invited you to join a conversation."]}),e.jsx("button",{type:"button",style:ke(!1),onClick:()=>void Et(i.inviteId,i.inviterKey,i.primaryPeerKey),children:"ACCEPT"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>Ft(i.inviteId),children:"DECLINE"})]},i.inviteId))]}):null,me?e.jsx("div",{style:{color:"#26d5ff",fontSize:12},children:me}):null,e.jsx("div",{style:{padding:10,borderBottom:"1px solid rgba(255,58,77,0.28)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8},children:[e.jsx("button",{type:"button",style:B(!1),onClick:ht,children:"GUYS"}),e.jsx("button",{type:"button",style:Pe?ke(!1):B(!1),onClick:()=>Le(i=>!i),"aria-label":"Toggle favorites only",children:"â˜…"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>Ke(!0),children:"FILTER"})]})}),Xe?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},role:"dialog","aria-modal":"true","aria-label":"Discover filters",onClick:()=>Ke(!1),children:e.jsx("div",{onClick:i=>i.stopPropagation(),style:{...Be(),width:"min(760px, 100%)",maxHeight:"86vh",overflow:"auto"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"FILTER USERS"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{type:"checkbox",checked:u,onChange:i=>y(i.target.checked)}),"Has pictures"]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Online status"}),e.jsxs("select",{style:ee(),value:We,onChange:i=>Je(i.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"offline",children:"Offline"})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[e.jsx("input",{style:ee(),placeholder:"Min age",value:j,onChange:i=>I(i.target.value)}),e.jsx("input",{style:ee(),placeholder:"Max age",value:Y,onChange:i=>ie(i.target.value)}),e.jsx("input",{style:ee(),placeholder:"Race",value:fe,onChange:i=>Re(i.target.value)}),e.jsxs("select",{style:ee(),value:lt,onChange:i=>It(i.target.value),children:[e.jsx("option",{value:"",children:"Cut / Uncut"}),e.jsx("option",{value:"cut",children:"Cut"}),e.jsx("option",{value:"uncut",children:"Uncut"})]}),e.jsx("input",{style:ee(),placeholder:"Min height (in)",value:qe,onChange:i=>vt(i.target.value)}),e.jsx("input",{style:ee(),placeholder:"Max height (in)",value:st,onChange:i=>xt(i.target.value)}),e.jsx("input",{style:ee(),placeholder:"Min weight (lbs)",value:it,onChange:i=>jt(i.target.value)}),e.jsx("input",{style:ee(),placeholder:"Max weight (lbs)",value:rt,onChange:i=>wt(i.target.value)}),e.jsx("input",{style:ee(),placeholder:"Min cock size (in)",value:at,onChange:i=>St(i.target.value)}),e.jsx("input",{style:ee(),placeholder:"Max cock size (in)",value:ot,onChange:i=>kt(i.target.value)}),e.jsxs("select",{style:ee(),value:dt,onChange:i=>Ct(i.target.value),children:[e.jsx("option",{value:"",children:"Position"}),e.jsx("option",{value:"top",children:"Top"}),e.jsx("option",{value:"bottom",children:"Bottom"}),e.jsx("option",{value:"side",children:"Side"})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:B(!1),onClick:ht,children:"RESET"}),e.jsx("button",{type:"button",style:ke(!1),onClick:()=>Ke(!1),children:"DONE"})]})]})})}):null,e.jsx("div",{style:{display:"grid",gap:0},children:e.jsx("div",{style:{display:"grid",gap:0,gridTemplateColumns:"repeat(3, minmax(0, 1fr))"},children:Ze.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:13,padding:12,gridColumn:"1 / -1"},children:"No users match current filters."}):Ze.map(i=>e.jsx("button",{type:"button",onClick:()=>R(i.key),style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:0,display:"grid",gap:0,color:"#fff",cursor:"pointer"},children:e.jsxs("div",{style:{position:"relative",width:"100%",aspectRatio:"1 / 1"},children:[e.jsx("img",{src:i.avatarUrl??Oe(i.key),alt:"User avatar",style:{width:"100%",height:"100%",borderRadius:0,objectFit:"cover",border:"1px solid #0fd9ff"}}),i.isOnline?e.jsx("span",{style:{position:"absolute",top:4,left:4,width:10,height:10,borderRadius:"50%",background:"#26d5ff",border:"2px solid #000"}}):null]})},i.key))})})]})}function zn({api:t,session:n,setLastError:r,openThreadRequest:d,onThreadRequestConsumed:l,isMobile:v}){var k,ye,oe,me,c,D;const[S,C]=s.useState([]),[R,z]=s.useState(null),[H,_]=s.useState([]),[F,P]=s.useState("messages"),[a,x]=s.useState(null),[M,b]=s.useState(!1),[m,L]=s.useState(""),[W,O]=s.useState(null),[ae,ce]=s.useState({}),[Se,he]=s.useState(null),ge=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,xe="cruise",p=s.useMemo(()=>S.filter(f=>f.key!==R).map(f=>({key:f.key,label:f.displayName})),[S,R]),h=s.useMemo(()=>S.find(f=>f.key===R)??null,[S,R]);s.useEffect(()=>{if(p.length===0){L("");return}L(f=>f&&p.some(A=>A.key===f)?f:p[0].key)},[p]),s.useEffect(()=>{let f=!1;async function A(){var pe,Te,Ee;try{const Ae=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,[te,be]=await Promise.all([t.getPublicProfiles(),t.listActivePresence(n.sessionToken)]),je={},ve={};for(const Q of te.profiles)je[Ve(Q.userId)]=Q.displayName,typeof Q.mainPhotoMediaId=="string"&&Q.mainPhotoMediaId.trim()!==""&&(ve[Ve(Q.userId)]=Q.mainPhotoMediaId);const $e=Array.from(new Set([...te.profiles.map(Q=>Ve(Q.userId)),...be.presence.map(Q=>Ne(Q.key))].filter(Q=>Q&&Q!==Ae))).slice(0,24),ze=[];for(const Q of $e)try{const Ie=await t.listChat(n.sessionToken,"cruise",Q),Me=(Ie==null?void 0:Ie.messages)??[];if(!Array.isArray(Me)||Me.length===0)continue;const Ce=Me[Me.length-1],g=typeof Ce.text=="string"&&Ce.text.trim().length>0?en(Ce.text):((pe=Ce.media)==null?void 0:pe.kind)==="image"?"[Photo]":((Te=Ce.media)==null?void 0:Te.kind)==="video"?"[Video]":((Ee=Ce.media)==null?void 0:Ee.kind)==="audio"?"[Voice]":"";ze.push({key:Q,displayName:je[Q]??Q,preview:g,at:Ce.createdAtMs})}catch{}const De=await Promise.all(ze.map(async Q=>{const Ie=ve[Q.key];if(!Ie)return null;try{const Me=await t.getPublicMediaUrl(Ie);return{key:Q.key,url:Me.downloadUrl}}catch{return null}})),He={};for(const Q of De)Q&&(He[Q.key]=Q.url);for(const Q of ze)Q.avatarUrl=He[Q.key];if(f)return;ze.sort((Q,Ie)=>Ie.at-Q.at),C(ze)}catch(Ae){f||r(q(Ae))}}A();const $=window.setInterval(()=>{A()},1e4);return()=>{f=!0,window.clearInterval($)}},[t,R,n.sessionToken,n.userId,r]),s.useEffect(()=>{d!=null&&d.key&&(z(Ne(d.key)),P("messages"),typeof l=="function"&&l())},[l,d]),s.useEffect(()=>{const f=A=>{var pe;((pe=A.detail)==null?void 0:pe.tab)==="threads"&&(z(null),P("messages"))};return window.addEventListener("rd:tab-select",f),()=>window.removeEventListener("rd:tab-select",f)},[]),s.useEffect(()=>{if(!R||F!=="profile")return;const f=mt(R);if(!f){x(null);return}let A=!1;return b(!0),t.getPublicProfile(f).then($=>{A||x($.profile)}).catch($=>{A||(x(null),r(q($)))}).finally(()=>{A||b(!1)}),()=>{A=!0}},[t,R,r,F]),s.useEffect(()=>{if(!R){_([]);return}let f=!1;const A=async()=>{try{const pe=await t.listChat(n.sessionToken,xe,R),Te=(pe==null?void 0:pe.messages)??[];f||(_(Array.isArray(Te)?Te:[]),t.markChatRead(n.sessionToken,xe,R).catch(()=>{}))}catch(pe){f||r(q(pe))}};A();const $=window.setInterval(()=>{A()},1200);return()=>{f=!0,window.clearInterval($)}},[t,R,n.sessionToken,r]);function N(f){if(!f.startsWith("GROUP_INVITE_ACCEPT|"))return null;const[,A,$]=f.split("|");return!A||!$?null:{inviteId:A,candidateKey:$}}const ne=s.useMemo(()=>({async sendMessage(f,A,$,pe){const Te=await t.sendChat(n.sessionToken,f,A,$,pe),Ee=Te==null?void 0:Te.message,Ae=N(Ee.text??"");if(Ae&&Ee.toKey===ge&&ae[Ae.inviteId]&&(O(Ae.candidateKey),he(`Invite accepted by ${Ae.candidateKey}.`),ce(be=>{const je={...be};return delete je[Ae.inviteId],je})),_(te=>[...te,Ee].sort((be,je)=>be.createdAtMs-je.createdAtMs)),f==="cruise"&&W)try{const te=await t.sendChat(n.sessionToken,f,W,$,pe),be=te==null?void 0:te.message;_(je=>[...je,be].sort((ve,$e)=>ve.createdAtMs-$e.createdAtMs))}catch(te){r(q(te))}return Ee},async initiateMediaUpload(f,A){const $=await t.initiateChatMediaUpload(n.sessionToken,{mimeType:f,sizeBytes:A});return{objectKey:$.objectKey,uploadUrl:$.uploadUrl}},async uploadToSignedUrl(f,A,$){if(await pt(f,A,$))return;if(!(await fetch(f,{method:"PUT",headers:{"content-type":$},body:A})).ok)throw{code:"MEDIA_UPLOAD_INCOMPLETE",message:"Upload failed."}},async getMediaUrl(f){return(await t.getChatMediaUrl(n.sessionToken,f)).downloadUrl}}),[t,ge,ae,n.sessionToken,r,W]);async function K(){var f;if(!(!R||!m)){if(!S.some(A=>A.key===m)){r("You can only add a third user you have previously messaged.");return}try{const A=crypto.randomUUID();await t.sendChat(n.sessionToken,"cruise",m,`GROUP_INVITE_REQUEST|${A}|${ge}|${R}`),ce($=>({...$,[A]:{candidateKey:m}})),he(`Invite sent to ${((f=S.find($=>$.key===m))==null?void 0:f.displayName)??m}.`)}catch(A){r(q(A))}}}async function Z(){if(R)try{await t.sendChat(n.sessionToken,"cruise",R,bt),he("Fire sent.")}catch(f){r(q(f))}}if(R){const f=(h==null?void 0:h.displayName)??R;return e.jsxs("div",{style:{display:"grid",gap:0,minHeight:v?"calc(100dvh - 150px)":void 0,marginInline:v?-10:0,marginBlock:0},children:[e.jsx("div",{style:{position:"sticky",top:0,zIndex:46,background:"rgba(8,8,12,0.96)",borderBottom:"1px solid rgba(255,58,77,0.35)",padding:"6px 10px",display:"flex",justifyContent:"flex-end"},children:e.jsx("button",{type:"button",onClick:()=>P(A=>A==="messages"?"profile":"messages"),style:{background:"transparent",border:0,color:"#26d5ff",fontSize:13,fontWeight:700,letterSpacing:"0.03em",textTransform:"uppercase",padding:0,cursor:"pointer"},children:F==="messages"?"View Profile":"Back to Thread"})}),F==="messages"?e.jsx(Zt,{chatKind:"cruise",peerKey:R,currentUserKey:ge,messages:H,client:ne,title:`INSTANT THREAD: ${f}`,peerSummary:{displayName:f},thirdParty:{candidates:p,selectedKey:m,onSelect:A=>L(A),onAdd:()=>void K(),disabled:!1},showHeader:!1,edgeToEdge:!0,fillHeight:v}):e.jsxs("div",{style:{padding:12,display:"grid",gap:12},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"88px 1fr",gap:12,alignItems:"center"},children:[e.jsx("img",{src:(h==null?void 0:h.avatarUrl)??Oe(R),alt:"Profile avatar",style:{width:88,height:88,borderRadius:"50%",objectFit:"cover",border:"2px solid #ff3047"}}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:24,fontWeight:700},children:(a==null?void 0:a.displayName)??f}),e.jsx("div",{style:{color:"#26d5ff",fontSize:14},children:"Instant Messaging Available"})]})]}),M?e.jsx("div",{style:{color:"#9fb6bf",fontSize:14},children:"Loading profile..."}):null,M?null:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:14,lineHeight:1.5},children:[e.jsxs("div",{children:["Age: ",(a==null?void 0:a.age)??"-"]}),e.jsxs("div",{children:["Race: ",((k=a==null?void 0:a.stats)==null?void 0:k.race)??"-"]}),e.jsxs("div",{children:["Height: ",((ye=a==null?void 0:a.stats)==null?void 0:ye.heightInches)??"-"]}),e.jsxs("div",{children:["Weight: ",((oe=a==null?void 0:a.stats)==null?void 0:oe.weightLbs)??"-"]}),e.jsxs("div",{children:["Cock Size: ",((me=a==null?void 0:a.stats)==null?void 0:me.cockSizeInches)??"-"]}),e.jsxs("div",{children:["Cut / Uncut: ",((c=a==null?void 0:a.stats)==null?void 0:c.cutStatus)??"-"]}),e.jsxs("div",{children:["Position: ",((D=a==null?void 0:a.stats)==null?void 0:D.position)??"-"]}),e.jsxs("div",{style:{marginTop:8},children:["Bio: ",(a==null?void 0:a.bio)??"-"]})]}),e.jsx("div",{children:e.jsx("button",{type:"button",style:{...B(!1),color:"#ffb347",borderColor:"rgba(255,179,71,0.65)"},onClick:()=>void Z(),children:"ðŸ”¥ FIRE"})})]})]})]})}return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:v?-10:0,marginBlock:0},children:[S.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14,padding:14},children:"No conversations yet."}):S.map(f=>e.jsxs("button",{type:"button",onClick:()=>z(f.key),style:{border:0,borderBottom:"1px solid rgba(255,58,77,0.24)",borderRadius:0,padding:"10px 12px",background:"rgba(0,0,0,0.2)",textAlign:"left",color:"#fff",cursor:"pointer",display:"grid",gridTemplateColumns:"52px 1fr",gap:10,alignItems:"center",width:"100%"},children:[e.jsx("img",{src:f.avatarUrl??Oe(f.key),alt:`${f.displayName} avatar`,style:{width:52,height:52,borderRadius:6,objectFit:"cover",border:"1px solid rgba(38,213,255,0.9)"}}),e.jsxs("div",{style:{display:"grid",gap:3,minWidth:0},children:[e.jsx("div",{style:{fontWeight:700},children:f.displayName}),e.jsx("div",{style:{color:"#b9bec9",fontSize:13,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:f.preview})]})]},f.key)),Se?e.jsx("div",{style:{color:"#26d5ff",fontSize:12,padding:10},children:Se}):null]})}function Un({api:t,session:n,isMobile:r,setLastError:d}){const[l,v]=s.useState("ads"),[S,C]=s.useState([]),[R,z]=s.useState([]),[H,_]=s.useState(""),[F,P]=s.useState(""),[a,x]=s.useState(""),[M,b]=s.useState(""),[m,L]=s.useState([]),[W,O]=s.useState(""),[ae,ce]=s.useState(""),[Se,he]=s.useState(""),[ge,xe]=s.useState(null),[p,h]=s.useState(null),[N,ne]=s.useState(null),[K,Z]=s.useState(""),[k,ye]=s.useState(""),[oe,me]=s.useState(""),[c,D]=s.useState({}),[f,A]=s.useState(null),[$,pe]=s.useState([]),[Te,Ee]=s.useState({}),Ae=!0,te=n.userType!=="guest",be=r?"repeat(2, minmax(0, 1fr))":"repeat(3, minmax(0, 1fr))";async function je(g){const G=Array.from(new Set(g.map(re=>re.trim()).filter(re=>re.length>0)));if(G.length===0)return;const se=G.filter(re=>!c[re]);if(se.length===0)return;const we=await Promise.all(se.map(async re=>{try{const Pe=await t.getPublicMediaUrl(re);return{mediaId:re,url:Pe.downloadUrl}}catch{return null}}));D(re=>{const Pe={...re};for(const Le of we)Le&&(Pe[Le.mediaId]=Le.url);return Pe})}async function ve(){try{const[g,G,se,we]=await Promise.all([t.listPublicPostings("ad"),t.listPublicPostings("event"),t.listCruisingSpots(),n.userType==="guest"?Promise.resolve({postings:[]}):t.listEventInvites(n.sessionToken)]);C([...g.postings].sort((re,Pe)=>re.createdAtMs-Pe.createdAtMs)),z([...G.postings].sort((re,Pe)=>re.createdAtMs-Pe.createdAtMs)),L(se.spots),pe(we.postings),await je([...g.postings.map(re=>re.photoMediaId??""),...G.postings.map(re=>re.photoMediaId??""),...se.spots.map(re=>re.photoMediaId??"")])}catch(g){d(q(g))}}s.useEffect(()=>{ve()},[]),s.useEffect(()=>{const g=G=>{var we;((we=G.detail)==null?void 0:we.tab)==="public"&&v("ads")};return window.addEventListener("rd:tab-select",g),()=>window.removeEventListener("rd:tab-select",g)},[]);async function $e(g){if(g==="event"&&!te){d("Anonymous users cannot create event postings.");return}const G=g==="ad"?H:a,se=g==="ad"?F:M,we=g==="ad"?K:k;try{await t.createPublicPosting(n.sessionToken,{type:g,title:G,body:se,photoMediaId:we||void 0}),g==="ad"?(_(""),P(""),xe(null),Z("")):(x(""),b(""),h(null),ye("")),await ve()}catch(re){d(q(re))}}async function ze(g){if(!te){d("Anonymous users cannot invite to events.");return}const G=(Te[g]??"").trim();if(!G){d("Target user id is required.");return}try{await t.inviteToEvent(n.sessionToken,{postingId:g,targetUserId:G}),Ee(se=>({...se,[g]:""})),await ve()}catch(se){d(q(se))}}async function De(g,G){if(n.userType==="guest"){d("Anonymous users cannot respond to event invites.");return}try{await t.respondToEventInvite(n.sessionToken,{postingId:g,accept:G}),await ve()}catch(se){d(q(se))}}async function He(){try{await t.createCruisingSpot(n.sessionToken,{name:W,address:ae,description:Se,photoMediaId:oe||void 0}),O(""),ce(""),he(""),ne(null),me(""),await ve()}catch(g){d(q(g))}}async function Q(g){try{await t.checkInCruisingSpot(n.sessionToken,g),await ve()}catch(G){d(q(G))}}async function Ie(g){const G=g==="ad"?ge:g==="event"?p:N;if(!G){d("Choose a photo before uploading.");return}if(n.userType==="guest"){d("Guests cannot upload media.");return}A(g);try{const se=await t.initiateMediaUpload(n.sessionToken,{kind:"photo_gallery",mimeType:G.type||"application/octet-stream",sizeBytes:G.size});if(!await pt(se.uploadUrl,G,G.type||"application/octet-stream")){const re=await fetch(se.uploadUrl,{method:"PUT",headers:{"content-type":G.type||"application/octet-stream"},body:G});if(!re.ok)throw{message:`Upload failed (${re.status}).`}}await t.completeMediaUpload(n.sessionToken,se.mediaId),await je([se.mediaId]),g==="ad"&&Z(se.mediaId),g==="event"&&ye(se.mediaId),g==="spot"&&me(se.mediaId)}catch(se){d(q(se))}finally{A(null)}}const Me=g=>{const G=g==="ads"?"ADS":"EVENTS",se=g==="ads"?S:R,we=g==="ads"?H:a,re=g==="ads"?F:M,Pe=g==="ads"?_:x,Le=g==="ads"?P:b,Xe=g==="ads"?ge:p,Ke=g==="ads"?xe:h,We=g==="ads"?K:k,Je=g==="ads"?Z:ye,u=g==="ads"?"ad":"event",y=g==="ads"?Ae:te,j=f===u;return e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.38)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:G}),e.jsx("input",{value:we,onChange:I=>Pe(I.target.value),placeholder:`${G} title`,style:ee(),"aria-label":`${G} title`,disabled:!y}),e.jsx("textarea",{value:re,onChange:I=>Le(I.target.value),placeholder:`Write ${G.toLowerCase()} details`,style:{...ee(),minHeight:86,resize:"vertical"},"aria-label":`${G} details`,disabled:!y}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:I=>{var Y;return Ke(((Y=I.target.files)==null?void 0:Y[0])??null)},disabled:!y}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",onClick:()=>void Ie(u),style:B(y?j:!0),disabled:!y||j,children:j?"UPLOADING...":"UPLOAD PHOTO"}),e.jsx("button",{type:"button",onClick:()=>{Je(""),Ke(null)},style:B(!1),children:"CLEAR PHOTO"})]}),We?e.jsx("img",{src:c[We]??Oe(We),alt:`${G} photo preview`,style:{width:"100%",maxWidth:240,aspectRatio:"1 / 1",objectFit:"cover",border:"1px solid rgba(255,58,77,0.4)"}}):null,!We&&Xe?e.jsx("div",{style:{color:"#b9bec9",fontSize:12},children:"Photo selected. Upload to attach."}):null]}),e.jsxs("button",{type:"button",onClick:()=>void $e(u),style:y?ke(!1):B(!0),disabled:!y,children:["POST ",G]}),y?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can view events but cannot post events."}),e.jsx("div",{style:{display:"grid",gap:0,marginTop:6},children:se.length===0?e.jsxs("div",{style:{color:"#b9bec9",fontSize:14},children:["No ",G.toLowerCase()," yet."]}):e.jsx("div",{style:{display:"grid",gap:0,gridTemplateColumns:be},children:se.map(I=>{var Y,ie;return e.jsxs("div",{style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,display:"grid",gap:0},children:[e.jsx("div",{style:{position:"relative",width:"100%",aspectRatio:"1 / 1"},children:e.jsx("img",{src:I.photoMediaId?c[I.photoMediaId]??Oe(I.postingId):Oe(I.postingId),alt:`${G} posting`,style:{width:"100%",height:"100%",borderRadius:0,objectFit:"cover",border:"1px solid #0fd9ff"}})}),e.jsxs("div",{style:{padding:8,display:"grid",gap:6},children:[e.jsx("div",{style:{fontWeight:700,fontSize:14},children:I.title}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12},children:["Host: ",I.authorUserId]}),e.jsx("div",{style:{color:"#ced3dc",fontSize:13,whiteSpace:"pre-wrap"},children:I.body}),g==="events"?e.jsxs("div",{style:{display:"grid",gap:8,marginTop:4},children:[e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12},children:["Invited: ",((Y=I.invitedUserIds)==null?void 0:Y.length)??0," | Accepted: ",((ie=I.acceptedUserIds)==null?void 0:ie.length)??0]}),n.userId&&n.userId===I.authorUserId?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8},children:[e.jsx("input",{value:Te[I.postingId]??"",onChange:fe=>Ee(Re=>({...Re,[I.postingId]:fe.target.value})),placeholder:"Invite user id",style:ee()}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void ze(I.postingId),children:"INVITE"})]}):null,n.userType!=="guest"&&n.userId&&Array.isArray(I.invitedUserIds)&&I.invitedUserIds.includes(n.userId)?e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:ke(!1),onClick:()=>void De(I.postingId,!0),children:"ACCEPT INVITE"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void De(I.postingId,!1),children:"DECLINE"})]}):null]}):null]})]},I.postingId)})})})]})})},Ce=e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.38)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"CRUISING SPOTS"}),e.jsx("input",{value:W,onChange:g=>O(g.target.value),placeholder:"Spot name",style:ee(),disabled:!1}),e.jsx("input",{value:ae,onChange:g=>ce(g.target.value),placeholder:"Spot address",style:ee(),disabled:!1}),e.jsx("textarea",{value:Se,onChange:g=>he(g.target.value),placeholder:"Spot description",style:{...ee(),minHeight:80,resize:"vertical"},disabled:!1}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:g=>{var G;return ne(((G=g.target.files)==null?void 0:G[0])??null)},disabled:!1}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:B(f==="spot"),disabled:f==="spot",onClick:()=>void Ie("spot"),children:f==="spot"?"UPLOADING...":"UPLOAD PHOTO"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>{ne(null),me("")},children:"CLEAR PHOTO"})]}),oe?e.jsx("img",{src:c[oe]??Oe(oe),alt:"Cruising spot preview",style:{width:"100%",maxWidth:240,aspectRatio:"1 / 1",objectFit:"cover",border:"1px solid rgba(255,58,77,0.4)"}}):null,!oe&&N?e.jsx("div",{style:{color:"#b9bec9",fontSize:12},children:"Photo selected. Upload to attach."}):null]}),e.jsx("button",{type:"button",style:ke(!1),disabled:!1,onClick:()=>void He(),children:"CREATE SPOT"}),null,e.jsx("div",{style:{display:"grid",gap:0},children:m.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"No cruising spots yet."}):e.jsx("div",{style:{display:"grid",gap:0,gridTemplateColumns:be},children:m.map(g=>e.jsxs("div",{style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,display:"grid",gap:0},children:[e.jsx("div",{style:{position:"relative",width:"100%",aspectRatio:"1 / 1"},children:e.jsx("img",{src:g.photoMediaId?c[g.photoMediaId]??Oe(g.spotId):Oe(g.spotId),alt:"Cruising spot",style:{width:"100%",height:"100%",borderRadius:0,objectFit:"cover",border:"1px solid #0fd9ff"}})}),e.jsxs("div",{style:{padding:8,display:"grid",gap:6},children:[e.jsx("div",{style:{fontWeight:700},children:g.name}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12},children:["Created by: ",g.creatorUserId]}),e.jsx("div",{style:{color:"#9fb6bf",fontSize:12},children:g.address}),e.jsx("div",{style:{color:"#ced3dc",fontSize:13,whiteSpace:"pre-wrap"},children:g.description}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:B(!1),onClick:()=>void Q(g.spotId),children:"CHECK IN"}),e.jsxs("span",{style:{color:"#9fb6bf",fontSize:12},children:["Checked in: ",g.checkInCount??0]}),e.jsxs("span",{style:{color:"#9fb6bf",fontSize:12},children:["Got action: ",g.actionCount??0]})]})]})]},g.spotId))})})]})});return e.jsx("div",{style:{display:"grid",gap:8,marginInline:r?-10:0},children:r?e.jsxs(e.Fragment,{children:[l==="ads"?Me("ads"):null,l==="events"?Me("events"):null,l==="spots"?Ce:null,e.jsx("div",{style:{position:"sticky",bottom:"calc(86px + env(safe-area-inset-bottom, 0px))",zIndex:31,background:"rgba(0,0,0,0.35)",padding:8},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[e.jsx("button",{type:"button",style:l==="ads"?ke(!1):B(!1),onClick:()=>v("ads"),children:"ADS"}),e.jsx("button",{type:"button",style:l==="events"?ke(!1):B(!1),onClick:()=>v("events"),children:"EVENTS"}),e.jsx("button",{type:"button",style:l==="spots"?ke(!1):B(!1),onClick:()=>v("spots"),children:"SPOTS"})]})})]}):e.jsxs("div",{style:{display:"grid",gap:12},children:[Me("ads"),Me("events"),e.jsx("div",{children:Ce}),n.userType!=="guest"&&$.length>0?e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.25)",display:"grid",gap:8,padding:10},children:[e.jsx("div",{style:{fontSize:16,fontWeight:700},children:"EVENT INVITES"}),$.map(g=>e.jsxs("div",{style:{display:"grid",gap:6,border:"1px solid rgba(255,58,77,0.4)",borderRadius:10,padding:8},children:[e.jsx("div",{style:{fontWeight:700},children:g.title}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13},children:["Host: ",g.authorUserId]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:ke(!1),onClick:()=>void De(g.postingId,!0),children:"ACCEPT"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void De(g.postingId,!1),children:"DECLINE"})]})]},g.postingId))]}):null]})})}function On({api:t,session:n,setLastError:r}){const[d,l]=s.useState([]),[v,S]=s.useState(""),[C,R]=s.useState("");async function z(){try{const a=await t.listSubmissions();l([...a.submissions].sort((x,M)=>M.createdAtMs-x.createdAtMs))}catch(a){r(q(a))}}s.useEffect(()=>{z()},[]);async function H(){try{await t.createSubmission(n.sessionToken,{title:v,body:C}),S(""),R(""),await z()}catch(a){r(q(a))}}async function _(a){try{await t.recordSubmissionView(a),await z()}catch(x){r(q(x))}}async function F(a,x){try{await t.rateSubmission(a,x),await z()}catch(M){r(q(M))}}const P=n.userType!=="guest";return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("input",{style:ee(),value:v,onChange:a=>S(a.target.value),placeholder:"Story title",disabled:!P}),e.jsx("textarea",{style:{...ee(),minHeight:120},value:C,onChange:a=>R(a.target.value),placeholder:"Write your story",disabled:!P}),e.jsx("button",{type:"button",style:P?ke(!1):B(!0),disabled:!P,onClick:()=>void H(),children:"PUBLISH STORY"}),P?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can read but cannot publish submissions."})]})}),e.jsx("div",{style:{display:"grid",gap:10},children:d.map(a=>{const x=a.ratingCount>0?(a.ratingSum/a.ratingCount).toFixed(2):"0.00";return e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.28)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:a.title}),e.jsx("div",{style:{color:"#ced3dc",whiteSpace:"pre-wrap",marginTop:6},children:a.body}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13,marginTop:8},children:["Views: ",a.viewCount," | Rating: ",x," (",a.ratingCount,")"]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:B(!1),onClick:()=>void _(a.submissionId),children:"VIEW"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void F(a.submissionId,1),children:"â˜…1"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void F(a.submissionId,2),children:"â˜…2"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void F(a.submissionId,3),children:"â˜…3"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void F(a.submissionId,4),children:"â˜…4"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void F(a.submissionId,5),children:"â˜…5"})]})]},a.submissionId)})})]})}function Ln({api:t,session:n,setLastError:r}){var ge,xe,p,h,N,ne;const[d,l]=s.useState([]),[v,S]=s.useState({}),[C,R]=s.useState(null),[z,H]=s.useState(2e3),[_,F]=s.useState(""),[P,a]=s.useState(""),[x,M]=s.useState(""),[b,m]=s.useState(""),[L,W]=s.useState("Ready."),O=n.userType!=="guest";async function ae(){try{const K=await t.listPromotedProfiles();l([...K.listings].sort((oe,me)=>me.createdAtMs-oe.createdAtMs)),H(K.feeCents);const Z=Array.from(new Set(K.listings.map(oe=>oe.userId))).filter(oe=>oe.trim().length>0),k=await Promise.all(Z.map(async oe=>{try{const c=(await t.getPublicProfile(oe)).profile.mainPhotoMediaId;if(!c)return null;const D=await t.getPublicMediaUrl(c);return{userId:oe,url:D.downloadUrl}}catch{return null}})),ye={};for(const oe of k)oe&&(ye[oe.userId]=oe.url);S(ye)}catch(K){r(q(K))}}s.useEffect(()=>{ae()},[]);async function ce(){if(!O){r("Anonymous users cannot create promoted profiles.");return}try{const K=await t.startPromotedPayment(n.sessionToken),Z=await t.confirmPromotedPayment(n.sessionToken,K.payment.paymentToken);m(Z.payment.paymentToken),W("Payment confirmed. You can now publish one promoted profile.")}catch(K){const Z=q(K);W(Z),r(Z)}}async function Se(){if(!O){r("Anonymous users cannot create promoted profiles.");return}try{await t.createPromotedProfile(n.sessionToken,{paymentToken:b,title:_,body:P,displayName:x}),F(""),a(""),M(""),m(""),W("Promoted profile published."),await ae()}catch(K){const Z=q(K);W(Z),r(Z)}}async function he(K){try{const Z=await t.getPublicProfile(K);R(Z.profile)}catch(Z){r(q(Z))}}return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"PROMOTED PROFILES"}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:14},children:["Publishing requires a $",Math.round(z/100)," fee per profile."]}),e.jsx("div",{style:{color:"#26d5ff",fontSize:13},children:L})]})}),e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("input",{value:x,onChange:K=>M(K.target.value),placeholder:"Display name",style:ee(),disabled:!O}),e.jsx("input",{value:_,onChange:K=>F(K.target.value),placeholder:"Headline",style:ee(),disabled:!O}),e.jsx("textarea",{value:P,onChange:K=>a(K.target.value),placeholder:"Profile description",style:{...ee(),minHeight:92,resize:"vertical"},disabled:!O}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsxs("button",{type:"button",style:B(!O),disabled:!O,onClick:()=>void ce(),children:["PAY $",Math.round(z/100)]}),e.jsx("button",{type:"button",style:O?ke(!1):B(!0),disabled:!O,onClick:()=>void Se(),children:"PUBLISH PROFILE"})]}),O?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can browse but cannot publish paid profiles."})]})}),e.jsx("div",{style:{display:"grid",gap:10},children:d.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"No promoted profiles yet."}):d.map(K=>e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.25)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"72px 1fr",gap:10,alignItems:"start"},children:[e.jsx("img",{src:v[K.userId]??Oe(`user:${K.userId}`),alt:`${K.displayName} profile`,style:{width:72,height:72,borderRadius:6,objectFit:"cover",border:"1px solid rgba(38,213,255,0.9)"}}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:K.title}),e.jsx("div",{style:{color:"#26d5ff",fontSize:13},children:K.displayName}),e.jsx("div",{style:{color:"#ced3dc",whiteSpace:"pre-wrap",fontSize:14},children:K.body}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void he(K.userId),children:"VIEW PROFILE"})]})]})},K.listingId))}),C?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},onClick:()=>R(null),children:e.jsxs("div",{onClick:K=>K.stopPropagation(),style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:12,width:"min(560px, 100%)",background:"rgba(0,0,0,0.88)"},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:C.displayName}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:6},children:["Age: ",C.age]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Race: ",((ge=C.stats)==null?void 0:ge.race)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Height: ",((xe=C.stats)==null?void 0:xe.heightInches)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Weight: ",((p=C.stats)==null?void 0:p.weightLbs)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Cock Size: ",((h=C.stats)==null?void 0:h.cockSizeInches)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Cut / Uncut: ",((N=C.stats)==null?void 0:N.cutStatus)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Position: ",((ne=C.stats)==null?void 0:ne.position)??"-"]}),e.jsx("div",{style:{color:"#ced3dc",marginTop:10,whiteSpace:"pre-wrap"},children:C.bio}),e.jsx("div",{style:{marginTop:10},children:e.jsx("button",{type:"button",style:B(!1),onClick:()=>R(null),children:"CLOSE"})})]})}):null]})}function Kn(){return{displayName:"",age:"",bio:"",heightInches:"",race:"",cockSizeInches:"",cutStatus:"",weightLbs:"",position:"",discreetMode:!1,travelEnabled:!1,travelLat:"",travelLng:"",lookingForMore:""}}function Gt(t){var r,d,l;const n=tn(t.bio);return{displayName:t.displayName,age:String(t.age),bio:n.bio,heightInches:t.stats.heightInches!==void 0?String(t.stats.heightInches):"",race:t.stats.race??"",cockSizeInches:t.stats.cockSizeInches!==void 0?String(t.stats.cockSizeInches):"",cutStatus:t.stats.cutStatus??"",weightLbs:t.stats.weightLbs!==void 0?String(t.stats.weightLbs):"",position:t.stats.position??"",discreetMode:t.discreetMode===!0,travelEnabled:((r=t.travelMode)==null?void 0:r.enabled)===!0,travelLat:typeof((d=t.travelMode)==null?void 0:d.lat)=="number"?String(t.travelMode.lat):"",travelLng:typeof((l=t.travelMode)==null?void 0:l.lng)=="number"?String(t.travelMode.lng):"",lookingForMore:n.lookingForMore}}function tn(t){const n=t.replace(/\r\n/g,`
`).trim(),r="Looking For More:",d=/Looking For More:\s*/g,l=Array.from(n.matchAll(d));if(l.length===0)return{bio:n,lookingForMore:""};const v=l[0],S=l[l.length-1],C=typeof v.index=="number"?v.index:n.indexOf(r),R=(typeof S.index=="number"?S.index:n.lastIndexOf(r))+S[0].length,z=n.slice(0,Math.max(0,C)).trim(),H=n.slice(Math.max(0,R)).trim();return{bio:z,lookingForMore:H}}function Wn(t,n){const d=tn(t).bio.trim(),l=n.trim();return l?d?`${d}

Looking For More: ${l}`:`${l}`:d}function Vt(t){const n=t.trim();if(!n)return;const r=Number(n);return Number.isFinite(r)?Math.trunc(r):void 0}function Dn(t){const n=t.trim();if(!n)return;const r=Number(n);return Number.isFinite(r)?r:void 0}function Bn({api:t,session:n,setLastError:r}){var ge,xe;const[d,l]=s.useState(Kn()),[v,S]=s.useState(null),[C,R]=s.useState(!1),[z,H]=s.useState(!1),[_,F]=s.useState(null),[P,a]=s.useState({});async function x(){R(!0);try{const p=await t.getMyProfile(n.sessionToken);S(p.profile),l(Gt(p.profile)),F("Profile loaded.")}catch(p){const h=p;if((h==null?void 0:h.code)==="PROFILE_NOT_FOUND"){S(null),l(N=>({...N,age:N.age||"18"})),F("No profile yet. Fill out the form and save.");return}F(q(p))}finally{R(!1)}}s.useEffect(()=>{x()},[n.sessionToken,n.userType]),s.useEffect(()=>{const p=[v==null?void 0:v.mainPhotoMediaId,...(v==null?void 0:v.galleryMediaIds)??[]].filter(N=>typeof N=="string"&&N.length>0);if(p.length===0)return;const h=p.filter(N=>!P[N]);h.length!==0&&Promise.all(h.map(async N=>{try{const ne=await t.getPublicMediaUrl(N);return{id:N,url:ne.downloadUrl}}catch{return null}})).then(N=>{a(ne=>{const K={...ne};for(const Z of N)Z&&(K[Z.id]=Z.url);return K})})},[t,P,v==null?void 0:v.galleryMediaIds,v==null?void 0:v.mainPhotoMediaId]);async function M(){var p,h,N,ne,K;H(!0),r(null);try{const Z=Number(d.age),k=Wn(d.bio,d.lookingForMore),ye=d.travelLat.trim()?Number(d.travelLat):void 0,oe=d.travelLng.trim()?Number(d.travelLng):void 0,me={displayName:d.displayName,age:Math.trunc(Z),bio:k,stats:{heightInches:Vt(d.heightInches),race:d.race.trim()||void 0,cockSizeInches:Dn(d.cockSizeInches),cutStatus:d.cutStatus||void 0,weightLbs:Vt(d.weightLbs),position:d.position||void 0},discreetMode:d.discreetMode,travelMode:{enabled:d.travelEnabled,lat:Number.isFinite(ye)?ye:void 0,lng:Number.isFinite(oe)?oe:void 0}},c=await t.upsertMyProfile(n.sessionToken,me);S(c.profile),l(Gt(c.profile));try{localStorage.setItem("reddoor_travel_center",JSON.stringify({enabled:((p=c.profile.travelMode)==null?void 0:p.enabled)===!0,lat:(h=c.profile.travelMode)==null?void 0:h.lat,lng:(N=c.profile.travelMode)==null?void 0:N.lng})),window.dispatchEvent(new CustomEvent("rd:location-updated",{detail:{lat:(ne=c.profile.travelMode)==null?void 0:ne.lat,lng:(K=c.profile.travelMode)==null?void 0:K.lng}}))}catch{}F("Profile saved.")}catch(Z){const k=q(Z);F(k),r(k)}finally{H(!1)}}async function b(p,h){if(!h){F("Choose a file first.");return}if(n.userType==="guest"){F("Guest sessions cannot upload media. Register to persist media.");return}H(!0),r(null);try{const N=await t.initiateMediaUpload(n.sessionToken,{kind:p,mimeType:h.type||(p==="video"?"video/mp4":"image/jpeg"),sizeBytes:h.size});if(!await pt(N.uploadUrl,h,h.type||"application/octet-stream")){const K=await fetch(N.uploadUrl,{method:"PUT",headers:{"content-type":h.type||"application/octet-stream"},body:h});if(!K.ok)throw{message:`Upload failed (${K.status}).`}}await t.completeMediaUpload(n.sessionToken,N.mediaId),await x(),F("Media uploaded.")}catch(N){const ne=q(N);F(ne),r(ne)}finally{H(!1)}}const[m,L]=s.useState(null),[W,O]=s.useState(null),[ae,ce]=s.useState(null);async function Se(p){if(v){H(!0);try{const h=(v.galleryMediaIds??[]).filter(ne=>ne!==p),N=await t.updateProfileMediaReferences(n.sessionToken,{galleryMediaIds:h});S(N.profile),F("Gallery updated.")}catch(h){const N=q(h);F(N),r(N)}finally{H(!1)}}}async function he(p){if(v){H(!0);try{const h=await t.updateProfileMediaReferences(n.sessionToken,{galleryMediaIds:v.galleryMediaIds,mainPhotoMediaId:p});S(h.profile),F("Main photo updated.")}catch(h){const N=q(h);F(N),r(N)}finally{H(!1)}}}return e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:Be(),children:e.jsxs("div",{style:{display:"grid",gap:14},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"SETTINGS / PROFILE"}),n.userType==="guest"?e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guest profile data is temporary for this session and is removed when you log out."}):null,_?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:_}):null,e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Display Name"}),e.jsx("input",{value:d.displayName,onChange:p=>l(h=>({...h,displayName:p.target.value})),style:ee()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Age"}),e.jsx("input",{value:d.age,onChange:p=>l(h=>({...h,age:p.target.value})),style:ee(),inputMode:"numeric"})]})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Bio"}),e.jsx("textarea",{value:d.bio,onChange:p=>l(h=>({...h,bio:p.target.value})),style:{...ee(),minHeight:88,resize:"vertical"}})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Looking For More (Optional)"}),e.jsx("textarea",{value:d.lookingForMore,onChange:p=>l(h=>({...h,lookingForMore:p.target.value})),style:{...ee(),minHeight:72,resize:"vertical"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:d.discreetMode,onChange:p=>l(h=>({...h,discreetMode:p.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0,fontSize:13},children:"Discreet Mode (hide profile from others)"})]}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:d.travelEnabled,onChange:p=>l(h=>({...h,travelEnabled:p.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Travel Mode"})]})]}),d.travelEnabled?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Travel Lat"}),e.jsx("input",{value:d.travelLat,onChange:p=>l(h=>({...h,travelLat:p.target.value})),style:ee()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Travel Lng"}),e.jsx("input",{value:d.travelLng,onChange:p=>l(h=>({...h,travelLng:p.target.value})),style:ee()})]})]}):null,e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Height (in)"}),e.jsx("input",{value:d.heightInches,onChange:p=>l(h=>({...h,heightInches:p.target.value})),style:ee(),inputMode:"numeric"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Race"}),e.jsx("input",{value:d.race,onChange:p=>l(h=>({...h,race:p.target.value})),style:ee()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Cock Size (in)"}),e.jsx("input",{value:d.cockSizeInches,onChange:p=>l(h=>({...h,cockSizeInches:p.target.value})),style:ee(),inputMode:"decimal"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Cut / Uncut"}),e.jsxs("select",{value:d.cutStatus,onChange:p=>l(h=>({...h,cutStatus:p.target.value})),style:ee(),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"cut",children:"Cut"}),e.jsx("option",{value:"uncut",children:"Uncut"})]})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Weight (lbs)"}),e.jsx("input",{value:d.weightLbs,onChange:p=>l(h=>({...h,weightLbs:p.target.value})),style:ee(),inputMode:"numeric"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Position"}),e.jsxs("select",{value:d.position,onChange:p=>l(h=>({...h,position:p.target.value})),style:ee(),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"top",children:"Top"}),e.jsx("option",{value:"bottom",children:"Bottom"}),e.jsx("option",{value:"side",children:"Side"})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",onClick:()=>void M(),style:ke(z),disabled:z,children:"SAVE PROFILE"}),e.jsx("button",{type:"button",onClick:()=>void x(),style:B(C),disabled:C,children:"REFRESH"})]})]})}),e.jsx("div",{style:Be(),children:e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"MEDIA"}),e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"Main profile photo, gallery photo, and video uploads."}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Main Photo"}),e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:p=>{var h;return L(((h=p.target.files)==null?void 0:h[0])??null)}})]}),e.jsx("button",{type:"button",style:ke(z),disabled:z,onClick:()=>void b("photo_main",m),children:"UPLOAD MAIN PHOTO"})]}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Gallery Photo"}),e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:p=>{var h;return O(((h=p.target.files)==null?void 0:h[0])??null)}})]}),e.jsx("button",{type:"button",style:ke(z),disabled:z,onClick:()=>void b("photo_gallery",W),children:"UPLOAD GALLERY PHOTO"})]}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Video"}),e.jsx("input",{className:"rd-input",type:"file",accept:"video/*",onChange:p=>{var h;return ce(((h=p.target.files)==null?void 0:h[0])??null)}})]}),e.jsx("button",{type:"button",style:ke(z),disabled:z,onClick:()=>void b("video",ae),children:"UPLOAD VIDEO"})]}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13},children:["Main photo media id: ",(v==null?void 0:v.mainPhotoMediaId)??"-",e.jsx("br",{}),"Gallery count: ",((ge=v==null?void 0:v.galleryMediaIds)==null?void 0:ge.length)??0,e.jsx("br",{}),"Video media id: ",(v==null?void 0:v.videoMediaId)??"-"]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"YOUR GALLERY"}),(xe=v==null?void 0:v.galleryMediaIds)!=null&&xe.length?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(130px, 1fr))",gap:10},children:v.galleryMediaIds.map(p=>e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.45)",borderRadius:10,padding:8,display:"grid",gap:8},children:[e.jsx("img",{src:P[p]??Oe(p),alt:"Gallery photo",style:{width:"100%",aspectRatio:"1/1",objectFit:"cover",borderRadius:8,border:"1px solid rgba(255,58,77,0.4)"}}),e.jsx("button",{type:"button",style:B(z),disabled:z,onClick:()=>void he(p),children:"SET MAIN"}),e.jsx("button",{type:"button",style:B(z),disabled:z,onClick:()=>void Se(p),children:"REMOVE"})]},p))}):e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No gallery photos uploaded yet."})]})]})})]})}function $n({api:t,session:n,setLastError:r,onLogout:d}){const[l,v]=s.useState({discreetMode:!1,travelEnabled:!1,travelLat:"",travelLng:""}),[S,C]=s.useState("Loading settings..."),[R,z]=s.useState(!1),[H,_]=s.useState([]);async function F(){var b,m,L;try{const W=await t.getMyProfile(n.sessionToken);if(v({discreetMode:W.profile.discreetMode===!0,travelEnabled:((b=W.profile.travelMode)==null?void 0:b.enabled)===!0,travelLat:typeof((m=W.profile.travelMode)==null?void 0:m.lat)=="number"?String(W.profile.travelMode.lat):"",travelLng:typeof((L=W.profile.travelMode)==null?void 0:L.lng)=="number"?String(W.profile.travelMode.lng):""}),C("Settings loaded."),n.userType!=="guest")try{const O=await t.listBlocked(n.sessionToken);_(O.blocked)}catch{_([])}else _([])}catch(W){C(q(W))}}async function P(){try{const b=await fetch("/api/config"),m=await b.json();if(!b.ok)throw m;z(m.mediaStorageConfigured===!0)}catch{z(!1)}}s.useEffect(()=>{F(),P()},[n.sessionToken,n.userType]);async function a(){try{const b=await t.getMyProfile(n.sessionToken),m=l.travelLat.trim()?Number(l.travelLat):void 0,L=l.travelLng.trim()?Number(l.travelLng):void 0;await t.upsertMyProfile(n.sessionToken,{displayName:b.profile.displayName,age:b.profile.age,bio:b.profile.bio,stats:b.profile.stats,discreetMode:l.discreetMode,travelMode:{enabled:l.travelEnabled,lat:Number.isFinite(m)?m:void 0,lng:Number.isFinite(L)?L:void 0}}),C("Privacy settings saved.")}catch(b){const m=q(b);C(m),r(m)}}async function x(){if(!navigator.geolocation){const b="Geolocation is unavailable on this device.";C(b),r(b);return}try{const b=await new Promise((W,O)=>{navigator.geolocation.getCurrentPosition(W,O,{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})}),m=Number(b.coords.latitude.toFixed(6)),L=Number(b.coords.longitude.toFixed(6));v(W=>({...W,travelEnabled:!0,travelLat:String(m),travelLng:String(L)}));try{localStorage.setItem("reddoor_travel_center",JSON.stringify({enabled:!0,lat:m,lng:L}))}catch{}try{await t.updatePresence(n.sessionToken,m,L,"online")}catch{}window.dispatchEvent(new CustomEvent("rd:location-updated",{detail:{lat:m,lng:L}})),C("Actual location detected. Save privacy settings to persist it.")}catch(b){const m=q(b);C(m),r(m)}}async function M(b){try{await t.unblock(n.sessionToken,b);const m=await t.listBlocked(n.sessionToken);_(m.blocked),C("Blocked users updated.")}catch(m){const L=q(m);C(L),r(L)}}return e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:Be(),children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"SETTINGS"}),e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:S}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:l.discreetMode,onChange:b=>v(m=>({...m,discreetMode:b.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Discreet Mode (hide your profile)"})]}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:l.travelEnabled,onChange:b=>v(m=>({...m,travelEnabled:b.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Travel Mode"})]}),l.travelEnabled?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("input",{value:l.travelLat,onChange:b=>v(m=>({...m,travelLat:b.target.value})),style:ee(),placeholder:"Travel lat"}),e.jsx("input",{value:l.travelLng,onChange:b=>v(m=>({...m,travelLng:b.target.value})),style:ee(),placeholder:"Travel lng"})]}):null,e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:ke(!1),onClick:()=>void a(),children:"SAVE PRIVACY"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void x(),children:"DETECT ACTUAL LOCATION"}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>d==null?void 0:d(),children:"LOGOUT"})]})]})}),e.jsx("div",{style:Be(),children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"MEDIA STORAGE"}),e.jsx("div",{style:{color:R?"#26d5ff":"#ff8a95",fontSize:14},children:R?"Configured: uploads enabled.":"Not configured: set S3_BUCKET, S3_REGION, S3_ACCESS_KEY_ID, S3_SECRET_ACCESS_KEY."}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void P(),children:"REFRESH STORAGE STATUS"})]})}),n.userType!=="guest"?e.jsx("div",{style:Be(),children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"BLOCKED USERS"}),H.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No blocked users."}):H.map(b=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[e.jsx("div",{style:{color:"#ced3dc",fontSize:14},children:b}),e.jsx("button",{type:"button",style:B(!1),onClick:()=>void M(b),children:"UNBLOCK"})]},b))]})}):null]})}function _n({api:t,session:n,setSession:r,settings:d,activeTab:l,setActiveTab:v,discoverScreen:S,onDiscoverScreenChange:C,discoverFilter:R,busy:z,setBusy:H,setLastError:_,onUnreadCountChange:F,hideModeCard:P,onLogout:a}){const x=Rn(),[M,b]=s.useState(null),m=e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx(Bn,{api:t,session:n,setLastError:_}),e.jsx($n,{api:t,session:n,setLastError:_,onLogout:a})]});return e.jsxs("div",{style:{display:"grid",gap:12},children:[null,e.jsx("div",{style:{display:l==="discover"?"block":"none"},children:e.jsx(Nn,{api:t,session:n,settings:d,discoverFilter:R,busy:z,setBusy:H,setLastError:_,isMobile:x,discoverScreen:S,onDiscoverScreenChange:C,onOpenThreadRequested:L=>{b({key:Ne(L),nonce:Date.now()}),v("threads")},onUnreadCountChange:F})}),l==="threads"?e.jsx(zn,{api:t,session:n,setLastError:_,openThreadRequest:M,onThreadRequestConsumed:()=>b(null),isMobile:x}):null,l==="public"?e.jsx(Un,{api:t,session:n,isMobile:x,setLastError:_}):null,l==="profile"||l==="settings"?m:null,l==="submissions"?e.jsx(On,{api:t,session:n,setLastError:_}):null,l==="promoted"?e.jsx(Ln,{api:t,session:n,setLastError:_}):null]})}export{_n as Router};
