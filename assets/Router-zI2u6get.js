const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./maplibre-gl-kIHVRkyf.js","./index-c1x9SBk0.js","./index-CcRnFIlo.css"])))=>i.map(i=>d[i]);
import{r as s,j as e,_ as fn,p as Vt,a as Yt,b as Jt,u as bt}from"./index-c1x9SBk0.js";function Qt(t){return typeof t=="object"&&t!==null}function gn(t){return!(!Qt(t)||typeof t.key!="string"||t.userType!=="guest"&&t.userType!=="registered"&&t.userType!=="subscriber"||typeof t.lat!="number"||!Number.isFinite(t.lat)||typeof t.lng!="number"||!Number.isFinite(t.lng)||typeof t.updatedAtMs!="number"||!Number.isFinite(t.updatedAtMs)||t.status!==void 0&&typeof t.status!="string")}function qt(t){const[n,a]=s.useState(()=>new Map),[u,c]=s.useState(null),v=s.useRef(null),S=s.useRef(null);return s.useEffect(()=>{if(t.disabled===!0||t.wsUrl.trim()===""){a(new Map),c(null),S.current!==null&&(window.clearTimeout(S.current),S.current=null);return}let A=!1,U=0,_=null;const H=()=>{_!==null&&(window.clearInterval(_),_=null)},T=()=>{if(A)return;const o=Math.min(8e3,500*2**Math.min(U,4));S.current=window.setTimeout(()=>{S.current=null,C()},o)},C=()=>{if(A)return;let o;try{o=new WebSocket(t.wsUrl)}catch{U+=1,c("Realtime unavailable in this mode."),T();return}v.current=o;let b=!1;o.onopen=()=>{b=!0,U=0,c(null);const M={};t.sessionToken&&(M.sessionToken=t.sessionToken),t.jwt&&(M.jwt=t.jwt),o.send(JSON.stringify({type:"auth",payload:M})),_=window.setInterval(()=>{o.readyState===o.OPEN&&o.send(JSON.stringify({type:"heartbeat",payload:{}}))},15e3)},o.onmessage=M=>{const K=(()=>{try{return JSON.parse(String(M.data))}catch{return null}})();if(!K||typeof K.type!="string"){c("Invalid server message.");return}if(K.type==="error"&&Qt(K.payload)&&typeof K.payload.message=="string"){c(K.payload.message);return}if(K.type==="presence_update"){const g=K.payload;if(!gn(g)){c("Invalid presence payload.");return}a(j=>{const O=new Map(j);return O.set(g.key,g),O})}},o.onerror=()=>{},o.onclose=M=>{if(H(),!A&&M.code!==1e3){U+=1;const K=typeof M.reason=="string"&&M.reason.trim()!==""?` Reason: ${M.reason}`:"";(U>=2||b)&&c(`Realtime ${b?"disconnected":"failed to connect"} (code ${M.code}). Reconnecting...${K}`),T()}}};return C(),()=>{var o;A=!0,H(),S.current!==null&&(window.clearTimeout(S.current),S.current=null),(o=v.current)==null||o.close(1e3,"Client cleanup"),v.current=null}},[t.disabled,t.jwt,t.sessionToken,t.wsUrl]),{state:s.useMemo(()=>({byKey:n}),[n]),lastErrorMessage:u}}async function yn(){const t=await fn(()=>import("./maplibre-gl-kIHVRkyf.js").then(a=>a.m),__vite__mapDeps([0,1,2]),import.meta.url);return t.default??t}function pn(t){return t.replace(/[&<>"']/g,n=>{switch(n){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return n}})}function hn(){return{version:8,sources:{basemap:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png","https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"Â© OpenStreetMap contributors"}},layers:[{id:"basemap",type:"raster",source:"basemap"}]}}function mn(t){const n=document.createElement("button");return n.type="button",n.setAttribute("aria-label",t.label??"Presence marker"),n.style.width="36px",n.style.height="36px",n.style.borderRadius="999px",n.style.border=`2px solid ${t.color}`,t.markerType==="spot"?(n.style.background="radial-gradient(circle at 30% 30%, #ff4f60, #a70013)",n.style.display="grid",n.style.placeItems="center",n.style.color="#ffffff",n.style.fontWeight="700",n.style.fontSize="13px",n.textContent=typeof t.markerGlyph=="string"&&t.markerGlyph.trim()?t.markerGlyph.trim().slice(0,2):"SP"):typeof t.imageUrl=="string"&&t.imageUrl.trim()!==""?(n.style.backgroundImage=`url("${t.imageUrl}")`,n.style.backgroundSize="cover",n.style.backgroundPosition="center"):n.style.background="#000000",n.style.padding="0",n.style.cursor=typeof t.onClick=="function"?"pointer":"default",n}function bn({initialView:t,markers:n,interactive:a,visible:u}){const c=s.useRef(null),v=s.useRef(null),S=s.useRef(null),I=s.useRef([]),[A,U]=s.useState({kind:"ready"}),_=s.useMemo(()=>t.center,[t.center]),H=a!==!1,T=u!==!1;return s.useEffect(()=>{let C=!1,o=null,b=null,M=null;async function K(){if(c.current&&!S.current)try{v.current||(v.current=await yn());const g=v.current,j=new g.Map({container:c.current,style:hn(),center:[_.lng,_.lat],zoom:t.zoom,interactive:H});j.addControl(new g.NavigationControl({showCompass:!1}),"top-right"),S.current=j;const O=()=>{j.resize()};b=O,M=window.requestAnimationFrame(O),window.addEventListener("resize",O),o=new ResizeObserver(()=>O()),o.observe(c.current),j.on("error",R=>{var ae;const ee=((ae=R.error)==null?void 0:ae.message)??"Map error.";C||ee.toLowerCase().includes("failed to fetch")||ee.toLowerCase().includes("network")||U({kind:"error",message:ee})}),j.once("load",()=>{C||U({kind:"ready"})})}catch(g){if(C)return;U({kind:"error",message:g instanceof Error?g.message:"Map error."})}}return K(),()=>{var g;C=!0,M!==null&&window.cancelAnimationFrame(M),b&&window.removeEventListener("resize",b),o==null||o.disconnect();for(const j of I.current)j.remove();I.current=[],(g=S.current)==null||g.remove(),S.current=null}},[H]),s.useEffect(()=>{const C=S.current;if(!C||!T)return;C.resize();const o=window.setTimeout(()=>{C.resize(),C.setCenter([t.center.lng,t.center.lat]),C.setZoom(t.zoom)},80);return()=>window.clearTimeout(o)},[t.center.lat,t.center.lng,t.zoom,T]),s.useEffect(()=>{const C=S.current;if(!C||!T)return;C.resize();const o=window.setTimeout(()=>C.resize(),120);return()=>window.clearTimeout(o)},[T]),s.useEffect(()=>{const C=S.current,o=v.current;if(!(!C||!o)){for(const b of I.current)b.remove();I.current=[];for(const b of n){const M=typeof b.label=="string"&&b.label.trim()!==""?new o.Popup({closeButton:!1,closeOnClick:!0}).setHTML(`<div style="font-family: var(--ui); font-size: 12px; line-height: 1.35;">
                 <div style="font-weight: 600;">${pn(b.label)}</div>
               </div>`):void 0,K=mn(b);typeof b.onClick=="function"&&K.addEventListener("click",j=>{var O;j.preventDefault(),(O=b.onClick)==null||O.call(b)});const g=new o.Marker({element:K}).setLngLat([b.position.lng,b.position.lat]);M&&g.setPopup(M),g.addTo(C),I.current.push(g)}}},[n]),A.kind==="error"?e.jsxs("div",{style:{background:"#000000",color:"#F22F2F",border:"2px solid #C00000",borderRadius:8,padding:12,fontFamily:"var(--ui)",fontSize:14,lineHeight:1.4},role:"alert","aria-live":"polite",children:["Map error: ",A.message]}):e.jsx("div",{ref:c,className:"rd-maplibre",style:{width:"100%",height:"100%",background:"#000000",borderRadius:8,overflow:"hidden"},"aria-label":"Cruise map"})}const Wt=[Vt,Yt,Jt];function vn(t){let n=0;for(let a=0;a<t.length;a+=1)n=n*31+t.charCodeAt(a)|0;return Math.abs(n)}function xn(t){return Wt[vn(t)%Wt.length]}function jn(t,n,a){return t.map(u=>({id:u.key,position:{lat:u.lat,lng:u.lng},color:"#C00000",label:u.status?`Presence: ${u.status}`:"Presence",imageUrl:(n==null?void 0:n[u.key])??xn(u.key),onClick:a?()=>a(u.key):void 0}))}function Dt({wsUrl:t,sessionToken:n,jwt:a,defaultCenter:u,defaultZoom:c,presenceUpdates:v,realtimeErrorMessage:S,onMarkerSelect:I,avatarByKey:A,additionalMarkers:U,height:_,visible:H}){const T=qt({wsUrl:t,sessionToken:n,jwt:a,disabled:Array.isArray(v)}),C=v?{byKey:new Map(v.map(R=>[R.key,R]))}:T.state,o=S??T.lastErrorMessage,[b,M]=s.useState({kind:"pending"});s.useEffect(()=>{if(!("geolocation"in navigator)||!navigator.geolocation){M({kind:"unavailable"});return}navigator.geolocation.getCurrentPosition(R=>{M({kind:"granted",center:{lat:R.coords.latitude,lng:R.coords.longitude}})},R=>{if(R.code===R.PERMISSION_DENIED){M({kind:"denied"});return}if(R.code===R.TIMEOUT){M({kind:"error",message:"Timed out while trying to read your location. Showing the default map view."});return}M({kind:"error",message:R.message||"Geolocation error."})},{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e4})},[]);const K=s.useMemo(()=>Array.from(C.byKey.values()),[C.byKey]),g=s.useMemo(()=>[...jn(K,A,I),...U??[]],[U,A,I,K]),j=s.useMemo(()=>{const R=typeof c=="number"&&Number.isFinite(c)?c:13;return b.kind==="granted"?{center:b.center,zoom:R}:{center:u,zoom:R}},[u,c,b]),O=s.useMemo(()=>b.kind==="denied"?"Location permission denied. Showing the default map view.":b.kind==="unavailable"?"Geolocation is unavailable. Showing the default map view.":b.kind==="error"?`Geolocation error: ${b.message}`:null,[b]);return e.jsxs("section",{"aria-label":"Cruise mode map",style:{background:"#000000",color:"#FFFFFF",fontFamily:"var(--ui)",display:"grid",gap:8,height:"100%"},children:[O?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"rgba(0,0,0,0.7)",border:"1px solid rgba(255,58,77,0.45)",borderRadius:0,padding:8,color:"#AAAAAA",fontSize:12,lineHeight:1.4},children:O}):null,o?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"rgba(0,0,0,0.7)",border:"1px solid rgba(255,58,77,0.45)",borderRadius:0,padding:8,color:"#F22F2F",fontSize:12,lineHeight:1.4},children:o}):null,e.jsx("div",{style:{background:"#111111",border:0,borderRadius:0,overflow:"hidden",height:typeof _=="number"||typeof _=="string"?_:520},children:e.jsx(bn,{initialView:j,markers:g,visible:H})})]})}const wn="FIRE_SIGNAL|1";function Sn(t){return new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function Bt(t){if(!t.startsWith("LOCATION|"))return null;const[,n,a]=t.split("|"),u=Number(n),c=Number(a);return!Number.isFinite(u)||!Number.isFinite(c)?null:{lat:u,lng:c,link:`https://maps.google.com/?q=${u},${c}`}}function kn(t){return t.trim()===wn?"ðŸ”¥ I'm into you":t}function Xt({chatKind:t,peerKey:n,currentUserKey:a,messages:u,client:c,title:v,peerSummary:S,thirdParty:I,edgeToEdge:A,showHeader:U,fillHeight:_}){const[H,T]=s.useState(""),[C,o]=s.useState(null),[b,M]=s.useState(!1),[K,g]=s.useState({}),[j,O]=s.useState(!1),[R,ee]=s.useState(!1),ae=s.useRef(null),he=s.useRef([]),ge=s.useRef(null),ce=s.useRef(null),me=s.useRef(null),y=A===!0,p=U!==!1,N=y&&_===!0,ne=s.useMemo(()=>[...u].sort((d,W)=>d.createdAtMs-W.createdAtMs),[u]),E=s.useMemo(()=>Array.from(new Set(ne.map(d=>{var W;return(W=d.media)==null?void 0:W.objectKey}).filter(d=>typeof d=="string"&&d.trim().length>0))),[ne]);s.useEffect(()=>{let d=!1;async function W(){for(const r of E){if(d)return;if(!K[r])try{const m=await c.getMediaUrl(r);if(d)return;g(F=>({...F,[r]:m}))}catch{}}}return W(),()=>{d=!0}},[c,E,K]);async function te(d){const W=H.trim();if(!(W.length===0&&!d)){M(!0),o(null);try{await c.sendMessage(t,n,W,d),T("")}catch(r){const m=r;o(typeof(m==null?void 0:m.message)=="string"?m.message:"Message rejected.")}finally{M(!1)}}}async function k(d){M(!0),o(null);try{const W=await c.initiateMediaUpload(d.type||"application/octet-stream",d.size);await c.uploadToSignedUrl(W.uploadUrl,d,d.type||"application/octet-stream");const m={kind:d.type.startsWith("image/")?"image":d.type.startsWith("video/")?"video":"audio",objectKey:W.objectKey,mimeType:d.type||"application/octet-stream"};await te(m)}catch(W){const r=W;o(typeof(r==null?void 0:r.message)=="string"?r.message:"Upload rejected."),M(!1)}}async function ue(d){var r;const W=(r=d.target.files)==null?void 0:r[0];if(d.target.value="",!!W){if(!W.type.startsWith("image/")&&!W.type.startsWith("video/")&&!W.type.startsWith("audio/")){o("Only image, video, or audio files are supported.");return}await k(W)}}async function oe(){var d;if(j){(d=ae.current)==null||d.stop();return}if(!navigator.mediaDevices||typeof navigator.mediaDevices.getUserMedia!="function"){o("Microphone is not available in this browser.");return}try{const W=await navigator.mediaDevices.getUserMedia({audio:!0}),r=new MediaRecorder(W);he.current=[],ae.current=r,r.ondataavailable=m=>{m.data.size>0&&he.current.push(m.data)},r.onstop=()=>{const m=new Blob(he.current,{type:r.mimeType||"audio/webm"}),F=new File([m],`voice-${Date.now()}.webm`,{type:r.mimeType||"audio/webm"});k(F);for(const se of W.getTracks())se.stop();ae.current=null,O(!1)},r.start(),O(!0)}catch(W){const r=W;o(typeof(r==null?void 0:r.message)=="string"?r.message:"Unable to record voice."),O(!1)}}async function be(){if(!navigator.geolocation){o("Geolocation is not available in this browser.");return}M(!0),o(null);try{const d=await new Promise((F,se)=>{navigator.geolocation.getCurrentPosition(F,se,{enableHighAccuracy:!1,timeout:12e3,maximumAge:3e4})}),W=Number(d.coords.latitude.toFixed(5)),r=Number(d.coords.longitude.toFixed(5)),m=`LOCATION|${W}|${r}`;await c.sendMessage(t,n,m)}catch(d){const W=d;o(typeof(W==null?void 0:W.message)=="string"?W.message:"Unable to send location.")}finally{M(!1)}}return e.jsxs("section",{"aria-label":"Chat",style:{background:y?"transparent":"#000000",color:"#FFFFFF",fontFamily:"Montserrat, sans-serif",padding:y?0:16,display:"grid",gap:y?0:12,gridTemplateRows:p?"auto auto 1fr auto":"1fr auto",minHeight:_?"calc(100dvh - 196px)":void 0},children:[p?e.jsxs("header",{style:{height:56,display:"grid",alignItems:"center",background:"#000000"},children:[e.jsx("div",{style:{textAlign:"center",fontSize:20,fontWeight:600},children:v}),S?e.jsxs("div",{style:{marginTop:4,display:"flex",alignItems:"center",justifyContent:"center",gap:8,color:"#b7d8e0",fontSize:13},children:[e.jsx("span",{children:"Chat with:"}),S.avatarUrl?e.jsx("img",{src:S.avatarUrl,alt:`${S.displayName} avatar`,style:{width:24,height:24,borderRadius:"50%",objectFit:"cover",border:"1px solid rgba(38,213,255,0.8)"}}):e.jsx("span",{"aria-hidden":!0,style:{width:24,height:24,borderRadius:"50%",border:"1px solid rgba(38,213,255,0.8)",background:"rgba(255,255,255,0.08)"}}),e.jsx("span",{style:{color:"#fff",fontWeight:600},children:S.displayName})]}):null,e.jsx("div",{style:{textAlign:"center",fontSize:12,color:"#AAAAAA"},children:t==="cruise"?"CRUISE CHAT (EPHEMERAL)":"DATE CHAT (PERSISTENT)"})]}):null,C?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"#111111",border:"2px solid #C00000",borderRadius:8,padding:12,color:"#F22F2F",fontSize:14,lineHeight:1.4},children:C}):null,e.jsx("div",{"aria-label":"Messages",style:{background:y?"#09090b":"#111111",border:y?"none":"2px solid #C00000",borderRadius:y?0:8,padding:12,display:"flex",flexDirection:"column",gap:12,minHeight:y?0:320,paddingBottom:N?148:12,overflowY:"auto"},children:ne.length===0?e.jsx("div",{style:{color:"#AAAAAA",fontSize:14,lineHeight:1.4},children:"No messages."}):ne.map(d=>{const W=d.fromKey===a,r=W?"#C00000":"#444444",m=W?{alignItems:"flex-end"}:{alignItems:"flex-start"};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,width:"100%",...m},children:[(()=>{const F=Bt(d.text??"");return F?e.jsxs("a",{href:F.link,target:"_blank",rel:"noreferrer",style:{display:"grid",gap:6,textDecoration:"none",color:"#fff",background:r,borderRadius:14,padding:8,width:"auto",maxWidth:"80%"},children:[e.jsx("div",{style:{fontSize:12,color:"#d8ecff"},children:"Shared location"}),e.jsx("iframe",{title:"Google Maps location preview",src:`https://www.google.com/maps?q=${F.lat},${F.lng}&z=14&output=embed`,style:{width:"100%",height:140,border:"1px solid rgba(255,255,255,0.18)",borderRadius:10},loading:"lazy",referrerPolicy:"no-referrer-when-downgrade"}),e.jsx("div",{style:{fontSize:12,color:"#3fdfff"},children:"Open in Google Maps"})]}):null})(),e.jsxs("div",{style:{background:r,color:"#FFFFFF",borderRadius:18,padding:"8px 12px",width:"auto",maxWidth:"80%",fontSize:16,lineHeight:1.4,whiteSpace:"pre-wrap",overflowWrap:"anywhere",wordBreak:"break-word"},children:[d.text&&!Bt(d.text)?e.jsx("div",{style:{marginBottom:d.media?8:0},children:kn(d.text)}):null,d.media?e.jsxs("div",{children:[d.media.kind==="image"?e.jsx("img",{src:K[d.media.objectKey],alt:"Shared",style:{width:"100%",maxWidth:260,borderRadius:10,border:"1px solid rgba(255,255,255,0.18)"}}):null,d.media.kind==="video"?e.jsx("video",{controls:!0,playsInline:!0,src:K[d.media.objectKey],style:{width:"100%",maxWidth:320,borderRadius:10,background:"#000"}}):null,d.media.kind==="audio"?e.jsx("audio",{controls:!0,src:K[d.media.objectKey],style:{width:"100%",maxWidth:260}}):null]}):null]}),e.jsx("div",{style:{fontSize:10,color:"#AAAAAA"},children:Sn(d.createdAtMs)}),W?e.jsx("div",{style:{fontSize:10,color:"#6fdcff"},children:typeof d.readAtMs=="number"?"Read":typeof d.deliveredAtMs=="number"?"Delivered":""}):null]},d.messageId)})}),e.jsxs("form",{onSubmit:d=>{d.preventDefault(),te()},"aria-label":"Message input",style:{background:y?"linear-gradient(180deg, rgba(96,0,12,0.96), rgba(58,0,8,0.98))":"#111111",border:y?"none":"2px solid #C00000",borderRadius:y?0:8,padding:12,display:"grid",gridTemplateColumns:"1fr auto auto",gap:12,alignItems:"start",position:N?"fixed":"static",left:N?0:void 0,right:N?0:void 0,bottom:N?"calc(env(safe-area-inset-bottom, 0px) + 66px)":void 0,zIndex:N?45:void 0},children:[e.jsx("label",{style:{display:"grid"},children:e.jsx("input",{value:H,onChange:d=>T(d.target.value),placeholder:"Type a message",disabled:b,style:{width:"100%",background:"#111111",color:"#FFFFFF",border:"2px solid #444444",borderRadius:8,padding:"10px 12px",fontSize:16,lineHeight:1.4,outline:"none"},"aria-label":"Message text"})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{ref:ge,type:"file",accept:"image/*,video/*,audio/*",disabled:b,onChange:d=>void ue(d),style:{display:"none"}}),e.jsx("input",{ref:ce,type:"file",accept:"image/*",capture:"environment",disabled:b,onChange:d=>void ue(d),style:{display:"none"}}),e.jsx("input",{ref:me,type:"file",accept:"video/*",capture:"environment",disabled:b,onChange:d=>void ue(d),style:{display:"none"}}),e.jsx("button",{type:"button",disabled:b,onClick:()=>ee(d=>!d),style:{background:"rgba(0,0,0,0.45)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px",display:"grid",placeItems:"center",cursor:b?"not-allowed":"pointer",color:"#3fdfff",fontWeight:700,height:44,minWidth:44},"aria-label":"More actions",children:"+"}),R?e.jsxs("div",{style:{position:"absolute",right:0,top:N?void 0:48,bottom:N?48:void 0,zIndex:5,minWidth:220,display:"grid",gap:8,padding:10,borderRadius:10,border:"1px solid rgba(255,58,77,0.5)",background:"rgba(10,11,16,0.98)"},children:[e.jsx("button",{type:"button",disabled:b,onClick:()=>{var d;ee(!1),(d=ce.current)==null||d.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Take Photo"}),e.jsx("button",{type:"button",disabled:b,onClick:()=>{var d;ee(!1),(d=me.current)==null||d.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Record Video"}),e.jsx("button",{type:"button",disabled:b,onClick:()=>{var d;ee(!1),(d=ge.current)==null||d.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Choose Media"}),e.jsx("button",{type:"button",disabled:b,onClick:()=>{ee(!1),oe()},style:{background:j?"#ff2136":"rgba(0,0,0,0.6)",color:"#fff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:j?"Stop Voice":"Record Voice"}),e.jsx("button",{type:"button",disabled:b,onClick:()=>{ee(!1),be()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Send Location"}),I?e.jsxs("div",{style:{display:"grid",gap:8,borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:8},children:[e.jsxs("select",{value:I.selectedKey,onChange:d=>I.onSelect(d.target.value),disabled:I.disabled||I.candidates.length===0,style:{background:"#0b0d12",color:"#fff",border:"1px solid rgba(255,58,77,0.62)",borderRadius:10,padding:"8px 10px"},"aria-label":"Add previous contact to group",children:[I.candidates.length===0?e.jsx("option",{value:"",children:"No previous contacts"}):null,I.candidates.map(d=>e.jsx("option",{value:d.key,children:d.label},d.key))]}),e.jsx("button",{type:"button",onClick:()=>{I.onAdd(),ee(!1)},disabled:I.disabled||I.candidates.length===0||!I.selectedKey,style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,58,77,0.62)",borderRadius:10,padding:"8px 10px",fontWeight:700},children:"Add Third User"})]}):null]}):null]}),e.jsx("button",{type:"submit",disabled:b,style:{background:b?"#333333":"#C00000",color:b?"#777777":"#FFFFFF",border:"2px solid #C00000",borderRadius:8,padding:"10px 20px",fontSize:16,fontWeight:600,cursor:b?"not-allowed":"pointer",height:44},"aria-label":"Send message",children:"SEND"})]})]})}const vt="FIRE_SIGNAL|1";function Ee(){return{background:"radial-gradient(500px 220px at 10% 0%, rgba(255,28,46,0.15), transparent 58%), linear-gradient(180deg, rgba(8,8,10,0.88), rgba(4,4,5,0.9))",border:"1px solid rgba(255,56,74,0.56)",borderRadius:20,padding:14,boxShadow:"inset 0 1px 0 rgba(255,255,255,0.06), inset 0 0 0 1px rgba(0,0,0,0.28), 0 16px 32px rgba(0,0,0,0.42)"}}function fe(t){return{background:t?"rgba(90,90,90,0.55)":"linear-gradient(180deg, #ff2136, #c60012)",border:"1px solid rgba(255,70,90,0.68)",color:t?"#999999":"#FFFFFF",padding:"10px 18px",borderRadius:12,fontSize:15,fontWeight:700,letterSpacing:"0.04em",cursor:t?"not-allowed":"pointer",textTransform:"uppercase",boxShadow:t?"none":"inset 0 1px 0 rgba(255,255,255,0.2), 0 10px 22px rgba(198,0,18,0.34)"}}function D(t){return{background:"rgba(0,0,0,0.58)",border:"1px solid rgba(255,58,77,0.62)",color:"#3fdfff",padding:"10px 18px",borderRadius:12,fontSize:15,fontWeight:700,letterSpacing:"0.03em",cursor:t?"not-allowed":"pointer",textTransform:"uppercase",opacity:t?.6:1}}function X(){return{background:"rgba(6,7,10,0.92)",color:"#ffffff",border:"1px solid rgba(255,64,82,0.48)",borderRadius:12,padding:"10px 12px",fontSize:15}}function In(t){return typeof t=="string"}function V(t){const n=t;return In(n==null?void 0:n.message)?n.message:"Action rejected."}function gt(){const t="__disabled__".trim();if(t==="__disabled__")return"";if(t!==""){if(t.startsWith("ws://")||t.startsWith("wss://"))return t;try{const a=new URL(t);return a.protocol=a.protocol==="https:"?"wss:":"ws:",a.toString()}catch{if(t.startsWith("/")){const a=new URL(t,window.location.origin);return a.protocol=a.protocol==="https:"?"wss:":"ws:",a.toString()}}}const n=new URL("/ws",window.location.origin);return n.protocol=n.protocol==="https:"?"wss:":"ws:",n.toString()}const Ht=[Vt,Yt,Jt];function Cn(t){let n=0;for(let a=0;a<t.length;a+=1)n=n*31+t.charCodeAt(a)|0;return Math.abs(n)}function He(t){return Ht[Cn(t)%Ht.length]}function ht(t){if(t.startsWith("user:")){const n=t.slice(5).trim();return n.length>0?n:null}if(t.startsWith("session:")){const n=t.slice(8).trim();return n.length>0?`guest:${n}`:null}return null}function Oe(t){if(t.startsWith("guest:")){const n=t.slice(6).trim();return n?`session:${n}`:`user:${t}`}return`user:${t}`}function Te(t){const n=t.trim();if(!n)return n;if(n.startsWith("user:guest:")){const a=n.slice(11).trim();return a?`session:${a}`:n}if(n.startsWith("guest:")){const a=n.slice(6).trim();return a?`session:${a}`:n}return n}function Tn(t){return t.trim()===vt}function Zt(t){return Tn(t)?"ðŸ”¥ I'm into you":t}function mt(t,n){const a=_=>_*Math.PI/180,c=a(n.lat-t.lat),v=a(n.lng-t.lng),S=Math.sin(c/2),I=Math.sin(v/2),A=S*S+Math.cos(a(t.lat))*Math.cos(a(n.lat))*I*I;return 6371e3*(2*Math.atan2(Math.sqrt(A),Math.sqrt(1-A)))}function _t(){try{const t=localStorage.getItem("reddoor_travel_center");if(!t)return null;const n=JSON.parse(t);return n.enabled!==!0?null:typeof n.lat=="number"&&Number.isFinite(n.lat)&&typeof n.lng=="number"&&Number.isFinite(n.lng)?{lat:n.lat,lng:n.lng}:null}catch{return null}}function Mn(){const[t,n]=s.useState(()=>window.matchMedia("(max-width: 900px)").matches);return s.useEffect(()=>{const a=window.matchMedia("(max-width: 900px)"),u=()=>n(a.matches);return u(),a.addEventListener("change",u),()=>a.removeEventListener("change",u)},[]),t}function et(t){return t==="instant"?"cruise":"date"}function An({api:t,session:n,settings:a,discoverFilter:u,busy:c,setBusy:v,setLastError:S,isMobile:I,discoverScreen:A,onDiscoverScreenChange:U,onOpenThreadRequested:_,onUnreadCountChange:H}){var Ve,nt,We,_e,qe,Ye;const[T,C]=s.useState(A),[o,b]=s.useState(null),[M,K]=s.useState(null),[g,j]=s.useState(null),[O,R]=s.useState([]),[ee,ae]=s.useState({}),[he,ge]=s.useState([]),[ce,me]=s.useState(new Set),[y,p]=s.useState(new Set),[N,ne]=s.useState({}),[E,te]=s.useState({}),[k,ue]=s.useState(null),[oe,be]=s.useState(0),[d,W]=s.useState(!1),[r,m]=s.useState([]),[F,se]=s.useState(null),[le,we]=s.useState(()=>_t()),{state:ke,lastErrorMessage:de}=qt({wsUrl:gt(),sessionToken:n.sessionToken}),ve=s.useMemo(()=>Array.from(ke.byKey.values()),[ke.byKey]);s.useEffect(()=>{C(A)},[A]),s.useEffect(()=>{const f=()=>{we(_t())},h=w=>{(w.key===null||w.key==="reddoor_travel_center")&&f()};return f(),window.addEventListener("rd:location-updated",f),window.addEventListener("storage",h),()=>{window.removeEventListener("rd:location-updated",f),window.removeEventListener("storage",h)}},[]);const Y=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,je=s.useMemo(()=>{const f=new Map;for(const h of O)f.set(h.key,h);for(const h of ve){const w=f.get(h.key);(!w||h.updatedAtMs>=w.updatedAtMs)&&f.set(h.key,h)}return Array.from(f.values())},[ve,O]),Re=s.useMemo(()=>je.filter(f=>f.key!==Y),[Y,je]),Se=s.useMemo(()=>g?[...Re].sort((f,h)=>mt(g,{lat:f.lat,lng:f.lng})-mt(g,{lat:h.lat,lng:h.lng})):Re,[Re,g]);s.useEffect(()=>{let f=!1;async function h(){try{const B=await t.listActivePresence(n.sessionToken);if(f)return;const Z=Array.isArray(B.presence)?B.presence:[];R(Z)}catch{f||R([])}}h();const w=window.setInterval(()=>{h()},8e3);return()=>{f=!0,window.clearInterval(w)}},[t,n.sessionToken]),s.useEffect(()=>{o||Se.length>0&&b(Se[0].key)},[o,Se]),s.useEffect(()=>{const f=Se.filter(h=>!ee[h.key]).map(h=>({key:h.key,profileId:ht(h.key)})).filter(h=>typeof h.profileId=="string");f.length!==0&&Promise.all(f.map(async h=>{var w,B;try{const Z=await t.getPublicProfile(h.profileId);return{key:h.key,displayName:(w=Z.profile)==null?void 0:w.displayName,age:(B=Z.profile)==null?void 0:B.age}}catch{return null}})).then(h=>{ae(w=>{const B={...w};for(const Z of h)Z&&(B[Z.key]={displayName:Z.displayName,age:Z.age});return B})})},[t,ee,Se]),s.useEffect(()=>{(async()=>{try{let f=await t.getPublicProfiles();if(f.profiles.length===0&&!d){W(!0);try{const h=g??le??{lat:a.defaultCenterLat,lng:a.defaultCenterLng};await t.seedFakeUsers(12,h.lat,h.lng),f=await t.getPublicProfiles()}catch{}}ge(f.profiles)}catch{ge([])}if(n.userType==="guest"){me(new Set),p(new Set);return}try{const f=await t.getFavorites(n.sessionToken);me(new Set(f.favorites))}catch{me(new Set)}try{const f=await t.listBlocked(n.sessionToken);p(new Set(f.blocked))}catch{p(new Set)}})()},[t,d,g,n.sessionToken,n.userType,a.defaultCenterLat,a.defaultCenterLng,le]),s.useEffect(()=>{let f=!1;async function h(){try{const B=await t.listCruisingSpots();f||m(B.spots)}catch{f||m([])}}h();const w=window.setInterval(()=>{h()},12e3);return()=>{f=!0,window.clearInterval(w)}},[t]),s.useEffect(()=>{const f=Date.now(),h=he.flatMap(w=>{const B=[];return w.mainPhotoMediaId&&B.push(w.mainPhotoMediaId),Array.isArray(w.galleryMediaIds)&&B.push(...w.galleryMediaIds),w.videoMediaId&&B.push(w.videoMediaId),B}).filter(w=>typeof w=="string"&&w.length>0&&!N[w]&&f>=(E[w]??0)).slice(0,6);h.length!==0&&Promise.all(h.map(async w=>{try{const B=await t.getPublicMediaUrl(w);return{mediaId:w,url:B.downloadUrl}}catch{return null}})).then(w=>{ne(B=>{const Z={...B};for(const ie of w)ie&&(Z[ie.mediaId]=ie.url);return Z}),te(B=>{const Z={...B};for(let ie=0;ie<h.length;ie+=1){const pe=h[ie];w[ie]?Z[pe]&&delete Z[pe]:Z[pe]=Date.now()+3e4}return Z})})},[t,E,N,he]);async function Fe(f){K(f),be(0);const h=ht(f);if(!h){ue(null);return}try{if(f===Y){const w=await t.getMyProfile(n.sessionToken);typeof w.profile.mainPhotoMediaId=="string"&&w.profile.mainPhotoMediaId;const B=[w.profile.mainPhotoMediaId,...w.profile.galleryMediaIds??[],w.profile.videoMediaId].filter(Z=>typeof Z=="string"&&Z.length>0);if(B.length>0){const Z=await Promise.all(B.map(async ie=>{try{const pe=await t.getPublicMediaUrl(ie);return{mediaId:ie,downloadUrl:pe.downloadUrl}}catch{return null}}));ne(ie=>{const pe={...ie};for(const Ce of Z)Ce&&(pe[Ce.mediaId]=Ce.downloadUrl);return pe})}ue({userId:w.profile.userId,displayName:w.profile.displayName,age:w.profile.age,bio:w.profile.bio,stats:w.profile.stats,discreetMode:w.profile.discreetMode,mainPhotoMediaId:w.profile.mainPhotoMediaId,galleryMediaIds:w.profile.galleryMediaIds,videoMediaId:w.profile.videoMediaId})}else{const w=await t.getPublicProfile(h),B=[w.profile.mainPhotoMediaId,...w.profile.galleryMediaIds??[],w.profile.videoMediaId].filter(Z=>typeof Z=="string"&&Z.length>0);if(B.length>0){const Z=await Promise.all(B.map(async ie=>{try{const pe=await t.getPublicMediaUrl(ie);return{mediaId:ie,downloadUrl:pe.downloadUrl}}catch{return null}}));ne(ie=>{const pe={...ie};for(const Ce of Z)Ce&&(pe[Ce.mediaId]=Ce.downloadUrl);return pe})}ue(w.profile)}}catch(w){const B=w;if((B==null?void 0:B.code)==="PROFILE_HIDDEN"){K(null),ue(null);return}ue(null),S(V(w))}}async function De(f){if(n.userType==="guest"){S("Guests cannot star users. Register to save favorites.");return}if(!(!n.userId||n.userId===f))try{const h=await t.toggleFavorite(n.sessionToken,f);me(new Set(h.favorites))}catch(h){S(V(h))}}async function q(f){const h=Te(f);if(!(!h||h===Y))try{await t.sendChat(n.sessionToken,"cruise",h,vt)}catch(w){S(V(w))}}async function Me(f){if(!(!f.trim()||f===Y)){if(n.userType==="guest"){S("Anonymous users cannot block users.");return}try{y.has(f)?await t.unblock(n.sessionToken,f):await t.block(n.sessionToken,f);const h=await t.listBlocked(n.sessionToken);p(new Set(h.blocked))}catch(h){S(V(h))}}}async function Ne(){const f=le??{lat:a.defaultCenterLat,lng:a.defaultCenterLng};if(!navigator.geolocation){j(f);try{await t.updatePresence(n.sessionToken,f.lat,f.lng,"online")}catch{}return}try{const h=await new Promise((w,B)=>{navigator.geolocation.getCurrentPosition(w,B,{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e4})});j({lat:h.coords.latitude,lng:h.coords.longitude}),await t.updatePresence(n.sessionToken,h.coords.latitude,h.coords.longitude,"online")}catch(h){j(f);try{await t.updatePresence(n.sessionToken,f.lat,f.lng,"online")}catch{const w=h&&typeof h=="object"&&"message"in h&&typeof h.message=="string"?h.message:null;S(w??V(h))}}}s.useEffect(()=>{Ne();const f=window.setInterval(()=>{Ne()},3e4);return()=>window.clearInterval(f)},[n.sessionToken]),s.useEffect(()=>{const f=h=>{var ie,pe;const w=h,B=(ie=w.detail)==null?void 0:ie.lat,Z=(pe=w.detail)==null?void 0:pe.lng;!Number.isFinite(B)||!Number.isFinite(Z)||(j({lat:B,lng:Z}),t.updatePresence(n.sessionToken,B,Z,"online").catch(()=>{}))};return window.addEventListener("rd:location-updated",f),()=>window.removeEventListener("rd:location-updated",f)},[t,n.sessionToken]);const Ie=s.useMemo(()=>{if(je.some(B=>B.key===Y))return je;const h=g??le??{lat:a.defaultCenterLat,lng:a.defaultCenterLng};return[{key:Y,userType:n.userType,lat:h.lat,lng:h.lng,status:"online",updatedAtMs:Date.now()},...je]},[Y,je,g,n.userType,a.defaultCenterLat,a.defaultCenterLng,le]),xe=s.useMemo(()=>{const f={};for(const h of he){if(!h.mainPhotoMediaId)continue;const w=N[h.mainPhotoMediaId];w&&(f[Oe(h.userId)]=w)}return f},[N,he]),Le=s.useMemo(()=>r.map(f=>({id:`spot:${f.spotId}`,position:{lat:f.lat,lng:f.lng},color:"#26d5ff",markerType:"spot",markerGlyph:"CS",label:`${f.name} | check-ins: ${f.checkInCount??0} | action: ${f.actionCount??0}`,onClick:()=>se(f.spotId)})),[r]),ze=f=>{C(f),U(f)},Ke=e.jsx(Dt,{wsUrl:gt(),sessionToken:n.sessionToken,presenceUpdates:Ie,realtimeErrorMessage:de,onMarkerSelect:f=>void Fe(f),avatarByKey:xe,additionalMarkers:Le,defaultCenter:le??{lat:a.defaultCenterLat,lng:a.defaultCenterLng},height:I?"calc(100vh - 340px)":600,visible:!0}),tt=e.jsxs("div",{style:{background:"#000",marginInline:-10},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,padding:"8px 10px",borderBottom:"1px solid rgba(255,58,77,0.25)"},children:[e.jsx("button",{type:"button",style:D(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"reset"}}))},children:"GUYS"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"toggle_favorites"}}))},"aria-label":"Toggle favorites only",children:"â˜…"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"open_filters"}})),ze("chat")},children:"FILTER"})]}),e.jsx(Dt,{wsUrl:gt(),sessionToken:n.sessionToken,presenceUpdates:Ie,realtimeErrorMessage:de,onMarkerSelect:f=>void Fe(f),avatarByKey:xe,additionalMarkers:Le,defaultCenter:le??{lat:a.defaultCenterLat,lng:a.defaultCenterLng},height:"calc(100dvh - 220px)",visible:T==="map"})]}),Ge=e.jsx(Nn,{api:t,session:n,busy:c,setBusy:v,setLastError:S,onlinePeers:Se,selectedPeerKey:o,setSelectedPeerKey:b,onOpenProfile:f=>void Fe(f),isMobile:I,selfCoords:g,peerProfileByKey:ee,discoverFilter:u,publicProfiles:he,favorites:ce,mediaUrlById:N,onUnreadCountChange:H});return e.jsxs("div",{style:{display:"grid",gap:8},children:[I?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:T==="map"?"block":"none"},children:tt}),e.jsx("div",{style:{display:T==="chat"?"block":"none"},children:Ge}),e.jsx("div",{style:{position:"fixed",left:10,right:10,bottom:"calc(env(safe-area-inset-bottom, 0px) + 66px)",zIndex:41,padding:8,background:"rgba(0,0,0,0.35)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("button",{type:"button",style:T==="map"?fe(!1):D(!1),onClick:()=>ze("map"),children:"MAP"}),e.jsx("button",{type:"button",style:T==="chat"?fe(!1):D(!1),onClick:()=>ze("chat"),children:"CHAT"})]})})]}):e.jsxs("div",{style:{display:"grid",gap:12,alignItems:"start"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("button",{type:"button",style:T==="map"?fe(!1):D(!1),onClick:()=>ze("map"),children:"MAP"}),e.jsx("button",{type:"button",style:T==="chat"?fe(!1):D(!1),onClick:()=>ze("chat"),children:"CHAT"})]}),T==="map"?Ke:Ge]}),M?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:80,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:I?"stretch":"center",padding:I?0:14},role:"dialog","aria-modal":"true","aria-label":"User profile",onClick:()=>K(null),children:e.jsx("div",{onClick:f=>f.stopPropagation(),style:I?{width:"100%",height:"100dvh",overflow:"auto",background:"linear-gradient(180deg, rgba(7,8,10,0.98), rgba(2,2,4,0.98))",borderRadius:0,border:"none",padding:"calc(env(safe-area-inset-top, 0px) + 56px) 12px calc(env(safe-area-inset-bottom, 0px) + 20px)"}:{...Ee(),width:"min(680px, 100%)",maxHeight:"86vh",overflow:"auto"},children:e.jsxs("div",{style:{display:"grid",gap:14},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"106px 1fr auto",gap:12,alignItems:"center"},children:[e.jsxs("div",{style:{position:"relative",width:106,height:106},children:[e.jsx("img",{src:k!=null&&k.mainPhotoMediaId&&N[k.mainPhotoMediaId]?N[k.mainPhotoMediaId]:He(M),alt:"Profile avatar",style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"cover",border:"2px solid #ff3047"}}),e.jsx("span",{style:{position:"absolute",right:4,bottom:4,width:14,height:14,borderRadius:"50%",background:"#26d5ff",border:"2px solid #000"}})]}),e.jsxs("div",{style:{display:"grid",gap:6},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:(k==null?void 0:k.displayName)??M}),e.jsx("div",{style:{color:"#26d5ff",fontSize:14},children:"Instant Messaging Available"})]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[k&&k.userId!==(n.userId??"")?e.jsx("button",{type:"button",style:{...D(!1),color:"#26d5ff",borderColor:"rgba(38,213,255,0.62)",minWidth:126},onClick:()=>void De(k.userId),children:ce.has(k.userId)?"â˜… STARRED":"â˜† STAR"}):null,k&&k.userId!==(n.userId??"")?e.jsx("button",{type:"button",style:{...D(!1),color:"#ffb347",borderColor:"rgba(255,179,71,0.65)",minWidth:126},onClick:()=>void q(Oe(k.userId)),children:"ðŸ”¥ FIRE"}):null,k&&k.userId!==(n.userId??"")?e.jsx("button",{type:"button",style:{...D(!1),color:y.has(Oe(k.userId))?"#ff9aa3":"#ffd4d8",borderColor:"rgba(255,120,130,0.62)",minWidth:126},onClick:()=>void Me(Oe(k.userId)),children:y.has(Oe(k.userId))?"UNBLOCK":"BLOCK"}):null,e.jsx("button",{type:"button",style:D(!1),onClick:()=>K(null),children:"CLOSE"})]})]}),e.jsxs("div",{style:{color:"#ced3dc",fontSize:14,lineHeight:1.5},children:[e.jsxs("div",{children:["Age: ",(k==null?void 0:k.age)??"-"]}),e.jsxs("div",{children:["Race: ",((Ve=k==null?void 0:k.stats)==null?void 0:Ve.race)??"-"]}),e.jsxs("div",{children:["Height: ",((nt=k==null?void 0:k.stats)==null?void 0:nt.heightInches)??"-"]}),e.jsxs("div",{children:["Weight: ",((We=k==null?void 0:k.stats)==null?void 0:We.weightLbs)??"-"]}),e.jsxs("div",{children:["Cock Size: ",((_e=k==null?void 0:k.stats)==null?void 0:_e.cockSizeInches)??"-"]}),e.jsxs("div",{children:["Cut / Uncut: ",((qe=k==null?void 0:k.stats)==null?void 0:qe.cutStatus)??"-"]}),e.jsxs("div",{children:["Position: ",((Ye=k==null?void 0:k.stats)==null?void 0:Ye.position)??"-"]}),e.jsxs("div",{style:{marginTop:8},children:["Bio: ",(k==null?void 0:k.bio)??"-"]})]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"MEDIA"}),k?e.jsx(e.Fragment,{children:(()=>{const f=[k.mainPhotoMediaId,...k.galleryMediaIds??[],k.videoMediaId].filter(ie=>typeof ie=="string"&&ie.length>0);if(f.length===0)return e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No uploaded media."});const h=Math.max(0,Math.min(oe,f.length-1)),w=f[h],B=N[w],Z=w===k.videoMediaId;return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.4)",borderRadius:12,padding:8},children:Z?e.jsx("video",{controls:!0,playsInline:!0,src:B,style:{width:"100%",maxHeight:260,borderRadius:10,background:"#000"}}):e.jsx("img",{src:B??He(M??k.userId),alt:"Profile media",style:{width:"100%",maxHeight:260,objectFit:"cover",borderRadius:10}})}),e.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:f.map((ie,pe)=>{const Ce=N[ie],Xe=ie===k.videoMediaId;return e.jsx("button",{type:"button",onClick:()=>be(pe),style:{width:64,height:64,padding:0,borderRadius:8,overflow:"hidden",border:pe===h?"2px solid #26d5ff":"1px solid rgba(255,58,77,0.4)",background:"#000",cursor:"pointer",color:"#fff",fontSize:10},"aria-label":Xe?"Open video":"Open photo",children:Xe?e.jsx("div",{style:{display:"grid",placeItems:"center",width:"100%",height:"100%"},children:Ce?e.jsx("video",{src:Ce,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}):"VIDEO"}):e.jsx("img",{src:Ce??He(M??k.userId),alt:"Media thumbnail",style:{width:"100%",height:"100%",objectFit:"cover"}})},ie)})})]})})()}):null]}),e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:e.jsx("button",{type:"button",style:fe(!1),onClick:()=>{M&&_(M),K(null),be(0)},children:"CHAT"})})]})})}):null,F?e.jsx(Rn,{api:t,session:n,spot:r.find(f=>f.spotId===F)??null,onClose:()=>se(null),onUpdated:async()=>{try{const f=await t.listCruisingSpots();m(f.spots)}catch{}},setLastError:S}):null]})}function Rn({api:t,session:n,spot:a,onClose:u,onUpdated:c,setLastError:v}){return a?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},role:"dialog","aria-modal":"true","aria-label":"Cruising spot",onClick:u,children:e.jsxs("div",{onClick:S=>S.stopPropagation(),style:{...Ee(),width:"min(520px, 100%)",display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:a.name}),e.jsx("div",{style:{color:"#9fb6bf",fontSize:13},children:a.address}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap"},children:a.description}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:13},children:["Check-ins: ",a.checkInCount??0," | I got action there: ",a.actionCount??0]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:fe(!1),onClick:async()=>{try{await t.checkInCruisingSpot(n.sessionToken,a.spotId),await c()}catch(S){v(V(S))}},children:"CHECK IN"}),e.jsx("button",{type:"button",style:D(!1),onClick:async()=>{try{await t.markCruisingSpotAction(n.sessionToken,a.spotId),await c()}catch(S){v(V(S))}},children:"I GOT ACTION THERE"}),e.jsx("button",{type:"button",style:D(!1),onClick:u,children:"CLOSE"})]})]})}):null}function Nn({api:t,session:n,busy:a,setBusy:u,setLastError:c,onlinePeers:v,selectedPeerKey:S,setSelectedPeerKey:I,onOpenProfile:A,openThreadRequest:U,onThreadRequestConsumed:_,isMobile:H,selfCoords:T,peerProfileByKey:C,discoverFilter:o,publicProfiles:b,favorites:M,mediaUrlById:K,onUnreadCountChange:g}){var zt;const[j,O]=s.useState({}),[R,ee]=s.useState({}),[ae,he]=s.useState("instant"),[ge,ce]=s.useState("grid"),[me,y]=s.useState(null),[p,N]=s.useState(""),[ne,E]=s.useState(null),[te,k]=s.useState([]),[ue,oe]=s.useState({}),[be,d]=s.useState(null),[W,r]=s.useState({}),[m,F]=s.useState({}),[se,le]=s.useState(!1),[we,ke]=s.useState(""),[de,ve]=s.useState(null),Y=s.useRef(!1),je=s.useRef(!1),Re=s.useRef(0),Se=s.useRef(null),Fe=s.useRef(null),De=s.useRef(null),q=s.useRef(null),Me=s.useRef(null),Ne=s.useRef(0),Ie=s.useRef(new Set),xe=s.useRef(null),Le=s.useRef(null),ze=s.useRef(null),[Ke,tt]=s.useState(null),[Ge,Ve]=s.useState(o==="favorites"),[nt,We]=s.useState(!1),[_e,qe]=s.useState(o==="online"?"online":"all"),[Ye,f]=s.useState(!1),[h,w]=s.useState(""),[B,Z]=s.useState(""),[ie,pe]=s.useState(""),[Ce,Xe]=s.useState(""),[st,xt]=s.useState(""),[it,jt]=s.useState(""),[rt,wt]=s.useState(""),[at,St]=s.useState(""),[ot,kt]=s.useState(""),[lt,It]=s.useState(""),[dt,Ct]=s.useState(""),Ae=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,re=me??S??"",en=re?j[re]??[]:[],Tt=s.useMemo(()=>new Map(v.map(i=>[i.key,i])),[v]),Ue=s.useMemo(()=>{const i={};for(const l of b)typeof l.displayName=="string"&&l.displayName.trim()&&(i[Oe(l.userId)]=l.displayName);for(const[l,x]of Object.entries(C))typeof x.displayName=="string"&&x.displayName.trim()&&(i[l]=x.displayName);return i},[C,b]),Mt=s.useMemo(()=>b.filter(i=>i.userId!==(n.userId??"")).map(i=>{const l=Oe(i.userId),x=Tt.get(l);return{key:l,userId:i.userId,displayName:i.displayName,age:i.age,stats:i.stats,meters:x&&T?Math.round(mt(T,{lat:x.lat,lng:x.lng})):null,isOnline:!!x,hasPicture:typeof i.mainPhotoMediaId=="string"&&i.mainPhotoMediaId.trim().length>0,avatarUrl:i.mainPhotoMediaId?K[i.mainPhotoMediaId]:void 0}}),[K,Tt,b,T,n.userId]),Je=s.useMemo(()=>{const i=h.trim()?Number(h):void 0,l=B.trim()?Number(B):void 0,x=Ce.trim()?Number(Ce):void 0,P=st.trim()?Number(st):void 0,z=it.trim()?Number(it):void 0,G=rt.trim()?Number(rt):void 0,J=at.trim()?Number(at):void 0,$=ot.trim()?Number(ot):void 0;return Mt.filter(L=>{var ye,Pe,$e,ft,Be,Ut,Ot,Lt,Kt;if(Ge&&!M.has(L.userId)||_e==="online"&&!L.isOnline||_e==="offline"&&L.isOnline||Ye&&!L.hasPicture||Number.isFinite(i)&&(typeof L.age!="number"||L.age<i)||Number.isFinite(l)&&(typeof L.age!="number"||L.age>l))return!1;const Q=typeof((ye=L.stats)==null?void 0:ye.race)=="string"?L.stats.race:"";return!(ie.trim()&&Q.toLowerCase()!==ie.trim().toLowerCase()||Number.isFinite(x)&&(typeof((Pe=L.stats)==null?void 0:Pe.heightInches)!="number"||L.stats.heightInches<x)||Number.isFinite(P)&&(typeof(($e=L.stats)==null?void 0:$e.heightInches)!="number"||L.stats.heightInches>P)||Number.isFinite(z)&&(typeof((ft=L.stats)==null?void 0:ft.weightLbs)!="number"||L.stats.weightLbs<z)||Number.isFinite(G)&&(typeof((Be=L.stats)==null?void 0:Be.weightLbs)!="number"||L.stats.weightLbs>G)||Number.isFinite(J)&&(typeof((Ut=L.stats)==null?void 0:Ut.cockSizeInches)!="number"||L.stats.cockSizeInches<J)||Number.isFinite($)&&(typeof((Ot=L.stats)==null?void 0:Ot.cockSizeInches)!="number"||L.stats.cockSizeInches>$)||lt&&((Lt=L.stats)==null?void 0:Lt.cutStatus)!==lt||dt&&((Kt=L.stats)==null?void 0:Kt.position)!==dt)})},[Mt,M,Ge,lt,B,ot,st,rt,h,at,Ce,it,dt,ie,Ye,_e]),ct=s.useMemo(()=>Array.from(new Set(Je.map(i=>i.key).filter(i=>i.trim().length>0))).slice(0,8),[Je]),At=ct.join("|"),ut=s.useMemo(()=>{const i=new Set(Object.keys(R));return re.trim()&&i.add(re),Array.from(i).sort((l,x)=>{var P,z;return(((P=R[x])==null?void 0:P.lastAt)??0)-(((z=R[l])==null?void 0:z.lastAt)??0)})},[R,re]),Rt=s.useMemo(()=>Object.values(W).reduce((i,l)=>i+(Number.isFinite(l)?l:0),0),[W]);s.useMemo(()=>{var i;return re?Ue[re]??((i=C[re])==null?void 0:i.displayName)??re:""},[Ue,re,C]);const tn=s.useMemo(()=>{if(!re)return;const i=Je.find(l=>l.key===re);return i==null?void 0:i.avatarUrl},[Je,re]),Qe=s.useMemo(()=>ut.filter(i=>i!==re&&i!==Ae&&!!R[i]).map(i=>{var l;return{key:i,label:Ue[i]??((l=C[i])==null?void 0:l.displayName)??i}}),[ut,R,Ue,Ae,re,C]);s.useEffect(()=>{typeof g=="function"&&g(Rt)},[g,Rt]),s.useEffect(()=>{const i=Se.current;i&&(i.srcObject=de)},[de]),s.useEffect(()=>{const i=Fe.current;i&&(i.srcObject=Ke)},[Ke]),s.useEffect(()=>()=>{if(de){for(const i of de.getTracks())i.stop();if(Ke)for(const i of Ke.getTracks())i.stop();xe.current&&(xe.current.close(),xe.current=null)}},[de,Ke]),s.useEffect(()=>{if(Qe.length===0){N("");return}N(i=>i&&Qe.some(l=>l.key===i)?i:Qe[0].key)},[Qe]);const nn=s.useMemo(()=>({async sendMessage(i,l,x,P){const z=Te(l),G=await t.sendChat(n.sessionToken,i,z,x,P),J=G==null?void 0:G.message,$=[J];if(i==="cruise"&&ne)try{const L=await t.sendChat(n.sessionToken,i,Te(ne),x,P),Q=L==null?void 0:L.message;$.push(Q)}catch(L){c(V(L))}for(const L of $)Nt(L);return J},async initiateMediaUpload(i,l){const x=await t.initiateChatMediaUpload(n.sessionToken,{mimeType:i,sizeBytes:l});return{objectKey:x.objectKey,uploadUrl:x.uploadUrl}},async uploadToSignedUrl(i,l,x){if(await bt(i,l,x))return;if(!(await fetch(i,{method:"PUT",headers:{"content-type":x},body:l})).ok)throw{code:"MEDIA_UPLOAD_INCOMPLETE",message:"Upload failed."}},async getMediaUrl(i){return(await t.getChatMediaUrl(n.sessionToken,i)).downloadUrl}}),[t,Ae,n.sessionToken,c,ne]);function Ze(i){var l,x,P;return i.text&&i.text.trim()?Zt(i.text):((l=i.media)==null?void 0:l.kind)==="image"?"[Photo]":((x=i.media)==null?void 0:x.kind)==="video"?"[Video]":((P=i.media)==null?void 0:P.kind)==="audio"?"[Voice]":""}function sn(i){if(!i||Ie.current.has(i))return!1;if(Ie.current.add(i),Ie.current.size>5e3){const l=Array.from(Ie.current).slice(-2500);Ie.current=new Set(l)}return!0}function rn(i,l){var z;const x=Ue[l]??((z=C[l])==null?void 0:z.displayName)??l,P=Ze(i)||"New activity";if("Notification"in window){if(Notification.permission==="granted"){try{new Notification(`${x}`,{body:P})}catch{}return}Notification.permission==="default"&&Notification.requestPermission()}}function an(i){if(!i.startsWith("GROUP_INVITE_REQUEST|"))return null;const[,l,x,P]=i.split("|");return!l||!x||!P?null:{inviteId:l,inviterKey:x,primaryPeerKey:P}}function on(i){if(!i.startsWith("GROUP_INVITE_ACCEPT|"))return null;const[,l,x]=i.split("|");return!l||!x?null:{inviteId:l,candidateKey:x}}function Nt(i){if(!sn(i.messageId))return;const l=i.fromKey===Ae?i.toKey:i.fromKey;O(z=>{const G=z[l]??[];return G.some(J=>J.messageId===i.messageId)?z:{...z,[l]:[...G,i].sort((J,$)=>J.createdAtMs-$.createdAtMs)}}),ee(z=>({...z,[l]:{lastAt:i.createdAtMs,lastText:Ze(i)}})),i.fromKey!==Ae&&(ge==="thread"&&Te(re)===Te(l)?(F(G=>({...G,[l]:Math.max(G[l]??0,i.createdAtMs)})),r(G=>{const J={...G};return delete J[l],J})):r(G=>({...G,[l]:(G[l]??0)+1})),rn(i,l));const x=an(i.text??"");x&&i.toKey===Ae&&k(z=>z.some(G=>G.inviteId===x.inviteId)?z:[...z,{...x,createdAtMs:i.createdAtMs}]);const P=on(i.text??"");P&&i.toKey===Ae&&ue[P.inviteId]&&(E(Te(P.candidateKey)),d(`Invite accepted by ${Ue[P.candidateKey]??P.candidateKey}.`),oe(G=>{const J={...G};return delete J[P.inviteId],J}))}async function ln(i){const l=Te(i);if(l)try{const x=await t.listChat(n.sessionToken,et(ae),l),P=x==null?void 0:x.messages,z=Array.isArray(P)?P:[];t.markChatRead(n.sessionToken,et(ae),l).catch(()=>{}),O($=>({...$,[l]:z}));const G=z.length>0?z[z.length-1]:null;G&&ee($=>({...$,[l]:{lastAt:G.createdAtMs,lastText:Ze(G)}}));let J=0;for(const $ of z)$.fromKey===l&&$.createdAtMs>J&&(J=$.createdAtMs);J>0&&F($=>({...$,[l]:Math.max($[l]??0,J)}))}catch(x){c(V(x))}}s.useEffect(()=>{if(ge!=="thread"||!re.trim())return;let i=!1,l=!1,x=null;const P=async()=>{if(!(i||l)){l=!0;try{await ln(re)}finally{l=!1}i||(x=window.setTimeout(()=>{P()},1200))}};return P(),()=>{i=!0,x!==null&&window.clearTimeout(x)}},[ae,re,ge]),s.useEffect(()=>{if(ge!=="grid")return;if(ct.length===0){r({});return}let i=!1;async function l(){if(!Y.current&&!document.hidden){Y.current=!0;try{const z=et(ae),G=[],J=[];for(const L of ct){if(i)break;try{const Q=Te(L);if(!Q)continue;const ye=await t.listChat(n.sessionToken,z,Q),Pe=(ye==null?void 0:ye.messages)??[];if(Pe.length>0){const Be=Pe[Pe.length-1];J.push([Q,{lastAt:Be.createdAtMs,lastText:Ze(Be)}])}let $e=0;const ft=m[Q]??0;for(const Be of Pe)Be.fromKey===Q&&Be.createdAtMs>ft&&($e+=1);G.push([Q,$e])}catch{const Q=Te(L);Q&&G.push([Q,0])}}if(i)return;J.length>0&&ee(L=>{const Q={...L};for(const[ye,Pe]of J)Q[ye]=Pe;return Q});const $={};for(const[L,Q]of G)Q>0&&($[L]=Q);r($)}finally{Y.current=!1}}}const x=window.setTimeout(()=>{l()},1200),P=window.setInterval(()=>{l()},15e3);return()=>{i=!0,Y.current=!1,window.clearTimeout(x),window.clearInterval(P)}},[t,ae,m,n.sessionToken,At,ge]),s.useEffect(()=>{const i=Array.from(new Set([...ut,...ct,re].map(G=>Te(G)).filter(G=>G.length>0))).slice(0,10);if(i.length===0)return;let l=!1;const x=async()=>{if(!(l||document.hidden||je.current)){je.current=!0;try{const G=et(ae),J=[];for(const $ of i){if(l)break;try{const L=await t.listChat(n.sessionToken,G,$),Q=(L==null?void 0:L.messages)??[];if(Q.length===0)continue;const ye=Q[Q.length-1];J.push([$,{lastAt:ye.createdAtMs,lastText:Ze(ye)}])}catch{}}if(l||J.length===0)return;ee($=>{const L={...$};for(const[Q,ye]of J)L[Q]=ye;return L})}finally{je.current=!1}}},P=window.setTimeout(()=>{x()},1e3),z=window.setInterval(()=>{x()},5e3);return()=>{l=!0,window.clearTimeout(P),window.clearInterval(z)}},[t,ae,ut,re,n.sessionToken,At]);async function dn(){if(de)return de;if(!navigator.mediaDevices||typeof navigator.mediaDevices.getUserMedia!="function")throw{code:"UNAUTHORIZED_ACTION",message:"Camera access is not available in this browser."};const i=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});return ve(i),i}function cn(i,l){xe.current&&(xe.current.close(),xe.current=null);const x=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});return xe.current=x,Le.current=l,ze.current=i,x.ontrack=P=>{const z=P.streams[0];z&&tt(z)},x.onicecandidate=P=>{const z=P.candidate;if(!z)return;const G=ze.current,J=Le.current;!G||!J||t.sendCallSignal(n.sessionToken,{toKey:G,callId:J,signalType:"ice",candidate:JSON.stringify(z.toJSON())}).catch(()=>{})},x}async function Pt(i=!0){const l=ze.current,x=Le.current;if(i&&l&&x)try{await t.sendCallSignal(n.sessionToken,{toKey:l,callId:x,signalType:"hangup"})}catch{}if(de)for(const P of de.getTracks())P.stop();if(Ke)for(const P of Ke.getTracks())P.stop();ve(null),tt(null),xe.current&&(xe.current.close(),xe.current=null),Le.current=null,ze.current=null,le(!1)}s.useEffect(()=>{let i=!1;const l=gt();if(!l)return;const x=()=>{q.current!==null&&(window.clearInterval(q.current),q.current=null),Me.current!==null&&(window.clearTimeout(Me.current),Me.current=null)},P=()=>{if(i)return;const z=new WebSocket(l);De.current=z,z.onopen=()=>{Ne.current=0,z.send(JSON.stringify({type:"auth",payload:{sessionToken:n.sessionToken}})),q.current=window.setInterval(()=>{z.readyState===z.OPEN&&z.send(JSON.stringify({type:"heartbeat",payload:{}}))},15e3)},z.onmessage=G=>{let J=null;try{J=JSON.parse(String(G.data))}catch{return}if(!J||typeof J.type!="string")return;if(J.type==="chat_message"){const Q=J.payload,ye=Q==null?void 0:Q.message;if(!ye||ye.fromKey!==Ae&&ye.toKey!==Ae)return;Nt(ye);return}if(J.type!=="call_signal")return;const $=J.payload;if(!$||$.toKey!==Ae||typeof $.fromKey!="string"||!$.callId||!$.signalType)return;const L=Te($.fromKey);if($.signalType==="hangup"){Pt(!1);return}if($.signalType==="offer"){(async()=>{try{yt(L),ke(L);const Q=await dn(),ye=cn(L,$.callId);for(const $e of Q.getTracks())ye.addTrack($e,Q);await ye.setRemoteDescription({type:"offer",sdp:$.sdp??""});const Pe=await ye.createAnswer();await ye.setLocalDescription(Pe),await t.sendCallSignal(n.sessionToken,{toKey:L,callId:$.callId,signalType:"answer",sdp:Pe.sdp??""}),le(!0)}catch(Q){c(V(Q))}})();return}if($.signalType==="answer"){(async()=>{try{if(!xe.current||Le.current!==$.callId)return;await xe.current.setRemoteDescription({type:"answer",sdp:$.sdp??""})}catch(Q){c(V(Q))}})();return}$.signalType==="ice"&&(async()=>{try{if(!xe.current||Le.current!==$.callId||!$.candidate)return;const Q=JSON.parse($.candidate);await xe.current.addIceCandidate(Q)}catch{}})()},z.onclose=()=>{if(x(),i)return;Ne.current+=1;const G=Math.min(8e3,500*2**Math.min(Ne.current,4));Me.current=window.setTimeout(P,G)},z.onerror=()=>{}};return P(),()=>{var z;i=!0,x(),(z=De.current)==null||z.close(1e3,"chat cleanup"),De.current=null}},[t,Ae,n.sessionToken]);async function un(){if(p.trim()){if(!re.trim()){c("Select a user first.");return}try{const i=Te(p);if(!i)return;if(!Qe.some(x=>x.key===i)){c("You can only add a third user you have previously messaged.");return}const l=crypto.randomUUID();await t.sendChat(n.sessionToken,"cruise",i,`GROUP_INVITE_REQUEST|${l}|${Ae}|${re.trim()}`),oe(x=>({...x,[l]:{candidateKey:i,primaryPeerKey:re.trim()}})),d(`Invite sent to ${Ue[i]??i}. Waiting for acceptance.`)}catch(i){c(V(i))}}}async function Et(i,l,x){try{await t.sendChat(n.sessionToken,"cruise",l,`GROUP_INVITE_ACCEPT|${i}|${Ae}`),k(P=>P.filter(z=>z.inviteId!==i)),d("Group invite accepted."),yt(x)}catch(P){c(V(P))}}function Ft(i){k(l=>l.filter(x=>x.inviteId!==i))}function yt(i){const l=Te(i);I(l),y(l),r(x=>{const P={...x};return delete P[l],P}),F(x=>({...x,[l]:Date.now()})),ce("thread")}function pt(){Ve(!1),qe("all"),f(!1),w(""),Z(""),pe(""),Xe(""),xt(""),jt(""),wt(""),St(""),kt(""),It(""),Ct(""),We(!1)}if(s.useEffect(()=>{const i=l=>{var z;const P=(z=l.detail)==null?void 0:z.action;if(P==="reset"){pt(),ce("grid");return}if(P==="toggle_favorites"){Ve(G=>!G),ce("grid");return}P==="open_filters"&&(We(!0),ce("grid"))};return window.addEventListener("rd:discover-control",i),()=>window.removeEventListener("rd:discover-control",i)},[]),s.useEffect(()=>{U&&U.nonce!==Re.current&&(Re.current=U.nonce,yt(U.key),typeof _=="function"&&_())},[_,U]),s.useEffect(()=>{const i=l=>{var P;((P=l.detail)==null?void 0:P.tab)==="discover"&&(ce("grid"),y(null),We(!1))};return window.addEventListener("rd:tab-select",i),()=>window.removeEventListener("rd:tab-select",i)},[]),ge==="thread"&&re.trim()){const i=Ue[re]??((zt=C[re])==null?void 0:zt.displayName)??re;return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:H?-10:0},children:[te.length>0?e.jsxs("div",{style:{...Ee(),display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"INVITE REQUESTS"}),te.map(l=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,alignItems:"center"},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:13},children:[Ue[l.inviterKey]??l.inviterKey," invited you to join a conversation."]}),e.jsx("button",{type:"button",style:fe(!1),onClick:()=>void Et(l.inviteId,l.inviterKey,l.primaryPeerKey),children:"ACCEPT"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>Ft(l.inviteId),children:"DECLINE"})]},l.inviteId))]}):null,be?e.jsx("div",{style:{color:"#26d5ff",fontSize:12},children:be}):null,e.jsx(Xt,{chatKind:et(ae),peerKey:re,currentUserKey:Ae,messages:en,client:nn,title:`INSTANT THREAD: ${i}`,peerSummary:{displayName:i,avatarUrl:tn},thirdParty:{candidates:Qe,selectedKey:p,onSelect:l=>N(l),onAdd:()=>void un(),disabled:a},showHeader:!1,edgeToEdge:H,fillHeight:H}),se?e.jsx("div",{role:"dialog","aria-modal":"true","aria-label":"Video call",style:{position:"fixed",inset:0,zIndex:60,background:"rgba(0,0,0,0.82)",display:"grid",placeItems:"center",padding:16},children:e.jsxs("div",{style:{...Ee(),width:"min(720px, 100%)",display:"grid",gap:10},children:[e.jsxs("div",{style:{fontSize:18,fontWeight:700},children:["VIDEO CALL: ",we]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("video",{ref:Se,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"100%",maxHeight:"52vh",borderRadius:12,background:"#000"}}),e.jsx("video",{ref:Fe,autoPlay:!0,playsInline:!0,style:{width:"100%",maxHeight:"52vh",borderRadius:12,background:"#000"}})]}),e.jsx("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:e.jsx("button",{type:"button",style:D(!1),onClick:()=>void Pt(),children:"END CALL"})})]})}):null]})}return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:H?-10:0},children:[te.length>0?e.jsxs("div",{style:{...Ee(),display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"INVITE REQUESTS"}),te.map(i=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,alignItems:"center"},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:13},children:[Ue[i.inviterKey]??i.inviterKey," invited you to join a conversation."]}),e.jsx("button",{type:"button",style:fe(!1),onClick:()=>void Et(i.inviteId,i.inviterKey,i.primaryPeerKey),children:"ACCEPT"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>Ft(i.inviteId),children:"DECLINE"})]},i.inviteId))]}):null,be?e.jsx("div",{style:{color:"#26d5ff",fontSize:12},children:be}):null,e.jsx("div",{style:{padding:10,borderBottom:"1px solid rgba(255,58,77,0.28)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8},children:[e.jsx("button",{type:"button",style:D(!1),onClick:pt,children:"GUYS"}),e.jsx("button",{type:"button",style:Ge?fe(!1):D(!1),onClick:()=>Ve(i=>!i),"aria-label":"Toggle favorites only",children:"â˜…"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>We(!0),children:"FILTER"})]})}),nt?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},role:"dialog","aria-modal":"true","aria-label":"Discover filters",onClick:()=>We(!1),children:e.jsx("div",{onClick:i=>i.stopPropagation(),style:{...Ee(),width:"min(760px, 100%)",maxHeight:"86vh",overflow:"auto"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"FILTER USERS"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{type:"checkbox",checked:Ye,onChange:i=>f(i.target.checked)}),"Has pictures"]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Online status"}),e.jsxs("select",{style:X(),value:_e,onChange:i=>qe(i.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"offline",children:"Offline"})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[e.jsx("input",{style:X(),placeholder:"Min age",value:h,onChange:i=>w(i.target.value)}),e.jsx("input",{style:X(),placeholder:"Max age",value:B,onChange:i=>Z(i.target.value)}),e.jsx("input",{style:X(),placeholder:"Race",value:ie,onChange:i=>pe(i.target.value)}),e.jsxs("select",{style:X(),value:lt,onChange:i=>It(i.target.value),children:[e.jsx("option",{value:"",children:"Cut / Uncut"}),e.jsx("option",{value:"cut",children:"Cut"}),e.jsx("option",{value:"uncut",children:"Uncut"})]}),e.jsx("input",{style:X(),placeholder:"Min height (in)",value:Ce,onChange:i=>Xe(i.target.value)}),e.jsx("input",{style:X(),placeholder:"Max height (in)",value:st,onChange:i=>xt(i.target.value)}),e.jsx("input",{style:X(),placeholder:"Min weight (lbs)",value:it,onChange:i=>jt(i.target.value)}),e.jsx("input",{style:X(),placeholder:"Max weight (lbs)",value:rt,onChange:i=>wt(i.target.value)}),e.jsx("input",{style:X(),placeholder:"Min cock size (in)",value:at,onChange:i=>St(i.target.value)}),e.jsx("input",{style:X(),placeholder:"Max cock size (in)",value:ot,onChange:i=>kt(i.target.value)}),e.jsxs("select",{style:X(),value:dt,onChange:i=>Ct(i.target.value),children:[e.jsx("option",{value:"",children:"Position"}),e.jsx("option",{value:"top",children:"Top"}),e.jsx("option",{value:"bottom",children:"Bottom"}),e.jsx("option",{value:"side",children:"Side"})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:D(!1),onClick:pt,children:"RESET"}),e.jsx("button",{type:"button",style:fe(!1),onClick:()=>We(!1),children:"DONE"})]})]})})}):null,e.jsx("div",{style:{display:"grid",gap:0},children:e.jsx("div",{style:{display:"grid",gap:0,gridTemplateColumns:"repeat(3, minmax(0, 1fr))"},children:Je.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:13,padding:12,gridColumn:"1 / -1"},children:"No users match current filters."}):Je.map(i=>e.jsx("button",{type:"button",onClick:()=>A(i.key),style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:0,display:"grid",gap:0,color:"#fff",cursor:"pointer"},children:e.jsxs("div",{style:{position:"relative",width:"100%",aspectRatio:"1 / 1"},children:[e.jsx("img",{src:i.avatarUrl??He(i.key),alt:"User avatar",style:{width:"100%",height:"100%",borderRadius:0,objectFit:"cover",border:"1px solid #0fd9ff"}}),i.isOnline?e.jsx("span",{style:{position:"absolute",top:4,left:4,width:10,height:10,borderRadius:"50%",background:"#26d5ff",border:"2px solid #000"}}):null]})},i.key))})})]})}function Pn({api:t,session:n,setLastError:a,openThreadRequest:u,onThreadRequestConsumed:c,isMobile:v}){var k,ue,oe,be,d,W;const[S,I]=s.useState([]),[A,U]=s.useState(null),[_,H]=s.useState([]),[T,C]=s.useState("messages"),[o,b]=s.useState(null),[M,K]=s.useState(!1),[g,j]=s.useState(""),[O,R]=s.useState(null),[ee,ae]=s.useState({}),[he,ge]=s.useState(null),ce=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,me="cruise",y=s.useMemo(()=>S.filter(r=>r.key!==A).map(r=>({key:r.key,label:r.displayName})),[S,A]),p=s.useMemo(()=>S.find(r=>r.key===A)??null,[S,A]);s.useEffect(()=>{if(y.length===0){j("");return}j(r=>r&&y.some(m=>m.key===r)?r:y[0].key)},[y]),s.useEffect(()=>{let r=!1;async function m(){var se,le,we;try{const ke=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,[de,ve]=await Promise.all([t.getPublicProfiles(),t.listActivePresence(n.sessionToken)]),Y={},je={};for(const q of de.profiles)Y[Oe(q.userId)]=q.displayName,typeof q.mainPhotoMediaId=="string"&&q.mainPhotoMediaId.trim()!==""&&(je[Oe(q.userId)]=q.mainPhotoMediaId);const Re=Array.from(new Set([...de.profiles.map(q=>Oe(q.userId)),...ve.presence.map(q=>Te(q.key))].filter(q=>q&&q!==ke))).slice(0,24),Se=[];for(const q of Re)try{const Me=await t.listChat(n.sessionToken,"cruise",q),Ne=(Me==null?void 0:Me.messages)??[];if(!Array.isArray(Ne)||Ne.length===0)continue;const Ie=Ne[Ne.length-1],xe=typeof Ie.text=="string"&&Ie.text.trim().length>0?Zt(Ie.text):((se=Ie.media)==null?void 0:se.kind)==="image"?"[Photo]":((le=Ie.media)==null?void 0:le.kind)==="video"?"[Video]":((we=Ie.media)==null?void 0:we.kind)==="audio"?"[Voice]":"";Se.push({key:q,displayName:Y[q]??q,preview:xe,at:Ie.createdAtMs})}catch{}const Fe=await Promise.all(Se.map(async q=>{const Me=je[q.key];if(!Me)return null;try{const Ne=await t.getPublicMediaUrl(Me);return{key:q.key,url:Ne.downloadUrl}}catch{return null}})),De={};for(const q of Fe)q&&(De[q.key]=q.url);for(const q of Se)q.avatarUrl=De[q.key];if(r)return;Se.sort((q,Me)=>Me.at-q.at),I(Se)}catch(ke){r||a(V(ke))}}m();const F=window.setInterval(()=>{m()},1e4);return()=>{r=!0,window.clearInterval(F)}},[t,A,n.sessionToken,n.userId,a]),s.useEffect(()=>{u!=null&&u.key&&(U(Te(u.key)),C("messages"),typeof c=="function"&&c())},[c,u]),s.useEffect(()=>{const r=m=>{var se;((se=m.detail)==null?void 0:se.tab)==="threads"&&(U(null),C("messages"))};return window.addEventListener("rd:tab-select",r),()=>window.removeEventListener("rd:tab-select",r)},[]),s.useEffect(()=>{if(!A||T!=="profile")return;const r=ht(A);if(!r){b(null);return}let m=!1;return K(!0),t.getPublicProfile(r).then(F=>{m||b(F.profile)}).catch(F=>{m||(b(null),a(V(F)))}).finally(()=>{m||K(!1)}),()=>{m=!0}},[t,A,a,T]),s.useEffect(()=>{if(!A){H([]);return}let r=!1;const m=async()=>{try{const se=await t.listChat(n.sessionToken,me,A),le=(se==null?void 0:se.messages)??[];r||(H(Array.isArray(le)?le:[]),t.markChatRead(n.sessionToken,me,A).catch(()=>{}))}catch(se){r||a(V(se))}};m();const F=window.setInterval(()=>{m()},1200);return()=>{r=!0,window.clearInterval(F)}},[t,A,n.sessionToken,a]);function N(r){if(!r.startsWith("GROUP_INVITE_ACCEPT|"))return null;const[,m,F]=r.split("|");return!m||!F?null:{inviteId:m,candidateKey:F}}const ne=s.useMemo(()=>({async sendMessage(r,m,F,se){const le=await t.sendChat(n.sessionToken,r,m,F,se),we=le==null?void 0:le.message,ke=N(we.text??"");if(ke&&we.toKey===ce&&ee[ke.inviteId]&&(R(ke.candidateKey),ge(`Invite accepted by ${ke.candidateKey}.`),ae(ve=>{const Y={...ve};return delete Y[ke.inviteId],Y})),H(de=>[...de,we].sort((ve,Y)=>ve.createdAtMs-Y.createdAtMs)),r==="cruise"&&O)try{const de=await t.sendChat(n.sessionToken,r,O,F,se),ve=de==null?void 0:de.message;H(Y=>[...Y,ve].sort((je,Re)=>je.createdAtMs-Re.createdAtMs))}catch(de){a(V(de))}return we},async initiateMediaUpload(r,m){const F=await t.initiateChatMediaUpload(n.sessionToken,{mimeType:r,sizeBytes:m});return{objectKey:F.objectKey,uploadUrl:F.uploadUrl}},async uploadToSignedUrl(r,m,F){if(await bt(r,m,F))return;if(!(await fetch(r,{method:"PUT",headers:{"content-type":F},body:m})).ok)throw{code:"MEDIA_UPLOAD_INCOMPLETE",message:"Upload failed."}},async getMediaUrl(r){return(await t.getChatMediaUrl(n.sessionToken,r)).downloadUrl}}),[t,ce,ee,n.sessionToken,a,O]);async function E(){var r;if(!(!A||!g)){if(!S.some(m=>m.key===g)){a("You can only add a third user you have previously messaged.");return}try{const m=crypto.randomUUID();await t.sendChat(n.sessionToken,"cruise",g,`GROUP_INVITE_REQUEST|${m}|${ce}|${A}`),ae(F=>({...F,[m]:{candidateKey:g}})),ge(`Invite sent to ${((r=S.find(F=>F.key===g))==null?void 0:r.displayName)??g}.`)}catch(m){a(V(m))}}}async function te(){if(A)try{await t.sendChat(n.sessionToken,"cruise",A,vt),ge("Fire sent.")}catch(r){a(V(r))}}if(A){const r=(p==null?void 0:p.displayName)??A;return e.jsxs("div",{style:{display:"grid",gap:0,minHeight:v?"calc(100dvh - 150px)":void 0,marginInline:v?-10:0,marginBlock:0},children:[e.jsx("div",{style:{position:"sticky",top:0,zIndex:46,background:"rgba(8,8,12,0.96)",borderBottom:"1px solid rgba(255,58,77,0.35)",padding:"6px 10px",display:"flex",justifyContent:"flex-end"},children:e.jsx("button",{type:"button",onClick:()=>C(m=>m==="messages"?"profile":"messages"),style:{background:"transparent",border:0,color:"#26d5ff",fontSize:13,fontWeight:700,letterSpacing:"0.03em",textTransform:"uppercase",padding:0,cursor:"pointer"},children:T==="messages"?"View Profile":"Back to Thread"})}),T==="messages"?e.jsx(Xt,{chatKind:"cruise",peerKey:A,currentUserKey:ce,messages:_,client:ne,title:`INSTANT THREAD: ${r}`,peerSummary:{displayName:r},thirdParty:{candidates:y,selectedKey:g,onSelect:m=>j(m),onAdd:()=>void E(),disabled:!1},showHeader:!1,edgeToEdge:!0,fillHeight:v}):e.jsxs("div",{style:{padding:12,display:"grid",gap:12},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"88px 1fr",gap:12,alignItems:"center"},children:[e.jsx("img",{src:(p==null?void 0:p.avatarUrl)??He(A),alt:"Profile avatar",style:{width:88,height:88,borderRadius:"50%",objectFit:"cover",border:"2px solid #ff3047"}}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:24,fontWeight:700},children:(o==null?void 0:o.displayName)??r}),e.jsx("div",{style:{color:"#26d5ff",fontSize:14},children:"Instant Messaging Available"})]})]}),M?e.jsx("div",{style:{color:"#9fb6bf",fontSize:14},children:"Loading profile..."}):null,M?null:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:14,lineHeight:1.5},children:[e.jsxs("div",{children:["Age: ",(o==null?void 0:o.age)??"-"]}),e.jsxs("div",{children:["Race: ",((k=o==null?void 0:o.stats)==null?void 0:k.race)??"-"]}),e.jsxs("div",{children:["Height: ",((ue=o==null?void 0:o.stats)==null?void 0:ue.heightInches)??"-"]}),e.jsxs("div",{children:["Weight: ",((oe=o==null?void 0:o.stats)==null?void 0:oe.weightLbs)??"-"]}),e.jsxs("div",{children:["Cock Size: ",((be=o==null?void 0:o.stats)==null?void 0:be.cockSizeInches)??"-"]}),e.jsxs("div",{children:["Cut / Uncut: ",((d=o==null?void 0:o.stats)==null?void 0:d.cutStatus)??"-"]}),e.jsxs("div",{children:["Position: ",((W=o==null?void 0:o.stats)==null?void 0:W.position)??"-"]}),e.jsxs("div",{style:{marginTop:8},children:["Bio: ",(o==null?void 0:o.bio)??"-"]})]}),e.jsx("div",{children:e.jsx("button",{type:"button",style:{...D(!1),color:"#ffb347",borderColor:"rgba(255,179,71,0.65)"},onClick:()=>void te(),children:"ðŸ”¥ FIRE"})})]})]})]})}return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:v?-10:0,marginBlock:0},children:[S.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14,padding:14},children:"No conversations yet."}):S.map(r=>e.jsxs("button",{type:"button",onClick:()=>U(r.key),style:{border:0,borderBottom:"1px solid rgba(255,58,77,0.24)",borderRadius:0,padding:"10px 12px",background:"rgba(0,0,0,0.2)",textAlign:"left",color:"#fff",cursor:"pointer",display:"grid",gridTemplateColumns:"52px 1fr",gap:10,alignItems:"center",width:"100%"},children:[e.jsx("img",{src:r.avatarUrl??He(r.key),alt:`${r.displayName} avatar`,style:{width:52,height:52,borderRadius:6,objectFit:"cover",border:"1px solid rgba(38,213,255,0.9)"}}),e.jsxs("div",{style:{display:"grid",gap:3,minWidth:0},children:[e.jsx("div",{style:{fontWeight:700},children:r.displayName}),e.jsx("div",{style:{color:"#b9bec9",fontSize:13,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:r.preview})]})]},r.key)),he?e.jsx("div",{style:{color:"#26d5ff",fontSize:12,padding:10},children:he}):null]})}function En({api:t,session:n,isMobile:a,setLastError:u}){const[c,v]=s.useState("ads"),[S,I]=s.useState([]),[A,U]=s.useState([]),[_,H]=s.useState(""),[T,C]=s.useState(""),[o,b]=s.useState(""),[M,K]=s.useState(""),[g,j]=s.useState([]),[O,R]=s.useState(""),[ee,ae]=s.useState(""),[he,ge]=s.useState(""),[ce,me]=s.useState([]),[y,p]=s.useState({}),N=!0,ne=n.userType!=="guest";async function E(){try{const[r,m,F,se]=await Promise.all([t.listPublicPostings("ad"),t.listPublicPostings("event"),t.listCruisingSpots(),n.userType==="guest"?Promise.resolve({postings:[]}):t.listEventInvites(n.sessionToken)]);I([...r.postings].sort((le,we)=>le.createdAtMs-we.createdAtMs)),U([...m.postings].sort((le,we)=>le.createdAtMs-we.createdAtMs)),j(F.spots),me(se.postings)}catch(r){u(V(r))}}s.useEffect(()=>{E()},[]),s.useEffect(()=>{const r=m=>{var se;((se=m.detail)==null?void 0:se.tab)==="public"&&v("ads")};return window.addEventListener("rd:tab-select",r),()=>window.removeEventListener("rd:tab-select",r)},[]);async function te(r){if(r==="event"&&!ne){u("Anonymous users cannot create event postings.");return}const m=r==="ad"?_:o,F=r==="ad"?T:M;try{await t.createPublicPosting(n.sessionToken,{type:r,title:m,body:F}),r==="ad"?(H(""),C("")):(b(""),K("")),await E()}catch(se){u(V(se))}}async function k(r){if(!ne){u("Anonymous users cannot invite to events.");return}const m=(y[r]??"").trim();if(!m){u("Target user id is required.");return}try{await t.inviteToEvent(n.sessionToken,{postingId:r,targetUserId:m}),p(F=>({...F,[r]:""})),await E()}catch(F){u(V(F))}}async function ue(r,m){if(n.userType==="guest"){u("Anonymous users cannot respond to event invites.");return}try{await t.respondToEventInvite(n.sessionToken,{postingId:r,accept:m}),await E()}catch(F){u(V(F))}}async function oe(){try{await t.createCruisingSpot(n.sessionToken,{name:O,address:ee,description:he}),R(""),ae(""),ge(""),await E()}catch(r){u(V(r))}}async function be(r){try{await t.checkInCruisingSpot(n.sessionToken,r),await E()}catch(m){u(V(m))}}const d=r=>{const m=r==="ads"?"ADS":"EVENTS",F=r==="ads"?S:A,se=r==="ads"?_:o,le=r==="ads"?T:M,we=r==="ads"?H:b,ke=r==="ads"?C:K,de=r==="ads"?"ad":"event",ve=r==="ads"?N:ne;return e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.38)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:m}),e.jsx("input",{value:se,onChange:Y=>we(Y.target.value),placeholder:`${m} title`,style:X(),"aria-label":`${m} title`,disabled:!ve}),e.jsx("textarea",{value:le,onChange:Y=>ke(Y.target.value),placeholder:`Write ${m.toLowerCase()} details`,style:{...X(),minHeight:86,resize:"vertical"},"aria-label":`${m} details`,disabled:!ve}),e.jsxs("button",{type:"button",onClick:()=>void te(de),style:ve?fe(!1):D(!0),disabled:!ve,children:["POST ",m]}),ve?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can view events but cannot post events."}),e.jsx("div",{style:{display:"grid",gap:8,marginTop:6},children:F.length===0?e.jsxs("div",{style:{color:"#b9bec9",fontSize:14},children:["No ",m.toLowerCase()," yet."]}):F.map(Y=>{var je,Re;return e.jsxs("div",{style:{borderTop:"1px solid rgba(255,58,77,0.25)",paddingTop:10,paddingBottom:10},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:4},children:Y.title}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12,marginBottom:6},children:["Host: ",Y.authorUserId]}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap"},children:Y.body}),r==="events"?e.jsxs("div",{style:{display:"grid",gap:8,marginTop:8},children:[e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12},children:["Invited: ",((je=Y.invitedUserIds)==null?void 0:je.length)??0," | Accepted: ",((Re=Y.acceptedUserIds)==null?void 0:Re.length)??0]}),n.userId&&n.userId===Y.authorUserId?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8},children:[e.jsx("input",{value:y[Y.postingId]??"",onChange:Se=>p(Fe=>({...Fe,[Y.postingId]:Se.target.value})),placeholder:"Invite user id",style:X()}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void k(Y.postingId),children:"INVITE"})]}):null,n.userType!=="guest"&&n.userId&&Array.isArray(Y.invitedUserIds)&&Y.invitedUserIds.includes(n.userId)?e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:fe(!1),onClick:()=>void ue(Y.postingId,!0),children:"ACCEPT INVITE"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void ue(Y.postingId,!1),children:"DECLINE"})]}):null]}):null]},Y.postingId)})})]})})},W=e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.38)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"CRUISING SPOTS"}),e.jsx("input",{value:O,onChange:r=>R(r.target.value),placeholder:"Spot name",style:X(),disabled:!1}),e.jsx("input",{value:ee,onChange:r=>ae(r.target.value),placeholder:"Spot address",style:X(),disabled:!1}),e.jsx("textarea",{value:he,onChange:r=>ge(r.target.value),placeholder:"Spot description",style:{...X(),minHeight:80,resize:"vertical"},disabled:!1}),e.jsx("button",{type:"button",style:fe(!1),disabled:!1,onClick:()=>void oe(),children:"CREATE SPOT"}),null,e.jsx("div",{style:{display:"grid",gap:8},children:g.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"No cruising spots yet."}):g.map(r=>e.jsxs("div",{style:{borderTop:"1px solid rgba(255,58,77,0.25)",paddingTop:10,paddingBottom:10},children:[e.jsx("div",{style:{fontWeight:700},children:r.name}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12,marginTop:4},children:["Created by: ",r.creatorUserId]}),e.jsx("div",{style:{color:"#9fb6bf",fontSize:12,marginTop:2},children:r.address}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap",marginTop:6},children:r.description}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:D(!1),onClick:()=>void be(r.spotId),children:"CHECK IN"}),e.jsxs("span",{style:{color:"#9fb6bf",fontSize:12},children:["Checked in: ",r.checkInCount??0]}),e.jsxs("span",{style:{color:"#9fb6bf",fontSize:12},children:["Got action: ",r.actionCount??0]})]})]},r.spotId))})]})});return e.jsx("div",{style:{display:"grid",gap:8,marginInline:a?-10:0},children:a?e.jsxs(e.Fragment,{children:[c==="ads"?d("ads"):null,c==="events"?d("events"):null,c==="spots"?W:null,e.jsx("div",{style:{position:"sticky",bottom:"calc(86px + env(safe-area-inset-bottom, 0px))",zIndex:31,background:"rgba(0,0,0,0.35)",padding:8},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[e.jsx("button",{type:"button",style:c==="ads"?fe(!1):D(!1),onClick:()=>v("ads"),children:"ADS"}),e.jsx("button",{type:"button",style:c==="events"?fe(!1):D(!1),onClick:()=>v("events"),children:"EVENTS"}),e.jsx("button",{type:"button",style:c==="spots"?fe(!1):D(!1),onClick:()=>v("spots"),children:"SPOTS"})]})})]}):e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[d("ads"),d("events"),e.jsx("div",{style:{gridColumn:"1 / -1"},children:W}),n.userType!=="guest"&&ce.length>0?e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.25)",gridColumn:"1 / -1",display:"grid",gap:8,padding:10},children:[e.jsx("div",{style:{fontSize:16,fontWeight:700},children:"EVENT INVITES"}),ce.map(r=>e.jsxs("div",{style:{display:"grid",gap:6,border:"1px solid rgba(255,58,77,0.4)",borderRadius:10,padding:8},children:[e.jsx("div",{style:{fontWeight:700},children:r.title}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13},children:["Host: ",r.authorUserId]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:fe(!1),onClick:()=>void ue(r.postingId,!0),children:"ACCEPT"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void ue(r.postingId,!1),children:"DECLINE"})]})]},r.postingId))]}):null]})})}function Fn({api:t,session:n,setLastError:a}){const[u,c]=s.useState([]),[v,S]=s.useState(""),[I,A]=s.useState("");async function U(){try{const o=await t.listSubmissions();c([...o.submissions].sort((b,M)=>M.createdAtMs-b.createdAtMs))}catch(o){a(V(o))}}s.useEffect(()=>{U()},[]);async function _(){try{await t.createSubmission(n.sessionToken,{title:v,body:I}),S(""),A(""),await U()}catch(o){a(V(o))}}async function H(o){try{await t.recordSubmissionView(o),await U()}catch(b){a(V(b))}}async function T(o,b){try{await t.rateSubmission(o,b),await U()}catch(M){a(V(M))}}const C=n.userType!=="guest";return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("input",{style:X(),value:v,onChange:o=>S(o.target.value),placeholder:"Story title",disabled:!C}),e.jsx("textarea",{style:{...X(),minHeight:120},value:I,onChange:o=>A(o.target.value),placeholder:"Write your story",disabled:!C}),e.jsx("button",{type:"button",style:C?fe(!1):D(!0),disabled:!C,onClick:()=>void _(),children:"PUBLISH STORY"}),C?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can read but cannot publish submissions."})]})}),e.jsx("div",{style:{display:"grid",gap:10},children:u.map(o=>{const b=o.ratingCount>0?(o.ratingSum/o.ratingCount).toFixed(2):"0.00";return e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.28)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:o.title}),e.jsx("div",{style:{color:"#ced3dc",whiteSpace:"pre-wrap",marginTop:6},children:o.body}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13,marginTop:8},children:["Views: ",o.viewCount," | Rating: ",b," (",o.ratingCount,")"]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:D(!1),onClick:()=>void H(o.submissionId),children:"VIEW"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void T(o.submissionId,1),children:"â˜…1"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void T(o.submissionId,2),children:"â˜…2"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void T(o.submissionId,3),children:"â˜…3"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void T(o.submissionId,4),children:"â˜…4"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void T(o.submissionId,5),children:"â˜…5"})]})]},o.submissionId)})})]})}function zn({api:t,session:n,setLastError:a}){var ce,me,y,p,N,ne;const[u,c]=s.useState([]),[v,S]=s.useState({}),[I,A]=s.useState(null),[U,_]=s.useState(2e3),[H,T]=s.useState(""),[C,o]=s.useState(""),[b,M]=s.useState(""),[K,g]=s.useState(""),[j,O]=s.useState("Ready."),R=n.userType!=="guest";async function ee(){try{const E=await t.listPromotedProfiles();c([...E.listings].sort((oe,be)=>be.createdAtMs-oe.createdAtMs)),_(E.feeCents);const te=Array.from(new Set(E.listings.map(oe=>oe.userId))).filter(oe=>oe.trim().length>0),k=await Promise.all(te.map(async oe=>{try{const d=(await t.getPublicProfile(oe)).profile.mainPhotoMediaId;if(!d)return null;const W=await t.getPublicMediaUrl(d);return{userId:oe,url:W.downloadUrl}}catch{return null}})),ue={};for(const oe of k)oe&&(ue[oe.userId]=oe.url);S(ue)}catch(E){a(V(E))}}s.useEffect(()=>{ee()},[]);async function ae(){if(!R){a("Anonymous users cannot create promoted profiles.");return}try{const E=await t.startPromotedPayment(n.sessionToken),te=await t.confirmPromotedPayment(n.sessionToken,E.payment.paymentToken);g(te.payment.paymentToken),O("Payment confirmed. You can now publish one promoted profile.")}catch(E){const te=V(E);O(te),a(te)}}async function he(){if(!R){a("Anonymous users cannot create promoted profiles.");return}try{await t.createPromotedProfile(n.sessionToken,{paymentToken:K,title:H,body:C,displayName:b}),T(""),o(""),M(""),g(""),O("Promoted profile published."),await ee()}catch(E){const te=V(E);O(te),a(te)}}async function ge(E){try{const te=await t.getPublicProfile(E);A(te.profile)}catch(te){a(V(te))}}return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"PROMOTED PROFILES"}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:14},children:["Publishing requires a $",Math.round(U/100)," fee per profile."]}),e.jsx("div",{style:{color:"#26d5ff",fontSize:13},children:j})]})}),e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("input",{value:b,onChange:E=>M(E.target.value),placeholder:"Display name",style:X(),disabled:!R}),e.jsx("input",{value:H,onChange:E=>T(E.target.value),placeholder:"Headline",style:X(),disabled:!R}),e.jsx("textarea",{value:C,onChange:E=>o(E.target.value),placeholder:"Profile description",style:{...X(),minHeight:92,resize:"vertical"},disabled:!R}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsxs("button",{type:"button",style:D(!R),disabled:!R,onClick:()=>void ae(),children:["PAY $",Math.round(U/100)]}),e.jsx("button",{type:"button",style:R?fe(!1):D(!0),disabled:!R,onClick:()=>void he(),children:"PUBLISH PROFILE"})]}),R?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can browse but cannot publish paid profiles."})]})}),e.jsx("div",{style:{display:"grid",gap:10},children:u.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"No promoted profiles yet."}):u.map(E=>e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.25)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"72px 1fr",gap:10,alignItems:"start"},children:[e.jsx("img",{src:v[E.userId]??He(`user:${E.userId}`),alt:`${E.displayName} profile`,style:{width:72,height:72,borderRadius:6,objectFit:"cover",border:"1px solid rgba(38,213,255,0.9)"}}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:E.title}),e.jsx("div",{style:{color:"#26d5ff",fontSize:13},children:E.displayName}),e.jsx("div",{style:{color:"#ced3dc",whiteSpace:"pre-wrap",fontSize:14},children:E.body}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void ge(E.userId),children:"VIEW PROFILE"})]})]})},E.listingId))}),I?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},onClick:()=>A(null),children:e.jsxs("div",{onClick:E=>E.stopPropagation(),style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:12,width:"min(560px, 100%)",background:"rgba(0,0,0,0.88)"},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:I.displayName}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:6},children:["Age: ",I.age]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Race: ",((ce=I.stats)==null?void 0:ce.race)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Height: ",((me=I.stats)==null?void 0:me.heightInches)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Weight: ",((y=I.stats)==null?void 0:y.weightLbs)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Cock Size: ",((p=I.stats)==null?void 0:p.cockSizeInches)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Cut / Uncut: ",((N=I.stats)==null?void 0:N.cutStatus)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Position: ",((ne=I.stats)==null?void 0:ne.position)??"-"]}),e.jsx("div",{style:{color:"#ced3dc",marginTop:10,whiteSpace:"pre-wrap"},children:I.bio}),e.jsx("div",{style:{marginTop:10},children:e.jsx("button",{type:"button",style:D(!1),onClick:()=>A(null),children:"CLOSE"})})]})}):null]})}function Un(){return{displayName:"",age:"",bio:"",heightInches:"",race:"",cockSizeInches:"",cutStatus:"",weightLbs:"",position:"",discreetMode:!1,travelEnabled:!1,travelLat:"",travelLng:"",lookingForMore:""}}function $t(t){var n,a,u;return{displayName:t.displayName,age:String(t.age),bio:t.bio,heightInches:t.stats.heightInches!==void 0?String(t.stats.heightInches):"",race:t.stats.race??"",cockSizeInches:t.stats.cockSizeInches!==void 0?String(t.stats.cockSizeInches):"",cutStatus:t.stats.cutStatus??"",weightLbs:t.stats.weightLbs!==void 0?String(t.stats.weightLbs):"",position:t.stats.position??"",discreetMode:t.discreetMode===!0,travelEnabled:((n=t.travelMode)==null?void 0:n.enabled)===!0,travelLat:typeof((a=t.travelMode)==null?void 0:a.lat)=="number"?String(t.travelMode.lat):"",travelLng:typeof((u=t.travelMode)==null?void 0:u.lng)=="number"?String(t.travelMode.lng):"",lookingForMore:t.bio}}function Gt(t){const n=t.trim();if(!n)return;const a=Number(n);return Number.isFinite(a)?Math.trunc(a):void 0}function On(t){const n=t.trim();if(!n)return;const a=Number(n);return Number.isFinite(a)?a:void 0}function Ln({api:t,session:n,setLastError:a}){var ce,me;const[u,c]=s.useState(Un()),[v,S]=s.useState(null),[I,A]=s.useState(!1),[U,_]=s.useState(!1),[H,T]=s.useState(null),[C,o]=s.useState({});async function b(){A(!0);try{const y=await t.getMyProfile(n.sessionToken);S(y.profile),c($t(y.profile)),T("Profile loaded.")}catch(y){const p=y;if((p==null?void 0:p.code)==="PROFILE_NOT_FOUND"){S(null),c(N=>({...N,age:N.age||"18"})),T("No profile yet. Fill out the form and save.");return}T(V(y))}finally{A(!1)}}s.useEffect(()=>{b()},[n.sessionToken,n.userType]),s.useEffect(()=>{const y=[v==null?void 0:v.mainPhotoMediaId,...(v==null?void 0:v.galleryMediaIds)??[]].filter(N=>typeof N=="string"&&N.length>0);if(y.length===0)return;const p=y.filter(N=>!C[N]);p.length!==0&&Promise.all(p.map(async N=>{try{const ne=await t.getPublicMediaUrl(N);return{id:N,url:ne.downloadUrl}}catch{return null}})).then(N=>{o(ne=>{const E={...ne};for(const te of N)te&&(E[te.id]=te.url);return E})})},[t,C,v==null?void 0:v.galleryMediaIds,v==null?void 0:v.mainPhotoMediaId]);async function M(){var y,p,N,ne,E;_(!0),a(null);try{const te=Number(u.age),k=u.lookingForMore.trim()?`${u.bio.trim()}

Looking For More: ${u.lookingForMore.trim()}`.trim():u.bio,ue=u.travelLat.trim()?Number(u.travelLat):void 0,oe=u.travelLng.trim()?Number(u.travelLng):void 0,be={displayName:u.displayName,age:Math.trunc(te),bio:k,stats:{heightInches:Gt(u.heightInches),race:u.race.trim()||void 0,cockSizeInches:On(u.cockSizeInches),cutStatus:u.cutStatus||void 0,weightLbs:Gt(u.weightLbs),position:u.position||void 0},discreetMode:u.discreetMode,travelMode:{enabled:u.travelEnabled,lat:Number.isFinite(ue)?ue:void 0,lng:Number.isFinite(oe)?oe:void 0}},d=await t.upsertMyProfile(n.sessionToken,be);S(d.profile),c($t(d.profile));try{localStorage.setItem("reddoor_travel_center",JSON.stringify({enabled:((y=d.profile.travelMode)==null?void 0:y.enabled)===!0,lat:(p=d.profile.travelMode)==null?void 0:p.lat,lng:(N=d.profile.travelMode)==null?void 0:N.lng})),window.dispatchEvent(new CustomEvent("rd:location-updated",{detail:{lat:(ne=d.profile.travelMode)==null?void 0:ne.lat,lng:(E=d.profile.travelMode)==null?void 0:E.lng}}))}catch{}T("Profile saved.")}catch(te){const k=V(te);T(k),a(k)}finally{_(!1)}}async function K(y,p){if(!p){T("Choose a file first.");return}if(n.userType==="guest"){T("Guest sessions cannot upload media. Register to persist media.");return}_(!0),a(null);try{const N=await t.initiateMediaUpload(n.sessionToken,{kind:y,mimeType:p.type||(y==="video"?"video/mp4":"image/jpeg"),sizeBytes:p.size});if(!await bt(N.uploadUrl,p,p.type||"application/octet-stream")){const E=await fetch(N.uploadUrl,{method:"PUT",headers:{"content-type":p.type||"application/octet-stream"},body:p});if(!E.ok)throw{message:`Upload failed (${E.status}).`}}await t.completeMediaUpload(n.sessionToken,N.mediaId),await b(),T("Media uploaded.")}catch(N){const ne=V(N);T(ne),a(ne)}finally{_(!1)}}const[g,j]=s.useState(null),[O,R]=s.useState(null),[ee,ae]=s.useState(null);async function he(y){if(v){_(!0);try{const p=(v.galleryMediaIds??[]).filter(ne=>ne!==y),N=await t.updateProfileMediaReferences(n.sessionToken,{galleryMediaIds:p});S(N.profile),T("Gallery updated.")}catch(p){const N=V(p);T(N),a(N)}finally{_(!1)}}}async function ge(y){if(v){_(!0);try{const p=await t.updateProfileMediaReferences(n.sessionToken,{galleryMediaIds:v.galleryMediaIds,mainPhotoMediaId:y});S(p.profile),T("Main photo updated.")}catch(p){const N=V(p);T(N),a(N)}finally{_(!1)}}}return e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:14},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"SETTINGS / PROFILE"}),n.userType==="guest"?e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guest profile data is temporary for this session and is removed when you log out."}):null,H?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:H}):null,e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Display Name"}),e.jsx("input",{value:u.displayName,onChange:y=>c(p=>({...p,displayName:y.target.value})),style:X()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Age"}),e.jsx("input",{value:u.age,onChange:y=>c(p=>({...p,age:y.target.value})),style:X(),inputMode:"numeric"})]})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Bio"}),e.jsx("textarea",{value:u.bio,onChange:y=>c(p=>({...p,bio:y.target.value})),style:{...X(),minHeight:88,resize:"vertical"}})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Looking For More (Optional)"}),e.jsx("textarea",{value:u.lookingForMore,onChange:y=>c(p=>({...p,lookingForMore:y.target.value})),style:{...X(),minHeight:72,resize:"vertical"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:u.discreetMode,onChange:y=>c(p=>({...p,discreetMode:y.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0,fontSize:13},children:"Discreet Mode (hide profile from others)"})]}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:u.travelEnabled,onChange:y=>c(p=>({...p,travelEnabled:y.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Travel Mode"})]})]}),u.travelEnabled?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Travel Lat"}),e.jsx("input",{value:u.travelLat,onChange:y=>c(p=>({...p,travelLat:y.target.value})),style:X()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Travel Lng"}),e.jsx("input",{value:u.travelLng,onChange:y=>c(p=>({...p,travelLng:y.target.value})),style:X()})]})]}):null,e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Height (in)"}),e.jsx("input",{value:u.heightInches,onChange:y=>c(p=>({...p,heightInches:y.target.value})),style:X(),inputMode:"numeric"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Race"}),e.jsx("input",{value:u.race,onChange:y=>c(p=>({...p,race:y.target.value})),style:X()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Cock Size (in)"}),e.jsx("input",{value:u.cockSizeInches,onChange:y=>c(p=>({...p,cockSizeInches:y.target.value})),style:X(),inputMode:"decimal"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Cut / Uncut"}),e.jsxs("select",{value:u.cutStatus,onChange:y=>c(p=>({...p,cutStatus:y.target.value})),style:X(),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"cut",children:"Cut"}),e.jsx("option",{value:"uncut",children:"Uncut"})]})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Weight (lbs)"}),e.jsx("input",{value:u.weightLbs,onChange:y=>c(p=>({...p,weightLbs:y.target.value})),style:X(),inputMode:"numeric"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Position"}),e.jsxs("select",{value:u.position,onChange:y=>c(p=>({...p,position:y.target.value})),style:X(),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"top",children:"Top"}),e.jsx("option",{value:"bottom",children:"Bottom"}),e.jsx("option",{value:"side",children:"Side"})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",onClick:()=>void M(),style:fe(U),disabled:U,children:"SAVE PROFILE"}),e.jsx("button",{type:"button",onClick:()=>void b(),style:D(I),disabled:I,children:"REFRESH"})]})]})}),e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"MEDIA"}),e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"Main profile photo, gallery photo, and video uploads."}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Main Photo"}),e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:y=>{var p;return j(((p=y.target.files)==null?void 0:p[0])??null)}})]}),e.jsx("button",{type:"button",style:fe(U),disabled:U,onClick:()=>void K("photo_main",g),children:"UPLOAD MAIN PHOTO"})]}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Gallery Photo"}),e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:y=>{var p;return R(((p=y.target.files)==null?void 0:p[0])??null)}})]}),e.jsx("button",{type:"button",style:fe(U),disabled:U,onClick:()=>void K("photo_gallery",O),children:"UPLOAD GALLERY PHOTO"})]}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Video"}),e.jsx("input",{className:"rd-input",type:"file",accept:"video/*",onChange:y=>{var p;return ae(((p=y.target.files)==null?void 0:p[0])??null)}})]}),e.jsx("button",{type:"button",style:fe(U),disabled:U,onClick:()=>void K("video",ee),children:"UPLOAD VIDEO"})]}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13},children:["Main photo media id: ",(v==null?void 0:v.mainPhotoMediaId)??"-",e.jsx("br",{}),"Gallery count: ",((ce=v==null?void 0:v.galleryMediaIds)==null?void 0:ce.length)??0,e.jsx("br",{}),"Video media id: ",(v==null?void 0:v.videoMediaId)??"-"]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"YOUR GALLERY"}),(me=v==null?void 0:v.galleryMediaIds)!=null&&me.length?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(130px, 1fr))",gap:10},children:v.galleryMediaIds.map(y=>e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.45)",borderRadius:10,padding:8,display:"grid",gap:8},children:[e.jsx("img",{src:C[y]??He(y),alt:"Gallery photo",style:{width:"100%",aspectRatio:"1/1",objectFit:"cover",borderRadius:8,border:"1px solid rgba(255,58,77,0.4)"}}),e.jsx("button",{type:"button",style:D(U),disabled:U,onClick:()=>void ge(y),children:"SET MAIN"}),e.jsx("button",{type:"button",style:D(U),disabled:U,onClick:()=>void he(y),children:"REMOVE"})]},y))}):e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No gallery photos uploaded yet."})]})]})})]})}function Kn({api:t,session:n,setLastError:a,onLogout:u}){const[c,v]=s.useState({discreetMode:!1,travelEnabled:!1,travelLat:"",travelLng:""}),[S,I]=s.useState("Loading settings..."),[A,U]=s.useState(!1),[_,H]=s.useState([]);async function T(){var g,j,O;try{const R=await t.getMyProfile(n.sessionToken);if(v({discreetMode:R.profile.discreetMode===!0,travelEnabled:((g=R.profile.travelMode)==null?void 0:g.enabled)===!0,travelLat:typeof((j=R.profile.travelMode)==null?void 0:j.lat)=="number"?String(R.profile.travelMode.lat):"",travelLng:typeof((O=R.profile.travelMode)==null?void 0:O.lng)=="number"?String(R.profile.travelMode.lng):""}),I("Settings loaded."),n.userType!=="guest")try{const ee=await t.listBlocked(n.sessionToken);H(ee.blocked)}catch{H([])}else H([])}catch(R){I(V(R))}}async function C(){try{const g=await fetch("/api/config"),j=await g.json();if(!g.ok)throw j;U(j.mediaStorageConfigured===!0)}catch{U(!1)}}s.useEffect(()=>{T(),C()},[n.sessionToken,n.userType]);async function o(){try{const g=await t.getMyProfile(n.sessionToken),j=c.travelLat.trim()?Number(c.travelLat):void 0,O=c.travelLng.trim()?Number(c.travelLng):void 0;await t.upsertMyProfile(n.sessionToken,{displayName:g.profile.displayName,age:g.profile.age,bio:g.profile.bio,stats:g.profile.stats,discreetMode:c.discreetMode,travelMode:{enabled:c.travelEnabled,lat:Number.isFinite(j)?j:void 0,lng:Number.isFinite(O)?O:void 0}}),I("Privacy settings saved.")}catch(g){const j=V(g);I(j),a(j)}}async function b(){if(!navigator.geolocation){const g="Geolocation is unavailable on this device.";I(g),a(g);return}try{const g=await new Promise((R,ee)=>{navigator.geolocation.getCurrentPosition(R,ee,{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})}),j=Number(g.coords.latitude.toFixed(6)),O=Number(g.coords.longitude.toFixed(6));v(R=>({...R,travelEnabled:!0,travelLat:String(j),travelLng:String(O)}));try{localStorage.setItem("reddoor_travel_center",JSON.stringify({enabled:!0,lat:j,lng:O}))}catch{}try{await t.updatePresence(n.sessionToken,j,O,"online")}catch{}window.dispatchEvent(new CustomEvent("rd:location-updated",{detail:{lat:j,lng:O}})),I("Actual location detected. Save privacy settings to persist it.")}catch(g){const j=V(g);I(j),a(j)}}async function M(){try{const g=c.travelLat.trim()?Number(c.travelLat):void 0,j=c.travelLng.trim()?Number(c.travelLng):void 0,O=await t.seedFakeUsers(12,Number.isFinite(g)?g:void 0,Number.isFinite(j)?j:void 0);I(`Seeded ${O.seededCount} fake users for testing.`)}catch(g){const j=V(g);I(j),a(j)}}async function K(g){try{await t.unblock(n.sessionToken,g);const j=await t.listBlocked(n.sessionToken);H(j.blocked),I("Blocked users updated.")}catch(j){const O=V(j);I(O),a(O)}}return e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"SETTINGS"}),e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:S}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:c.discreetMode,onChange:g=>v(j=>({...j,discreetMode:g.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Discreet Mode (hide your profile)"})]}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:c.travelEnabled,onChange:g=>v(j=>({...j,travelEnabled:g.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Travel Mode"})]}),c.travelEnabled?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("input",{value:c.travelLat,onChange:g=>v(j=>({...j,travelLat:g.target.value})),style:X(),placeholder:"Travel lat"}),e.jsx("input",{value:c.travelLng,onChange:g=>v(j=>({...j,travelLng:g.target.value})),style:X(),placeholder:"Travel lng"})]}):null,e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:fe(!1),onClick:()=>void o(),children:"SAVE PRIVACY"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void b(),children:"DETECT ACTUAL LOCATION"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void M(),children:"SEED FAKE USERS"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>u==null?void 0:u(),children:"LOGOUT"})]})]})}),e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"MEDIA STORAGE"}),e.jsx("div",{style:{color:A?"#26d5ff":"#ff8a95",fontSize:14},children:A?"Configured: uploads enabled.":"Not configured: set S3_BUCKET, S3_REGION, S3_ACCESS_KEY_ID, S3_SECRET_ACCESS_KEY."}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void C(),children:"REFRESH STORAGE STATUS"})]})}),n.userType!=="guest"?e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"BLOCKED USERS"}),_.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No blocked users."}):_.map(g=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[e.jsx("div",{style:{color:"#ced3dc",fontSize:14},children:g}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void K(g),children:"UNBLOCK"})]},g))]})}):null]})}function Dn({api:t,session:n,setSession:a,settings:u,activeTab:c,setActiveTab:v,discoverScreen:S,onDiscoverScreenChange:I,discoverFilter:A,busy:U,setBusy:_,setLastError:H,onUnreadCountChange:T,hideModeCard:C,onLogout:o}){const b=Mn(),[M,K]=s.useState(null),g=e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx(Ln,{api:t,session:n,setLastError:H}),e.jsx(Kn,{api:t,session:n,setLastError:H,onLogout:o})]});return e.jsxs("div",{style:{display:"grid",gap:12},children:[null,c==="discover"?e.jsx(An,{api:t,session:n,settings:u,discoverFilter:A,busy:U,setBusy:_,setLastError:H,isMobile:b,discoverScreen:S,onDiscoverScreenChange:I,onOpenThreadRequested:j=>{K({key:Te(j),nonce:Date.now()}),v("threads")},onUnreadCountChange:T}):null,c==="threads"?e.jsx(Pn,{api:t,session:n,setLastError:H,openThreadRequest:M,onThreadRequestConsumed:()=>K(null),isMobile:b}):null,c==="public"?e.jsx(En,{api:t,session:n,isMobile:b,setLastError:H}):null,c==="profile"||c==="settings"?g:null,c==="submissions"?e.jsx(Fn,{api:t,session:n,setLastError:H}):null,c==="promoted"?e.jsx(zn,{api:t,session:n,setLastError:H}):null]})}export{Dn as Router};
