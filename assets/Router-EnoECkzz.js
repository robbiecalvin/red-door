const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./maplibre-gl-BqoVe-IS.js","./index-BQvD5UPx.js","./index-D_xfmmRC.css"])))=>i.map(i=>d[i]);
import{r as s,j as e,_ as yn,p as Yt,a as Jt,b as Qt,u as bt}from"./index-BQvD5UPx.js";function qt(t){return typeof t=="object"&&t!==null}function pn(t){return!(!qt(t)||typeof t.key!="string"||t.userType!=="guest"&&t.userType!=="registered"&&t.userType!=="subscriber"||typeof t.lat!="number"||!Number.isFinite(t.lat)||typeof t.lng!="number"||!Number.isFinite(t.lng)||typeof t.updatedAtMs!="number"||!Number.isFinite(t.updatedAtMs)||t.status!==void 0&&typeof t.status!="string")}function Xt(t){const[n,a]=s.useState(()=>new Map),[f,l]=s.useState(null),b=s.useRef(null),S=s.useRef(null);return s.useEffect(()=>{if(t.disabled===!0||t.wsUrl.trim()===""){a(new Map),l(null),S.current!==null&&(window.clearTimeout(S.current),S.current=null);return}let N=!1,F=0,D=null;const B=()=>{D!==null&&(window.clearInterval(D),D=null)},E=()=>{if(N)return;const o=Math.min(8e3,500*2**Math.min(F,4));S.current=window.setTimeout(()=>{S.current=null,M()},o)},M=()=>{if(N)return;let o;try{o=new WebSocket(t.wsUrl)}catch{F+=1,l("Realtime unavailable in this mode."),E();return}b.current=o;let v=!1;o.onopen=()=>{v=!0,F=0,l(null);const T={};t.sessionToken&&(T.sessionToken=t.sessionToken),t.jwt&&(T.jwt=t.jwt),o.send(JSON.stringify({type:"auth",payload:T})),D=window.setInterval(()=>{o.readyState===o.OPEN&&o.send(JSON.stringify({type:"heartbeat",payload:{}}))},15e3)},o.onmessage=T=>{const K=(()=>{try{return JSON.parse(String(T.data))}catch{return null}})();if(!K||typeof K.type!="string"){l("Invalid server message.");return}if(K.type==="error"&&qt(K.payload)&&typeof K.payload.message=="string"){l(K.payload.message);return}if(K.type==="presence_update"){const g=K.payload;if(!pn(g)){l("Invalid presence payload.");return}a(j=>{const L=new Map(j);return L.set(g.key,g),L})}},o.onerror=()=>{},o.onclose=T=>{if(B(),!N&&T.code!==1e3){F+=1;const K=typeof T.reason=="string"&&T.reason.trim()!==""?` Reason: ${T.reason}`:"";(F>=2||v)&&l(`Realtime ${v?"disconnected":"failed to connect"} (code ${T.code}). Reconnecting...${K}`),E()}}};return M(),()=>{var o;N=!0,B(),S.current!==null&&(window.clearTimeout(S.current),S.current=null),(o=b.current)==null||o.close(1e3,"Client cleanup"),b.current=null}},[t.disabled,t.jwt,t.sessionToken,t.wsUrl]),{state:s.useMemo(()=>({byKey:n}),[n]),lastErrorMessage:f}}async function hn(){const t=await yn(()=>import("./maplibre-gl-BqoVe-IS.js").then(a=>a.m),__vite__mapDeps([0,1,2]),import.meta.url);return t.default??t}function mn(t){return t.replace(/[&<>"']/g,n=>{switch(n){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return n}})}function bn(){return{version:8,sources:{basemap:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png","https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"Â© OpenStreetMap contributors"}},layers:[{id:"basemap",type:"raster",source:"basemap"}]}}function vn(t){const n=document.createElement("button");return n.type="button",n.setAttribute("aria-label",t.label??"Presence marker"),n.style.width="40px",n.style.height="40px",n.style.borderRadius="999px",n.style.border=`2px solid ${t.color}`,n.style.touchAction="manipulation",n.style.userSelect="none",t.markerType==="spot"?(n.style.background="radial-gradient(circle at 30% 30%, #ff4f60, #a70013)",n.style.display="grid",n.style.placeItems="center",n.style.color="#ffffff",n.style.fontWeight="700",n.style.fontSize="13px",n.textContent=typeof t.markerGlyph=="string"&&t.markerGlyph.trim()?t.markerGlyph.trim().slice(0,2):"SP"):typeof t.imageUrl=="string"&&t.imageUrl.trim()!==""?(n.style.backgroundImage=`url("${t.imageUrl}")`,n.style.backgroundSize="cover",n.style.backgroundPosition="center"):n.style.background="#000000",n.style.padding="0",n.style.cursor=typeof t.onClick=="function"?"pointer":"default",n.style.pointerEvents="auto",n}function xn({initialView:t,markers:n,interactive:a,visible:f}){const l=s.useRef(null),b=s.useRef(null),S=s.useRef(null),k=s.useRef([]),[N,F]=s.useState({kind:"ready"}),D=s.useMemo(()=>t.center,[t.center]),B=a!==!1,E=f!==!1;return s.useEffect(()=>{let M=!1,o=null,v=null,T=null;async function K(){if(l.current&&!S.current)try{b.current||(b.current=await hn());const g=b.current,j=new g.Map({container:l.current,style:bn(),center:[D.lng,D.lat],zoom:t.zoom,interactive:B});j.addControl(new g.NavigationControl({showCompass:!1}),"top-right"),S.current=j;const L=()=>{j.resize()};v=L,T=window.requestAnimationFrame(L),window.addEventListener("resize",L),o=new ResizeObserver(()=>L()),o.observe(l.current),j.on("error",A=>{var ae;const Z=((ae=A.error)==null?void 0:ae.message)??"Map error.";M||Z.toLowerCase().includes("failed to fetch")||Z.toLowerCase().includes("network")||F({kind:"error",message:Z})}),j.once("load",()=>{M||F({kind:"ready"})})}catch(g){if(M)return;F({kind:"error",message:g instanceof Error?g.message:"Map error."})}}return K(),()=>{var g;M=!0,T!==null&&window.cancelAnimationFrame(T),v&&window.removeEventListener("resize",v),o==null||o.disconnect();for(const j of k.current)j.remove();k.current=[],(g=S.current)==null||g.remove(),S.current=null}},[B]),s.useEffect(()=>{const M=S.current;if(!M||!E)return;M.resize();const o=window.setTimeout(()=>{M.resize(),M.setCenter([t.center.lng,t.center.lat]),M.setZoom(t.zoom)},80);return()=>window.clearTimeout(o)},[t.center.lat,t.center.lng,t.zoom,E]),s.useEffect(()=>{const M=S.current;if(!M||!E)return;M.resize();const o=window.setTimeout(()=>M.resize(),120);return()=>window.clearTimeout(o)},[E]),s.useEffect(()=>{const M=S.current,o=b.current;if(!(!M||!o)){for(const v of k.current)v.remove();k.current=[];for(const v of n){const T=typeof v.label=="string"&&v.label.trim()!==""?new o.Popup({closeButton:!1,closeOnClick:!0}).setHTML(`<div style="font-family: var(--ui); font-size: 12px; line-height: 1.35;">
                 <div style="font-weight: 600;">${mn(v.label)}</div>
               </div>`):void 0,K=vn(v);if(typeof v.onClick=="function"){const j=L=>{var A;L.preventDefault(),L.stopPropagation(),(A=v.onClick)==null||A.call(v)};K.addEventListener("click",j),K.addEventListener("touchend",j,{passive:!1}),K.addEventListener("pointerup",j)}const g=new o.Marker({element:K}).setLngLat([v.position.lng,v.position.lat]);T&&g.setPopup(T),g.addTo(M),k.current.push(g)}}},[n]),N.kind==="error"?e.jsxs("div",{style:{background:"#000000",color:"#F22F2F",border:"2px solid #C00000",borderRadius:8,padding:12,fontFamily:"var(--ui)",fontSize:14,lineHeight:1.4},role:"alert","aria-live":"polite",children:["Map error: ",N.message]}):e.jsx("div",{ref:l,className:"rd-maplibre",style:{width:"100%",height:"100%",background:"#000000",borderRadius:8,overflow:"hidden"},"aria-label":"Cruise map"})}const Dt=[Yt,Jt,Qt];function jn(t){let n=0;for(let a=0;a<t.length;a+=1)n=n*31+t.charCodeAt(a)|0;return Math.abs(n)}function wn(t){return Dt[jn(t)%Dt.length]}function Sn(t,n,a){return t.map(f=>({id:f.key,position:{lat:f.lat,lng:f.lng},color:"#C00000",label:f.status?`Presence: ${f.status}`:"Presence",imageUrl:(n==null?void 0:n[f.key])??wn(f.key),onClick:a?()=>a(f.key):void 0}))}function Bt({wsUrl:t,sessionToken:n,jwt:a,defaultCenter:f,defaultZoom:l,presenceUpdates:b,realtimeErrorMessage:S,onMarkerSelect:k,avatarByKey:N,additionalMarkers:F,height:D,visible:B}){const E=Xt({wsUrl:t,sessionToken:n,jwt:a,disabled:Array.isArray(b)}),M=b?{byKey:new Map(b.map(A=>[A.key,A]))}:E.state,o=S??E.lastErrorMessage,[v,T]=s.useState({kind:"pending"});s.useEffect(()=>{if(!("geolocation"in navigator)||!navigator.geolocation){T({kind:"unavailable"});return}navigator.geolocation.getCurrentPosition(A=>{T({kind:"granted",center:{lat:A.coords.latitude,lng:A.coords.longitude}})},A=>{if(A.code===A.PERMISSION_DENIED){T({kind:"denied"});return}if(A.code===A.TIMEOUT){T({kind:"error",message:"Timed out while trying to read your location. Showing the default map view."});return}T({kind:"error",message:A.message||"Geolocation error."})},{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e4})},[]);const K=s.useMemo(()=>Array.from(M.byKey.values()),[M.byKey]),g=s.useMemo(()=>[...Sn(K,N,k),...F??[]],[F,N,k,K]),j=s.useMemo(()=>{const A=typeof l=="number"&&Number.isFinite(l)?l:13;return v.kind==="granted"?{center:v.center,zoom:A}:{center:f,zoom:A}},[f,l,v]),L=s.useMemo(()=>v.kind==="denied"?"Location permission denied. Showing the default map view.":v.kind==="unavailable"?"Geolocation is unavailable. Showing the default map view.":v.kind==="error"?`Geolocation error: ${v.message}`:null,[v]);return e.jsxs("section",{"aria-label":"Cruise mode map",style:{background:"#000000",color:"#FFFFFF",fontFamily:"var(--ui)",display:"grid",gap:8,height:"100%"},children:[L?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"rgba(0,0,0,0.7)",border:"1px solid rgba(255,58,77,0.45)",borderRadius:0,padding:8,color:"#AAAAAA",fontSize:12,lineHeight:1.4},children:L}):null,o?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"rgba(0,0,0,0.7)",border:"1px solid rgba(255,58,77,0.45)",borderRadius:0,padding:8,color:"#F22F2F",fontSize:12,lineHeight:1.4},children:o}):null,e.jsx("div",{style:{background:"#111111",border:0,borderRadius:0,overflow:"hidden",height:typeof D=="number"||typeof D=="string"?D:520},children:e.jsx(xn,{initialView:j,markers:g,visible:B})})]})}const kn="FIRE_SIGNAL|1";function In(t){return new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function $t(t){if(!t.startsWith("LOCATION|"))return null;const[,n,a]=t.split("|"),f=Number(n),l=Number(a);return!Number.isFinite(f)||!Number.isFinite(l)?null:{lat:f,lng:l,link:`https://maps.google.com/?q=${f},${l}`}}function Cn(t){return t.trim()===kn?"ðŸ”¥ I'm into you":t}function Zt({chatKind:t,peerKey:n,currentUserKey:a,messages:f,client:l,title:b,peerSummary:S,thirdParty:k,edgeToEdge:N,showHeader:F,fillHeight:D}){const[B,E]=s.useState(""),[M,o]=s.useState(null),[v,T]=s.useState(!1),[K,g]=s.useState({}),[j,L]=s.useState(!1),[A,Z]=s.useState(!1),ae=s.useRef(null),pe=s.useRef([]),ye=s.useRef(null),ue=s.useRef(null),he=s.useRef(null),y=N===!0,p=F!==!1,R=y&&D===!0,te=s.useMemo(()=>[...f].sort((c,W)=>c.createdAtMs-W.createdAtMs),[f]),z=s.useMemo(()=>Array.from(new Set(te.map(c=>{var W;return(W=c.media)==null?void 0:W.objectKey}).filter(c=>typeof c=="string"&&c.trim().length>0))),[te]);s.useEffect(()=>{let c=!1;async function W(){for(const r of z){if(c)return;if(!K[r])try{const m=await l.getMediaUrl(r);if(c)return;g(U=>({...U,[r]:m}))}catch{}}}return W(),()=>{c=!0}},[l,z,K]);async function ee(c){const W=B.trim();if(!(W.length===0&&!c)){T(!0),o(null);try{await l.sendMessage(t,n,W,c),E("")}catch(r){const m=r;o(typeof(m==null?void 0:m.message)=="string"?m.message:"Message rejected.")}finally{T(!1)}}}async function I(c){T(!0),o(null);try{const W=await l.initiateMediaUpload(c.type||"application/octet-stream",c.size);await l.uploadToSignedUrl(W.uploadUrl,c,c.type||"application/octet-stream");const m={kind:c.type.startsWith("image/")?"image":c.type.startsWith("video/")?"video":"audio",objectKey:W.objectKey,mimeType:c.type||"application/octet-stream"};await ee(m)}catch(W){const r=W;o(typeof(r==null?void 0:r.message)=="string"?r.message:"Upload rejected."),T(!1)}}async function fe(c){var r;const W=(r=c.target.files)==null?void 0:r[0];if(c.target.value="",!!W){if(!W.type.startsWith("image/")&&!W.type.startsWith("video/")&&!W.type.startsWith("audio/")){o("Only image, video, or audio files are supported.");return}await I(W)}}async function oe(){var c;if(j){(c=ae.current)==null||c.stop();return}if(!navigator.mediaDevices||typeof navigator.mediaDevices.getUserMedia!="function"){o("Microphone is not available in this browser.");return}try{const W=await navigator.mediaDevices.getUserMedia({audio:!0}),r=new MediaRecorder(W);pe.current=[],ae.current=r,r.ondataavailable=m=>{m.data.size>0&&pe.current.push(m.data)},r.onstop=()=>{const m=new Blob(pe.current,{type:r.mimeType||"audio/webm"}),U=new File([m],`voice-${Date.now()}.webm`,{type:r.mimeType||"audio/webm"});I(U);for(const ne of W.getTracks())ne.stop();ae.current=null,L(!1)},r.start(),L(!0)}catch(W){const r=W;o(typeof(r==null?void 0:r.message)=="string"?r.message:"Unable to record voice."),L(!1)}}async function me(){if(!navigator.geolocation){o("Geolocation is not available in this browser.");return}T(!0),o(null);try{const c=await new Promise((U,ne)=>{navigator.geolocation.getCurrentPosition(U,ne,{enableHighAccuracy:!1,timeout:12e3,maximumAge:3e4})}),W=Number(c.coords.latitude.toFixed(5)),r=Number(c.coords.longitude.toFixed(5)),m=`LOCATION|${W}|${r}`;await l.sendMessage(t,n,m)}catch(c){const W=c;o(typeof(W==null?void 0:W.message)=="string"?W.message:"Unable to send location.")}finally{T(!1)}}return e.jsxs("section",{"aria-label":"Chat",style:{background:y?"transparent":"#000000",color:"#FFFFFF",fontFamily:"Montserrat, sans-serif",padding:y?0:16,display:"grid",gap:y?0:12,gridTemplateRows:p?"auto auto 1fr auto":"1fr auto",minHeight:D?"calc(100dvh - 196px)":void 0},children:[p?e.jsxs("header",{style:{height:56,display:"grid",alignItems:"center",background:"#000000"},children:[e.jsx("div",{style:{textAlign:"center",fontSize:20,fontWeight:600},children:b}),S?e.jsxs("div",{style:{marginTop:4,display:"flex",alignItems:"center",justifyContent:"center",gap:8,color:"#b7d8e0",fontSize:13},children:[e.jsx("span",{children:"Chat with:"}),S.avatarUrl?e.jsx("img",{src:S.avatarUrl,alt:`${S.displayName} avatar`,style:{width:24,height:24,borderRadius:"50%",objectFit:"cover",border:"1px solid rgba(38,213,255,0.8)"}}):e.jsx("span",{"aria-hidden":!0,style:{width:24,height:24,borderRadius:"50%",border:"1px solid rgba(38,213,255,0.8)",background:"rgba(255,255,255,0.08)"}}),e.jsx("span",{style:{color:"#fff",fontWeight:600},children:S.displayName})]}):null,e.jsx("div",{style:{textAlign:"center",fontSize:12,color:"#AAAAAA"},children:t==="cruise"?"CRUISE CHAT (EPHEMERAL)":"DATE CHAT (PERSISTENT)"})]}):null,M?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"#111111",border:"2px solid #C00000",borderRadius:8,padding:12,color:"#F22F2F",fontSize:14,lineHeight:1.4},children:M}):null,e.jsx("div",{"aria-label":"Messages",style:{background:y?"#09090b":"#111111",border:y?"none":"2px solid #C00000",borderRadius:y?0:8,padding:12,display:"flex",flexDirection:"column",gap:12,minHeight:y?0:320,paddingBottom:R?148:12,overflowY:"auto"},children:te.length===0?e.jsx("div",{style:{color:"#AAAAAA",fontSize:14,lineHeight:1.4},children:"No messages."}):te.map(c=>{const W=c.fromKey===a,r=W?"#C00000":"#444444",m=W?{alignItems:"flex-end"}:{alignItems:"flex-start"};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,width:"100%",...m},children:[(()=>{const U=$t(c.text??"");return U?e.jsxs("a",{href:U.link,target:"_blank",rel:"noreferrer",style:{display:"grid",gap:6,textDecoration:"none",color:"#fff",background:r,borderRadius:14,padding:8,width:"auto",maxWidth:"80%"},children:[e.jsx("div",{style:{fontSize:12,color:"#d8ecff"},children:"Shared location"}),e.jsx("iframe",{title:"Google Maps location preview",src:`https://www.google.com/maps?q=${U.lat},${U.lng}&z=14&output=embed`,style:{width:"100%",height:140,border:"1px solid rgba(255,255,255,0.18)",borderRadius:10},loading:"lazy",referrerPolicy:"no-referrer-when-downgrade"}),e.jsx("div",{style:{fontSize:12,color:"#3fdfff"},children:"Open in Google Maps"})]}):null})(),e.jsxs("div",{style:{background:r,color:"#FFFFFF",borderRadius:18,padding:"8px 12px",width:"auto",maxWidth:"80%",fontSize:16,lineHeight:1.4,whiteSpace:"pre-wrap",overflowWrap:"anywhere",wordBreak:"break-word"},children:[c.text&&!$t(c.text)?e.jsx("div",{style:{marginBottom:c.media?8:0},children:Cn(c.text)}):null,c.media?e.jsxs("div",{children:[c.media.kind==="image"?e.jsx("img",{src:K[c.media.objectKey],alt:"Shared",style:{width:"100%",maxWidth:260,borderRadius:10,border:"1px solid rgba(255,255,255,0.18)"}}):null,c.media.kind==="video"?e.jsx("video",{controls:!0,playsInline:!0,src:K[c.media.objectKey],style:{width:"100%",maxWidth:320,borderRadius:10,background:"#000"}}):null,c.media.kind==="audio"?e.jsx("audio",{controls:!0,src:K[c.media.objectKey],style:{width:"100%",maxWidth:260}}):null]}):null]}),e.jsx("div",{style:{fontSize:10,color:"#AAAAAA"},children:In(c.createdAtMs)}),W?e.jsx("div",{style:{fontSize:10,color:"#6fdcff"},children:typeof c.readAtMs=="number"?"Read":typeof c.deliveredAtMs=="number"?"Delivered":""}):null]},c.messageId)})}),e.jsxs("form",{onSubmit:c=>{c.preventDefault(),ee()},"aria-label":"Message input",style:{background:y?"linear-gradient(180deg, rgba(96,0,12,0.96), rgba(58,0,8,0.98))":"#111111",border:y?"none":"2px solid #C00000",borderRadius:y?0:8,padding:12,display:"grid",gridTemplateColumns:"1fr auto auto",gap:12,alignItems:"start",position:R?"fixed":"static",left:R?0:void 0,right:R?0:void 0,bottom:R?"calc(env(safe-area-inset-bottom, 0px) + 66px)":void 0,zIndex:R?45:void 0},children:[e.jsx("label",{style:{display:"grid"},children:e.jsx("input",{value:B,onChange:c=>E(c.target.value),placeholder:"Type a message",disabled:v,style:{width:"100%",background:"#111111",color:"#FFFFFF",border:"2px solid #444444",borderRadius:8,padding:"10px 12px",fontSize:16,lineHeight:1.4,outline:"none"},"aria-label":"Message text"})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{ref:ye,type:"file",accept:"image/*,video/*,audio/*",disabled:v,onChange:c=>void fe(c),style:{display:"none"}}),e.jsx("input",{ref:ue,type:"file",accept:"image/*",capture:"environment",disabled:v,onChange:c=>void fe(c),style:{display:"none"}}),e.jsx("input",{ref:he,type:"file",accept:"video/*",capture:"environment",disabled:v,onChange:c=>void fe(c),style:{display:"none"}}),e.jsx("button",{type:"button",disabled:v,onClick:()=>Z(c=>!c),style:{background:"rgba(0,0,0,0.45)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px",display:"grid",placeItems:"center",cursor:v?"not-allowed":"pointer",color:"#3fdfff",fontWeight:700,height:44,minWidth:44},"aria-label":"More actions",children:"+"}),A?e.jsxs("div",{style:{position:"absolute",right:0,top:R?void 0:48,bottom:R?48:void 0,zIndex:5,minWidth:220,display:"grid",gap:8,padding:10,borderRadius:10,border:"1px solid rgba(255,58,77,0.5)",background:"rgba(10,11,16,0.98)"},children:[e.jsx("button",{type:"button",disabled:v,onClick:()=>{var c;Z(!1),(c=ue.current)==null||c.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Take Photo"}),e.jsx("button",{type:"button",disabled:v,onClick:()=>{var c;Z(!1),(c=he.current)==null||c.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Record Video"}),e.jsx("button",{type:"button",disabled:v,onClick:()=>{var c;Z(!1),(c=ye.current)==null||c.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Choose Media"}),e.jsx("button",{type:"button",disabled:v,onClick:()=>{Z(!1),oe()},style:{background:j?"#ff2136":"rgba(0,0,0,0.6)",color:"#fff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:j?"Stop Voice":"Record Voice"}),e.jsx("button",{type:"button",disabled:v,onClick:()=>{Z(!1),me()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Send Location"}),k?e.jsxs("div",{style:{display:"grid",gap:8,borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:8},children:[e.jsxs("select",{value:k.selectedKey,onChange:c=>k.onSelect(c.target.value),disabled:k.disabled||k.candidates.length===0,style:{background:"#0b0d12",color:"#fff",border:"1px solid rgba(255,58,77,0.62)",borderRadius:10,padding:"8px 10px"},"aria-label":"Add previous contact to group",children:[k.candidates.length===0?e.jsx("option",{value:"",children:"No previous contacts"}):null,k.candidates.map(c=>e.jsx("option",{value:c.key,children:c.label},c.key))]}),e.jsx("button",{type:"button",onClick:()=>{k.onAdd(),Z(!1)},disabled:k.disabled||k.candidates.length===0||!k.selectedKey,style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,58,77,0.62)",borderRadius:10,padding:"8px 10px",fontWeight:700},children:"Add Third User"})]}):null]}):null]}),e.jsx("button",{type:"submit",disabled:v,style:{background:v?"#333333":"#C00000",color:v?"#777777":"#FFFFFF",border:"2px solid #C00000",borderRadius:8,padding:"10px 20px",fontSize:16,fontWeight:600,cursor:v?"not-allowed":"pointer",height:44},"aria-label":"Send message",children:"SEND"})]})]})}const vt="FIRE_SIGNAL|1";function Ee(){return{background:"radial-gradient(500px 220px at 10% 0%, rgba(255,28,46,0.15), transparent 58%), linear-gradient(180deg, rgba(8,8,10,0.88), rgba(4,4,5,0.9))",border:"1px solid rgba(255,56,74,0.56)",borderRadius:20,padding:14,boxShadow:"inset 0 1px 0 rgba(255,255,255,0.06), inset 0 0 0 1px rgba(0,0,0,0.28), 0 16px 32px rgba(0,0,0,0.42)"}}function ve(t){return{background:t?"rgba(90,90,90,0.55)":"linear-gradient(180deg, #ff2136, #c60012)",border:"1px solid rgba(255,70,90,0.68)",color:t?"#999999":"#FFFFFF",padding:"10px 18px",borderRadius:12,fontSize:15,fontWeight:700,letterSpacing:"0.04em",cursor:t?"not-allowed":"pointer",textTransform:"uppercase",boxShadow:t?"none":"inset 0 1px 0 rgba(255,255,255,0.2), 0 10px 22px rgba(198,0,18,0.34)"}}function H(t){return{background:"rgba(0,0,0,0.58)",border:"1px solid rgba(255,58,77,0.62)",color:"#3fdfff",padding:"10px 18px",borderRadius:12,fontSize:15,fontWeight:700,letterSpacing:"0.03em",cursor:t?"not-allowed":"pointer",textTransform:"uppercase",opacity:t?.6:1}}function X(){return{background:"rgba(6,7,10,0.92)",color:"#ffffff",border:"1px solid rgba(255,64,82,0.48)",borderRadius:12,padding:"10px 12px",fontSize:15}}function Tn(t){return typeof t=="string"}function Y(t){const n=t;return Tn(n==null?void 0:n.message)?n.message:"Action rejected."}function gt(){const t="__disabled__".trim();if(t==="__disabled__")return"";if(t!==""){if(t.startsWith("ws://")||t.startsWith("wss://"))return t;try{const a=new URL(t);return a.protocol=a.protocol==="https:"?"wss:":"ws:",a.toString()}catch{if(t.startsWith("/")){const a=new URL(t,window.location.origin);return a.protocol=a.protocol==="https:"?"wss:":"ws:",a.toString()}}}const n=new URL("/ws",window.location.origin);return n.protocol=n.protocol==="https:"?"wss:":"ws:",n.toString()}const _t=[Yt,Jt,Qt];function Mn(t){let n=0;for(let a=0;a<t.length;a+=1)n=n*31+t.charCodeAt(a)|0;return Math.abs(n)}function $e(t){return _t[Mn(t)%_t.length]}function mt(t){if(t.startsWith("user:")){const n=t.slice(5).trim();return n.length>0?n:null}if(t.startsWith("session:")){const n=t.slice(8).trim();return n.length>0?`guest:${n}`:null}return null}function Oe(t){if(t.startsWith("guest:")){const n=t.slice(6).trim();return n?`session:${n}`:`user:${t}`}return`user:${t}`}function Ce(t){const n=t.trim();if(!n)return n;if(n.startsWith("user:guest:")){const a=n.slice(11).trim();return a?`session:${a}`:n}if(n.startsWith("guest:")){const a=n.slice(6).trim();return a?`session:${a}`:n}return n}function An(t){return t.trim()===vt}function en(t){return An(t)?"ðŸ”¥ I'm into you":t}function yt(t,n){const a=D=>D*Math.PI/180,l=a(n.lat-t.lat),b=a(n.lng-t.lng),S=Math.sin(l/2),k=Math.sin(b/2),N=S*S+Math.cos(a(t.lat))*Math.cos(a(n.lat))*k*k;return 6371e3*(2*Math.atan2(Math.sqrt(N),Math.sqrt(1-N)))}function Nn(t){return!Number.isFinite(t)||t<0?"-":t<1e3?`${Math.round(t)} m`:t<1e4?`${(t/1e3).toFixed(1)} km`:`${Math.round(t/1e3)} km`}function Ht(){try{const t=localStorage.getItem("reddoor_travel_center");if(!t)return null;const n=JSON.parse(t);return n.enabled!==!0?null:typeof n.lat=="number"&&Number.isFinite(n.lat)&&typeof n.lng=="number"&&Number.isFinite(n.lng)?{lat:n.lat,lng:n.lng}:null}catch{return null}}function Rn(){const[t,n]=s.useState(()=>window.matchMedia("(max-width: 900px)").matches);return s.useEffect(()=>{const a=window.matchMedia("(max-width: 900px)"),f=()=>n(a.matches);return f(),a.addEventListener("change",f),()=>a.removeEventListener("change",f)},[]),t}function nt(t){return t==="instant"?"cruise":"date"}function Pn({api:t,session:n,settings:a,discoverFilter:f,busy:l,setBusy:b,setLastError:S,isMobile:k,discoverScreen:N,onDiscoverScreenChange:F,onOpenThreadRequested:D,onUnreadCountChange:B}){var it,We,He,Ze,Je,et;const[E,M]=s.useState(N),[o,v]=s.useState(null),[T,K]=s.useState(null),[g,j]=s.useState(null),[L,A]=s.useState([]),[Z,ae]=s.useState({}),[pe,ye]=s.useState([]),[ue,he]=s.useState(new Set),[y,p]=s.useState(new Set),[R,te]=s.useState({}),[z,ee]=s.useState({}),[I,fe]=s.useState(null),[oe,me]=s.useState(0),[c,W]=s.useState(!1),[r,m]=s.useState([]),[U,ne]=s.useState(null),[de,we]=s.useState(()=>Ht()),{state:ke,lastErrorMessage:ce}=Xt({wsUrl:gt(),sessionToken:n.sessionToken}),xe=s.useMemo(()=>Array.from(ke.byKey.values()),[ke.byKey]);s.useEffect(()=>{M(N)},[N]),s.useEffect(()=>{const u=()=>{we(Ht())},h=w=>{(w.key===null||w.key==="reddoor_travel_center")&&u()};return u(),window.addEventListener("rd:location-updated",u),window.addEventListener("storage",h),()=>{window.removeEventListener("rd:location-updated",u),window.removeEventListener("storage",h)}},[]);const G=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,be=s.useMemo(()=>{const u=new Map;for(const h of L)u.set(h.key,h);for(const h of xe){const w=u.get(h.key);(!w||h.updatedAtMs>=w.updatedAtMs)&&u.set(h.key,h)}return Array.from(u.values())},[xe,L]),Re=s.useMemo(()=>be.filter(u=>u.key!==G),[G,be]),Se=s.useMemo(()=>g?[...Re].sort((u,h)=>yt(g,{lat:u.lat,lng:u.lng})-yt(g,{lat:h.lat,lng:h.lng})):Re,[Re,g]),De=s.useMemo(()=>{if(!T)return null;if(T===G)return"0 m";if(!g)return null;const u=be.find(h=>h.key===T);return u?Nn(yt(g,{lat:u.lat,lng:u.lng})):null},[G,be,T,g]);s.useEffect(()=>{let u=!1;async function h(){try{const $=await t.listActivePresence(n.sessionToken);if(u)return;const Q=Array.isArray($.presence)?$.presence:[];A(Q)}catch{u||A([])}}h();const w=window.setInterval(()=>{h()},8e3);return()=>{u=!0,window.clearInterval(w)}},[t,n.sessionToken]),s.useEffect(()=>{o||Se.length>0&&v(Se[0].key)},[o,Se]),s.useEffect(()=>{const u=Se.filter(h=>!Z[h.key]).map(h=>({key:h.key,profileId:mt(h.key)})).filter(h=>typeof h.profileId=="string");u.length!==0&&Promise.all(u.map(async h=>{var w,$;try{const Q=await t.getPublicProfile(h.profileId);return{key:h.key,displayName:(w=Q.profile)==null?void 0:w.displayName,age:($=Q.profile)==null?void 0:$.age}}catch{return null}})).then(h=>{ae(w=>{const $={...w};for(const Q of h)Q&&($[Q.key]={displayName:Q.displayName,age:Q.age});return $})})},[t,Z,Se]),s.useEffect(()=>{(async()=>{try{let u=await t.getPublicProfiles();if(u.profiles.length===0&&!c){W(!0);try{const h=g??de??{lat:a.defaultCenterLat,lng:a.defaultCenterLng};await t.seedFakeUsers(12,h.lat,h.lng),u=await t.getPublicProfiles()}catch{}}ye(u.profiles)}catch{ye([])}if(n.userType==="guest"){he(new Set),p(new Set);return}try{const u=await t.getFavorites(n.sessionToken);he(new Set(u.favorites))}catch{he(new Set)}try{const u=await t.listBlocked(n.sessionToken);p(new Set(u.blocked))}catch{p(new Set)}})()},[t,c,g,n.sessionToken,n.userType,a.defaultCenterLat,a.defaultCenterLng,de]),s.useEffect(()=>{let u=!1;async function h(){try{const $=await t.listCruisingSpots();u||m($.spots)}catch{u||m([])}}h();const w=window.setInterval(()=>{h()},12e3);return()=>{u=!0,window.clearInterval(w)}},[t]),s.useEffect(()=>{const u=Date.now(),h=pe.flatMap(w=>{const $=[];return w.mainPhotoMediaId&&$.push(w.mainPhotoMediaId),Array.isArray(w.galleryMediaIds)&&$.push(...w.galleryMediaIds),w.videoMediaId&&$.push(w.videoMediaId),$}).filter(w=>typeof w=="string"&&w.length>0&&!R[w]&&u>=(z[w]??0)).slice(0,6);h.length!==0&&Promise.all(h.map(async w=>{try{const $=await t.getPublicMediaUrl(w);return{mediaId:w,url:$.downloadUrl}}catch{return null}})).then(w=>{te($=>{const Q={...$};for(const se of w)se&&(Q[se.mediaId]=se.url);return Q}),ee($=>{const Q={...$};for(let se=0;se<h.length;se+=1){const ge=h[se];w[se]?Q[ge]&&delete Q[ge]:Q[ge]=Date.now()+3e4}return Q})})},[t,z,R,pe]);async function Fe(u){K(u),me(0);const h=mt(u);if(!h){fe(null);return}try{if(u===G){const w=await t.getMyProfile(n.sessionToken);typeof w.profile.mainPhotoMediaId=="string"&&w.profile.mainPhotoMediaId;const $=[w.profile.mainPhotoMediaId,...w.profile.galleryMediaIds??[],w.profile.videoMediaId].filter(Q=>typeof Q=="string"&&Q.length>0);if($.length>0){const Q=await Promise.all($.map(async se=>{try{const ge=await t.getPublicMediaUrl(se);return{mediaId:se,downloadUrl:ge.downloadUrl}}catch{return null}}));te(se=>{const ge={...se};for(const Ae of Q)Ae&&(ge[Ae.mediaId]=Ae.downloadUrl);return ge})}fe({userId:w.profile.userId,displayName:w.profile.displayName,age:w.profile.age,bio:w.profile.bio,stats:w.profile.stats,discreetMode:w.profile.discreetMode,mainPhotoMediaId:w.profile.mainPhotoMediaId,galleryMediaIds:w.profile.galleryMediaIds,videoMediaId:w.profile.videoMediaId})}else{const w=await t.getPublicProfile(h),$=[w.profile.mainPhotoMediaId,...w.profile.galleryMediaIds??[],w.profile.videoMediaId].filter(Q=>typeof Q=="string"&&Q.length>0);if($.length>0){const Q=await Promise.all($.map(async se=>{try{const ge=await t.getPublicMediaUrl(se);return{mediaId:se,downloadUrl:ge.downloadUrl}}catch{return null}}));te(se=>{const ge={...se};for(const Ae of Q)Ae&&(ge[Ae.mediaId]=Ae.downloadUrl);return ge})}fe(w.profile)}}catch(w){const $=w;if(($==null?void 0:$.code)==="PROFILE_HIDDEN"){K(null),fe(null);return}fe(null),S(Y(w))}}async function q(u){if(n.userType==="guest"){S("Guests cannot star users. Register to save favorites.");return}if(!(!n.userId||n.userId===u))try{const h=await t.toggleFavorite(n.sessionToken,u);he(new Set(h.favorites))}catch(h){S(Y(h))}}async function Te(u){const h=Ce(u);if(!(!h||h===G))try{await t.sendChat(n.sessionToken,"cruise",h,vt)}catch(w){S(Y(w))}}async function Pe(u){if(!(!u.trim()||u===G)){if(n.userType==="guest"){S("Anonymous users cannot block users.");return}try{y.has(u)?await t.unblock(n.sessionToken,u):await t.block(n.sessionToken,u);const h=await t.listBlocked(n.sessionToken);p(new Set(h.blocked))}catch(h){S(Y(h))}}}async function Ie(){const u=de??{lat:a.defaultCenterLat,lng:a.defaultCenterLng};if(!navigator.geolocation){j(u);try{await t.updatePresence(n.sessionToken,u.lat,u.lng,"online")}catch{}return}try{const h=await new Promise((w,$)=>{navigator.geolocation.getCurrentPosition(w,$,{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e4})});j({lat:h.coords.latitude,lng:h.coords.longitude}),await t.updatePresence(n.sessionToken,h.coords.latitude,h.coords.longitude,"online")}catch(h){j(u);try{await t.updatePresence(n.sessionToken,u.lat,u.lng,"online")}catch{const w=h&&typeof h=="object"&&"message"in h&&typeof h.message=="string"?h.message:null;S(w??Y(h))}}}s.useEffect(()=>{Ie();const u=window.setInterval(()=>{Ie()},3e4);return()=>window.clearInterval(u)},[n.sessionToken]),s.useEffect(()=>{const u=h=>{var se,ge;const w=h,$=(se=w.detail)==null?void 0:se.lat,Q=(ge=w.detail)==null?void 0:ge.lng;!Number.isFinite($)||!Number.isFinite(Q)||(j({lat:$,lng:Q}),t.updatePresence(n.sessionToken,$,Q,"online").catch(()=>{}))};return window.addEventListener("rd:location-updated",u),()=>window.removeEventListener("rd:location-updated",u)},[t,n.sessionToken]);const je=s.useMemo(()=>{if(be.some($=>$.key===G))return be;const h=g??de??{lat:a.defaultCenterLat,lng:a.defaultCenterLng};return[{key:G,userType:n.userType,lat:h.lat,lng:h.lng,status:"online",updatedAtMs:Date.now()},...be]},[G,be,g,n.userType,a.defaultCenterLat,a.defaultCenterLng,de]),Le=s.useMemo(()=>{const u={};for(const h of pe){if(!h.mainPhotoMediaId)continue;const w=R[h.mainPhotoMediaId];w&&(u[Oe(h.userId)]=w)}return u},[R,pe]),_e=s.useMemo(()=>r.map(u=>({id:`spot:${u.spotId}`,position:{lat:u.lat,lng:u.lng},color:"#26d5ff",markerType:"spot",markerGlyph:"CS",label:`${u.name} | check-ins: ${u.checkInCount??0} | action: ${u.actionCount??0}`,onClick:()=>ne(u.spotId)})),[r]),Ke=u=>{M(u),F(u)},st=e.jsx(Bt,{wsUrl:gt(),sessionToken:n.sessionToken,presenceUpdates:je,realtimeErrorMessage:ce,onMarkerSelect:u=>void Fe(u),avatarByKey:Le,additionalMarkers:_e,defaultCenter:de??{lat:a.defaultCenterLat,lng:a.defaultCenterLng},height:k?"calc(100vh - 340px)":"calc(100dvh - 62px)",visible:!0}),Xe=e.jsxs("div",{style:{background:"#000",marginInline:-10},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,padding:"8px 10px",borderBottom:"1px solid rgba(255,58,77,0.25)"},children:[e.jsx("button",{type:"button",style:H(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"reset"}}))},children:"GUYS"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"toggle_favorites"}}))},"aria-label":"Toggle favorites only",children:"â˜…"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"open_filters"}})),Ke("chat")},children:"FILTER"})]}),e.jsx(Bt,{wsUrl:gt(),sessionToken:n.sessionToken,presenceUpdates:je,realtimeErrorMessage:ce,onMarkerSelect:u=>void Fe(u),avatarByKey:Le,additionalMarkers:_e,defaultCenter:de??{lat:a.defaultCenterLat,lng:a.defaultCenterLng},height:"calc(100dvh - 220px)",visible:E==="map"})]}),Ye=e.jsx(Fn,{api:t,session:n,busy:l,setBusy:b,setLastError:S,onlinePeers:Se,selectedPeerKey:o,setSelectedPeerKey:v,onOpenProfile:u=>void Fe(u),isMobile:k,selfCoords:g,peerProfileByKey:Z,discoverFilter:f,publicProfiles:pe,favorites:ue,mediaUrlById:R,onUnreadCountChange:B});return e.jsxs("div",{style:!k&&E==="map"?{height:"100%"}:{display:"grid",gap:8},children:[k?e.jsx(e.Fragment,{children:E==="map"?Xe:Ye}):e.jsx("div",{style:E==="map"?{display:"grid",height:"100%",alignItems:"stretch"}:{display:"grid",gap:12,alignItems:"start"},children:E==="map"?st:Ye}),T?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:80,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:k?"stretch":"center",padding:k?0:14},role:"dialog","aria-modal":"true","aria-label":"User profile",onClick:()=>K(null),children:e.jsx("div",{onClick:u=>u.stopPropagation(),style:k?{width:"100%",height:"100dvh",overflow:"auto",background:"linear-gradient(180deg, rgba(7,8,10,0.98), rgba(2,2,4,0.98))",borderRadius:0,border:"none",padding:"calc(env(safe-area-inset-top, 0px) + 56px) 12px calc(env(safe-area-inset-bottom, 0px) + 20px)"}:{...Ee(),width:"min(680px, 100%)",maxHeight:"86vh",overflow:"auto"},children:e.jsxs("div",{style:{display:"grid",gap:14},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"106px 1fr auto",gap:12,alignItems:"center"},children:[e.jsxs("div",{style:{position:"relative",width:106,height:106},children:[e.jsx("img",{src:I!=null&&I.mainPhotoMediaId&&R[I.mainPhotoMediaId]?R[I.mainPhotoMediaId]:$e(T),alt:"Profile avatar",style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"cover",border:"2px solid #ff3047"}}),e.jsx("span",{style:{position:"absolute",right:4,bottom:4,width:14,height:14,borderRadius:"50%",background:"#26d5ff",border:"2px solid #000"}})]}),e.jsxs("div",{style:{display:"grid",gap:6},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:(I==null?void 0:I.displayName)??T}),e.jsx("div",{style:{color:"#26d5ff",fontSize:14},children:"Instant Messaging Available"})]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[I&&I.userId!==(n.userId??"")?e.jsx("button",{type:"button",style:{...H(!1),color:"#26d5ff",borderColor:"rgba(38,213,255,0.62)",minWidth:126},onClick:()=>void q(I.userId),children:ue.has(I.userId)?"â˜… STARRED":"â˜† STAR"}):null,I&&I.userId!==(n.userId??"")?e.jsx("button",{type:"button",style:{...H(!1),color:"#ffb347",borderColor:"rgba(255,179,71,0.65)",minWidth:126},onClick:()=>void Te(Oe(I.userId)),children:"ðŸ”¥ FIRE"}):null,I&&I.userId!==(n.userId??"")?e.jsx("button",{type:"button",style:{...H(!1),color:y.has(Oe(I.userId))?"#ff9aa3":"#ffd4d8",borderColor:"rgba(255,120,130,0.62)",minWidth:126},onClick:()=>void Pe(Oe(I.userId)),children:y.has(Oe(I.userId))?"UNBLOCK":"BLOCK"}):null,e.jsx("button",{type:"button",style:H(!1),onClick:()=>K(null),children:"CLOSE"})]})]}),e.jsxs("div",{style:{color:"#ced3dc",fontSize:14,lineHeight:1.5},children:[e.jsxs("div",{children:["Age: ",(I==null?void 0:I.age)??"-"]}),e.jsxs("div",{children:["Distance: ",De??"-"]}),e.jsxs("div",{children:["Race: ",((it=I==null?void 0:I.stats)==null?void 0:it.race)??"-"]}),e.jsxs("div",{children:["Height: ",((We=I==null?void 0:I.stats)==null?void 0:We.heightInches)??"-"]}),e.jsxs("div",{children:["Weight: ",((He=I==null?void 0:I.stats)==null?void 0:He.weightLbs)??"-"]}),e.jsxs("div",{children:["Cock Size: ",((Ze=I==null?void 0:I.stats)==null?void 0:Ze.cockSizeInches)??"-"]}),e.jsxs("div",{children:["Cut / Uncut: ",((Je=I==null?void 0:I.stats)==null?void 0:Je.cutStatus)??"-"]}),e.jsxs("div",{children:["Position: ",((et=I==null?void 0:I.stats)==null?void 0:et.position)??"-"]}),e.jsxs("div",{style:{marginTop:8},children:["Bio: ",(I==null?void 0:I.bio)??"-"]})]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"MEDIA"}),I?e.jsx(e.Fragment,{children:(()=>{const u=[I.mainPhotoMediaId,...I.galleryMediaIds??[],I.videoMediaId].filter(se=>typeof se=="string"&&se.length>0);if(u.length===0)return e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No uploaded media."});const h=Math.max(0,Math.min(oe,u.length-1)),w=u[h],$=R[w],Q=w===I.videoMediaId;return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.4)",borderRadius:12,padding:8},children:Q?e.jsx("video",{controls:!0,playsInline:!0,src:$,style:{width:"100%",maxHeight:260,borderRadius:10,background:"#000"}}):e.jsx("img",{src:$??$e(T??I.userId),alt:"Profile media",style:{width:"100%",maxHeight:260,objectFit:"cover",borderRadius:10}})}),e.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:u.map((se,ge)=>{const Ae=R[se],Ge=se===I.videoMediaId;return e.jsx("button",{type:"button",onClick:()=>me(ge),style:{width:64,height:64,padding:0,borderRadius:8,overflow:"hidden",border:ge===h?"2px solid #26d5ff":"1px solid rgba(255,58,77,0.4)",background:"#000",cursor:"pointer",color:"#fff",fontSize:10},"aria-label":Ge?"Open video":"Open photo",children:Ge?e.jsx("div",{style:{display:"grid",placeItems:"center",width:"100%",height:"100%"},children:Ae?e.jsx("video",{src:Ae,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}):"VIDEO"}):e.jsx("img",{src:Ae??$e(T??I.userId),alt:"Media thumbnail",style:{width:"100%",height:"100%",objectFit:"cover"}})},se)})})]})})()}):null]}),e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:e.jsx("button",{type:"button",style:ve(!1),onClick:()=>{T&&D(T),K(null),me(0)},children:"CHAT"})})]})})}):null,U?e.jsx(En,{api:t,session:n,spot:r.find(u=>u.spotId===U)??null,onClose:()=>ne(null),onUpdated:async()=>{try{const u=await t.listCruisingSpots();m(u.spots)}catch{}},setLastError:S}):null]})}function En({api:t,session:n,spot:a,onClose:f,onUpdated:l,setLastError:b}){return a?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},role:"dialog","aria-modal":"true","aria-label":"Cruising spot",onClick:f,children:e.jsxs("div",{onClick:S=>S.stopPropagation(),style:{...Ee(),width:"min(520px, 100%)",display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:a.name}),e.jsx("div",{style:{color:"#9fb6bf",fontSize:13},children:a.address}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap"},children:a.description}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:13},children:["Check-ins: ",a.checkInCount??0," | I got action there: ",a.actionCount??0]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:ve(!1),onClick:async()=>{try{await t.checkInCruisingSpot(n.sessionToken,a.spotId),await l()}catch(S){b(Y(S))}},children:"CHECK IN"}),e.jsx("button",{type:"button",style:H(!1),onClick:async()=>{try{await t.markCruisingSpotAction(n.sessionToken,a.spotId),await l()}catch(S){b(Y(S))}},children:"I GOT ACTION THERE"}),e.jsx("button",{type:"button",style:H(!1),onClick:f,children:"CLOSE"})]})]})}):null}function Fn({api:t,session:n,busy:a,setBusy:f,setLastError:l,onlinePeers:b,selectedPeerKey:S,setSelectedPeerKey:k,onOpenProfile:N,openThreadRequest:F,onThreadRequestConsumed:D,isMobile:B,selfCoords:E,peerProfileByKey:M,discoverFilter:o,publicProfiles:v,favorites:T,mediaUrlById:K,onUnreadCountChange:g}){var zt;const[j,L]=s.useState({}),[A,Z]=s.useState({}),[ae,pe]=s.useState("instant"),[ye,ue]=s.useState("grid"),[he,y]=s.useState(null),[p,R]=s.useState(""),[te,z]=s.useState(null),[ee,I]=s.useState([]),[fe,oe]=s.useState({}),[me,c]=s.useState(null),[W,r]=s.useState({}),[m,U]=s.useState({}),[ne,de]=s.useState(!1),[we,ke]=s.useState(""),[ce,xe]=s.useState(null),G=s.useRef(!1),be=s.useRef(!1),Re=s.useRef(0),Se=s.useRef(null),De=s.useRef(null),Fe=s.useRef(null),q=s.useRef(null),Te=s.useRef(null),Pe=s.useRef(0),Ie=s.useRef(new Set),je=s.useRef(null),Le=s.useRef(null),_e=s.useRef(null),[Ke,st]=s.useState(null),[Xe,Ye]=s.useState(o==="favorites"),[it,We]=s.useState(!1),[He,Ze]=s.useState(o==="online"?"online":"all"),[Je,et]=s.useState(!1),[u,h]=s.useState(""),[w,$]=s.useState(""),[Q,se]=s.useState(""),[ge,Ae]=s.useState(""),[Ge,xt]=s.useState(""),[rt,jt]=s.useState(""),[at,wt]=s.useState(""),[ot,St]=s.useState(""),[lt,kt]=s.useState(""),[dt,It]=s.useState(""),[ct,Ct]=s.useState(""),Ne=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,ie=he??S??"",nn=ie?j[ie]??[]:[],Tt=s.useMemo(()=>new Map(b.map(i=>[i.key,i])),[b]),ze=s.useMemo(()=>{const i={};for(const d of v)typeof d.displayName=="string"&&d.displayName.trim()&&(i[Oe(d.userId)]=d.displayName);for(const[d,x]of Object.entries(M))typeof x.displayName=="string"&&x.displayName.trim()&&(i[d]=x.displayName);return i},[M,v]),Mt=s.useMemo(()=>v.filter(i=>i.userId!==(n.userId??"")).map(i=>{const d=Oe(i.userId),x=Tt.get(d);return{key:d,userId:i.userId,displayName:i.displayName,age:i.age,stats:i.stats,meters:x&&E?Math.round(yt(E,{lat:x.lat,lng:x.lng})):null,isOnline:!!x,hasPicture:typeof i.mainPhotoMediaId=="string"&&i.mainPhotoMediaId.trim().length>0,avatarUrl:i.mainPhotoMediaId?K[i.mainPhotoMediaId]:void 0}}),[K,Tt,v,E,n.userId]),Qe=s.useMemo(()=>{const i=u.trim()?Number(u):void 0,d=w.trim()?Number(w):void 0,x=ge.trim()?Number(ge):void 0,P=Ge.trim()?Number(Ge):void 0,O=rt.trim()?Number(rt):void 0,V=at.trim()?Number(at):void 0,J=ot.trim()?Number(ot):void 0,_=lt.trim()?Number(lt):void 0;return[...Mt.filter(C=>{var Me,Ue,Ve,Be,Ut,Ot,Lt,Kt,Wt;if(Xe&&!T.has(C.userId)||He==="online"&&!C.isOnline||He==="offline"&&C.isOnline||Je&&!C.hasPicture||Number.isFinite(i)&&(typeof C.age!="number"||C.age<i)||Number.isFinite(d)&&(typeof C.age!="number"||C.age>d))return!1;const re=typeof((Me=C.stats)==null?void 0:Me.race)=="string"?C.stats.race:"";return!(Q.trim()&&re.toLowerCase()!==Q.trim().toLowerCase()||Number.isFinite(x)&&(typeof((Ue=C.stats)==null?void 0:Ue.heightInches)!="number"||C.stats.heightInches<x)||Number.isFinite(P)&&(typeof((Ve=C.stats)==null?void 0:Ve.heightInches)!="number"||C.stats.heightInches>P)||Number.isFinite(O)&&(typeof((Be=C.stats)==null?void 0:Be.weightLbs)!="number"||C.stats.weightLbs<O)||Number.isFinite(V)&&(typeof((Ut=C.stats)==null?void 0:Ut.weightLbs)!="number"||C.stats.weightLbs>V)||Number.isFinite(J)&&(typeof((Ot=C.stats)==null?void 0:Ot.cockSizeInches)!="number"||C.stats.cockSizeInches<J)||Number.isFinite(_)&&(typeof((Lt=C.stats)==null?void 0:Lt.cockSizeInches)!="number"||C.stats.cockSizeInches>_)||dt&&((Kt=C.stats)==null?void 0:Kt.cutStatus)!==dt||ct&&((Wt=C.stats)==null?void 0:Wt.position)!==ct)})].sort((C,re)=>{const Me=typeof C.meters=="number"&&Number.isFinite(C.meters)?C.meters:Number.POSITIVE_INFINITY,Ue=typeof re.meters=="number"&&Number.isFinite(re.meters)?re.meters:Number.POSITIVE_INFINITY;if(Me!==Ue)return Me-Ue;const Ve=C.displayName.localeCompare(re.displayName);return Ve!==0?Ve:C.key.localeCompare(re.key)})},[Mt,T,Xe,dt,w,lt,Ge,at,u,ot,ge,rt,ct,Q,Je,He]),ut=s.useMemo(()=>Array.from(new Set(Qe.map(i=>i.key).filter(i=>i.trim().length>0))).slice(0,8),[Qe]),At=ut.join("|"),ft=s.useMemo(()=>{const i=new Set(Object.keys(A));return ie.trim()&&i.add(ie),Array.from(i).sort((d,x)=>{var P,O;return(((P=A[x])==null?void 0:P.lastAt)??0)-(((O=A[d])==null?void 0:O.lastAt)??0)})},[A,ie]),Nt=s.useMemo(()=>Object.values(W).reduce((i,d)=>i+(Number.isFinite(d)?d:0),0),[W]);s.useMemo(()=>{var i;return ie?ze[ie]??((i=M[ie])==null?void 0:i.displayName)??ie:""},[ze,ie,M]);const sn=s.useMemo(()=>{if(!ie)return;const i=Qe.find(d=>d.key===ie);return i==null?void 0:i.avatarUrl},[Qe,ie]),qe=s.useMemo(()=>ft.filter(i=>i!==ie&&i!==Ne&&!!A[i]).map(i=>{var d;return{key:i,label:ze[i]??((d=M[i])==null?void 0:d.displayName)??i}}),[ft,A,ze,Ne,ie,M]);s.useEffect(()=>{typeof g=="function"&&g(Nt)},[g,Nt]),s.useEffect(()=>{const i=Se.current;i&&(i.srcObject=ce)},[ce]),s.useEffect(()=>{const i=De.current;i&&(i.srcObject=Ke)},[Ke]),s.useEffect(()=>()=>{if(ce){for(const i of ce.getTracks())i.stop();if(Ke)for(const i of Ke.getTracks())i.stop();je.current&&(je.current.close(),je.current=null)}},[ce,Ke]),s.useEffect(()=>{if(qe.length===0){R("");return}R(i=>i&&qe.some(d=>d.key===i)?i:qe[0].key)},[qe]);const rn=s.useMemo(()=>({async sendMessage(i,d,x,P){const O=Ce(d),V=await t.sendChat(n.sessionToken,i,O,x,P),J=V==null?void 0:V.message,_=[J];if(i==="cruise"&&te)try{const le=await t.sendChat(n.sessionToken,i,Ce(te),x,P),C=le==null?void 0:le.message;_.push(C)}catch(le){l(Y(le))}for(const le of _)Rt(le);return J},async initiateMediaUpload(i,d){const x=await t.initiateChatMediaUpload(n.sessionToken,{mimeType:i,sizeBytes:d});return{objectKey:x.objectKey,uploadUrl:x.uploadUrl}},async uploadToSignedUrl(i,d,x){if(await bt(i,d,x))return;if(!(await fetch(i,{method:"PUT",headers:{"content-type":x},body:d})).ok)throw{code:"MEDIA_UPLOAD_INCOMPLETE",message:"Upload failed."}},async getMediaUrl(i){return(await t.getChatMediaUrl(n.sessionToken,i)).downloadUrl}}),[t,Ne,n.sessionToken,l,te]);function tt(i){var d,x,P;return i.text&&i.text.trim()?en(i.text):((d=i.media)==null?void 0:d.kind)==="image"?"[Photo]":((x=i.media)==null?void 0:x.kind)==="video"?"[Video]":((P=i.media)==null?void 0:P.kind)==="audio"?"[Voice]":""}function an(i){if(!i||Ie.current.has(i))return!1;if(Ie.current.add(i),Ie.current.size>5e3){const d=Array.from(Ie.current).slice(-2500);Ie.current=new Set(d)}return!0}function on(i,d){var O;const x=ze[d]??((O=M[d])==null?void 0:O.displayName)??d,P=tt(i)||"New activity";if("Notification"in window){if(Notification.permission==="granted"){try{new Notification(`${x}`,{body:P})}catch{}return}Notification.permission==="default"&&Notification.requestPermission()}}function ln(i){if(!i.startsWith("GROUP_INVITE_REQUEST|"))return null;const[,d,x,P]=i.split("|");return!d||!x||!P?null:{inviteId:d,inviterKey:x,primaryPeerKey:P}}function dn(i){if(!i.startsWith("GROUP_INVITE_ACCEPT|"))return null;const[,d,x]=i.split("|");return!d||!x?null:{inviteId:d,candidateKey:x}}function Rt(i){if(!an(i.messageId))return;const d=i.fromKey===Ne?i.toKey:i.fromKey;L(O=>{const V=O[d]??[];return V.some(J=>J.messageId===i.messageId)?O:{...O,[d]:[...V,i].sort((J,_)=>J.createdAtMs-_.createdAtMs)}}),Z(O=>({...O,[d]:{lastAt:i.createdAtMs,lastText:tt(i)}})),i.fromKey!==Ne&&(ye==="thread"&&Ce(ie)===Ce(d)?(U(V=>({...V,[d]:Math.max(V[d]??0,i.createdAtMs)})),r(V=>{const J={...V};return delete J[d],J})):r(V=>({...V,[d]:(V[d]??0)+1})),on(i,d));const x=ln(i.text??"");x&&i.toKey===Ne&&I(O=>O.some(V=>V.inviteId===x.inviteId)?O:[...O,{...x,createdAtMs:i.createdAtMs}]);const P=dn(i.text??"");P&&i.toKey===Ne&&fe[P.inviteId]&&(z(Ce(P.candidateKey)),c(`Invite accepted by ${ze[P.candidateKey]??P.candidateKey}.`),oe(V=>{const J={...V};return delete J[P.inviteId],J}))}async function cn(i){const d=Ce(i);if(d)try{const x=await t.listChat(n.sessionToken,nt(ae),d),P=x==null?void 0:x.messages,O=Array.isArray(P)?P:[];t.markChatRead(n.sessionToken,nt(ae),d).catch(()=>{}),L(_=>({..._,[d]:O}));const V=O.length>0?O[O.length-1]:null;V&&Z(_=>({..._,[d]:{lastAt:V.createdAtMs,lastText:tt(V)}}));let J=0;for(const _ of O)_.fromKey===d&&_.createdAtMs>J&&(J=_.createdAtMs);J>0&&U(_=>({..._,[d]:Math.max(_[d]??0,J)}))}catch(x){l(Y(x))}}s.useEffect(()=>{if(ye!=="thread"||!ie.trim())return;let i=!1,d=!1,x=null;const P=async()=>{if(!(i||d)){d=!0;try{await cn(ie)}finally{d=!1}i||(x=window.setTimeout(()=>{P()},1200))}};return P(),()=>{i=!0,x!==null&&window.clearTimeout(x)}},[ae,ie,ye]),s.useEffect(()=>{if(ye!=="grid")return;if(ut.length===0){r({});return}let i=!1;async function d(){if(!G.current&&!document.hidden){G.current=!0;try{const O=nt(ae),V=[],J=[];for(const le of ut){if(i)break;try{const C=Ce(le);if(!C)continue;const re=await t.listChat(n.sessionToken,O,C),Me=(re==null?void 0:re.messages)??[];if(Me.length>0){const Be=Me[Me.length-1];J.push([C,{lastAt:Be.createdAtMs,lastText:tt(Be)}])}let Ue=0;const Ve=m[C]??0;for(const Be of Me)Be.fromKey===C&&Be.createdAtMs>Ve&&(Ue+=1);V.push([C,Ue])}catch{const C=Ce(le);C&&V.push([C,0])}}if(i)return;J.length>0&&Z(le=>{const C={...le};for(const[re,Me]of J)C[re]=Me;return C});const _={};for(const[le,C]of V)C>0&&(_[le]=C);r(_)}finally{G.current=!1}}}const x=window.setTimeout(()=>{d()},1200),P=window.setInterval(()=>{d()},15e3);return()=>{i=!0,G.current=!1,window.clearTimeout(x),window.clearInterval(P)}},[t,ae,m,n.sessionToken,At,ye]),s.useEffect(()=>{const i=Array.from(new Set([...ft,...ut,ie].map(V=>Ce(V)).filter(V=>V.length>0))).slice(0,10);if(i.length===0)return;let d=!1;const x=async()=>{if(!(d||document.hidden||be.current)){be.current=!0;try{const V=nt(ae),J=[];for(const _ of i){if(d)break;try{const le=await t.listChat(n.sessionToken,V,_),C=(le==null?void 0:le.messages)??[];if(C.length===0)continue;const re=C[C.length-1];J.push([_,{lastAt:re.createdAtMs,lastText:tt(re)}])}catch{}}if(d||J.length===0)return;Z(_=>{const le={..._};for(const[C,re]of J)le[C]=re;return le})}finally{be.current=!1}}},P=window.setTimeout(()=>{x()},1e3),O=window.setInterval(()=>{x()},5e3);return()=>{d=!0,window.clearTimeout(P),window.clearInterval(O)}},[t,ae,ft,ie,n.sessionToken,At]);async function un(){if(ce)return ce;if(!navigator.mediaDevices||typeof navigator.mediaDevices.getUserMedia!="function")throw{code:"UNAUTHORIZED_ACTION",message:"Camera access is not available in this browser."};const i=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});return xe(i),i}function fn(i,d){je.current&&(je.current.close(),je.current=null);const x=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});return je.current=x,Le.current=d,_e.current=i,x.ontrack=P=>{const O=P.streams[0];O&&st(O)},x.onicecandidate=P=>{const O=P.candidate;if(!O)return;const V=_e.current,J=Le.current;!V||!J||t.sendCallSignal(n.sessionToken,{toKey:V,callId:J,signalType:"ice",candidate:JSON.stringify(O.toJSON())}).catch(()=>{})},x}async function Pt(i=!0){const d=_e.current,x=Le.current;if(i&&d&&x)try{await t.sendCallSignal(n.sessionToken,{toKey:d,callId:x,signalType:"hangup"})}catch{}if(ce)for(const P of ce.getTracks())P.stop();if(Ke)for(const P of Ke.getTracks())P.stop();xe(null),st(null),je.current&&(je.current.close(),je.current=null),Le.current=null,_e.current=null,de(!1)}s.useEffect(()=>{let i=!1;const d=gt();if(!d)return;const x=()=>{q.current!==null&&(window.clearInterval(q.current),q.current=null),Te.current!==null&&(window.clearTimeout(Te.current),Te.current=null)},P=()=>{if(i)return;const O=new WebSocket(d);Fe.current=O,O.onopen=()=>{Pe.current=0,O.send(JSON.stringify({type:"auth",payload:{sessionToken:n.sessionToken}})),q.current=window.setInterval(()=>{O.readyState===O.OPEN&&O.send(JSON.stringify({type:"heartbeat",payload:{}}))},15e3)},O.onmessage=V=>{let J=null;try{J=JSON.parse(String(V.data))}catch{return}if(!J||typeof J.type!="string")return;if(J.type==="chat_message"){const C=J.payload,re=C==null?void 0:C.message;if(!re||re.fromKey!==Ne&&re.toKey!==Ne)return;Rt(re);return}if(J.type!=="call_signal")return;const _=J.payload;if(!_||_.toKey!==Ne||typeof _.fromKey!="string"||!_.callId||!_.signalType)return;const le=Ce(_.fromKey);if(_.signalType==="hangup"){Pt(!1);return}if(_.signalType==="offer"){(async()=>{try{pt(le),ke(le);const C=await un(),re=fn(le,_.callId);for(const Ue of C.getTracks())re.addTrack(Ue,C);await re.setRemoteDescription({type:"offer",sdp:_.sdp??""});const Me=await re.createAnswer();await re.setLocalDescription(Me),await t.sendCallSignal(n.sessionToken,{toKey:le,callId:_.callId,signalType:"answer",sdp:Me.sdp??""}),de(!0)}catch(C){l(Y(C))}})();return}if(_.signalType==="answer"){(async()=>{try{if(!je.current||Le.current!==_.callId)return;await je.current.setRemoteDescription({type:"answer",sdp:_.sdp??""})}catch(C){l(Y(C))}})();return}_.signalType==="ice"&&(async()=>{try{if(!je.current||Le.current!==_.callId||!_.candidate)return;const C=JSON.parse(_.candidate);await je.current.addIceCandidate(C)}catch{}})()},O.onclose=()=>{if(x(),i)return;Pe.current+=1;const V=Math.min(8e3,500*2**Math.min(Pe.current,4));Te.current=window.setTimeout(P,V)},O.onerror=()=>{}};return P(),()=>{var O;i=!0,x(),(O=Fe.current)==null||O.close(1e3,"chat cleanup"),Fe.current=null}},[t,Ne,n.sessionToken]);async function gn(){if(p.trim()){if(!ie.trim()){l("Select a user first.");return}try{const i=Ce(p);if(!i)return;if(!qe.some(x=>x.key===i)){l("You can only add a third user you have previously messaged.");return}const d=crypto.randomUUID();await t.sendChat(n.sessionToken,"cruise",i,`GROUP_INVITE_REQUEST|${d}|${Ne}|${ie.trim()}`),oe(x=>({...x,[d]:{candidateKey:i,primaryPeerKey:ie.trim()}})),c(`Invite sent to ${ze[i]??i}. Waiting for acceptance.`)}catch(i){l(Y(i))}}}async function Et(i,d,x){try{await t.sendChat(n.sessionToken,"cruise",d,`GROUP_INVITE_ACCEPT|${i}|${Ne}`),I(P=>P.filter(O=>O.inviteId!==i)),c("Group invite accepted."),pt(x)}catch(P){l(Y(P))}}function Ft(i){I(d=>d.filter(x=>x.inviteId!==i))}function pt(i){const d=Ce(i);k(d),y(d),r(x=>{const P={...x};return delete P[d],P}),U(x=>({...x,[d]:Date.now()})),ue("thread")}function ht(){Ye(!1),Ze("all"),et(!1),h(""),$(""),se(""),Ae(""),xt(""),jt(""),wt(""),St(""),kt(""),It(""),Ct(""),We(!1)}if(s.useEffect(()=>{const i=d=>{var O;const P=(O=d.detail)==null?void 0:O.action;if(P==="reset"){ht(),ue("grid");return}if(P==="toggle_favorites"){Ye(V=>!V),ue("grid");return}P==="open_filters"&&(We(!0),ue("grid"))};return window.addEventListener("rd:discover-control",i),()=>window.removeEventListener("rd:discover-control",i)},[]),s.useEffect(()=>{F&&F.nonce!==Re.current&&(Re.current=F.nonce,pt(F.key),typeof D=="function"&&D())},[D,F]),s.useEffect(()=>{const i=d=>{var P;((P=d.detail)==null?void 0:P.tab)==="discover"&&(ue("grid"),y(null),We(!1))};return window.addEventListener("rd:tab-select",i),()=>window.removeEventListener("rd:tab-select",i)},[]),ye==="thread"&&ie.trim()){const i=ze[ie]??((zt=M[ie])==null?void 0:zt.displayName)??ie;return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:B?-10:0},children:[ee.length>0?e.jsxs("div",{style:{...Ee(),display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"INVITE REQUESTS"}),ee.map(d=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,alignItems:"center"},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:13},children:[ze[d.inviterKey]??d.inviterKey," invited you to join a conversation."]}),e.jsx("button",{type:"button",style:ve(!1),onClick:()=>void Et(d.inviteId,d.inviterKey,d.primaryPeerKey),children:"ACCEPT"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>Ft(d.inviteId),children:"DECLINE"})]},d.inviteId))]}):null,me?e.jsx("div",{style:{color:"#26d5ff",fontSize:12},children:me}):null,e.jsx(Zt,{chatKind:nt(ae),peerKey:ie,currentUserKey:Ne,messages:nn,client:rn,title:`INSTANT THREAD: ${i}`,peerSummary:{displayName:i,avatarUrl:sn},thirdParty:{candidates:qe,selectedKey:p,onSelect:d=>R(d),onAdd:()=>void gn(),disabled:a},showHeader:!1,edgeToEdge:B,fillHeight:B}),ne?e.jsx("div",{role:"dialog","aria-modal":"true","aria-label":"Video call",style:{position:"fixed",inset:0,zIndex:60,background:"rgba(0,0,0,0.82)",display:"grid",placeItems:"center",padding:16},children:e.jsxs("div",{style:{...Ee(),width:"min(720px, 100%)",display:"grid",gap:10},children:[e.jsxs("div",{style:{fontSize:18,fontWeight:700},children:["VIDEO CALL: ",we]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("video",{ref:Se,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"100%",maxHeight:"52vh",borderRadius:12,background:"#000"}}),e.jsx("video",{ref:De,autoPlay:!0,playsInline:!0,style:{width:"100%",maxHeight:"52vh",borderRadius:12,background:"#000"}})]}),e.jsx("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:e.jsx("button",{type:"button",style:H(!1),onClick:()=>void Pt(),children:"END CALL"})})]})}):null]})}return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:B?-10:0},children:[ee.length>0?e.jsxs("div",{style:{...Ee(),display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"INVITE REQUESTS"}),ee.map(i=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,alignItems:"center"},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:13},children:[ze[i.inviterKey]??i.inviterKey," invited you to join a conversation."]}),e.jsx("button",{type:"button",style:ve(!1),onClick:()=>void Et(i.inviteId,i.inviterKey,i.primaryPeerKey),children:"ACCEPT"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>Ft(i.inviteId),children:"DECLINE"})]},i.inviteId))]}):null,me?e.jsx("div",{style:{color:"#26d5ff",fontSize:12},children:me}):null,e.jsx("div",{style:{padding:10,borderBottom:"1px solid rgba(255,58,77,0.28)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8},children:[e.jsx("button",{type:"button",style:H(!1),onClick:ht,children:"GUYS"}),e.jsx("button",{type:"button",style:Xe?ve(!1):H(!1),onClick:()=>Ye(i=>!i),"aria-label":"Toggle favorites only",children:"â˜…"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>We(!0),children:"FILTER"})]})}),it?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},role:"dialog","aria-modal":"true","aria-label":"Discover filters",onClick:()=>We(!1),children:e.jsx("div",{onClick:i=>i.stopPropagation(),style:{...Ee(),width:"min(760px, 100%)",maxHeight:"86vh",overflow:"auto"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"FILTER USERS"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{type:"checkbox",checked:Je,onChange:i=>et(i.target.checked)}),"Has pictures"]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Online status"}),e.jsxs("select",{style:X(),value:He,onChange:i=>Ze(i.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"offline",children:"Offline"})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[e.jsx("input",{style:X(),placeholder:"Min age",value:u,onChange:i=>h(i.target.value)}),e.jsx("input",{style:X(),placeholder:"Max age",value:w,onChange:i=>$(i.target.value)}),e.jsx("input",{style:X(),placeholder:"Race",value:Q,onChange:i=>se(i.target.value)}),e.jsxs("select",{style:X(),value:dt,onChange:i=>It(i.target.value),children:[e.jsx("option",{value:"",children:"Cut / Uncut"}),e.jsx("option",{value:"cut",children:"Cut"}),e.jsx("option",{value:"uncut",children:"Uncut"})]}),e.jsx("input",{style:X(),placeholder:"Min height (in)",value:ge,onChange:i=>Ae(i.target.value)}),e.jsx("input",{style:X(),placeholder:"Max height (in)",value:Ge,onChange:i=>xt(i.target.value)}),e.jsx("input",{style:X(),placeholder:"Min weight (lbs)",value:rt,onChange:i=>jt(i.target.value)}),e.jsx("input",{style:X(),placeholder:"Max weight (lbs)",value:at,onChange:i=>wt(i.target.value)}),e.jsx("input",{style:X(),placeholder:"Min cock size (in)",value:ot,onChange:i=>St(i.target.value)}),e.jsx("input",{style:X(),placeholder:"Max cock size (in)",value:lt,onChange:i=>kt(i.target.value)}),e.jsxs("select",{style:X(),value:ct,onChange:i=>Ct(i.target.value),children:[e.jsx("option",{value:"",children:"Position"}),e.jsx("option",{value:"top",children:"Top"}),e.jsx("option",{value:"bottom",children:"Bottom"}),e.jsx("option",{value:"side",children:"Side"})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:H(!1),onClick:ht,children:"RESET"}),e.jsx("button",{type:"button",style:ve(!1),onClick:()=>We(!1),children:"DONE"})]})]})})}):null,e.jsx("div",{style:{display:"grid",gap:0},children:e.jsx("div",{style:{display:"grid",gap:0,gridTemplateColumns:"repeat(3, minmax(0, 1fr))"},children:Qe.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:13,padding:12,gridColumn:"1 / -1"},children:"No users match current filters."}):Qe.map(i=>e.jsx("button",{type:"button",onClick:()=>N(i.key),style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:0,display:"grid",gap:0,color:"#fff",cursor:"pointer"},children:e.jsxs("div",{style:{position:"relative",width:"100%",aspectRatio:"1 / 1"},children:[e.jsx("img",{src:i.avatarUrl??$e(i.key),alt:"User avatar",style:{width:"100%",height:"100%",borderRadius:0,objectFit:"cover",border:"1px solid #0fd9ff"}}),i.isOnline?e.jsx("span",{style:{position:"absolute",top:4,left:4,width:10,height:10,borderRadius:"50%",background:"#26d5ff",border:"2px solid #000"}}):null]})},i.key))})})]})}function zn({api:t,session:n,setLastError:a,openThreadRequest:f,onThreadRequestConsumed:l,isMobile:b}){var I,fe,oe,me,c,W;const[S,k]=s.useState([]),[N,F]=s.useState(null),[D,B]=s.useState([]),[E,M]=s.useState("messages"),[o,v]=s.useState(null),[T,K]=s.useState(!1),[g,j]=s.useState(""),[L,A]=s.useState(null),[Z,ae]=s.useState({}),[pe,ye]=s.useState(null),ue=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,he="cruise",y=s.useMemo(()=>S.filter(r=>r.key!==N).map(r=>({key:r.key,label:r.displayName})),[S,N]),p=s.useMemo(()=>S.find(r=>r.key===N)??null,[S,N]);s.useEffect(()=>{if(y.length===0){j("");return}j(r=>r&&y.some(m=>m.key===r)?r:y[0].key)},[y]),s.useEffect(()=>{let r=!1;async function m(){var ne,de,we;try{const ke=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,[ce,xe]=await Promise.all([t.getPublicProfiles(),t.listActivePresence(n.sessionToken)]),G={},be={};for(const q of ce.profiles)G[Oe(q.userId)]=q.displayName,typeof q.mainPhotoMediaId=="string"&&q.mainPhotoMediaId.trim()!==""&&(be[Oe(q.userId)]=q.mainPhotoMediaId);const Re=Array.from(new Set([...ce.profiles.map(q=>Oe(q.userId)),...xe.presence.map(q=>Ce(q.key))].filter(q=>q&&q!==ke))).slice(0,24),Se=[];for(const q of Re)try{const Te=await t.listChat(n.sessionToken,"cruise",q),Pe=(Te==null?void 0:Te.messages)??[];if(!Array.isArray(Pe)||Pe.length===0)continue;const Ie=Pe[Pe.length-1],je=typeof Ie.text=="string"&&Ie.text.trim().length>0?en(Ie.text):((ne=Ie.media)==null?void 0:ne.kind)==="image"?"[Photo]":((de=Ie.media)==null?void 0:de.kind)==="video"?"[Video]":((we=Ie.media)==null?void 0:we.kind)==="audio"?"[Voice]":"";Se.push({key:q,displayName:G[q]??q,preview:je,at:Ie.createdAtMs})}catch{}const De=await Promise.all(Se.map(async q=>{const Te=be[q.key];if(!Te)return null;try{const Pe=await t.getPublicMediaUrl(Te);return{key:q.key,url:Pe.downloadUrl}}catch{return null}})),Fe={};for(const q of De)q&&(Fe[q.key]=q.url);for(const q of Se)q.avatarUrl=Fe[q.key];if(r)return;Se.sort((q,Te)=>Te.at-q.at),k(Se)}catch(ke){r||a(Y(ke))}}m();const U=window.setInterval(()=>{m()},1e4);return()=>{r=!0,window.clearInterval(U)}},[t,N,n.sessionToken,n.userId,a]),s.useEffect(()=>{f!=null&&f.key&&(F(Ce(f.key)),M("messages"),typeof l=="function"&&l())},[l,f]),s.useEffect(()=>{const r=m=>{var ne;((ne=m.detail)==null?void 0:ne.tab)==="threads"&&(F(null),M("messages"))};return window.addEventListener("rd:tab-select",r),()=>window.removeEventListener("rd:tab-select",r)},[]),s.useEffect(()=>{if(!N||E!=="profile")return;const r=mt(N);if(!r){v(null);return}let m=!1;return K(!0),t.getPublicProfile(r).then(U=>{m||v(U.profile)}).catch(U=>{m||(v(null),a(Y(U)))}).finally(()=>{m||K(!1)}),()=>{m=!0}},[t,N,a,E]),s.useEffect(()=>{if(!N){B([]);return}let r=!1;const m=async()=>{try{const ne=await t.listChat(n.sessionToken,he,N),de=(ne==null?void 0:ne.messages)??[];r||(B(Array.isArray(de)?de:[]),t.markChatRead(n.sessionToken,he,N).catch(()=>{}))}catch(ne){r||a(Y(ne))}};m();const U=window.setInterval(()=>{m()},1200);return()=>{r=!0,window.clearInterval(U)}},[t,N,n.sessionToken,a]);function R(r){if(!r.startsWith("GROUP_INVITE_ACCEPT|"))return null;const[,m,U]=r.split("|");return!m||!U?null:{inviteId:m,candidateKey:U}}const te=s.useMemo(()=>({async sendMessage(r,m,U,ne){const de=await t.sendChat(n.sessionToken,r,m,U,ne),we=de==null?void 0:de.message,ke=R(we.text??"");if(ke&&we.toKey===ue&&Z[ke.inviteId]&&(A(ke.candidateKey),ye(`Invite accepted by ${ke.candidateKey}.`),ae(xe=>{const G={...xe};return delete G[ke.inviteId],G})),B(ce=>[...ce,we].sort((xe,G)=>xe.createdAtMs-G.createdAtMs)),r==="cruise"&&L)try{const ce=await t.sendChat(n.sessionToken,r,L,U,ne),xe=ce==null?void 0:ce.message;B(G=>[...G,xe].sort((be,Re)=>be.createdAtMs-Re.createdAtMs))}catch(ce){a(Y(ce))}return we},async initiateMediaUpload(r,m){const U=await t.initiateChatMediaUpload(n.sessionToken,{mimeType:r,sizeBytes:m});return{objectKey:U.objectKey,uploadUrl:U.uploadUrl}},async uploadToSignedUrl(r,m,U){if(await bt(r,m,U))return;if(!(await fetch(r,{method:"PUT",headers:{"content-type":U},body:m})).ok)throw{code:"MEDIA_UPLOAD_INCOMPLETE",message:"Upload failed."}},async getMediaUrl(r){return(await t.getChatMediaUrl(n.sessionToken,r)).downloadUrl}}),[t,ue,Z,n.sessionToken,a,L]);async function z(){var r;if(!(!N||!g)){if(!S.some(m=>m.key===g)){a("You can only add a third user you have previously messaged.");return}try{const m=crypto.randomUUID();await t.sendChat(n.sessionToken,"cruise",g,`GROUP_INVITE_REQUEST|${m}|${ue}|${N}`),ae(U=>({...U,[m]:{candidateKey:g}})),ye(`Invite sent to ${((r=S.find(U=>U.key===g))==null?void 0:r.displayName)??g}.`)}catch(m){a(Y(m))}}}async function ee(){if(N)try{await t.sendChat(n.sessionToken,"cruise",N,vt),ye("Fire sent.")}catch(r){a(Y(r))}}if(N){const r=(p==null?void 0:p.displayName)??N;return e.jsxs("div",{style:{display:"grid",gap:0,minHeight:b?"calc(100dvh - 150px)":void 0,marginInline:b?-10:0,marginBlock:0},children:[e.jsx("div",{style:{position:"sticky",top:0,zIndex:46,background:"rgba(8,8,12,0.96)",borderBottom:"1px solid rgba(255,58,77,0.35)",padding:"6px 10px",display:"flex",justifyContent:"flex-end"},children:e.jsx("button",{type:"button",onClick:()=>M(m=>m==="messages"?"profile":"messages"),style:{background:"transparent",border:0,color:"#26d5ff",fontSize:13,fontWeight:700,letterSpacing:"0.03em",textTransform:"uppercase",padding:0,cursor:"pointer"},children:E==="messages"?"View Profile":"Back to Thread"})}),E==="messages"?e.jsx(Zt,{chatKind:"cruise",peerKey:N,currentUserKey:ue,messages:D,client:te,title:`INSTANT THREAD: ${r}`,peerSummary:{displayName:r},thirdParty:{candidates:y,selectedKey:g,onSelect:m=>j(m),onAdd:()=>void z(),disabled:!1},showHeader:!1,edgeToEdge:!0,fillHeight:b}):e.jsxs("div",{style:{padding:12,display:"grid",gap:12},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"88px 1fr",gap:12,alignItems:"center"},children:[e.jsx("img",{src:(p==null?void 0:p.avatarUrl)??$e(N),alt:"Profile avatar",style:{width:88,height:88,borderRadius:"50%",objectFit:"cover",border:"2px solid #ff3047"}}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:24,fontWeight:700},children:(o==null?void 0:o.displayName)??r}),e.jsx("div",{style:{color:"#26d5ff",fontSize:14},children:"Instant Messaging Available"})]})]}),T?e.jsx("div",{style:{color:"#9fb6bf",fontSize:14},children:"Loading profile..."}):null,T?null:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:14,lineHeight:1.5},children:[e.jsxs("div",{children:["Age: ",(o==null?void 0:o.age)??"-"]}),e.jsxs("div",{children:["Race: ",((I=o==null?void 0:o.stats)==null?void 0:I.race)??"-"]}),e.jsxs("div",{children:["Height: ",((fe=o==null?void 0:o.stats)==null?void 0:fe.heightInches)??"-"]}),e.jsxs("div",{children:["Weight: ",((oe=o==null?void 0:o.stats)==null?void 0:oe.weightLbs)??"-"]}),e.jsxs("div",{children:["Cock Size: ",((me=o==null?void 0:o.stats)==null?void 0:me.cockSizeInches)??"-"]}),e.jsxs("div",{children:["Cut / Uncut: ",((c=o==null?void 0:o.stats)==null?void 0:c.cutStatus)??"-"]}),e.jsxs("div",{children:["Position: ",((W=o==null?void 0:o.stats)==null?void 0:W.position)??"-"]}),e.jsxs("div",{style:{marginTop:8},children:["Bio: ",(o==null?void 0:o.bio)??"-"]})]}),e.jsx("div",{children:e.jsx("button",{type:"button",style:{...H(!1),color:"#ffb347",borderColor:"rgba(255,179,71,0.65)"},onClick:()=>void ee(),children:"ðŸ”¥ FIRE"})})]})]})]})}return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:b?-10:0,marginBlock:0},children:[S.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14,padding:14},children:"No conversations yet."}):S.map(r=>e.jsxs("button",{type:"button",onClick:()=>F(r.key),style:{border:0,borderBottom:"1px solid rgba(255,58,77,0.24)",borderRadius:0,padding:"10px 12px",background:"rgba(0,0,0,0.2)",textAlign:"left",color:"#fff",cursor:"pointer",display:"grid",gridTemplateColumns:"52px 1fr",gap:10,alignItems:"center",width:"100%"},children:[e.jsx("img",{src:r.avatarUrl??$e(r.key),alt:`${r.displayName} avatar`,style:{width:52,height:52,borderRadius:6,objectFit:"cover",border:"1px solid rgba(38,213,255,0.9)"}}),e.jsxs("div",{style:{display:"grid",gap:3,minWidth:0},children:[e.jsx("div",{style:{fontWeight:700},children:r.displayName}),e.jsx("div",{style:{color:"#b9bec9",fontSize:13,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:r.preview})]})]},r.key)),pe?e.jsx("div",{style:{color:"#26d5ff",fontSize:12,padding:10},children:pe}):null]})}function Un({api:t,session:n,isMobile:a,setLastError:f}){const[l,b]=s.useState("ads"),[S,k]=s.useState([]),[N,F]=s.useState([]),[D,B]=s.useState(""),[E,M]=s.useState(""),[o,v]=s.useState(""),[T,K]=s.useState(""),[g,j]=s.useState([]),[L,A]=s.useState(""),[Z,ae]=s.useState(""),[pe,ye]=s.useState(""),[ue,he]=s.useState([]),[y,p]=s.useState({}),R=!0,te=n.userType!=="guest";async function z(){try{const[r,m,U,ne]=await Promise.all([t.listPublicPostings("ad"),t.listPublicPostings("event"),t.listCruisingSpots(),n.userType==="guest"?Promise.resolve({postings:[]}):t.listEventInvites(n.sessionToken)]);k([...r.postings].sort((de,we)=>de.createdAtMs-we.createdAtMs)),F([...m.postings].sort((de,we)=>de.createdAtMs-we.createdAtMs)),j(U.spots),he(ne.postings)}catch(r){f(Y(r))}}s.useEffect(()=>{z()},[]),s.useEffect(()=>{const r=m=>{var ne;((ne=m.detail)==null?void 0:ne.tab)==="public"&&b("ads")};return window.addEventListener("rd:tab-select",r),()=>window.removeEventListener("rd:tab-select",r)},[]);async function ee(r){if(r==="event"&&!te){f("Anonymous users cannot create event postings.");return}const m=r==="ad"?D:o,U=r==="ad"?E:T;try{await t.createPublicPosting(n.sessionToken,{type:r,title:m,body:U}),r==="ad"?(B(""),M("")):(v(""),K("")),await z()}catch(ne){f(Y(ne))}}async function I(r){if(!te){f("Anonymous users cannot invite to events.");return}const m=(y[r]??"").trim();if(!m){f("Target user id is required.");return}try{await t.inviteToEvent(n.sessionToken,{postingId:r,targetUserId:m}),p(U=>({...U,[r]:""})),await z()}catch(U){f(Y(U))}}async function fe(r,m){if(n.userType==="guest"){f("Anonymous users cannot respond to event invites.");return}try{await t.respondToEventInvite(n.sessionToken,{postingId:r,accept:m}),await z()}catch(U){f(Y(U))}}async function oe(){try{await t.createCruisingSpot(n.sessionToken,{name:L,address:Z,description:pe}),A(""),ae(""),ye(""),await z()}catch(r){f(Y(r))}}async function me(r){try{await t.checkInCruisingSpot(n.sessionToken,r),await z()}catch(m){f(Y(m))}}const c=r=>{const m=r==="ads"?"ADS":"EVENTS",U=r==="ads"?S:N,ne=r==="ads"?D:o,de=r==="ads"?E:T,we=r==="ads"?B:v,ke=r==="ads"?M:K,ce=r==="ads"?"ad":"event",xe=r==="ads"?R:te;return e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.38)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:m}),e.jsx("input",{value:ne,onChange:G=>we(G.target.value),placeholder:`${m} title`,style:X(),"aria-label":`${m} title`,disabled:!xe}),e.jsx("textarea",{value:de,onChange:G=>ke(G.target.value),placeholder:`Write ${m.toLowerCase()} details`,style:{...X(),minHeight:86,resize:"vertical"},"aria-label":`${m} details`,disabled:!xe}),e.jsxs("button",{type:"button",onClick:()=>void ee(ce),style:xe?ve(!1):H(!0),disabled:!xe,children:["POST ",m]}),xe?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can view events but cannot post events."}),e.jsx("div",{style:{display:"grid",gap:8,marginTop:6},children:U.length===0?e.jsxs("div",{style:{color:"#b9bec9",fontSize:14},children:["No ",m.toLowerCase()," yet."]}):U.map(G=>{var be,Re;return e.jsxs("div",{style:{borderTop:"1px solid rgba(255,58,77,0.25)",paddingTop:10,paddingBottom:10},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:4},children:G.title}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12,marginBottom:6},children:["Host: ",G.authorUserId]}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap"},children:G.body}),r==="events"?e.jsxs("div",{style:{display:"grid",gap:8,marginTop:8},children:[e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12},children:["Invited: ",((be=G.invitedUserIds)==null?void 0:be.length)??0," | Accepted: ",((Re=G.acceptedUserIds)==null?void 0:Re.length)??0]}),n.userId&&n.userId===G.authorUserId?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8},children:[e.jsx("input",{value:y[G.postingId]??"",onChange:Se=>p(De=>({...De,[G.postingId]:Se.target.value})),placeholder:"Invite user id",style:X()}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>void I(G.postingId),children:"INVITE"})]}):null,n.userType!=="guest"&&n.userId&&Array.isArray(G.invitedUserIds)&&G.invitedUserIds.includes(n.userId)?e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:ve(!1),onClick:()=>void fe(G.postingId,!0),children:"ACCEPT INVITE"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>void fe(G.postingId,!1),children:"DECLINE"})]}):null]}):null]},G.postingId)})})]})})},W=e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.38)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"CRUISING SPOTS"}),e.jsx("input",{value:L,onChange:r=>A(r.target.value),placeholder:"Spot name",style:X(),disabled:!1}),e.jsx("input",{value:Z,onChange:r=>ae(r.target.value),placeholder:"Spot address",style:X(),disabled:!1}),e.jsx("textarea",{value:pe,onChange:r=>ye(r.target.value),placeholder:"Spot description",style:{...X(),minHeight:80,resize:"vertical"},disabled:!1}),e.jsx("button",{type:"button",style:ve(!1),disabled:!1,onClick:()=>void oe(),children:"CREATE SPOT"}),null,e.jsx("div",{style:{display:"grid",gap:8},children:g.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"No cruising spots yet."}):g.map(r=>e.jsxs("div",{style:{borderTop:"1px solid rgba(255,58,77,0.25)",paddingTop:10,paddingBottom:10},children:[e.jsx("div",{style:{fontWeight:700},children:r.name}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12,marginTop:4},children:["Created by: ",r.creatorUserId]}),e.jsx("div",{style:{color:"#9fb6bf",fontSize:12,marginTop:2},children:r.address}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap",marginTop:6},children:r.description}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:H(!1),onClick:()=>void me(r.spotId),children:"CHECK IN"}),e.jsxs("span",{style:{color:"#9fb6bf",fontSize:12},children:["Checked in: ",r.checkInCount??0]}),e.jsxs("span",{style:{color:"#9fb6bf",fontSize:12},children:["Got action: ",r.actionCount??0]})]})]},r.spotId))})]})});return e.jsx("div",{style:{display:"grid",gap:8,marginInline:a?-10:0},children:a?e.jsxs(e.Fragment,{children:[l==="ads"?c("ads"):null,l==="events"?c("events"):null,l==="spots"?W:null,e.jsx("div",{style:{position:"sticky",bottom:"calc(86px + env(safe-area-inset-bottom, 0px))",zIndex:31,background:"rgba(0,0,0,0.35)",padding:8},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[e.jsx("button",{type:"button",style:l==="ads"?ve(!1):H(!1),onClick:()=>b("ads"),children:"ADS"}),e.jsx("button",{type:"button",style:l==="events"?ve(!1):H(!1),onClick:()=>b("events"),children:"EVENTS"}),e.jsx("button",{type:"button",style:l==="spots"?ve(!1):H(!1),onClick:()=>b("spots"),children:"SPOTS"})]})})]}):e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[c("ads"),c("events"),e.jsx("div",{style:{gridColumn:"1 / -1"},children:W}),n.userType!=="guest"&&ue.length>0?e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.25)",gridColumn:"1 / -1",display:"grid",gap:8,padding:10},children:[e.jsx("div",{style:{fontSize:16,fontWeight:700},children:"EVENT INVITES"}),ue.map(r=>e.jsxs("div",{style:{display:"grid",gap:6,border:"1px solid rgba(255,58,77,0.4)",borderRadius:10,padding:8},children:[e.jsx("div",{style:{fontWeight:700},children:r.title}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13},children:["Host: ",r.authorUserId]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:ve(!1),onClick:()=>void fe(r.postingId,!0),children:"ACCEPT"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>void fe(r.postingId,!1),children:"DECLINE"})]})]},r.postingId))]}):null]})})}function On({api:t,session:n,setLastError:a}){const[f,l]=s.useState([]),[b,S]=s.useState(""),[k,N]=s.useState("");async function F(){try{const o=await t.listSubmissions();l([...o.submissions].sort((v,T)=>T.createdAtMs-v.createdAtMs))}catch(o){a(Y(o))}}s.useEffect(()=>{F()},[]);async function D(){try{await t.createSubmission(n.sessionToken,{title:b,body:k}),S(""),N(""),await F()}catch(o){a(Y(o))}}async function B(o){try{await t.recordSubmissionView(o),await F()}catch(v){a(Y(v))}}async function E(o,v){try{await t.rateSubmission(o,v),await F()}catch(T){a(Y(T))}}const M=n.userType!=="guest";return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("input",{style:X(),value:b,onChange:o=>S(o.target.value),placeholder:"Story title",disabled:!M}),e.jsx("textarea",{style:{...X(),minHeight:120},value:k,onChange:o=>N(o.target.value),placeholder:"Write your story",disabled:!M}),e.jsx("button",{type:"button",style:M?ve(!1):H(!0),disabled:!M,onClick:()=>void D(),children:"PUBLISH STORY"}),M?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can read but cannot publish submissions."})]})}),e.jsx("div",{style:{display:"grid",gap:10},children:f.map(o=>{const v=o.ratingCount>0?(o.ratingSum/o.ratingCount).toFixed(2):"0.00";return e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.28)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:o.title}),e.jsx("div",{style:{color:"#ced3dc",whiteSpace:"pre-wrap",marginTop:6},children:o.body}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13,marginTop:8},children:["Views: ",o.viewCount," | Rating: ",v," (",o.ratingCount,")"]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:H(!1),onClick:()=>void B(o.submissionId),children:"VIEW"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>void E(o.submissionId,1),children:"â˜…1"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>void E(o.submissionId,2),children:"â˜…2"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>void E(o.submissionId,3),children:"â˜…3"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>void E(o.submissionId,4),children:"â˜…4"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>void E(o.submissionId,5),children:"â˜…5"})]})]},o.submissionId)})})]})}function Ln({api:t,session:n,setLastError:a}){var ue,he,y,p,R,te;const[f,l]=s.useState([]),[b,S]=s.useState({}),[k,N]=s.useState(null),[F,D]=s.useState(2e3),[B,E]=s.useState(""),[M,o]=s.useState(""),[v,T]=s.useState(""),[K,g]=s.useState(""),[j,L]=s.useState("Ready."),A=n.userType!=="guest";async function Z(){try{const z=await t.listPromotedProfiles();l([...z.listings].sort((oe,me)=>me.createdAtMs-oe.createdAtMs)),D(z.feeCents);const ee=Array.from(new Set(z.listings.map(oe=>oe.userId))).filter(oe=>oe.trim().length>0),I=await Promise.all(ee.map(async oe=>{try{const c=(await t.getPublicProfile(oe)).profile.mainPhotoMediaId;if(!c)return null;const W=await t.getPublicMediaUrl(c);return{userId:oe,url:W.downloadUrl}}catch{return null}})),fe={};for(const oe of I)oe&&(fe[oe.userId]=oe.url);S(fe)}catch(z){a(Y(z))}}s.useEffect(()=>{Z()},[]);async function ae(){if(!A){a("Anonymous users cannot create promoted profiles.");return}try{const z=await t.startPromotedPayment(n.sessionToken),ee=await t.confirmPromotedPayment(n.sessionToken,z.payment.paymentToken);g(ee.payment.paymentToken),L("Payment confirmed. You can now publish one promoted profile.")}catch(z){const ee=Y(z);L(ee),a(ee)}}async function pe(){if(!A){a("Anonymous users cannot create promoted profiles.");return}try{await t.createPromotedProfile(n.sessionToken,{paymentToken:K,title:B,body:M,displayName:v}),E(""),o(""),T(""),g(""),L("Promoted profile published."),await Z()}catch(z){const ee=Y(z);L(ee),a(ee)}}async function ye(z){try{const ee=await t.getPublicProfile(z);N(ee.profile)}catch(ee){a(Y(ee))}}return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"PROMOTED PROFILES"}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:14},children:["Publishing requires a $",Math.round(F/100)," fee per profile."]}),e.jsx("div",{style:{color:"#26d5ff",fontSize:13},children:j})]})}),e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("input",{value:v,onChange:z=>T(z.target.value),placeholder:"Display name",style:X(),disabled:!A}),e.jsx("input",{value:B,onChange:z=>E(z.target.value),placeholder:"Headline",style:X(),disabled:!A}),e.jsx("textarea",{value:M,onChange:z=>o(z.target.value),placeholder:"Profile description",style:{...X(),minHeight:92,resize:"vertical"},disabled:!A}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsxs("button",{type:"button",style:H(!A),disabled:!A,onClick:()=>void ae(),children:["PAY $",Math.round(F/100)]}),e.jsx("button",{type:"button",style:A?ve(!1):H(!0),disabled:!A,onClick:()=>void pe(),children:"PUBLISH PROFILE"})]}),A?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can browse but cannot publish paid profiles."})]})}),e.jsx("div",{style:{display:"grid",gap:10},children:f.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"No promoted profiles yet."}):f.map(z=>e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.25)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"72px 1fr",gap:10,alignItems:"start"},children:[e.jsx("img",{src:b[z.userId]??$e(`user:${z.userId}`),alt:`${z.displayName} profile`,style:{width:72,height:72,borderRadius:6,objectFit:"cover",border:"1px solid rgba(38,213,255,0.9)"}}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:z.title}),e.jsx("div",{style:{color:"#26d5ff",fontSize:13},children:z.displayName}),e.jsx("div",{style:{color:"#ced3dc",whiteSpace:"pre-wrap",fontSize:14},children:z.body}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>void ye(z.userId),children:"VIEW PROFILE"})]})]})},z.listingId))}),k?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},onClick:()=>N(null),children:e.jsxs("div",{onClick:z=>z.stopPropagation(),style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:12,width:"min(560px, 100%)",background:"rgba(0,0,0,0.88)"},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:k.displayName}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:6},children:["Age: ",k.age]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Race: ",((ue=k.stats)==null?void 0:ue.race)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Height: ",((he=k.stats)==null?void 0:he.heightInches)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Weight: ",((y=k.stats)==null?void 0:y.weightLbs)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Cock Size: ",((p=k.stats)==null?void 0:p.cockSizeInches)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Cut / Uncut: ",((R=k.stats)==null?void 0:R.cutStatus)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Position: ",((te=k.stats)==null?void 0:te.position)??"-"]}),e.jsx("div",{style:{color:"#ced3dc",marginTop:10,whiteSpace:"pre-wrap"},children:k.bio}),e.jsx("div",{style:{marginTop:10},children:e.jsx("button",{type:"button",style:H(!1),onClick:()=>N(null),children:"CLOSE"})})]})}):null]})}function Kn(){return{displayName:"",age:"",bio:"",heightInches:"",race:"",cockSizeInches:"",cutStatus:"",weightLbs:"",position:"",discreetMode:!1,travelEnabled:!1,travelLat:"",travelLng:"",lookingForMore:""}}function Gt(t){var a,f,l;const n=tn(t.bio);return{displayName:t.displayName,age:String(t.age),bio:n.bio,heightInches:t.stats.heightInches!==void 0?String(t.stats.heightInches):"",race:t.stats.race??"",cockSizeInches:t.stats.cockSizeInches!==void 0?String(t.stats.cockSizeInches):"",cutStatus:t.stats.cutStatus??"",weightLbs:t.stats.weightLbs!==void 0?String(t.stats.weightLbs):"",position:t.stats.position??"",discreetMode:t.discreetMode===!0,travelEnabled:((a=t.travelMode)==null?void 0:a.enabled)===!0,travelLat:typeof((f=t.travelMode)==null?void 0:f.lat)=="number"?String(t.travelMode.lat):"",travelLng:typeof((l=t.travelMode)==null?void 0:l.lng)=="number"?String(t.travelMode.lng):"",lookingForMore:n.lookingForMore}}function tn(t){const n=t.replace(/\r\n/g,`
`).trim(),a="Looking For More:",f=/Looking For More:\s*/g,l=Array.from(n.matchAll(f));if(l.length===0)return{bio:n,lookingForMore:""};const b=l[0],S=l[l.length-1],k=typeof b.index=="number"?b.index:n.indexOf(a),N=(typeof S.index=="number"?S.index:n.lastIndexOf(a))+S[0].length,F=n.slice(0,Math.max(0,k)).trim(),D=n.slice(Math.max(0,N)).trim();return{bio:F,lookingForMore:D}}function Wn(t,n){const f=tn(t).bio.trim(),l=n.trim();return l?f?`${f}

Looking For More: ${l}`:`${l}`:f}function Vt(t){const n=t.trim();if(!n)return;const a=Number(n);return Number.isFinite(a)?Math.trunc(a):void 0}function Dn(t){const n=t.trim();if(!n)return;const a=Number(n);return Number.isFinite(a)?a:void 0}function Bn({api:t,session:n,setLastError:a}){var ue,he;const[f,l]=s.useState(Kn()),[b,S]=s.useState(null),[k,N]=s.useState(!1),[F,D]=s.useState(!1),[B,E]=s.useState(null),[M,o]=s.useState({});async function v(){N(!0);try{const y=await t.getMyProfile(n.sessionToken);S(y.profile),l(Gt(y.profile)),E("Profile loaded.")}catch(y){const p=y;if((p==null?void 0:p.code)==="PROFILE_NOT_FOUND"){S(null),l(R=>({...R,age:R.age||"18"})),E("No profile yet. Fill out the form and save.");return}E(Y(y))}finally{N(!1)}}s.useEffect(()=>{v()},[n.sessionToken,n.userType]),s.useEffect(()=>{const y=[b==null?void 0:b.mainPhotoMediaId,...(b==null?void 0:b.galleryMediaIds)??[]].filter(R=>typeof R=="string"&&R.length>0);if(y.length===0)return;const p=y.filter(R=>!M[R]);p.length!==0&&Promise.all(p.map(async R=>{try{const te=await t.getPublicMediaUrl(R);return{id:R,url:te.downloadUrl}}catch{return null}})).then(R=>{o(te=>{const z={...te};for(const ee of R)ee&&(z[ee.id]=ee.url);return z})})},[t,M,b==null?void 0:b.galleryMediaIds,b==null?void 0:b.mainPhotoMediaId]);async function T(){var y,p,R,te,z;D(!0),a(null);try{const ee=Number(f.age),I=Wn(f.bio,f.lookingForMore),fe=f.travelLat.trim()?Number(f.travelLat):void 0,oe=f.travelLng.trim()?Number(f.travelLng):void 0,me={displayName:f.displayName,age:Math.trunc(ee),bio:I,stats:{heightInches:Vt(f.heightInches),race:f.race.trim()||void 0,cockSizeInches:Dn(f.cockSizeInches),cutStatus:f.cutStatus||void 0,weightLbs:Vt(f.weightLbs),position:f.position||void 0},discreetMode:f.discreetMode,travelMode:{enabled:f.travelEnabled,lat:Number.isFinite(fe)?fe:void 0,lng:Number.isFinite(oe)?oe:void 0}},c=await t.upsertMyProfile(n.sessionToken,me);S(c.profile),l(Gt(c.profile));try{localStorage.setItem("reddoor_travel_center",JSON.stringify({enabled:((y=c.profile.travelMode)==null?void 0:y.enabled)===!0,lat:(p=c.profile.travelMode)==null?void 0:p.lat,lng:(R=c.profile.travelMode)==null?void 0:R.lng})),window.dispatchEvent(new CustomEvent("rd:location-updated",{detail:{lat:(te=c.profile.travelMode)==null?void 0:te.lat,lng:(z=c.profile.travelMode)==null?void 0:z.lng}}))}catch{}E("Profile saved.")}catch(ee){const I=Y(ee);E(I),a(I)}finally{D(!1)}}async function K(y,p){if(!p){E("Choose a file first.");return}if(n.userType==="guest"){E("Guest sessions cannot upload media. Register to persist media.");return}D(!0),a(null);try{const R=await t.initiateMediaUpload(n.sessionToken,{kind:y,mimeType:p.type||(y==="video"?"video/mp4":"image/jpeg"),sizeBytes:p.size});if(!await bt(R.uploadUrl,p,p.type||"application/octet-stream")){const z=await fetch(R.uploadUrl,{method:"PUT",headers:{"content-type":p.type||"application/octet-stream"},body:p});if(!z.ok)throw{message:`Upload failed (${z.status}).`}}await t.completeMediaUpload(n.sessionToken,R.mediaId),await v(),E("Media uploaded.")}catch(R){const te=Y(R);E(te),a(te)}finally{D(!1)}}const[g,j]=s.useState(null),[L,A]=s.useState(null),[Z,ae]=s.useState(null);async function pe(y){if(b){D(!0);try{const p=(b.galleryMediaIds??[]).filter(te=>te!==y),R=await t.updateProfileMediaReferences(n.sessionToken,{galleryMediaIds:p});S(R.profile),E("Gallery updated.")}catch(p){const R=Y(p);E(R),a(R)}finally{D(!1)}}}async function ye(y){if(b){D(!0);try{const p=await t.updateProfileMediaReferences(n.sessionToken,{galleryMediaIds:b.galleryMediaIds,mainPhotoMediaId:y});S(p.profile),E("Main photo updated.")}catch(p){const R=Y(p);E(R),a(R)}finally{D(!1)}}}return e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:14},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"SETTINGS / PROFILE"}),n.userType==="guest"?e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guest profile data is temporary for this session and is removed when you log out."}):null,B?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:B}):null,e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Display Name"}),e.jsx("input",{value:f.displayName,onChange:y=>l(p=>({...p,displayName:y.target.value})),style:X()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Age"}),e.jsx("input",{value:f.age,onChange:y=>l(p=>({...p,age:y.target.value})),style:X(),inputMode:"numeric"})]})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Bio"}),e.jsx("textarea",{value:f.bio,onChange:y=>l(p=>({...p,bio:y.target.value})),style:{...X(),minHeight:88,resize:"vertical"}})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Looking For More (Optional)"}),e.jsx("textarea",{value:f.lookingForMore,onChange:y=>l(p=>({...p,lookingForMore:y.target.value})),style:{...X(),minHeight:72,resize:"vertical"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:f.discreetMode,onChange:y=>l(p=>({...p,discreetMode:y.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0,fontSize:13},children:"Discreet Mode (hide profile from others)"})]}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:f.travelEnabled,onChange:y=>l(p=>({...p,travelEnabled:y.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Travel Mode"})]})]}),f.travelEnabled?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Travel Lat"}),e.jsx("input",{value:f.travelLat,onChange:y=>l(p=>({...p,travelLat:y.target.value})),style:X()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Travel Lng"}),e.jsx("input",{value:f.travelLng,onChange:y=>l(p=>({...p,travelLng:y.target.value})),style:X()})]})]}):null,e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Height (in)"}),e.jsx("input",{value:f.heightInches,onChange:y=>l(p=>({...p,heightInches:y.target.value})),style:X(),inputMode:"numeric"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Race"}),e.jsx("input",{value:f.race,onChange:y=>l(p=>({...p,race:y.target.value})),style:X()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Cock Size (in)"}),e.jsx("input",{value:f.cockSizeInches,onChange:y=>l(p=>({...p,cockSizeInches:y.target.value})),style:X(),inputMode:"decimal"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Cut / Uncut"}),e.jsxs("select",{value:f.cutStatus,onChange:y=>l(p=>({...p,cutStatus:y.target.value})),style:X(),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"cut",children:"Cut"}),e.jsx("option",{value:"uncut",children:"Uncut"})]})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Weight (lbs)"}),e.jsx("input",{value:f.weightLbs,onChange:y=>l(p=>({...p,weightLbs:y.target.value})),style:X(),inputMode:"numeric"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Position"}),e.jsxs("select",{value:f.position,onChange:y=>l(p=>({...p,position:y.target.value})),style:X(),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"top",children:"Top"}),e.jsx("option",{value:"bottom",children:"Bottom"}),e.jsx("option",{value:"side",children:"Side"})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",onClick:()=>void T(),style:ve(F),disabled:F,children:"SAVE PROFILE"}),e.jsx("button",{type:"button",onClick:()=>void v(),style:H(k),disabled:k,children:"REFRESH"})]})]})}),e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"MEDIA"}),e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"Main profile photo, gallery photo, and video uploads."}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Main Photo"}),e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:y=>{var p;return j(((p=y.target.files)==null?void 0:p[0])??null)}})]}),e.jsx("button",{type:"button",style:ve(F),disabled:F,onClick:()=>void K("photo_main",g),children:"UPLOAD MAIN PHOTO"})]}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Gallery Photo"}),e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:y=>{var p;return A(((p=y.target.files)==null?void 0:p[0])??null)}})]}),e.jsx("button",{type:"button",style:ve(F),disabled:F,onClick:()=>void K("photo_gallery",L),children:"UPLOAD GALLERY PHOTO"})]}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Video"}),e.jsx("input",{className:"rd-input",type:"file",accept:"video/*",onChange:y=>{var p;return ae(((p=y.target.files)==null?void 0:p[0])??null)}})]}),e.jsx("button",{type:"button",style:ve(F),disabled:F,onClick:()=>void K("video",Z),children:"UPLOAD VIDEO"})]}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13},children:["Main photo media id: ",(b==null?void 0:b.mainPhotoMediaId)??"-",e.jsx("br",{}),"Gallery count: ",((ue=b==null?void 0:b.galleryMediaIds)==null?void 0:ue.length)??0,e.jsx("br",{}),"Video media id: ",(b==null?void 0:b.videoMediaId)??"-"]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"YOUR GALLERY"}),(he=b==null?void 0:b.galleryMediaIds)!=null&&he.length?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(130px, 1fr))",gap:10},children:b.galleryMediaIds.map(y=>e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.45)",borderRadius:10,padding:8,display:"grid",gap:8},children:[e.jsx("img",{src:M[y]??$e(y),alt:"Gallery photo",style:{width:"100%",aspectRatio:"1/1",objectFit:"cover",borderRadius:8,border:"1px solid rgba(255,58,77,0.4)"}}),e.jsx("button",{type:"button",style:H(F),disabled:F,onClick:()=>void ye(y),children:"SET MAIN"}),e.jsx("button",{type:"button",style:H(F),disabled:F,onClick:()=>void pe(y),children:"REMOVE"})]},y))}):e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No gallery photos uploaded yet."})]})]})})]})}function $n({api:t,session:n,setLastError:a,onLogout:f}){const[l,b]=s.useState({discreetMode:!1,travelEnabled:!1,travelLat:"",travelLng:""}),[S,k]=s.useState("Loading settings..."),[N,F]=s.useState(!1),[D,B]=s.useState([]);async function E(){var g,j,L;try{const A=await t.getMyProfile(n.sessionToken);if(b({discreetMode:A.profile.discreetMode===!0,travelEnabled:((g=A.profile.travelMode)==null?void 0:g.enabled)===!0,travelLat:typeof((j=A.profile.travelMode)==null?void 0:j.lat)=="number"?String(A.profile.travelMode.lat):"",travelLng:typeof((L=A.profile.travelMode)==null?void 0:L.lng)=="number"?String(A.profile.travelMode.lng):""}),k("Settings loaded."),n.userType!=="guest")try{const Z=await t.listBlocked(n.sessionToken);B(Z.blocked)}catch{B([])}else B([])}catch(A){k(Y(A))}}async function M(){try{const g=await fetch("/api/config"),j=await g.json();if(!g.ok)throw j;F(j.mediaStorageConfigured===!0)}catch{F(!1)}}s.useEffect(()=>{E(),M()},[n.sessionToken,n.userType]);async function o(){try{const g=await t.getMyProfile(n.sessionToken),j=l.travelLat.trim()?Number(l.travelLat):void 0,L=l.travelLng.trim()?Number(l.travelLng):void 0;await t.upsertMyProfile(n.sessionToken,{displayName:g.profile.displayName,age:g.profile.age,bio:g.profile.bio,stats:g.profile.stats,discreetMode:l.discreetMode,travelMode:{enabled:l.travelEnabled,lat:Number.isFinite(j)?j:void 0,lng:Number.isFinite(L)?L:void 0}}),k("Privacy settings saved.")}catch(g){const j=Y(g);k(j),a(j)}}async function v(){if(!navigator.geolocation){const g="Geolocation is unavailable on this device.";k(g),a(g);return}try{const g=await new Promise((A,Z)=>{navigator.geolocation.getCurrentPosition(A,Z,{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})}),j=Number(g.coords.latitude.toFixed(6)),L=Number(g.coords.longitude.toFixed(6));b(A=>({...A,travelEnabled:!0,travelLat:String(j),travelLng:String(L)}));try{localStorage.setItem("reddoor_travel_center",JSON.stringify({enabled:!0,lat:j,lng:L}))}catch{}try{await t.updatePresence(n.sessionToken,j,L,"online")}catch{}window.dispatchEvent(new CustomEvent("rd:location-updated",{detail:{lat:j,lng:L}})),k("Actual location detected. Save privacy settings to persist it.")}catch(g){const j=Y(g);k(j),a(j)}}async function T(){try{const g=l.travelLat.trim()?Number(l.travelLat):void 0,j=l.travelLng.trim()?Number(l.travelLng):void 0,L=await t.seedFakeUsers(12,Number.isFinite(g)?g:void 0,Number.isFinite(j)?j:void 0);k(`Seeded ${L.seededCount} fake users for testing.`)}catch(g){const j=Y(g);k(j),a(j)}}async function K(g){try{await t.unblock(n.sessionToken,g);const j=await t.listBlocked(n.sessionToken);B(j.blocked),k("Blocked users updated.")}catch(j){const L=Y(j);k(L),a(L)}}return e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"SETTINGS"}),e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:S}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:l.discreetMode,onChange:g=>b(j=>({...j,discreetMode:g.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Discreet Mode (hide your profile)"})]}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:l.travelEnabled,onChange:g=>b(j=>({...j,travelEnabled:g.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Travel Mode"})]}),l.travelEnabled?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("input",{value:l.travelLat,onChange:g=>b(j=>({...j,travelLat:g.target.value})),style:X(),placeholder:"Travel lat"}),e.jsx("input",{value:l.travelLng,onChange:g=>b(j=>({...j,travelLng:g.target.value})),style:X(),placeholder:"Travel lng"})]}):null,e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:ve(!1),onClick:()=>void o(),children:"SAVE PRIVACY"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>void v(),children:"DETECT ACTUAL LOCATION"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>void T(),children:"SEED FAKE USERS"}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>f==null?void 0:f(),children:"LOGOUT"})]})]})}),e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"MEDIA STORAGE"}),e.jsx("div",{style:{color:N?"#26d5ff":"#ff8a95",fontSize:14},children:N?"Configured: uploads enabled.":"Not configured: set S3_BUCKET, S3_REGION, S3_ACCESS_KEY_ID, S3_SECRET_ACCESS_KEY."}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>void M(),children:"REFRESH STORAGE STATUS"})]})}),n.userType!=="guest"?e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"BLOCKED USERS"}),D.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No blocked users."}):D.map(g=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[e.jsx("div",{style:{color:"#ced3dc",fontSize:14},children:g}),e.jsx("button",{type:"button",style:H(!1),onClick:()=>void K(g),children:"UNBLOCK"})]},g))]})}):null]})}function Hn({api:t,session:n,setSession:a,settings:f,activeTab:l,setActiveTab:b,discoverScreen:S,onDiscoverScreenChange:k,discoverFilter:N,busy:F,setBusy:D,setLastError:B,onUnreadCountChange:E,hideModeCard:M,onLogout:o}){const v=Rn(),[T,K]=s.useState(null),g=e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx(Bn,{api:t,session:n,setLastError:B}),e.jsx($n,{api:t,session:n,setLastError:B,onLogout:o})]});return e.jsxs("div",{style:{display:"grid",gap:12},children:[null,e.jsx("div",{style:{display:l==="discover"?"block":"none"},children:e.jsx(Pn,{api:t,session:n,settings:f,discoverFilter:N,busy:F,setBusy:D,setLastError:B,isMobile:v,discoverScreen:S,onDiscoverScreenChange:k,onOpenThreadRequested:j=>{K({key:Ce(j),nonce:Date.now()}),b("threads")},onUnreadCountChange:E})}),l==="threads"?e.jsx(zn,{api:t,session:n,setLastError:B,openThreadRequest:T,onThreadRequestConsumed:()=>K(null),isMobile:v}):null,l==="public"?e.jsx(Un,{api:t,session:n,isMobile:v,setLastError:B}):null,l==="profile"||l==="settings"?g:null,l==="submissions"?e.jsx(On,{api:t,session:n,setLastError:B}):null,l==="promoted"?e.jsx(Ln,{api:t,session:n,setLastError:B}):null]})}export{Hn as Router};
