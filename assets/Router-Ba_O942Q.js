const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./maplibre-gl-D-U8UB9N.js","./index-D9Nd_-1-.js","./index-CcRnFIlo.css"])))=>i.map(i=>d[i]);
import{r as s,j as e,_ as un,p as Gt,a as Vt,b as Yt,u as ht}from"./index-D9Nd_-1-.js";function Jt(t){return typeof t=="object"&&t!==null}function fn(t){return!(!Jt(t)||typeof t.key!="string"||t.userType!=="guest"&&t.userType!=="registered"&&t.userType!=="subscriber"||typeof t.lat!="number"||!Number.isFinite(t.lat)||typeof t.lng!="number"||!Number.isFinite(t.lng)||typeof t.updatedAtMs!="number"||!Number.isFinite(t.updatedAtMs)||t.status!==void 0&&typeof t.status!="string")}function Qt(t){const[n,o]=s.useState(()=>new Map),[u,c]=s.useState(null),x=s.useRef(null),S=s.useRef(null);return s.useEffect(()=>{if(t.disabled===!0||t.wsUrl.trim()===""){o(new Map),c(null),S.current!==null&&(window.clearTimeout(S.current),S.current=null);return}let N=!1,M=0,L=null;const G=()=>{L!==null&&(window.clearInterval(L),L=null)},P=()=>{if(N)return;const a=Math.min(8e3,500*2**Math.min(M,4));S.current=window.setTimeout(()=>{S.current=null,C()},a)},C=()=>{if(N)return;let a;try{a=new WebSocket(t.wsUrl)}catch{M+=1,c("Realtime unavailable in this mode."),P();return}x.current=a;let b=!1;a.onopen=()=>{b=!0,M=0,c(null);const T={};t.sessionToken&&(T.sessionToken=t.sessionToken),t.jwt&&(T.jwt=t.jwt),a.send(JSON.stringify({type:"auth",payload:T})),L=window.setInterval(()=>{a.readyState===a.OPEN&&a.send(JSON.stringify({type:"heartbeat",payload:{}}))},15e3)},a.onmessage=T=>{const W=(()=>{try{return JSON.parse(String(T.data))}catch{return null}})();if(!W||typeof W.type!="string"){c("Invalid server message.");return}if(W.type==="error"&&Jt(W.payload)&&typeof W.payload.message=="string"){c(W.payload.message);return}if(W.type==="presence_update"){const h=W.payload;if(!fn(h)){c("Invalid presence payload.");return}o(k=>{const z=new Map(k);return z.set(h.key,h),z})}},a.onerror=()=>{},a.onclose=T=>{if(G(),!N&&T.code!==1e3){M+=1;const W=typeof T.reason=="string"&&T.reason.trim()!==""?` Reason: ${T.reason}`:"";(M>=2||b)&&c(`Realtime ${b?"disconnected":"failed to connect"} (code ${T.code}). Reconnecting...${W}`),P()}}};return C(),()=>{var a;N=!0,G(),S.current!==null&&(window.clearTimeout(S.current),S.current=null),(a=x.current)==null||a.close(1e3,"Client cleanup"),x.current=null}},[t.disabled,t.jwt,t.sessionToken,t.wsUrl]),{state:s.useMemo(()=>({byKey:n}),[n]),lastErrorMessage:u}}async function gn(){const t=await un(()=>import("./maplibre-gl-D-U8UB9N.js").then(o=>o.m),__vite__mapDeps([0,1,2]),import.meta.url);return t.default??t}function yn(t){return t.replace(/[&<>"']/g,n=>{switch(n){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return n}})}function pn(){return{version:8,sources:{basemap:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png","https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"Â© OpenStreetMap contributors"}},layers:[{id:"basemap",type:"raster",source:"basemap"}]}}function hn(t){const n=document.createElement("button");return n.type="button",n.setAttribute("aria-label",t.label??"Presence marker"),n.style.width="36px",n.style.height="36px",n.style.borderRadius="999px",n.style.border=`2px solid ${t.color}`,t.markerType==="spot"?(n.style.background="radial-gradient(circle at 30% 30%, #ff4f60, #a70013)",n.style.display="grid",n.style.placeItems="center",n.style.color="#ffffff",n.style.fontWeight="700",n.style.fontSize="13px",n.textContent=typeof t.markerGlyph=="string"&&t.markerGlyph.trim()?t.markerGlyph.trim().slice(0,2):"SP"):typeof t.imageUrl=="string"&&t.imageUrl.trim()!==""?(n.style.backgroundImage=`url("${t.imageUrl}")`,n.style.backgroundSize="cover",n.style.backgroundPosition="center"):n.style.background="#000000",n.style.padding="0",n.style.cursor=typeof t.onClick=="function"?"pointer":"default",n}function mn({initialView:t,markers:n,interactive:o,visible:u}){const c=s.useRef(null),x=s.useRef(null),S=s.useRef(null),I=s.useRef([]),[N,M]=s.useState({kind:"ready"}),L=s.useMemo(()=>t.center,[t.center]),G=o!==!1,P=u!==!1;return s.useEffect(()=>{let C=!1,a=null,b=null,T=null;async function W(){if(c.current&&!S.current)try{x.current||(x.current=await gn());const h=x.current,k=new h.Map({container:c.current,style:pn(),center:[L.lng,L.lat],zoom:t.zoom,interactive:G});k.addControl(new h.NavigationControl({showCompass:!1}),"top-right"),S.current=k;const z=()=>{k.resize()};b=z,T=window.requestAnimationFrame(z),window.addEventListener("resize",z),a=new ResizeObserver(()=>z()),a.observe(c.current),k.on("error",R=>{var oe;const X=((oe=R.error)==null?void 0:oe.message)??"Map error.";C||X.toLowerCase().includes("failed to fetch")||X.toLowerCase().includes("network")||M({kind:"error",message:X})}),k.once("load",()=>{C||M({kind:"ready"})})}catch(h){if(C)return;M({kind:"error",message:h instanceof Error?h.message:"Map error."})}}return W(),()=>{var h;C=!0,T!==null&&window.cancelAnimationFrame(T),b&&window.removeEventListener("resize",b),a==null||a.disconnect();for(const k of I.current)k.remove();I.current=[],(h=S.current)==null||h.remove(),S.current=null}},[G]),s.useEffect(()=>{const C=S.current;if(!C||!P)return;C.resize();const a=window.setTimeout(()=>{C.resize(),C.setCenter([t.center.lng,t.center.lat]),C.setZoom(t.zoom)},80);return()=>window.clearTimeout(a)},[t.center.lat,t.center.lng,t.zoom,P]),s.useEffect(()=>{const C=S.current;if(!C||!P)return;C.resize();const a=window.setTimeout(()=>C.resize(),120);return()=>window.clearTimeout(a)},[P]),s.useEffect(()=>{const C=S.current,a=x.current;if(!(!C||!a)){for(const b of I.current)b.remove();I.current=[];for(const b of n){const T=typeof b.label=="string"&&b.label.trim()!==""?new a.Popup({closeButton:!1,closeOnClick:!0}).setHTML(`<div style="font-family: var(--ui); font-size: 12px; line-height: 1.35;">
                 <div style="font-weight: 600;">${yn(b.label)}</div>
               </div>`):void 0,W=hn(b);typeof b.onClick=="function"&&W.addEventListener("click",k=>{var z;k.preventDefault(),(z=b.onClick)==null||z.call(b)});const h=new a.Marker({element:W}).setLngLat([b.position.lng,b.position.lat]);T&&h.setPopup(T),h.addTo(C),I.current.push(h)}}},[n]),N.kind==="error"?e.jsxs("div",{style:{background:"#000000",color:"#F22F2F",border:"2px solid #C00000",borderRadius:8,padding:12,fontFamily:"var(--ui)",fontSize:14,lineHeight:1.4},role:"alert","aria-live":"polite",children:["Map error: ",N.message]}):e.jsx("div",{ref:c,className:"rd-maplibre",style:{width:"100%",height:"100%",background:"#000000",borderRadius:8,overflow:"hidden"},"aria-label":"Cruise map"})}const Wt=[Gt,Vt,Yt];function bn(t){let n=0;for(let o=0;o<t.length;o+=1)n=n*31+t.charCodeAt(o)|0;return Math.abs(n)}function vn(t){return Wt[bn(t)%Wt.length]}function xn(t,n,o){return t.map(u=>({id:u.key,position:{lat:u.lat,lng:u.lng},color:"#C00000",label:u.status?`Presence: ${u.status}`:"Presence",imageUrl:(n==null?void 0:n[u.key])??vn(u.key),onClick:o?()=>o(u.key):void 0}))}function Dt({wsUrl:t,sessionToken:n,jwt:o,defaultCenter:u,defaultZoom:c,presenceUpdates:x,realtimeErrorMessage:S,onMarkerSelect:I,avatarByKey:N,additionalMarkers:M,height:L,visible:G}){const P=Qt({wsUrl:t,sessionToken:n,jwt:o,disabled:Array.isArray(x)}),C=x?{byKey:new Map(x.map(R=>[R.key,R]))}:P.state,a=S??P.lastErrorMessage,[b,T]=s.useState({kind:"pending"});s.useEffect(()=>{if(!("geolocation"in navigator)||!navigator.geolocation){T({kind:"unavailable"});return}navigator.geolocation.getCurrentPosition(R=>{T({kind:"granted",center:{lat:R.coords.latitude,lng:R.coords.longitude}})},R=>{if(R.code===R.PERMISSION_DENIED){T({kind:"denied"});return}if(R.code===R.TIMEOUT){T({kind:"error",message:"Timed out while trying to read your location. Showing the default map view."});return}T({kind:"error",message:R.message||"Geolocation error."})},{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e4})},[]);const W=s.useMemo(()=>Array.from(C.byKey.values()),[C.byKey]),h=s.useMemo(()=>[...xn(W,N,I),...M??[]],[M,N,I,W]),k=s.useMemo(()=>{const R=typeof c=="number"&&Number.isFinite(c)?c:13;return b.kind==="granted"?{center:b.center,zoom:R}:{center:u,zoom:R}},[u,c,b]),z=s.useMemo(()=>b.kind==="denied"?"Location permission denied. Showing the default map view.":b.kind==="unavailable"?"Geolocation is unavailable. Showing the default map view.":b.kind==="error"?`Geolocation error: ${b.message}`:null,[b]);return e.jsxs("section",{"aria-label":"Cruise mode map",style:{background:"#000000",color:"#FFFFFF",fontFamily:"var(--ui)",display:"grid",gap:8,height:"100%"},children:[z?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"rgba(0,0,0,0.7)",border:"1px solid rgba(255,58,77,0.45)",borderRadius:0,padding:8,color:"#AAAAAA",fontSize:12,lineHeight:1.4},children:z}):null,a?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"rgba(0,0,0,0.7)",border:"1px solid rgba(255,58,77,0.45)",borderRadius:0,padding:8,color:"#F22F2F",fontSize:12,lineHeight:1.4},children:a}):null,e.jsx("div",{style:{background:"#111111",border:0,borderRadius:0,overflow:"hidden",height:typeof L=="number"||typeof L=="string"?L:520},children:e.jsx(mn,{initialView:k,markers:h,visible:G})})]})}const jn="FIRE_SIGNAL|1";function Sn(t){return new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function Bt(t){if(!t.startsWith("LOCATION|"))return null;const[,n,o]=t.split("|"),u=Number(n),c=Number(o);return!Number.isFinite(u)||!Number.isFinite(c)?null:{lat:u,lng:c,link:`https://maps.google.com/?q=${u},${c}`}}function wn(t){return t.trim()===jn?"ðŸ”¥ I'm into you":t}function qt({chatKind:t,peerKey:n,currentUserKey:o,messages:u,client:c,title:x,peerSummary:S,thirdParty:I,edgeToEdge:N,showHeader:M,fillHeight:L}){const[G,P]=s.useState(""),[C,a]=s.useState(null),[b,T]=s.useState(!1),[W,h]=s.useState({}),[k,z]=s.useState(!1),[R,X]=s.useState(!1),oe=s.useRef(null),je=s.useRef([]),de=s.useRef(null),le=s.useRef(null),me=s.useRef(null),y=N===!0,m=M!==!1,U=y&&L===!0,te=s.useMemo(()=>[...u].sort((f,O)=>f.createdAtMs-O.createdAtMs),[u]),d=s.useMemo(()=>Array.from(new Set(te.map(f=>{var O;return(O=f.media)==null?void 0:O.objectKey}).filter(f=>typeof f=="string"&&f.trim().length>0))),[te]);s.useEffect(()=>{let f=!1;async function O(){for(const r of d){if(f)return;if(!W[r])try{const v=await c.getMediaUrl(r);if(f)return;h(E=>({...E,[r]:v}))}catch{}}}return O(),()=>{f=!0}},[c,d,W]);async function J(f){const O=G.trim();if(!(O.length===0&&!f)){T(!0),a(null);try{await c.sendMessage(t,n,O,f),P("")}catch(r){const v=r;a(typeof(v==null?void 0:v.message)=="string"?v.message:"Message rejected.")}finally{T(!1)}}}async function ve(f){T(!0),a(null);try{const O=await c.initiateMediaUpload(f.type||"application/octet-stream",f.size);await c.uploadToSignedUrl(O.uploadUrl,f,f.type||"application/octet-stream");const v={kind:f.type.startsWith("image/")?"image":f.type.startsWith("video/")?"video":"audio",objectKey:O.objectKey,mimeType:f.type||"application/octet-stream"};await J(v)}catch(O){const r=O;a(typeof(r==null?void 0:r.message)=="string"?r.message:"Upload rejected."),T(!1)}}async function fe(f){var r;const O=(r=f.target.files)==null?void 0:r[0];if(f.target.value="",!!O){if(!O.type.startsWith("image/")&&!O.type.startsWith("video/")&&!O.type.startsWith("audio/")){a("Only image, video, or audio files are supported.");return}await ve(O)}}async function ie(){var f;if(k){(f=oe.current)==null||f.stop();return}if(!navigator.mediaDevices||typeof navigator.mediaDevices.getUserMedia!="function"){a("Microphone is not available in this browser.");return}try{const O=await navigator.mediaDevices.getUserMedia({audio:!0}),r=new MediaRecorder(O);je.current=[],oe.current=r,r.ondataavailable=v=>{v.data.size>0&&je.current.push(v.data)},r.onstop=()=>{const v=new Blob(je.current,{type:r.mimeType||"audio/webm"}),E=new File([v],`voice-${Date.now()}.webm`,{type:r.mimeType||"audio/webm"});ve(E);for(const ne of O.getTracks())ne.stop();oe.current=null,z(!1)},r.start(),z(!0)}catch(O){const r=O;a(typeof(r==null?void 0:r.message)=="string"?r.message:"Unable to record voice."),z(!1)}}async function Se(){if(!navigator.geolocation){a("Geolocation is not available in this browser.");return}T(!0),a(null);try{const f=await new Promise((E,ne)=>{navigator.geolocation.getCurrentPosition(E,ne,{enableHighAccuracy:!1,timeout:12e3,maximumAge:3e4})}),O=Number(f.coords.latitude.toFixed(5)),r=Number(f.coords.longitude.toFixed(5)),v=`LOCATION|${O}|${r}`;await c.sendMessage(t,n,v)}catch(f){const O=f;a(typeof(O==null?void 0:O.message)=="string"?O.message:"Unable to send location.")}finally{T(!1)}}return e.jsxs("section",{"aria-label":"Chat",style:{background:y?"transparent":"#000000",color:"#FFFFFF",fontFamily:"Montserrat, sans-serif",padding:y?0:16,display:"grid",gap:y?0:12,gridTemplateRows:m?"auto auto 1fr auto":"1fr auto",minHeight:L?"calc(100dvh - 196px)":void 0},children:[m?e.jsxs("header",{style:{height:56,display:"grid",alignItems:"center",background:"#000000"},children:[e.jsx("div",{style:{textAlign:"center",fontSize:20,fontWeight:600},children:x}),S?e.jsxs("div",{style:{marginTop:4,display:"flex",alignItems:"center",justifyContent:"center",gap:8,color:"#b7d8e0",fontSize:13},children:[e.jsx("span",{children:"Chat with:"}),S.avatarUrl?e.jsx("img",{src:S.avatarUrl,alt:`${S.displayName} avatar`,style:{width:24,height:24,borderRadius:"50%",objectFit:"cover",border:"1px solid rgba(38,213,255,0.8)"}}):e.jsx("span",{"aria-hidden":!0,style:{width:24,height:24,borderRadius:"50%",border:"1px solid rgba(38,213,255,0.8)",background:"rgba(255,255,255,0.08)"}}),e.jsx("span",{style:{color:"#fff",fontWeight:600},children:S.displayName})]}):null,e.jsx("div",{style:{textAlign:"center",fontSize:12,color:"#AAAAAA"},children:t==="cruise"?"CRUISE CHAT (EPHEMERAL)":"DATE CHAT (PERSISTENT)"})]}):null,C?e.jsx("div",{role:"alert","aria-live":"polite",style:{background:"#111111",border:"2px solid #C00000",borderRadius:8,padding:12,color:"#F22F2F",fontSize:14,lineHeight:1.4},children:C}):null,e.jsx("div",{"aria-label":"Messages",style:{background:y?"#09090b":"#111111",border:y?"none":"2px solid #C00000",borderRadius:y?0:8,padding:12,display:"flex",flexDirection:"column",gap:12,minHeight:y?0:320,paddingBottom:U?148:12,overflowY:"auto"},children:te.length===0?e.jsx("div",{style:{color:"#AAAAAA",fontSize:14,lineHeight:1.4},children:"No messages."}):te.map(f=>{const O=f.fromKey===o,r=O?"#C00000":"#444444",v=O?{alignItems:"flex-end"}:{alignItems:"flex-start"};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,width:"100%",...v},children:[(()=>{const E=Bt(f.text??"");return E?e.jsxs("a",{href:E.link,target:"_blank",rel:"noreferrer",style:{display:"grid",gap:6,textDecoration:"none",color:"#fff",background:r,borderRadius:14,padding:8,width:"auto",maxWidth:"80%"},children:[e.jsx("div",{style:{fontSize:12,color:"#d8ecff"},children:"Shared location"}),e.jsx("iframe",{title:"Google Maps location preview",src:`https://www.google.com/maps?q=${E.lat},${E.lng}&z=14&output=embed`,style:{width:"100%",height:140,border:"1px solid rgba(255,255,255,0.18)",borderRadius:10},loading:"lazy",referrerPolicy:"no-referrer-when-downgrade"}),e.jsx("div",{style:{fontSize:12,color:"#3fdfff"},children:"Open in Google Maps"})]}):null})(),e.jsxs("div",{style:{background:r,color:"#FFFFFF",borderRadius:18,padding:"8px 12px",width:"auto",maxWidth:"80%",fontSize:16,lineHeight:1.4,whiteSpace:"pre-wrap",overflowWrap:"anywhere",wordBreak:"break-word"},children:[f.text&&!Bt(f.text)?e.jsx("div",{style:{marginBottom:f.media?8:0},children:wn(f.text)}):null,f.media?e.jsxs("div",{children:[f.media.kind==="image"?e.jsx("img",{src:W[f.media.objectKey],alt:"Shared",style:{width:"100%",maxWidth:260,borderRadius:10,border:"1px solid rgba(255,255,255,0.18)"}}):null,f.media.kind==="video"?e.jsx("video",{controls:!0,playsInline:!0,src:W[f.media.objectKey],style:{width:"100%",maxWidth:320,borderRadius:10,background:"#000"}}):null,f.media.kind==="audio"?e.jsx("audio",{controls:!0,src:W[f.media.objectKey],style:{width:"100%",maxWidth:260}}):null]}):null]}),e.jsx("div",{style:{fontSize:10,color:"#AAAAAA"},children:Sn(f.createdAtMs)}),O?e.jsx("div",{style:{fontSize:10,color:"#6fdcff"},children:typeof f.readAtMs=="number"?"Read":typeof f.deliveredAtMs=="number"?"Delivered":""}):null]},f.messageId)})}),e.jsxs("form",{onSubmit:f=>{f.preventDefault(),J()},"aria-label":"Message input",style:{background:y?"linear-gradient(180deg, rgba(96,0,12,0.96), rgba(58,0,8,0.98))":"#111111",border:y?"none":"2px solid #C00000",borderRadius:y?0:8,padding:12,display:"grid",gridTemplateColumns:"1fr auto auto",gap:12,alignItems:"start",position:U?"fixed":"static",left:U?0:void 0,right:U?0:void 0,bottom:U?"calc(env(safe-area-inset-bottom, 0px) + 66px)":void 0,zIndex:U?45:void 0},children:[e.jsx("label",{style:{display:"grid"},children:e.jsx("input",{value:G,onChange:f=>P(f.target.value),placeholder:"Type a message",disabled:b,style:{width:"100%",background:"#111111",color:"#FFFFFF",border:"2px solid #444444",borderRadius:8,padding:"10px 12px",fontSize:16,lineHeight:1.4,outline:"none"},"aria-label":"Message text"})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{ref:de,type:"file",accept:"image/*,video/*,audio/*",disabled:b,onChange:f=>void fe(f),style:{display:"none"}}),e.jsx("input",{ref:le,type:"file",accept:"image/*",capture:"environment",disabled:b,onChange:f=>void fe(f),style:{display:"none"}}),e.jsx("input",{ref:me,type:"file",accept:"video/*",capture:"environment",disabled:b,onChange:f=>void fe(f),style:{display:"none"}}),e.jsx("button",{type:"button",disabled:b,onClick:()=>X(f=>!f),style:{background:"rgba(0,0,0,0.45)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:8,padding:"8px 10px",display:"grid",placeItems:"center",cursor:b?"not-allowed":"pointer",color:"#3fdfff",fontWeight:700,height:44,minWidth:44},"aria-label":"More actions",children:"+"}),R?e.jsxs("div",{style:{position:"absolute",right:0,top:U?void 0:48,bottom:U?48:void 0,zIndex:5,minWidth:220,display:"grid",gap:8,padding:10,borderRadius:10,border:"1px solid rgba(255,58,77,0.5)",background:"rgba(10,11,16,0.98)"},children:[e.jsx("button",{type:"button",disabled:b,onClick:()=>{var f;X(!1),(f=le.current)==null||f.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Take Photo"}),e.jsx("button",{type:"button",disabled:b,onClick:()=>{var f;X(!1),(f=me.current)==null||f.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Record Video"}),e.jsx("button",{type:"button",disabled:b,onClick:()=>{var f;X(!1),(f=de.current)==null||f.click()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Choose Media"}),e.jsx("button",{type:"button",disabled:b,onClick:()=>{X(!1),ie()},style:{background:k?"#ff2136":"rgba(0,0,0,0.6)",color:"#fff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:k?"Stop Voice":"Record Voice"}),e.jsx("button",{type:"button",disabled:b,onClick:()=>{X(!1),Se()},style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,255,255,0.18)",borderRadius:8,padding:"8px 10px",fontSize:13,fontWeight:700},children:"Send Location"}),I?e.jsxs("div",{style:{display:"grid",gap:8,borderTop:"1px solid rgba(255,255,255,0.1)",paddingTop:8},children:[e.jsxs("select",{value:I.selectedKey,onChange:f=>I.onSelect(f.target.value),disabled:I.disabled||I.candidates.length===0,style:{background:"#0b0d12",color:"#fff",border:"1px solid rgba(255,58,77,0.62)",borderRadius:10,padding:"8px 10px"},"aria-label":"Add previous contact to group",children:[I.candidates.length===0?e.jsx("option",{value:"",children:"No previous contacts"}):null,I.candidates.map(f=>e.jsx("option",{value:f.key,children:f.label},f.key))]}),e.jsx("button",{type:"button",onClick:()=>{I.onAdd(),X(!1)},disabled:I.disabled||I.candidates.length===0||!I.selectedKey,style:{background:"rgba(0,0,0,0.6)",color:"#3fdfff",border:"1px solid rgba(255,58,77,0.62)",borderRadius:10,padding:"8px 10px",fontWeight:700},children:"Add Third User"})]}):null]}):null]}),e.jsx("button",{type:"submit",disabled:b,style:{background:b?"#333333":"#C00000",color:b?"#777777":"#FFFFFF",border:"2px solid #C00000",borderRadius:8,padding:"10px 20px",fontSize:16,fontWeight:600,cursor:b?"not-allowed":"pointer",height:44},"aria-label":"Send message",children:"SEND"})]})]})}const mt="FIRE_SIGNAL|1";function Ee(){return{background:"radial-gradient(500px 220px at 10% 0%, rgba(255,28,46,0.15), transparent 58%), linear-gradient(180deg, rgba(8,8,10,0.88), rgba(4,4,5,0.9))",border:"1px solid rgba(255,56,74,0.56)",borderRadius:20,padding:14,boxShadow:"inset 0 1px 0 rgba(255,255,255,0.06), inset 0 0 0 1px rgba(0,0,0,0.28), 0 16px 32px rgba(0,0,0,0.42)"}}function pe(t){return{background:t?"rgba(90,90,90,0.55)":"linear-gradient(180deg, #ff2136, #c60012)",border:"1px solid rgba(255,70,90,0.68)",color:t?"#999999":"#FFFFFF",padding:"10px 18px",borderRadius:12,fontSize:15,fontWeight:700,letterSpacing:"0.04em",cursor:t?"not-allowed":"pointer",textTransform:"uppercase",boxShadow:t?"none":"inset 0 1px 0 rgba(255,255,255,0.2), 0 10px 22px rgba(198,0,18,0.34)"}}function D(t){return{background:"rgba(0,0,0,0.58)",border:"1px solid rgba(255,58,77,0.62)",color:"#3fdfff",padding:"10px 18px",borderRadius:12,fontSize:15,fontWeight:700,letterSpacing:"0.03em",cursor:t?"not-allowed":"pointer",textTransform:"uppercase",opacity:t?.6:1}}function Z(){return{background:"rgba(6,7,10,0.92)",color:"#ffffff",border:"1px solid rgba(255,64,82,0.48)",borderRadius:12,padding:"10px 12px",fontSize:15}}function kn(t){return typeof t=="string"}function _(t){const n=t;return kn(n==null?void 0:n.message)?n.message:"Action rejected."}function ut(){const t="__disabled__".trim();if(t==="__disabled__")return"";if(t!==""){if(t.startsWith("ws://")||t.startsWith("wss://"))return t;try{const o=new URL(t);return o.protocol=o.protocol==="https:"?"wss:":"ws:",o.toString()}catch{if(t.startsWith("/")){const o=new URL(t,window.location.origin);return o.protocol=o.protocol==="https:"?"wss:":"ws:",o.toString()}}}const n=new URL("/ws",window.location.origin);return n.protocol=n.protocol==="https:"?"wss:":"ws:",n.toString()}const Ht=[Gt,Vt,Yt];function In(t){let n=0;for(let o=0;o<t.length;o+=1)n=n*31+t.charCodeAt(o)|0;return Math.abs(n)}function De(t){return Ht[In(t)%Ht.length]}function yt(t){if(t.startsWith("user:")){const n=t.slice(5).trim();return n.length>0?n:null}if(t.startsWith("session:")){const n=t.slice(8).trim();return n.length>0?`guest:${n}`:null}return null}function Ue(t){if(t.startsWith("guest:")){const n=t.slice(6).trim();return n?`session:${n}`:`user:${t}`}return`user:${t}`}function Ie(t){const n=t.trim();if(!n)return n;if(n.startsWith("user:guest:")){const o=n.slice(11).trim();return o?`session:${o}`:n}if(n.startsWith("guest:")){const o=n.slice(6).trim();return o?`session:${o}`:n}return n}function Cn(t){return t.trim()===mt}function Xt(t){return Cn(t)?"ðŸ”¥ I'm into you":t}function pt(t,n){const o=L=>L*Math.PI/180,c=o(n.lat-t.lat),x=o(n.lng-t.lng),S=Math.sin(c/2),I=Math.sin(x/2),N=S*S+Math.cos(o(t.lat))*Math.cos(o(n.lat))*I*I;return 6371e3*(2*Math.atan2(Math.sqrt(N),Math.sqrt(1-N)))}function Tn(){const[t,n]=s.useState(()=>window.matchMedia("(max-width: 900px)").matches);return s.useEffect(()=>{const o=window.matchMedia("(max-width: 900px)"),u=()=>n(o.matches);return u(),o.addEventListener("change",u),()=>o.removeEventListener("change",u)},[]),t}function qe(t){return t==="instant"?"cruise":"date"}function Mn({api:t,session:n,settings:o,discoverFilter:u,busy:c,setBusy:x,setLastError:S,isMobile:I,onOpenThreadRequested:N,onUnreadCountChange:M}){var Be,Fe,Ye,$e,_e,Xe;const[L,G]=s.useState("map"),[P,C]=s.useState(null),[a,b]=s.useState(null),[T,W]=s.useState(null),[h,k]=s.useState([]),[z,R]=s.useState({}),[X,oe]=s.useState([]),[je,de]=s.useState(new Set),[le,me]=s.useState(new Set),[y,m]=s.useState({}),[U,te]=s.useState({}),[d,J]=s.useState(null),[ve,fe]=s.useState(0),[ie,Se]=s.useState(!1),[f,O]=s.useState([]),[r,v]=s.useState(null),{state:E,lastErrorMessage:ne}=Qt({wsUrl:ut(),sessionToken:n.sessionToken}),he=s.useMemo(()=>Array.from(E.byKey.values()),[E.byKey]),ce=(()=>{try{const g=localStorage.getItem("reddoor_travel_center");if(!g)return null;const p=JSON.parse(g);return p.enabled!==!0?null:typeof p.lat=="number"&&Number.isFinite(p.lat)&&typeof p.lng=="number"&&Number.isFinite(p.lng)?{lat:p.lat,lng:p.lng}:null}catch{return null}})(),ge=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,re=s.useMemo(()=>{const g=new Map;for(const p of h)g.set(p.key,p);for(const p of he){const w=g.get(p.key);(!w||p.updatedAtMs>=w.updatedAtMs)&&g.set(p.key,p)}return Array.from(g.values())},[he,h]),be=s.useMemo(()=>re.filter(g=>g.key!==ge),[ge,re]),V=s.useMemo(()=>T?[...be].sort((g,p)=>pt(T,{lat:g.lat,lng:g.lng})-pt(T,{lat:p.lat,lng:p.lng})):be,[be,T]);s.useEffect(()=>{let g=!1;async function p(){try{const B=await t.listActivePresence(n.sessionToken);if(g)return;const ee=Array.isArray(B.presence)?B.presence:[];k(ee)}catch{g||k([])}}p();const w=window.setInterval(()=>{p()},8e3);return()=>{g=!0,window.clearInterval(w)}},[t,n.sessionToken]),s.useEffect(()=>{P||V.length>0&&C(V[0].key)},[P,V]),s.useEffect(()=>{const g=V.filter(p=>!z[p.key]).map(p=>({key:p.key,profileId:yt(p.key)})).filter(p=>typeof p.profileId=="string");g.length!==0&&Promise.all(g.map(async p=>{var w,B;try{const ee=await t.getPublicProfile(p.profileId);return{key:p.key,displayName:(w=ee.profile)==null?void 0:w.displayName,age:(B=ee.profile)==null?void 0:B.age}}catch{return null}})).then(p=>{R(w=>{const B={...w};for(const ee of p)ee&&(B[ee.key]={displayName:ee.displayName,age:ee.age});return B})})},[t,z,V]),s.useEffect(()=>{(async()=>{try{let g=await t.getPublicProfiles();if(g.profiles.length===0&&!ie){Se(!0);try{const p=T??ce??{lat:o.defaultCenterLat,lng:o.defaultCenterLng};await t.seedFakeUsers(12,p.lat,p.lng),g=await t.getPublicProfiles()}catch{}}oe(g.profiles)}catch{oe([])}if(n.userType==="guest"){de(new Set),me(new Set);return}try{const g=await t.getFavorites(n.sessionToken);de(new Set(g.favorites))}catch{de(new Set)}try{const g=await t.listBlocked(n.sessionToken);me(new Set(g.blocked))}catch{me(new Set)}})()},[t,ie,T,n.sessionToken,n.userType,o.defaultCenterLat,o.defaultCenterLng,ce]),s.useEffect(()=>{let g=!1;async function p(){try{const B=await t.listCruisingSpots();g||O(B.spots)}catch{g||O([])}}p();const w=window.setInterval(()=>{p()},12e3);return()=>{g=!0,window.clearInterval(w)}},[t]),s.useEffect(()=>{const g=Date.now(),p=X.flatMap(w=>{const B=[];return w.mainPhotoMediaId&&B.push(w.mainPhotoMediaId),Array.isArray(w.galleryMediaIds)&&B.push(...w.galleryMediaIds),w.videoMediaId&&B.push(w.videoMediaId),B}).filter(w=>typeof w=="string"&&w.length>0&&!y[w]&&g>=(U[w]??0)).slice(0,6);p.length!==0&&Promise.all(p.map(async w=>{try{const B=await t.getPublicMediaUrl(w);return{mediaId:w,url:B.downloadUrl}}catch{return null}})).then(w=>{m(B=>{const ee={...B};for(const se of w)se&&(ee[se.mediaId]=se.url);return ee}),te(B=>{const ee={...B};for(let se=0;se<p.length;se+=1){const ye=p[se];w[se]?ee[ye]&&delete ee[ye]:ee[ye]=Date.now()+3e4}return ee})})},[t,U,y,X]);async function Ce(g){b(g),fe(0);const p=yt(g);if(!p){J(null);return}try{if(g===ge){const w=await t.getMyProfile(n.sessionToken);typeof w.profile.mainPhotoMediaId=="string"&&w.profile.mainPhotoMediaId;const B=[w.profile.mainPhotoMediaId,...w.profile.galleryMediaIds??[],w.profile.videoMediaId].filter(ee=>typeof ee=="string"&&ee.length>0);if(B.length>0){const ee=await Promise.all(B.map(async se=>{try{const ye=await t.getPublicMediaUrl(se);return{mediaId:se,downloadUrl:ye.downloadUrl}}catch{return null}}));m(se=>{const ye={...se};for(const ke of ee)ke&&(ye[ke.mediaId]=ke.downloadUrl);return ye})}J({userId:w.profile.userId,displayName:w.profile.displayName,age:w.profile.age,bio:w.profile.bio,stats:w.profile.stats,discreetMode:w.profile.discreetMode,mainPhotoMediaId:w.profile.mainPhotoMediaId,galleryMediaIds:w.profile.galleryMediaIds,videoMediaId:w.profile.videoMediaId})}else{const w=await t.getPublicProfile(p),B=[w.profile.mainPhotoMediaId,...w.profile.galleryMediaIds??[],w.profile.videoMediaId].filter(ee=>typeof ee=="string"&&ee.length>0);if(B.length>0){const ee=await Promise.all(B.map(async se=>{try{const ye=await t.getPublicMediaUrl(se);return{mediaId:se,downloadUrl:ye.downloadUrl}}catch{return null}}));m(se=>{const ye={...se};for(const ke of ee)ke&&(ye[ke.mediaId]=ke.downloadUrl);return ye})}J(w.profile)}}catch(w){const B=w;if((B==null?void 0:B.code)==="PROFILE_HIDDEN"){b(null),J(null);return}J(null),S(_(w))}}async function Pe(g){if(n.userType==="guest"){S("Guests cannot star users. Register to save favorites.");return}if(!(!n.userId||n.userId===g))try{const p=await t.toggleFavorite(n.sessionToken,g);de(new Set(p.favorites))}catch(p){S(_(p))}}async function Re(g){const p=Ie(g);if(!(!p||p===ge))try{await t.sendChat(n.sessionToken,"cruise",p,mt)}catch(w){S(_(w))}}async function Le(g){if(!(!g.trim()||g===ge)){if(n.userType==="guest"){S("Anonymous users cannot block users.");return}try{le.has(g)?await t.unblock(n.sessionToken,g):await t.block(n.sessionToken,g);const p=await t.listBlocked(n.sessionToken);me(new Set(p.blocked))}catch(p){S(_(p))}}}async function Oe(){const g=ce??{lat:o.defaultCenterLat,lng:o.defaultCenterLng};if(!navigator.geolocation){W(g);try{await t.updatePresence(n.sessionToken,g.lat,g.lng,"online")}catch{}return}try{const p=await new Promise((w,B)=>{navigator.geolocation.getCurrentPosition(w,B,{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e4})});W({lat:p.coords.latitude,lng:p.coords.longitude}),await t.updatePresence(n.sessionToken,p.coords.latitude,p.coords.longitude,"online")}catch(p){W(g);try{await t.updatePresence(n.sessionToken,g.lat,g.lng,"online")}catch{const w=p&&typeof p=="object"&&"message"in p&&typeof p.message=="string"?p.message:null;S(w??_(p))}}}s.useEffect(()=>{Oe();const g=window.setInterval(()=>{Oe()},3e4);return()=>window.clearInterval(g)},[n.sessionToken]),s.useEffect(()=>{const g=p=>{var se,ye;const w=p,B=(se=w.detail)==null?void 0:se.lat,ee=(ye=w.detail)==null?void 0:ye.lng;!Number.isFinite(B)||!Number.isFinite(ee)||(W({lat:B,lng:ee}),t.updatePresence(n.sessionToken,B,ee,"online").catch(()=>{}))};return window.addEventListener("rd:location-updated",g),()=>window.removeEventListener("rd:location-updated",g)},[t,n.sessionToken]);const Q=s.useMemo(()=>{if(re.some(B=>B.key===ge))return re;const p=T??ce??{lat:o.defaultCenterLat,lng:o.defaultCenterLng};return[{key:ge,userType:n.userType,lat:p.lat,lng:p.lng,status:"online",updatedAtMs:Date.now()},...re]},[ge,re,T,n.userType,o.defaultCenterLat,o.defaultCenterLng,ce]),we=s.useMemo(()=>{const g={};for(const p of X){if(!p.mainPhotoMediaId)continue;const w=y[p.mainPhotoMediaId];w&&(g[Ue(p.userId)]=w)}return g},[y,X]),Ae=s.useMemo(()=>f.map(g=>({id:`spot:${g.spotId}`,position:{lat:g.lat,lng:g.lng},color:"#26d5ff",markerType:"spot",markerGlyph:"CS",label:`${g.name} | check-ins: ${g.checkInCount??0} | action: ${g.actionCount??0}`,onClick:()=>v(g.spotId)})),[f]),Te=e.jsx(Dt,{wsUrl:ut(),sessionToken:n.sessionToken,presenceUpdates:Q,realtimeErrorMessage:ne,onMarkerSelect:g=>void Ce(g),avatarByKey:we,additionalMarkers:Ae,defaultCenter:ce??{lat:o.defaultCenterLat,lng:o.defaultCenterLng},height:I?"calc(100vh - 340px)":600,visible:!0}),xe=e.jsxs("div",{style:{background:"#000",marginInline:-10},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,padding:"8px 10px",borderBottom:"1px solid rgba(255,58,77,0.25)"},children:[e.jsx("button",{type:"button",style:D(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"reset"}}))},children:"GUYS"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"toggle_favorites"}}))},"aria-label":"Toggle favorites only",children:"â˜…"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>{window.dispatchEvent(new CustomEvent("rd:discover-control",{detail:{action:"open_filters"}})),G("chat")},children:"FILTER"})]}),e.jsx(Dt,{wsUrl:ut(),sessionToken:n.sessionToken,presenceUpdates:Q,realtimeErrorMessage:ne,onMarkerSelect:g=>void Ce(g),avatarByKey:we,additionalMarkers:Ae,defaultCenter:ce??{lat:o.defaultCenterLat,lng:o.defaultCenterLng},height:"calc(100dvh - 220px)",visible:L==="map"})]}),Ke=e.jsx(Rn,{api:t,session:n,busy:c,setBusy:x,setLastError:S,onlinePeers:V,selectedPeerKey:P,setSelectedPeerKey:C,onOpenProfile:g=>void Ce(g),isMobile:I,selfCoords:T,peerProfileByKey:z,discoverFilter:u,publicProfiles:X,favorites:je,mediaUrlById:y,onUnreadCountChange:M});return e.jsxs("div",{style:{display:"grid",gap:8},children:[I?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:L==="map"?"block":"none"},children:xe}),e.jsx("div",{style:{display:L==="chat"?"block":"none"},children:Ke}),e.jsx("div",{style:{position:"fixed",left:10,right:10,bottom:"calc(env(safe-area-inset-bottom, 0px) + 66px)",zIndex:41,padding:8,background:"rgba(0,0,0,0.35)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("button",{type:"button",style:L==="map"?pe(!1):D(!1),onClick:()=>G("map"),children:"MAP"}),e.jsx("button",{type:"button",style:L==="chat"?pe(!1):D(!1),onClick:()=>G("chat"),children:"CHAT"})]})})]}):e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1.2fr 1fr",gap:12,alignItems:"start"},children:[Te,Ke]}),a?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:80,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:I?"stretch":"center",padding:I?0:14},role:"dialog","aria-modal":"true","aria-label":"User profile",onClick:()=>b(null),children:e.jsx("div",{onClick:g=>g.stopPropagation(),style:I?{width:"100%",height:"100dvh",overflow:"auto",background:"linear-gradient(180deg, rgba(7,8,10,0.98), rgba(2,2,4,0.98))",borderRadius:0,border:"none",padding:"calc(env(safe-area-inset-top, 0px) + 56px) 12px calc(env(safe-area-inset-bottom, 0px) + 20px)"}:{...Ee(),width:"min(680px, 100%)",maxHeight:"86vh",overflow:"auto"},children:e.jsxs("div",{style:{display:"grid",gap:14},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"106px 1fr auto",gap:12,alignItems:"center"},children:[e.jsxs("div",{style:{position:"relative",width:106,height:106},children:[e.jsx("img",{src:d!=null&&d.mainPhotoMediaId&&y[d.mainPhotoMediaId]?y[d.mainPhotoMediaId]:De(a),alt:"Profile avatar",style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"cover",border:"2px solid #ff3047"}}),e.jsx("span",{style:{position:"absolute",right:4,bottom:4,width:14,height:14,borderRadius:"50%",background:"#26d5ff",border:"2px solid #000"}})]}),e.jsxs("div",{style:{display:"grid",gap:6},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:(d==null?void 0:d.displayName)??a}),e.jsx("div",{style:{color:"#26d5ff",fontSize:14},children:"Instant Messaging Available"})]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[d&&d.userId!==(n.userId??"")?e.jsx("button",{type:"button",style:{...D(!1),color:"#26d5ff",borderColor:"rgba(38,213,255,0.62)",minWidth:126},onClick:()=>void Pe(d.userId),children:je.has(d.userId)?"â˜… STARRED":"â˜† STAR"}):null,d&&d.userId!==(n.userId??"")?e.jsx("button",{type:"button",style:{...D(!1),color:"#ffb347",borderColor:"rgba(255,179,71,0.65)",minWidth:126},onClick:()=>void Re(Ue(d.userId)),children:"ðŸ”¥ FIRE"}):null,d&&d.userId!==(n.userId??"")?e.jsx("button",{type:"button",style:{...D(!1),color:le.has(Ue(d.userId))?"#ff9aa3":"#ffd4d8",borderColor:"rgba(255,120,130,0.62)",minWidth:126},onClick:()=>void Le(Ue(d.userId)),children:le.has(Ue(d.userId))?"UNBLOCK":"BLOCK"}):null,e.jsx("button",{type:"button",style:D(!1),onClick:()=>b(null),children:"CLOSE"})]})]}),e.jsxs("div",{style:{color:"#ced3dc",fontSize:14,lineHeight:1.5},children:[e.jsxs("div",{children:["Age: ",(d==null?void 0:d.age)??"-"]}),e.jsxs("div",{children:["Race: ",((Be=d==null?void 0:d.stats)==null?void 0:Be.race)??"-"]}),e.jsxs("div",{children:["Height: ",((Fe=d==null?void 0:d.stats)==null?void 0:Fe.heightInches)??"-"]}),e.jsxs("div",{children:["Weight: ",((Ye=d==null?void 0:d.stats)==null?void 0:Ye.weightLbs)??"-"]}),e.jsxs("div",{children:["Cock Size: ",(($e=d==null?void 0:d.stats)==null?void 0:$e.cockSizeInches)??"-"]}),e.jsxs("div",{children:["Cut / Uncut: ",((_e=d==null?void 0:d.stats)==null?void 0:_e.cutStatus)??"-"]}),e.jsxs("div",{children:["Position: ",((Xe=d==null?void 0:d.stats)==null?void 0:Xe.position)??"-"]}),e.jsxs("div",{style:{marginTop:8},children:["Bio: ",(d==null?void 0:d.bio)??"-"]})]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"MEDIA"}),d?e.jsx(e.Fragment,{children:(()=>{const g=[d.mainPhotoMediaId,...d.galleryMediaIds??[],d.videoMediaId].filter(se=>typeof se=="string"&&se.length>0);if(g.length===0)return e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No uploaded media."});const p=Math.max(0,Math.min(ve,g.length-1)),w=g[p],B=y[w],ee=w===d.videoMediaId;return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.4)",borderRadius:12,padding:8},children:ee?e.jsx("video",{controls:!0,playsInline:!0,src:B,style:{width:"100%",maxHeight:260,borderRadius:10,background:"#000"}}):e.jsx("img",{src:B??De(a??d.userId),alt:"Profile media",style:{width:"100%",maxHeight:260,objectFit:"cover",borderRadius:10}})}),e.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:g.map((se,ye)=>{const ke=y[se],Je=se===d.videoMediaId;return e.jsx("button",{type:"button",onClick:()=>fe(ye),style:{width:64,height:64,padding:0,borderRadius:8,overflow:"hidden",border:ye===p?"2px solid #26d5ff":"1px solid rgba(255,58,77,0.4)",background:"#000",cursor:"pointer",color:"#fff",fontSize:10},"aria-label":Je?"Open video":"Open photo",children:Je?e.jsx("div",{style:{display:"grid",placeItems:"center",width:"100%",height:"100%"},children:ke?e.jsx("video",{src:ke,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}):"VIDEO"}):e.jsx("img",{src:ke??De(a??d.userId),alt:"Media thumbnail",style:{width:"100%",height:"100%",objectFit:"cover"}})},se)})})]})})()}):null]}),e.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:e.jsx("button",{type:"button",style:pe(!1),onClick:()=>{a&&N(a),b(null),fe(0)},children:"CHAT"})})]})})}):null,r?e.jsx(An,{api:t,session:n,spot:f.find(g=>g.spotId===r)??null,onClose:()=>v(null),onUpdated:async()=>{try{const g=await t.listCruisingSpots();O(g.spots)}catch{}},setLastError:S}):null]})}function An({api:t,session:n,spot:o,onClose:u,onUpdated:c,setLastError:x}){return o?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},role:"dialog","aria-modal":"true","aria-label":"Cruising spot",onClick:u,children:e.jsxs("div",{onClick:S=>S.stopPropagation(),style:{...Ee(),width:"min(520px, 100%)",display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:o.name}),e.jsx("div",{style:{color:"#9fb6bf",fontSize:13},children:o.address}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap"},children:o.description}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:13},children:["Check-ins: ",o.checkInCount??0," | I got action there: ",o.actionCount??0]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:pe(!1),onClick:async()=>{try{await t.checkInCruisingSpot(n.sessionToken,o.spotId),await c()}catch(S){x(_(S))}},children:"CHECK IN"}),e.jsx("button",{type:"button",style:D(!1),onClick:async()=>{try{await t.markCruisingSpotAction(n.sessionToken,o.spotId),await c()}catch(S){x(_(S))}},children:"I GOT ACTION THERE"}),e.jsx("button",{type:"button",style:D(!1),onClick:u,children:"CLOSE"})]})]})}):null}function Rn({api:t,session:n,busy:o,setBusy:u,setLastError:c,onlinePeers:x,selectedPeerKey:S,setSelectedPeerKey:I,onOpenProfile:N,openThreadRequest:M,onThreadRequestConsumed:L,isMobile:G,selfCoords:P,peerProfileByKey:C,discoverFilter:a,publicProfiles:b,favorites:T,mediaUrlById:W,onUnreadCountChange:h}){var zt;const[k,z]=s.useState({}),[R,X]=s.useState({}),[oe,je]=s.useState("instant"),[de,le]=s.useState("grid"),[me,y]=s.useState(null),[m,U]=s.useState(""),[te,d]=s.useState(null),[J,ve]=s.useState([]),[fe,ie]=s.useState({}),[Se,f]=s.useState(null),[O,r]=s.useState({}),[v,E]=s.useState({}),[ne,he]=s.useState(!1),[ce,ge]=s.useState(""),[re,be]=s.useState(null),V=s.useRef(!1),Ce=s.useRef(!1),Pe=s.useRef(0),Re=s.useRef(null),Le=s.useRef(null),Oe=s.useRef(null),Q=s.useRef(null),we=s.useRef(null),Ae=s.useRef(0),Te=s.useRef(new Set),xe=s.useRef(null),Ke=s.useRef(null),Be=s.useRef(null),[Fe,Ye]=s.useState(null),[$e,_e]=s.useState(a==="favorites"),[Xe,g]=s.useState(!1),[p,w]=s.useState(a==="online"?"online":"all"),[B,ee]=s.useState(!1),[se,ye]=s.useState(""),[ke,Je]=s.useState(""),[Ze,bt]=s.useState(""),[et,vt]=s.useState(""),[tt,xt]=s.useState(""),[nt,jt]=s.useState(""),[st,St]=s.useState(""),[it,wt]=s.useState(""),[rt,kt]=s.useState(""),[at,It]=s.useState(""),[ot,Ct]=s.useState(""),Me=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,ae=me??S??"",Zt=ae?k[ae]??[]:[],Tt=s.useMemo(()=>new Map(x.map(i=>[i.key,i])),[x]),ze=s.useMemo(()=>{const i={};for(const l of b)typeof l.displayName=="string"&&l.displayName.trim()&&(i[Ue(l.userId)]=l.displayName);for(const[l,j]of Object.entries(C))typeof j.displayName=="string"&&j.displayName.trim()&&(i[l]=j.displayName);return i},[C,b]),Mt=s.useMemo(()=>b.filter(i=>i.userId!==(n.userId??"")).map(i=>{const l=Ue(i.userId),j=Tt.get(l);return{key:l,userId:i.userId,displayName:i.displayName,age:i.age,stats:i.stats,meters:j&&P?Math.round(pt(P,{lat:j.lat,lng:j.lng})):null,isOnline:!!j,hasPicture:typeof i.mainPhotoMediaId=="string"&&i.mainPhotoMediaId.trim().length>0,avatarUrl:i.mainPhotoMediaId?W[i.mainPhotoMediaId]:void 0}}),[W,Tt,b,P,n.userId]),Ge=s.useMemo(()=>{const i=se.trim()?Number(se):void 0,l=ke.trim()?Number(ke):void 0,j=et.trim()?Number(et):void 0,A=tt.trim()?Number(tt):void 0,F=nt.trim()?Number(nt):void 0,$=st.trim()?Number(st):void 0,Y=it.trim()?Number(it):void 0,H=rt.trim()?Number(rt):void 0;return Mt.filter(K=>{var ue,Ne,He,ct,We,Ut,Ot,Kt,Lt;if($e&&!T.has(K.userId)||p==="online"&&!K.isOnline||p==="offline"&&K.isOnline||B&&!K.hasPicture||Number.isFinite(i)&&(typeof K.age!="number"||K.age<i)||Number.isFinite(l)&&(typeof K.age!="number"||K.age>l))return!1;const q=typeof((ue=K.stats)==null?void 0:ue.race)=="string"?K.stats.race:"";return!(Ze.trim()&&q.toLowerCase()!==Ze.trim().toLowerCase()||Number.isFinite(j)&&(typeof((Ne=K.stats)==null?void 0:Ne.heightInches)!="number"||K.stats.heightInches<j)||Number.isFinite(A)&&(typeof((He=K.stats)==null?void 0:He.heightInches)!="number"||K.stats.heightInches>A)||Number.isFinite(F)&&(typeof((ct=K.stats)==null?void 0:ct.weightLbs)!="number"||K.stats.weightLbs<F)||Number.isFinite($)&&(typeof((We=K.stats)==null?void 0:We.weightLbs)!="number"||K.stats.weightLbs>$)||Number.isFinite(Y)&&(typeof((Ut=K.stats)==null?void 0:Ut.cockSizeInches)!="number"||K.stats.cockSizeInches<Y)||Number.isFinite(H)&&(typeof((Ot=K.stats)==null?void 0:Ot.cockSizeInches)!="number"||K.stats.cockSizeInches>H)||at&&((Kt=K.stats)==null?void 0:Kt.cutStatus)!==at||ot&&((Lt=K.stats)==null?void 0:Lt.position)!==ot)})},[Mt,T,$e,at,ke,rt,tt,st,se,it,et,nt,ot,Ze,B,p]),lt=s.useMemo(()=>Array.from(new Set(Ge.map(i=>i.key).filter(i=>i.trim().length>0))).slice(0,8),[Ge]),At=lt.join("|"),dt=s.useMemo(()=>{const i=new Set(Object.keys(R));return ae.trim()&&i.add(ae),Array.from(i).sort((l,j)=>{var A,F;return(((A=R[j])==null?void 0:A.lastAt)??0)-(((F=R[l])==null?void 0:F.lastAt)??0)})},[R,ae]),Rt=s.useMemo(()=>Object.values(O).reduce((i,l)=>i+(Number.isFinite(l)?l:0),0),[O]);s.useMemo(()=>{var i;return ae?ze[ae]??((i=C[ae])==null?void 0:i.displayName)??ae:""},[ze,ae,C]);const en=s.useMemo(()=>{if(!ae)return;const i=Ge.find(l=>l.key===ae);return i==null?void 0:i.avatarUrl},[Ge,ae]),Ve=s.useMemo(()=>dt.filter(i=>i!==ae&&i!==Me&&!!R[i]).map(i=>{var l;return{key:i,label:ze[i]??((l=C[i])==null?void 0:l.displayName)??i}}),[dt,R,ze,Me,ae,C]);s.useEffect(()=>{typeof h=="function"&&h(Rt)},[h,Rt]),s.useEffect(()=>{const i=Re.current;i&&(i.srcObject=re)},[re]),s.useEffect(()=>{const i=Le.current;i&&(i.srcObject=Fe)},[Fe]),s.useEffect(()=>()=>{if(re){for(const i of re.getTracks())i.stop();if(Fe)for(const i of Fe.getTracks())i.stop();xe.current&&(xe.current.close(),xe.current=null)}},[re,Fe]),s.useEffect(()=>{if(Ve.length===0){U("");return}U(i=>i&&Ve.some(l=>l.key===i)?i:Ve[0].key)},[Ve]);const tn=s.useMemo(()=>({async sendMessage(i,l,j,A){const F=Ie(l),$=await t.sendChat(n.sessionToken,i,F,j,A),Y=$==null?void 0:$.message,H=[Y];if(i==="cruise"&&te)try{const K=await t.sendChat(n.sessionToken,i,Ie(te),j,A),q=K==null?void 0:K.message;H.push(q)}catch(K){c(_(K))}for(const K of H)Nt(K);return Y},async initiateMediaUpload(i,l){const j=await t.initiateChatMediaUpload(n.sessionToken,{mimeType:i,sizeBytes:l});return{objectKey:j.objectKey,uploadUrl:j.uploadUrl}},async uploadToSignedUrl(i,l,j){if(await ht(i,l,j))return;if(!(await fetch(i,{method:"PUT",headers:{"content-type":j},body:l})).ok)throw{code:"MEDIA_UPLOAD_INCOMPLETE",message:"Upload failed."}},async getMediaUrl(i){return(await t.getChatMediaUrl(n.sessionToken,i)).downloadUrl}}),[t,Me,n.sessionToken,c,te]);function Qe(i){var l,j,A;return i.text&&i.text.trim()?Xt(i.text):((l=i.media)==null?void 0:l.kind)==="image"?"[Photo]":((j=i.media)==null?void 0:j.kind)==="video"?"[Video]":((A=i.media)==null?void 0:A.kind)==="audio"?"[Voice]":""}function nn(i){if(!i||Te.current.has(i))return!1;if(Te.current.add(i),Te.current.size>5e3){const l=Array.from(Te.current).slice(-2500);Te.current=new Set(l)}return!0}function sn(i,l){var F;const j=ze[l]??((F=C[l])==null?void 0:F.displayName)??l,A=Qe(i)||"New activity";if("Notification"in window){if(Notification.permission==="granted"){try{new Notification(`${j}`,{body:A})}catch{}return}Notification.permission==="default"&&Notification.requestPermission()}}function rn(i){if(!i.startsWith("GROUP_INVITE_REQUEST|"))return null;const[,l,j,A]=i.split("|");return!l||!j||!A?null:{inviteId:l,inviterKey:j,primaryPeerKey:A}}function an(i){if(!i.startsWith("GROUP_INVITE_ACCEPT|"))return null;const[,l,j]=i.split("|");return!l||!j?null:{inviteId:l,candidateKey:j}}function Nt(i){if(!nn(i.messageId))return;const l=i.fromKey===Me?i.toKey:i.fromKey;z(F=>{const $=F[l]??[];return $.some(Y=>Y.messageId===i.messageId)?F:{...F,[l]:[...$,i].sort((Y,H)=>Y.createdAtMs-H.createdAtMs)}}),X(F=>({...F,[l]:{lastAt:i.createdAtMs,lastText:Qe(i)}})),i.fromKey!==Me&&(de==="thread"&&Ie(ae)===Ie(l)?(E($=>({...$,[l]:Math.max($[l]??0,i.createdAtMs)})),r($=>{const Y={...$};return delete Y[l],Y})):r($=>({...$,[l]:($[l]??0)+1})),sn(i,l));const j=rn(i.text??"");j&&i.toKey===Me&&ve(F=>F.some($=>$.inviteId===j.inviteId)?F:[...F,{...j,createdAtMs:i.createdAtMs}]);const A=an(i.text??"");A&&i.toKey===Me&&fe[A.inviteId]&&(d(Ie(A.candidateKey)),f(`Invite accepted by ${ze[A.candidateKey]??A.candidateKey}.`),ie($=>{const Y={...$};return delete Y[A.inviteId],Y}))}async function on(i){const l=Ie(i);if(l)try{const j=await t.listChat(n.sessionToken,qe(oe),l),A=j==null?void 0:j.messages,F=Array.isArray(A)?A:[];t.markChatRead(n.sessionToken,qe(oe),l).catch(()=>{}),z(H=>({...H,[l]:F}));const $=F.length>0?F[F.length-1]:null;$&&X(H=>({...H,[l]:{lastAt:$.createdAtMs,lastText:Qe($)}}));let Y=0;for(const H of F)H.fromKey===l&&H.createdAtMs>Y&&(Y=H.createdAtMs);Y>0&&E(H=>({...H,[l]:Math.max(H[l]??0,Y)}))}catch(j){c(_(j))}}s.useEffect(()=>{if(de!=="thread"||!ae.trim())return;let i=!1,l=!1,j=null;const A=async()=>{if(!(i||l)){l=!0;try{await on(ae)}finally{l=!1}i||(j=window.setTimeout(()=>{A()},1200))}};return A(),()=>{i=!0,j!==null&&window.clearTimeout(j)}},[oe,ae,de]),s.useEffect(()=>{if(de!=="grid")return;if(lt.length===0){r({});return}let i=!1;async function l(){if(!V.current&&!document.hidden){V.current=!0;try{const F=qe(oe),$=[],Y=[];for(const K of lt){if(i)break;try{const q=Ie(K);if(!q)continue;const ue=await t.listChat(n.sessionToken,F,q),Ne=(ue==null?void 0:ue.messages)??[];if(Ne.length>0){const We=Ne[Ne.length-1];Y.push([q,{lastAt:We.createdAtMs,lastText:Qe(We)}])}let He=0;const ct=v[q]??0;for(const We of Ne)We.fromKey===q&&We.createdAtMs>ct&&(He+=1);$.push([q,He])}catch{const q=Ie(K);q&&$.push([q,0])}}if(i)return;Y.length>0&&X(K=>{const q={...K};for(const[ue,Ne]of Y)q[ue]=Ne;return q});const H={};for(const[K,q]of $)q>0&&(H[K]=q);r(H)}finally{V.current=!1}}}const j=window.setTimeout(()=>{l()},1200),A=window.setInterval(()=>{l()},15e3);return()=>{i=!0,V.current=!1,window.clearTimeout(j),window.clearInterval(A)}},[t,oe,v,n.sessionToken,At,de]),s.useEffect(()=>{const i=Array.from(new Set([...dt,...lt,ae].map($=>Ie($)).filter($=>$.length>0))).slice(0,10);if(i.length===0)return;let l=!1;const j=async()=>{if(!(l||document.hidden||Ce.current)){Ce.current=!0;try{const $=qe(oe),Y=[];for(const H of i){if(l)break;try{const K=await t.listChat(n.sessionToken,$,H),q=(K==null?void 0:K.messages)??[];if(q.length===0)continue;const ue=q[q.length-1];Y.push([H,{lastAt:ue.createdAtMs,lastText:Qe(ue)}])}catch{}}if(l||Y.length===0)return;X(H=>{const K={...H};for(const[q,ue]of Y)K[q]=ue;return K})}finally{Ce.current=!1}}},A=window.setTimeout(()=>{j()},1e3),F=window.setInterval(()=>{j()},5e3);return()=>{l=!0,window.clearTimeout(A),window.clearInterval(F)}},[t,oe,dt,ae,n.sessionToken,At]);async function ln(){if(re)return re;if(!navigator.mediaDevices||typeof navigator.mediaDevices.getUserMedia!="function")throw{code:"UNAUTHORIZED_ACTION",message:"Camera access is not available in this browser."};const i=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});return be(i),i}function dn(i,l){xe.current&&(xe.current.close(),xe.current=null);const j=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});return xe.current=j,Ke.current=l,Be.current=i,j.ontrack=A=>{const F=A.streams[0];F&&Ye(F)},j.onicecandidate=A=>{const F=A.candidate;if(!F)return;const $=Be.current,Y=Ke.current;!$||!Y||t.sendCallSignal(n.sessionToken,{toKey:$,callId:Y,signalType:"ice",candidate:JSON.stringify(F.toJSON())}).catch(()=>{})},j}async function Pt(i=!0){const l=Be.current,j=Ke.current;if(i&&l&&j)try{await t.sendCallSignal(n.sessionToken,{toKey:l,callId:j,signalType:"hangup"})}catch{}if(re)for(const A of re.getTracks())A.stop();if(Fe)for(const A of Fe.getTracks())A.stop();be(null),Ye(null),xe.current&&(xe.current.close(),xe.current=null),Ke.current=null,Be.current=null,he(!1)}s.useEffect(()=>{let i=!1;const l=ut();if(!l)return;const j=()=>{Q.current!==null&&(window.clearInterval(Q.current),Q.current=null),we.current!==null&&(window.clearTimeout(we.current),we.current=null)},A=()=>{if(i)return;const F=new WebSocket(l);Oe.current=F,F.onopen=()=>{Ae.current=0,F.send(JSON.stringify({type:"auth",payload:{sessionToken:n.sessionToken}})),Q.current=window.setInterval(()=>{F.readyState===F.OPEN&&F.send(JSON.stringify({type:"heartbeat",payload:{}}))},15e3)},F.onmessage=$=>{let Y=null;try{Y=JSON.parse(String($.data))}catch{return}if(!Y||typeof Y.type!="string")return;if(Y.type==="chat_message"){const q=Y.payload,ue=q==null?void 0:q.message;if(!ue||ue.fromKey!==Me&&ue.toKey!==Me)return;Nt(ue);return}if(Y.type!=="call_signal")return;const H=Y.payload;if(!H||H.toKey!==Me||typeof H.fromKey!="string"||!H.callId||!H.signalType)return;const K=Ie(H.fromKey);if(H.signalType==="hangup"){Pt(!1);return}if(H.signalType==="offer"){(async()=>{try{ft(K),ge(K);const q=await ln(),ue=dn(K,H.callId);for(const He of q.getTracks())ue.addTrack(He,q);await ue.setRemoteDescription({type:"offer",sdp:H.sdp??""});const Ne=await ue.createAnswer();await ue.setLocalDescription(Ne),await t.sendCallSignal(n.sessionToken,{toKey:K,callId:H.callId,signalType:"answer",sdp:Ne.sdp??""}),he(!0)}catch(q){c(_(q))}})();return}if(H.signalType==="answer"){(async()=>{try{if(!xe.current||Ke.current!==H.callId)return;await xe.current.setRemoteDescription({type:"answer",sdp:H.sdp??""})}catch(q){c(_(q))}})();return}H.signalType==="ice"&&(async()=>{try{if(!xe.current||Ke.current!==H.callId||!H.candidate)return;const q=JSON.parse(H.candidate);await xe.current.addIceCandidate(q)}catch{}})()},F.onclose=()=>{if(j(),i)return;Ae.current+=1;const $=Math.min(8e3,500*2**Math.min(Ae.current,4));we.current=window.setTimeout(A,$)},F.onerror=()=>{}};return A(),()=>{var F;i=!0,j(),(F=Oe.current)==null||F.close(1e3,"chat cleanup"),Oe.current=null}},[t,Me,n.sessionToken]);async function cn(){if(m.trim()){if(!ae.trim()){c("Select a user first.");return}try{const i=Ie(m);if(!i)return;if(!Ve.some(j=>j.key===i)){c("You can only add a third user you have previously messaged.");return}const l=crypto.randomUUID();await t.sendChat(n.sessionToken,"cruise",i,`GROUP_INVITE_REQUEST|${l}|${Me}|${ae.trim()}`),ie(j=>({...j,[l]:{candidateKey:i,primaryPeerKey:ae.trim()}})),f(`Invite sent to ${ze[i]??i}. Waiting for acceptance.`)}catch(i){c(_(i))}}}async function Et(i,l,j){try{await t.sendChat(n.sessionToken,"cruise",l,`GROUP_INVITE_ACCEPT|${i}|${Me}`),ve(A=>A.filter(F=>F.inviteId!==i)),f("Group invite accepted."),ft(j)}catch(A){c(_(A))}}function Ft(i){ve(l=>l.filter(j=>j.inviteId!==i))}function ft(i){const l=Ie(i);I(l),y(l),r(j=>{const A={...j};return delete A[l],A}),E(j=>({...j,[l]:Date.now()})),le("thread")}function gt(){_e(!1),w("all"),ee(!1),ye(""),Je(""),bt(""),vt(""),xt(""),jt(""),St(""),wt(""),kt(""),It(""),Ct(""),g(!1)}if(s.useEffect(()=>{const i=l=>{var F;const A=(F=l.detail)==null?void 0:F.action;if(A==="reset"){gt(),le("grid");return}if(A==="toggle_favorites"){_e($=>!$),le("grid");return}A==="open_filters"&&(g(!0),le("grid"))};return window.addEventListener("rd:discover-control",i),()=>window.removeEventListener("rd:discover-control",i)},[]),s.useEffect(()=>{M&&M.nonce!==Pe.current&&(Pe.current=M.nonce,ft(M.key),typeof L=="function"&&L())},[L,M]),s.useEffect(()=>{const i=l=>{var A;((A=l.detail)==null?void 0:A.tab)==="discover"&&(le("grid"),y(null),g(!1))};return window.addEventListener("rd:tab-select",i),()=>window.removeEventListener("rd:tab-select",i)},[]),de==="thread"&&ae.trim()){const i=ze[ae]??((zt=C[ae])==null?void 0:zt.displayName)??ae;return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:G?-10:0},children:[J.length>0?e.jsxs("div",{style:{...Ee(),display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"INVITE REQUESTS"}),J.map(l=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,alignItems:"center"},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:13},children:[ze[l.inviterKey]??l.inviterKey," invited you to join a conversation."]}),e.jsx("button",{type:"button",style:pe(!1),onClick:()=>void Et(l.inviteId,l.inviterKey,l.primaryPeerKey),children:"ACCEPT"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>Ft(l.inviteId),children:"DECLINE"})]},l.inviteId))]}):null,Se?e.jsx("div",{style:{color:"#26d5ff",fontSize:12},children:Se}):null,e.jsx(qt,{chatKind:qe(oe),peerKey:ae,currentUserKey:Me,messages:Zt,client:tn,title:`INSTANT THREAD: ${i}`,peerSummary:{displayName:i,avatarUrl:en},thirdParty:{candidates:Ve,selectedKey:m,onSelect:l=>U(l),onAdd:()=>void cn(),disabled:o},showHeader:!1,edgeToEdge:G,fillHeight:G}),ne?e.jsx("div",{role:"dialog","aria-modal":"true","aria-label":"Video call",style:{position:"fixed",inset:0,zIndex:60,background:"rgba(0,0,0,0.82)",display:"grid",placeItems:"center",padding:16},children:e.jsxs("div",{style:{...Ee(),width:"min(720px, 100%)",display:"grid",gap:10},children:[e.jsxs("div",{style:{fontSize:18,fontWeight:700},children:["VIDEO CALL: ",ce]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("video",{ref:Re,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"100%",maxHeight:"52vh",borderRadius:12,background:"#000"}}),e.jsx("video",{ref:Le,autoPlay:!0,playsInline:!0,style:{width:"100%",maxHeight:"52vh",borderRadius:12,background:"#000"}})]}),e.jsx("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:e.jsx("button",{type:"button",style:D(!1),onClick:()=>void Pt(),children:"END CALL"})})]})}):null]})}return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:G?-10:0},children:[J.length>0?e.jsxs("div",{style:{...Ee(),display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"INVITE REQUESTS"}),J.map(i=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8,alignItems:"center"},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:13},children:[ze[i.inviterKey]??i.inviterKey," invited you to join a conversation."]}),e.jsx("button",{type:"button",style:pe(!1),onClick:()=>void Et(i.inviteId,i.inviterKey,i.primaryPeerKey),children:"ACCEPT"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>Ft(i.inviteId),children:"DECLINE"})]},i.inviteId))]}):null,Se?e.jsx("div",{style:{color:"#26d5ff",fontSize:12},children:Se}):null,e.jsx("div",{style:{padding:10,borderBottom:"1px solid rgba(255,58,77,0.28)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto auto",gap:8},children:[e.jsx("button",{type:"button",style:D(!1),onClick:gt,children:"GUYS"}),e.jsx("button",{type:"button",style:$e?pe(!1):D(!1),onClick:()=>_e(i=>!i),"aria-label":"Toggle favorites only",children:"â˜…"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>g(!0),children:"FILTER"})]})}),Xe?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},role:"dialog","aria-modal":"true","aria-label":"Discover filters",onClick:()=>g(!1),children:e.jsx("div",{onClick:i=>i.stopPropagation(),style:{...Ee(),width:"min(760px, 100%)",maxHeight:"86vh",overflow:"auto"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"FILTER USERS"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{type:"checkbox",checked:B,onChange:i=>ee(i.target.checked)}),"Has pictures"]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Online status"}),e.jsxs("select",{style:Z(),value:p,onChange:i=>w(i.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"offline",children:"Offline"})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:8},children:[e.jsx("input",{style:Z(),placeholder:"Min age",value:se,onChange:i=>ye(i.target.value)}),e.jsx("input",{style:Z(),placeholder:"Max age",value:ke,onChange:i=>Je(i.target.value)}),e.jsx("input",{style:Z(),placeholder:"Race",value:Ze,onChange:i=>bt(i.target.value)}),e.jsxs("select",{style:Z(),value:at,onChange:i=>It(i.target.value),children:[e.jsx("option",{value:"",children:"Cut / Uncut"}),e.jsx("option",{value:"cut",children:"Cut"}),e.jsx("option",{value:"uncut",children:"Uncut"})]}),e.jsx("input",{style:Z(),placeholder:"Min height (in)",value:et,onChange:i=>vt(i.target.value)}),e.jsx("input",{style:Z(),placeholder:"Max height (in)",value:tt,onChange:i=>xt(i.target.value)}),e.jsx("input",{style:Z(),placeholder:"Min weight (lbs)",value:nt,onChange:i=>jt(i.target.value)}),e.jsx("input",{style:Z(),placeholder:"Max weight (lbs)",value:st,onChange:i=>St(i.target.value)}),e.jsx("input",{style:Z(),placeholder:"Min cock size (in)",value:it,onChange:i=>wt(i.target.value)}),e.jsx("input",{style:Z(),placeholder:"Max cock size (in)",value:rt,onChange:i=>kt(i.target.value)}),e.jsxs("select",{style:Z(),value:ot,onChange:i=>Ct(i.target.value),children:[e.jsx("option",{value:"",children:"Position"}),e.jsx("option",{value:"top",children:"Top"}),e.jsx("option",{value:"bottom",children:"Bottom"}),e.jsx("option",{value:"side",children:"Side"})]})]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:D(!1),onClick:gt,children:"RESET"}),e.jsx("button",{type:"button",style:pe(!1),onClick:()=>g(!1),children:"DONE"})]})]})})}):null,e.jsx("div",{style:{display:"grid",gap:0},children:e.jsx("div",{style:{display:"grid",gap:0,gridTemplateColumns:"repeat(3, minmax(0, 1fr))"},children:Ge.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:13,padding:12,gridColumn:"1 / -1"},children:"No users match current filters."}):Ge.map(i=>e.jsx("button",{type:"button",onClick:()=>N(i.key),style:{background:"rgba(0,0,0,0.5)",border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:0,display:"grid",gap:0,color:"#fff",cursor:"pointer"},children:e.jsxs("div",{style:{position:"relative",width:"100%",aspectRatio:"1 / 1"},children:[e.jsx("img",{src:i.avatarUrl??De(i.key),alt:"User avatar",style:{width:"100%",height:"100%",borderRadius:0,objectFit:"cover",border:"1px solid #0fd9ff"}}),i.isOnline?e.jsx("span",{style:{position:"absolute",top:4,left:4,width:10,height:10,borderRadius:"50%",background:"#26d5ff",border:"2px solid #000"}}):null]})},i.key))})})]})}function Nn({api:t,session:n,setLastError:o,openThreadRequest:u,onThreadRequestConsumed:c,isMobile:x}){var ve,fe,ie,Se,f,O;const[S,I]=s.useState([]),[N,M]=s.useState(null),[L,G]=s.useState([]),[P,C]=s.useState("messages"),[a,b]=s.useState(null),[T,W]=s.useState(!1),[h,k]=s.useState(""),[z,R]=s.useState(null),[X,oe]=s.useState({}),[je,de]=s.useState(null),le=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,me="cruise",y=s.useMemo(()=>S.filter(r=>r.key!==N).map(r=>({key:r.key,label:r.displayName})),[S,N]),m=s.useMemo(()=>S.find(r=>r.key===N)??null,[S,N]);s.useEffect(()=>{if(y.length===0){k("");return}k(r=>r&&y.some(v=>v.key===r)?r:y[0].key)},[y]),s.useEffect(()=>{let r=!1;async function v(){var ne,he,ce;try{const ge=n.userId?`user:${n.userId}`:`session:${n.sessionToken}`,[re,be]=await Promise.all([t.getPublicProfiles(),t.listActivePresence(n.sessionToken)]),V={},Ce={};for(const Q of re.profiles)V[Ue(Q.userId)]=Q.displayName,typeof Q.mainPhotoMediaId=="string"&&Q.mainPhotoMediaId.trim()!==""&&(Ce[Ue(Q.userId)]=Q.mainPhotoMediaId);const Pe=Array.from(new Set([...re.profiles.map(Q=>Ue(Q.userId)),...be.presence.map(Q=>Ie(Q.key))].filter(Q=>Q&&Q!==ge))).slice(0,24),Re=[];for(const Q of Pe)try{const we=await t.listChat(n.sessionToken,"cruise",Q),Ae=(we==null?void 0:we.messages)??[];if(!Array.isArray(Ae)||Ae.length===0)continue;const Te=Ae[Ae.length-1],xe=typeof Te.text=="string"&&Te.text.trim().length>0?Xt(Te.text):((ne=Te.media)==null?void 0:ne.kind)==="image"?"[Photo]":((he=Te.media)==null?void 0:he.kind)==="video"?"[Video]":((ce=Te.media)==null?void 0:ce.kind)==="audio"?"[Voice]":"";Re.push({key:Q,displayName:V[Q]??Q,preview:xe,at:Te.createdAtMs})}catch{}const Le=await Promise.all(Re.map(async Q=>{const we=Ce[Q.key];if(!we)return null;try{const Ae=await t.getPublicMediaUrl(we);return{key:Q.key,url:Ae.downloadUrl}}catch{return null}})),Oe={};for(const Q of Le)Q&&(Oe[Q.key]=Q.url);for(const Q of Re)Q.avatarUrl=Oe[Q.key];if(r)return;Re.sort((Q,we)=>we.at-Q.at),I(Re)}catch(ge){r||o(_(ge))}}v();const E=window.setInterval(()=>{v()},1e4);return()=>{r=!0,window.clearInterval(E)}},[t,N,n.sessionToken,n.userId,o]),s.useEffect(()=>{u!=null&&u.key&&(M(Ie(u.key)),C("messages"),typeof c=="function"&&c())},[c,u]),s.useEffect(()=>{const r=v=>{var ne;((ne=v.detail)==null?void 0:ne.tab)==="threads"&&(M(null),C("messages"))};return window.addEventListener("rd:tab-select",r),()=>window.removeEventListener("rd:tab-select",r)},[]),s.useEffect(()=>{if(!N||P!=="profile")return;const r=yt(N);if(!r){b(null);return}let v=!1;return W(!0),t.getPublicProfile(r).then(E=>{v||b(E.profile)}).catch(E=>{v||(b(null),o(_(E)))}).finally(()=>{v||W(!1)}),()=>{v=!0}},[t,N,o,P]),s.useEffect(()=>{if(!N){G([]);return}let r=!1;const v=async()=>{try{const ne=await t.listChat(n.sessionToken,me,N),he=(ne==null?void 0:ne.messages)??[];r||(G(Array.isArray(he)?he:[]),t.markChatRead(n.sessionToken,me,N).catch(()=>{}))}catch(ne){r||o(_(ne))}};v();const E=window.setInterval(()=>{v()},1200);return()=>{r=!0,window.clearInterval(E)}},[t,N,n.sessionToken,o]);function U(r){if(!r.startsWith("GROUP_INVITE_ACCEPT|"))return null;const[,v,E]=r.split("|");return!v||!E?null:{inviteId:v,candidateKey:E}}const te=s.useMemo(()=>({async sendMessage(r,v,E,ne){const he=await t.sendChat(n.sessionToken,r,v,E,ne),ce=he==null?void 0:he.message,ge=U(ce.text??"");if(ge&&ce.toKey===le&&X[ge.inviteId]&&(R(ge.candidateKey),de(`Invite accepted by ${ge.candidateKey}.`),oe(be=>{const V={...be};return delete V[ge.inviteId],V})),G(re=>[...re,ce].sort((be,V)=>be.createdAtMs-V.createdAtMs)),r==="cruise"&&z)try{const re=await t.sendChat(n.sessionToken,r,z,E,ne),be=re==null?void 0:re.message;G(V=>[...V,be].sort((Ce,Pe)=>Ce.createdAtMs-Pe.createdAtMs))}catch(re){o(_(re))}return ce},async initiateMediaUpload(r,v){const E=await t.initiateChatMediaUpload(n.sessionToken,{mimeType:r,sizeBytes:v});return{objectKey:E.objectKey,uploadUrl:E.uploadUrl}},async uploadToSignedUrl(r,v,E){if(await ht(r,v,E))return;if(!(await fetch(r,{method:"PUT",headers:{"content-type":E},body:v})).ok)throw{code:"MEDIA_UPLOAD_INCOMPLETE",message:"Upload failed."}},async getMediaUrl(r){return(await t.getChatMediaUrl(n.sessionToken,r)).downloadUrl}}),[t,le,X,n.sessionToken,o,z]);async function d(){var r;if(!(!N||!h)){if(!S.some(v=>v.key===h)){o("You can only add a third user you have previously messaged.");return}try{const v=crypto.randomUUID();await t.sendChat(n.sessionToken,"cruise",h,`GROUP_INVITE_REQUEST|${v}|${le}|${N}`),oe(E=>({...E,[v]:{candidateKey:h}})),de(`Invite sent to ${((r=S.find(E=>E.key===h))==null?void 0:r.displayName)??h}.`)}catch(v){o(_(v))}}}async function J(){if(N)try{await t.sendChat(n.sessionToken,"cruise",N,mt),de("Fire sent.")}catch(r){o(_(r))}}if(N){const r=(m==null?void 0:m.displayName)??N;return e.jsxs("div",{style:{display:"grid",gap:0,minHeight:x?"calc(100dvh - 150px)":void 0,marginInline:x?-10:0,marginBlock:0},children:[e.jsx("div",{style:{position:"sticky",top:0,zIndex:46,background:"rgba(8,8,12,0.96)",borderBottom:"1px solid rgba(255,58,77,0.35)",padding:"6px 10px",display:"flex",justifyContent:"flex-end"},children:e.jsx("button",{type:"button",onClick:()=>C(v=>v==="messages"?"profile":"messages"),style:{background:"transparent",border:0,color:"#26d5ff",fontSize:13,fontWeight:700,letterSpacing:"0.03em",textTransform:"uppercase",padding:0,cursor:"pointer"},children:P==="messages"?"View Profile":"Back to Thread"})}),P==="messages"?e.jsx(qt,{chatKind:"cruise",peerKey:N,currentUserKey:le,messages:L,client:te,title:`INSTANT THREAD: ${r}`,peerSummary:{displayName:r},thirdParty:{candidates:y,selectedKey:h,onSelect:v=>k(v),onAdd:()=>void d(),disabled:!1},showHeader:!1,edgeToEdge:!0,fillHeight:x}):e.jsxs("div",{style:{padding:12,display:"grid",gap:12},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"88px 1fr",gap:12,alignItems:"center"},children:[e.jsx("img",{src:(m==null?void 0:m.avatarUrl)??De(N),alt:"Profile avatar",style:{width:88,height:88,borderRadius:"50%",objectFit:"cover",border:"2px solid #ff3047"}}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:24,fontWeight:700},children:(a==null?void 0:a.displayName)??r}),e.jsx("div",{style:{color:"#26d5ff",fontSize:14},children:"Instant Messaging Available"})]})]}),T?e.jsx("div",{style:{color:"#9fb6bf",fontSize:14},children:"Loading profile..."}):null,T?null:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsxs("div",{style:{color:"#ced3dc",fontSize:14,lineHeight:1.5},children:[e.jsxs("div",{children:["Age: ",(a==null?void 0:a.age)??"-"]}),e.jsxs("div",{children:["Race: ",((ve=a==null?void 0:a.stats)==null?void 0:ve.race)??"-"]}),e.jsxs("div",{children:["Height: ",((fe=a==null?void 0:a.stats)==null?void 0:fe.heightInches)??"-"]}),e.jsxs("div",{children:["Weight: ",((ie=a==null?void 0:a.stats)==null?void 0:ie.weightLbs)??"-"]}),e.jsxs("div",{children:["Cock Size: ",((Se=a==null?void 0:a.stats)==null?void 0:Se.cockSizeInches)??"-"]}),e.jsxs("div",{children:["Cut / Uncut: ",((f=a==null?void 0:a.stats)==null?void 0:f.cutStatus)??"-"]}),e.jsxs("div",{children:["Position: ",((O=a==null?void 0:a.stats)==null?void 0:O.position)??"-"]}),e.jsxs("div",{style:{marginTop:8},children:["Bio: ",(a==null?void 0:a.bio)??"-"]})]}),e.jsx("div",{children:e.jsx("button",{type:"button",style:{...D(!1),color:"#ffb347",borderColor:"rgba(255,179,71,0.65)"},onClick:()=>void J(),children:"ðŸ”¥ FIRE"})})]})]})]})}return e.jsxs("div",{style:{display:"grid",gap:0,marginInline:x?-10:0,marginBlock:0},children:[S.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14,padding:14},children:"No conversations yet."}):S.map(r=>e.jsxs("button",{type:"button",onClick:()=>M(r.key),style:{border:0,borderBottom:"1px solid rgba(255,58,77,0.24)",borderRadius:0,padding:"10px 12px",background:"rgba(0,0,0,0.2)",textAlign:"left",color:"#fff",cursor:"pointer",display:"grid",gridTemplateColumns:"52px 1fr",gap:10,alignItems:"center",width:"100%"},children:[e.jsx("img",{src:r.avatarUrl??De(r.key),alt:`${r.displayName} avatar`,style:{width:52,height:52,borderRadius:6,objectFit:"cover",border:"1px solid rgba(38,213,255,0.9)"}}),e.jsxs("div",{style:{display:"grid",gap:3,minWidth:0},children:[e.jsx("div",{style:{fontWeight:700},children:r.displayName}),e.jsx("div",{style:{color:"#b9bec9",fontSize:13,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:r.preview})]})]},r.key)),je?e.jsx("div",{style:{color:"#26d5ff",fontSize:12,padding:10},children:je}):null]})}function Pn({api:t,session:n,isMobile:o,setLastError:u}){const[c,x]=s.useState("ads"),[S,I]=s.useState([]),[N,M]=s.useState([]),[L,G]=s.useState(""),[P,C]=s.useState(""),[a,b]=s.useState(""),[T,W]=s.useState(""),[h,k]=s.useState([]),[z,R]=s.useState(""),[X,oe]=s.useState(""),[je,de]=s.useState(""),[le,me]=s.useState([]),[y,m]=s.useState({}),U=!0,te=n.userType!=="guest";async function d(){try{const[r,v,E,ne]=await Promise.all([t.listPublicPostings("ad"),t.listPublicPostings("event"),t.listCruisingSpots(),n.userType==="guest"?Promise.resolve({postings:[]}):t.listEventInvites(n.sessionToken)]);I([...r.postings].sort((he,ce)=>he.createdAtMs-ce.createdAtMs)),M([...v.postings].sort((he,ce)=>he.createdAtMs-ce.createdAtMs)),k(E.spots),me(ne.postings)}catch(r){u(_(r))}}s.useEffect(()=>{d()},[]),s.useEffect(()=>{const r=v=>{var ne;((ne=v.detail)==null?void 0:ne.tab)==="public"&&x("ads")};return window.addEventListener("rd:tab-select",r),()=>window.removeEventListener("rd:tab-select",r)},[]);async function J(r){if(r==="event"&&!te){u("Anonymous users cannot create event postings.");return}const v=r==="ad"?L:a,E=r==="ad"?P:T;try{await t.createPublicPosting(n.sessionToken,{type:r,title:v,body:E}),r==="ad"?(G(""),C("")):(b(""),W("")),await d()}catch(ne){u(_(ne))}}async function ve(r){if(!te){u("Anonymous users cannot invite to events.");return}const v=(y[r]??"").trim();if(!v){u("Target user id is required.");return}try{await t.inviteToEvent(n.sessionToken,{postingId:r,targetUserId:v}),m(E=>({...E,[r]:""})),await d()}catch(E){u(_(E))}}async function fe(r,v){if(n.userType==="guest"){u("Anonymous users cannot respond to event invites.");return}try{await t.respondToEventInvite(n.sessionToken,{postingId:r,accept:v}),await d()}catch(E){u(_(E))}}async function ie(){try{await t.createCruisingSpot(n.sessionToken,{name:z,address:X,description:je}),R(""),oe(""),de(""),await d()}catch(r){u(_(r))}}async function Se(r){try{await t.checkInCruisingSpot(n.sessionToken,r),await d()}catch(v){u(_(v))}}const f=r=>{const v=r==="ads"?"ADS":"EVENTS",E=r==="ads"?S:N,ne=r==="ads"?L:a,he=r==="ads"?P:T,ce=r==="ads"?G:b,ge=r==="ads"?C:W,re=r==="ads"?"ad":"event",be=r==="ads"?U:te;return e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.38)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:v}),e.jsx("input",{value:ne,onChange:V=>ce(V.target.value),placeholder:`${v} title`,style:Z(),"aria-label":`${v} title`,disabled:!be}),e.jsx("textarea",{value:he,onChange:V=>ge(V.target.value),placeholder:`Write ${v.toLowerCase()} details`,style:{...Z(),minHeight:86,resize:"vertical"},"aria-label":`${v} details`,disabled:!be}),e.jsxs("button",{type:"button",onClick:()=>void J(re),style:be?pe(!1):D(!0),disabled:!be,children:["POST ",v]}),be?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can view events but cannot post events."}),e.jsx("div",{style:{display:"grid",gap:8,marginTop:6},children:E.length===0?e.jsxs("div",{style:{color:"#b9bec9",fontSize:14},children:["No ",v.toLowerCase()," yet."]}):E.map(V=>{var Ce,Pe;return e.jsxs("div",{style:{borderTop:"1px solid rgba(255,58,77,0.25)",paddingTop:10,paddingBottom:10},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:4},children:V.title}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12,marginBottom:6},children:["Host: ",V.authorUserId]}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap"},children:V.body}),r==="events"?e.jsxs("div",{style:{display:"grid",gap:8,marginTop:8},children:[e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12},children:["Invited: ",((Ce=V.invitedUserIds)==null?void 0:Ce.length)??0," | Accepted: ",((Pe=V.acceptedUserIds)==null?void 0:Pe.length)??0]}),n.userId&&n.userId===V.authorUserId?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8},children:[e.jsx("input",{value:y[V.postingId]??"",onChange:Re=>m(Le=>({...Le,[V.postingId]:Re.target.value})),placeholder:"Invite user id",style:Z()}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void ve(V.postingId),children:"INVITE"})]}):null,n.userType!=="guest"&&n.userId&&Array.isArray(V.invitedUserIds)&&V.invitedUserIds.includes(n.userId)?e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:pe(!1),onClick:()=>void fe(V.postingId,!0),children:"ACCEPT INVITE"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void fe(V.postingId,!1),children:"DECLINE"})]}):null]}):null]},V.postingId)})})]})})},O=e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.38)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"CRUISING SPOTS"}),e.jsx("input",{value:z,onChange:r=>R(r.target.value),placeholder:"Spot name",style:Z(),disabled:!1}),e.jsx("input",{value:X,onChange:r=>oe(r.target.value),placeholder:"Spot address",style:Z(),disabled:!1}),e.jsx("textarea",{value:je,onChange:r=>de(r.target.value),placeholder:"Spot description",style:{...Z(),minHeight:80,resize:"vertical"},disabled:!1}),e.jsx("button",{type:"button",style:pe(!1),disabled:!1,onClick:()=>void ie(),children:"CREATE SPOT"}),null,e.jsx("div",{style:{display:"grid",gap:8},children:h.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"No cruising spots yet."}):h.map(r=>e.jsxs("div",{style:{borderTop:"1px solid rgba(255,58,77,0.25)",paddingTop:10,paddingBottom:10},children:[e.jsx("div",{style:{fontWeight:700},children:r.name}),e.jsxs("div",{style:{color:"#9fb6bf",fontSize:12,marginTop:4},children:["Created by: ",r.creatorUserId]}),e.jsx("div",{style:{color:"#9fb6bf",fontSize:12,marginTop:2},children:r.address}),e.jsx("div",{style:{color:"#ced3dc",fontSize:14,whiteSpace:"pre-wrap",marginTop:6},children:r.description}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:D(!1),onClick:()=>void Se(r.spotId),children:"CHECK IN"}),e.jsxs("span",{style:{color:"#9fb6bf",fontSize:12},children:["Checked in: ",r.checkInCount??0]}),e.jsxs("span",{style:{color:"#9fb6bf",fontSize:12},children:["Got action: ",r.actionCount??0]})]})]},r.spotId))})]})});return e.jsx("div",{style:{display:"grid",gap:8,marginInline:o?-10:0},children:o?e.jsxs(e.Fragment,{children:[c==="ads"?f("ads"):null,c==="events"?f("events"):null,c==="spots"?O:null,e.jsx("div",{style:{position:"sticky",bottom:"calc(86px + env(safe-area-inset-bottom, 0px))",zIndex:31,background:"rgba(0,0,0,0.35)",padding:8},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10},children:[e.jsx("button",{type:"button",style:c==="ads"?pe(!1):D(!1),onClick:()=>x("ads"),children:"ADS"}),e.jsx("button",{type:"button",style:c==="events"?pe(!1):D(!1),onClick:()=>x("events"),children:"EVENTS"}),e.jsx("button",{type:"button",style:c==="spots"?pe(!1):D(!1),onClick:()=>x("spots"),children:"SPOTS"})]})})]}):e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[f("ads"),f("events"),e.jsx("div",{style:{gridColumn:"1 / -1"},children:O}),n.userType!=="guest"&&le.length>0?e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.25)",gridColumn:"1 / -1",display:"grid",gap:8,padding:10},children:[e.jsx("div",{style:{fontSize:16,fontWeight:700},children:"EVENT INVITES"}),le.map(r=>e.jsxs("div",{style:{display:"grid",gap:6,border:"1px solid rgba(255,58,77,0.4)",borderRadius:10,padding:8},children:[e.jsx("div",{style:{fontWeight:700},children:r.title}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13},children:["Host: ",r.authorUserId]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:pe(!1),onClick:()=>void fe(r.postingId,!0),children:"ACCEPT"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void fe(r.postingId,!1),children:"DECLINE"})]})]},r.postingId))]}):null]})})}function En({api:t,session:n,setLastError:o}){const[u,c]=s.useState([]),[x,S]=s.useState(""),[I,N]=s.useState("");async function M(){try{const a=await t.listSubmissions();c([...a.submissions].sort((b,T)=>T.createdAtMs-b.createdAtMs))}catch(a){o(_(a))}}s.useEffect(()=>{M()},[]);async function L(){try{await t.createSubmission(n.sessionToken,{title:x,body:I}),S(""),N(""),await M()}catch(a){o(_(a))}}async function G(a){try{await t.recordSubmissionView(a),await M()}catch(b){o(_(b))}}async function P(a,b){try{await t.rateSubmission(a,b),await M()}catch(T){o(_(T))}}const C=n.userType!=="guest";return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",padding:10,background:"rgba(0,0,0,0.2)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("input",{style:Z(),value:x,onChange:a=>S(a.target.value),placeholder:"Story title",disabled:!C}),e.jsx("textarea",{style:{...Z(),minHeight:120},value:I,onChange:a=>N(a.target.value),placeholder:"Write your story",disabled:!C}),e.jsx("button",{type:"button",style:C?pe(!1):D(!0),disabled:!C,onClick:()=>void L(),children:"PUBLISH STORY"}),C?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can read but cannot publish submissions."})]})}),e.jsx("div",{style:{display:"grid",gap:10},children:u.map(a=>{const b=a.ratingCount>0?(a.ratingSum/a.ratingCount).toFixed(2):"0.00";return e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.28)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:a.title}),e.jsx("div",{style:{color:"#ced3dc",whiteSpace:"pre-wrap",marginTop:6},children:a.body}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13,marginTop:8},children:["Views: ",a.viewCount," | Rating: ",b," (",a.ratingCount,")"]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:D(!1),onClick:()=>void G(a.submissionId),children:"VIEW"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void P(a.submissionId,1),children:"â˜…1"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void P(a.submissionId,2),children:"â˜…2"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void P(a.submissionId,3),children:"â˜…3"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void P(a.submissionId,4),children:"â˜…4"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void P(a.submissionId,5),children:"â˜…5"})]})]},a.submissionId)})})]})}function Fn({api:t,session:n,setLastError:o}){var le,me,y,m,U,te;const[u,c]=s.useState([]),[x,S]=s.useState({}),[I,N]=s.useState(null),[M,L]=s.useState(2e3),[G,P]=s.useState(""),[C,a]=s.useState(""),[b,T]=s.useState(""),[W,h]=s.useState(""),[k,z]=s.useState("Ready."),R=n.userType!=="guest";async function X(){try{const d=await t.listPromotedProfiles();c([...d.listings].sort((ie,Se)=>Se.createdAtMs-ie.createdAtMs)),L(d.feeCents);const J=Array.from(new Set(d.listings.map(ie=>ie.userId))).filter(ie=>ie.trim().length>0),ve=await Promise.all(J.map(async ie=>{try{const f=(await t.getPublicProfile(ie)).profile.mainPhotoMediaId;if(!f)return null;const O=await t.getPublicMediaUrl(f);return{userId:ie,url:O.downloadUrl}}catch{return null}})),fe={};for(const ie of ve)ie&&(fe[ie.userId]=ie.url);S(fe)}catch(d){o(_(d))}}s.useEffect(()=>{X()},[]);async function oe(){if(!R){o("Anonymous users cannot create promoted profiles.");return}try{const d=await t.startPromotedPayment(n.sessionToken),J=await t.confirmPromotedPayment(n.sessionToken,d.payment.paymentToken);h(J.payment.paymentToken),z("Payment confirmed. You can now publish one promoted profile.")}catch(d){const J=_(d);z(J),o(J)}}async function je(){if(!R){o("Anonymous users cannot create promoted profiles.");return}try{await t.createPromotedProfile(n.sessionToken,{paymentToken:W,title:G,body:C,displayName:b}),P(""),a(""),T(""),h(""),z("Promoted profile published."),await X()}catch(d){const J=_(d);z(J),o(J)}}async function de(d){try{const J=await t.getPublicProfile(d);N(J.profile)}catch(J){o(_(J))}}return e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"PROMOTED PROFILES"}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:14},children:["Publishing requires a $",Math.round(M/100)," fee per profile."]}),e.jsx("div",{style:{color:"#26d5ff",fontSize:13},children:k})]})}),e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("input",{value:b,onChange:d=>T(d.target.value),placeholder:"Display name",style:Z(),disabled:!R}),e.jsx("input",{value:G,onChange:d=>P(d.target.value),placeholder:"Headline",style:Z(),disabled:!R}),e.jsx("textarea",{value:C,onChange:d=>a(d.target.value),placeholder:"Profile description",style:{...Z(),minHeight:92,resize:"vertical"},disabled:!R}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsxs("button",{type:"button",style:D(!R),disabled:!R,onClick:()=>void oe(),children:["PAY $",Math.round(M/100)]}),e.jsx("button",{type:"button",style:R?pe(!1):D(!0),disabled:!R,onClick:()=>void je(),children:"PUBLISH PROFILE"})]}),R?null:e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guests can browse but cannot publish paid profiles."})]})}),e.jsx("div",{style:{display:"grid",gap:10},children:u.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"No promoted profiles yet."}):u.map(d=>e.jsx("div",{style:{border:"1px solid rgba(255,58,77,0.25)",borderRadius:0,padding:10,background:"rgba(0,0,0,0.22)"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"72px 1fr",gap:10,alignItems:"start"},children:[e.jsx("img",{src:x[d.userId]??De(`user:${d.userId}`),alt:`${d.displayName} profile`,style:{width:72,height:72,borderRadius:6,objectFit:"cover",border:"1px solid rgba(38,213,255,0.9)"}}),e.jsxs("div",{style:{display:"grid",gap:4},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:d.title}),e.jsx("div",{style:{color:"#26d5ff",fontSize:13},children:d.displayName}),e.jsx("div",{style:{color:"#ced3dc",whiteSpace:"pre-wrap",fontSize:14},children:d.body}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void de(d.userId),children:"VIEW PROFILE"})]})]})},d.listingId))}),I?e.jsx("div",{style:{position:"fixed",inset:0,zIndex:40,background:"rgba(0,0,0,0.72)",display:"grid",placeItems:"center",padding:14},onClick:()=>N(null),children:e.jsxs("div",{onClick:d=>d.stopPropagation(),style:{border:"1px solid rgba(255,58,77,0.35)",borderRadius:0,padding:12,width:"min(560px, 100%)",background:"rgba(0,0,0,0.88)"},children:[e.jsx("div",{style:{fontSize:22,fontWeight:700},children:I.displayName}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:6},children:["Age: ",I.age]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Race: ",((le=I.stats)==null?void 0:le.race)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Height: ",((me=I.stats)==null?void 0:me.heightInches)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Weight: ",((y=I.stats)==null?void 0:y.weightLbs)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Cock Size: ",((m=I.stats)==null?void 0:m.cockSizeInches)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Cut / Uncut: ",((U=I.stats)==null?void 0:U.cutStatus)??"-"]}),e.jsxs("div",{style:{color:"#ced3dc",marginTop:2},children:["Position: ",((te=I.stats)==null?void 0:te.position)??"-"]}),e.jsx("div",{style:{color:"#ced3dc",marginTop:10,whiteSpace:"pre-wrap"},children:I.bio}),e.jsx("div",{style:{marginTop:10},children:e.jsx("button",{type:"button",style:D(!1),onClick:()=>N(null),children:"CLOSE"})})]})}):null]})}function zn(){return{displayName:"",age:"",bio:"",heightInches:"",race:"",cockSizeInches:"",cutStatus:"",weightLbs:"",position:"",discreetMode:!1,travelEnabled:!1,travelLat:"",travelLng:"",lookingForMore:""}}function $t(t){var n,o,u;return{displayName:t.displayName,age:String(t.age),bio:t.bio,heightInches:t.stats.heightInches!==void 0?String(t.stats.heightInches):"",race:t.stats.race??"",cockSizeInches:t.stats.cockSizeInches!==void 0?String(t.stats.cockSizeInches):"",cutStatus:t.stats.cutStatus??"",weightLbs:t.stats.weightLbs!==void 0?String(t.stats.weightLbs):"",position:t.stats.position??"",discreetMode:t.discreetMode===!0,travelEnabled:((n=t.travelMode)==null?void 0:n.enabled)===!0,travelLat:typeof((o=t.travelMode)==null?void 0:o.lat)=="number"?String(t.travelMode.lat):"",travelLng:typeof((u=t.travelMode)==null?void 0:u.lng)=="number"?String(t.travelMode.lng):"",lookingForMore:t.bio}}function _t(t){const n=t.trim();if(!n)return;const o=Number(n);return Number.isFinite(o)?Math.trunc(o):void 0}function Un(t){const n=t.trim();if(!n)return;const o=Number(n);return Number.isFinite(o)?o:void 0}function On({api:t,session:n,setLastError:o}){var le,me;const[u,c]=s.useState(zn()),[x,S]=s.useState(null),[I,N]=s.useState(!1),[M,L]=s.useState(!1),[G,P]=s.useState(null),[C,a]=s.useState({});async function b(){N(!0);try{const y=await t.getMyProfile(n.sessionToken);S(y.profile),c($t(y.profile)),P("Profile loaded.")}catch(y){const m=y;if((m==null?void 0:m.code)==="PROFILE_NOT_FOUND"){S(null),c(U=>({...U,age:U.age||"18"})),P("No profile yet. Fill out the form and save.");return}P(_(y))}finally{N(!1)}}s.useEffect(()=>{b()},[n.sessionToken,n.userType]),s.useEffect(()=>{const y=[x==null?void 0:x.mainPhotoMediaId,...(x==null?void 0:x.galleryMediaIds)??[]].filter(U=>typeof U=="string"&&U.length>0);if(y.length===0)return;const m=y.filter(U=>!C[U]);m.length!==0&&Promise.all(m.map(async U=>{try{const te=await t.getPublicMediaUrl(U);return{id:U,url:te.downloadUrl}}catch{return null}})).then(U=>{a(te=>{const d={...te};for(const J of U)J&&(d[J.id]=J.url);return d})})},[t,C,x==null?void 0:x.galleryMediaIds,x==null?void 0:x.mainPhotoMediaId]);async function T(){var y,m,U;L(!0),o(null);try{const te=Number(u.age),d=u.lookingForMore.trim()?`${u.bio.trim()}

Looking For More: ${u.lookingForMore.trim()}`.trim():u.bio,J=u.travelLat.trim()?Number(u.travelLat):void 0,ve=u.travelLng.trim()?Number(u.travelLng):void 0,fe={displayName:u.displayName,age:Math.trunc(te),bio:d,stats:{heightInches:_t(u.heightInches),race:u.race.trim()||void 0,cockSizeInches:Un(u.cockSizeInches),cutStatus:u.cutStatus||void 0,weightLbs:_t(u.weightLbs),position:u.position||void 0},discreetMode:u.discreetMode,travelMode:{enabled:u.travelEnabled,lat:Number.isFinite(J)?J:void 0,lng:Number.isFinite(ve)?ve:void 0}},ie=await t.upsertMyProfile(n.sessionToken,fe);S(ie.profile),c($t(ie.profile));try{localStorage.setItem("reddoor_travel_center",JSON.stringify({enabled:((y=ie.profile.travelMode)==null?void 0:y.enabled)===!0,lat:(m=ie.profile.travelMode)==null?void 0:m.lat,lng:(U=ie.profile.travelMode)==null?void 0:U.lng}))}catch{}P("Profile saved.")}catch(te){const d=_(te);P(d),o(d)}finally{L(!1)}}async function W(y,m){if(!m){P("Choose a file first.");return}if(n.userType==="guest"){P("Guest sessions cannot upload media. Register to persist media.");return}L(!0),o(null);try{const U=await t.initiateMediaUpload(n.sessionToken,{kind:y,mimeType:m.type||(y==="video"?"video/mp4":"image/jpeg"),sizeBytes:m.size});if(!await ht(U.uploadUrl,m,m.type||"application/octet-stream")){const d=await fetch(U.uploadUrl,{method:"PUT",headers:{"content-type":m.type||"application/octet-stream"},body:m});if(!d.ok)throw{message:`Upload failed (${d.status}).`}}await t.completeMediaUpload(n.sessionToken,U.mediaId),await b(),P("Media uploaded.")}catch(U){const te=_(U);P(te),o(te)}finally{L(!1)}}const[h,k]=s.useState(null),[z,R]=s.useState(null),[X,oe]=s.useState(null);async function je(y){if(x){L(!0);try{const m=(x.galleryMediaIds??[]).filter(te=>te!==y),U=await t.updateProfileMediaReferences(n.sessionToken,{galleryMediaIds:m});S(U.profile),P("Gallery updated.")}catch(m){const U=_(m);P(U),o(U)}finally{L(!1)}}}async function de(y){if(x){L(!0);try{const m=await t.updateProfileMediaReferences(n.sessionToken,{galleryMediaIds:x.galleryMediaIds,mainPhotoMediaId:y});S(m.profile),P("Main photo updated.")}catch(m){const U=_(m);P(U),o(U)}finally{L(!1)}}}return e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:14},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"SETTINGS / PROFILE"}),n.userType==="guest"?e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"Guest profile data is temporary for this session and is removed when you log out."}):null,G?e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:G}):null,e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Display Name"}),e.jsx("input",{value:u.displayName,onChange:y=>c(m=>({...m,displayName:y.target.value})),style:Z()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Age"}),e.jsx("input",{value:u.age,onChange:y=>c(m=>({...m,age:y.target.value})),style:Z(),inputMode:"numeric"})]})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Bio"}),e.jsx("textarea",{value:u.bio,onChange:y=>c(m=>({...m,bio:y.target.value})),style:{...Z(),minHeight:88,resize:"vertical"}})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Looking For More (Optional)"}),e.jsx("textarea",{value:u.lookingForMore,onChange:y=>c(m=>({...m,lookingForMore:y.target.value})),style:{...Z(),minHeight:72,resize:"vertical"}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:u.discreetMode,onChange:y=>c(m=>({...m,discreetMode:y.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0,fontSize:13},children:"Discreet Mode (hide profile from others)"})]}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:u.travelEnabled,onChange:y=>c(m=>({...m,travelEnabled:y.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Travel Mode"})]})]}),u.travelEnabled?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Travel Lat"}),e.jsx("input",{value:u.travelLat,onChange:y=>c(m=>({...m,travelLat:y.target.value})),style:Z()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Travel Lng"}),e.jsx("input",{value:u.travelLng,onChange:y=>c(m=>({...m,travelLng:y.target.value})),style:Z()})]})]}):null,e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Height (in)"}),e.jsx("input",{value:u.heightInches,onChange:y=>c(m=>({...m,heightInches:y.target.value})),style:Z(),inputMode:"numeric"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Race"}),e.jsx("input",{value:u.race,onChange:y=>c(m=>({...m,race:y.target.value})),style:Z()})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Cock Size (in)"}),e.jsx("input",{value:u.cockSizeInches,onChange:y=>c(m=>({...m,cockSizeInches:y.target.value})),style:Z(),inputMode:"decimal"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:12},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Cut / Uncut"}),e.jsxs("select",{value:u.cutStatus,onChange:y=>c(m=>({...m,cutStatus:y.target.value})),style:Z(),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"cut",children:"Cut"}),e.jsx("option",{value:"uncut",children:"Uncut"})]})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Weight (lbs)"}),e.jsx("input",{value:u.weightLbs,onChange:y=>c(m=>({...m,weightLbs:y.target.value})),style:Z(),inputMode:"numeric"})]}),e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Position"}),e.jsxs("select",{value:u.position,onChange:y=>c(m=>({...m,position:y.target.value})),style:Z(),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"top",children:"Top"}),e.jsx("option",{value:"bottom",children:"Bottom"}),e.jsx("option",{value:"side",children:"Side"})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",onClick:()=>void T(),style:pe(M),disabled:M,children:"SAVE PROFILE"}),e.jsx("button",{type:"button",onClick:()=>void b(),style:D(I),disabled:I,children:"REFRESH"})]})]})}),e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"MEDIA"}),e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:"Main profile photo, gallery photo, and video uploads."}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Main Photo"}),e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:y=>{var m;return k(((m=y.target.files)==null?void 0:m[0])??null)}})]}),e.jsx("button",{type:"button",style:pe(M),disabled:M,onClick:()=>void W("photo_main",h),children:"UPLOAD MAIN PHOTO"})]}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Gallery Photo"}),e.jsx("input",{className:"rd-input",type:"file",accept:"image/*",onChange:y=>{var m;return R(((m=y.target.files)==null?void 0:m[0])??null)}})]}),e.jsx("button",{type:"button",style:pe(M),disabled:M,onClick:()=>void W("photo_gallery",z),children:"UPLOAD GALLERY PHOTO"})]}),e.jsxs("div",{style:{display:"grid",gap:10,padding:10,borderRadius:12,border:"1px solid rgba(255,58,77,0.45)",background:"rgba(0,0,0,0.42)"},children:[e.jsxs("label",{style:{display:"grid",gap:6},children:[e.jsx("span",{className:"rd-label",children:"Video"}),e.jsx("input",{className:"rd-input",type:"file",accept:"video/*",onChange:y=>{var m;return oe(((m=y.target.files)==null?void 0:m[0])??null)}})]}),e.jsx("button",{type:"button",style:pe(M),disabled:M,onClick:()=>void W("video",X),children:"UPLOAD VIDEO"})]}),e.jsxs("div",{style:{color:"#b9bec9",fontSize:13},children:["Main photo media id: ",(x==null?void 0:x.mainPhotoMediaId)??"-",e.jsx("br",{}),"Gallery count: ",((le=x==null?void 0:x.galleryMediaIds)==null?void 0:le.length)??0,e.jsx("br",{}),"Video media id: ",(x==null?void 0:x.videoMediaId)??"-"]}),e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:14,fontWeight:700},children:"YOUR GALLERY"}),(me=x==null?void 0:x.galleryMediaIds)!=null&&me.length?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(130px, 1fr))",gap:10},children:x.galleryMediaIds.map(y=>e.jsxs("div",{style:{border:"1px solid rgba(255,58,77,0.45)",borderRadius:10,padding:8,display:"grid",gap:8},children:[e.jsx("img",{src:C[y]??De(y),alt:"Gallery photo",style:{width:"100%",aspectRatio:"1/1",objectFit:"cover",borderRadius:8,border:"1px solid rgba(255,58,77,0.4)"}}),e.jsx("button",{type:"button",style:D(M),disabled:M,onClick:()=>void de(y),children:"SET MAIN"}),e.jsx("button",{type:"button",style:D(M),disabled:M,onClick:()=>void je(y),children:"REMOVE"})]},y))}):e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No gallery photos uploaded yet."})]})]})})]})}function Kn({api:t,session:n,setLastError:o,onLogout:u}){const[c,x]=s.useState({discreetMode:!1,travelEnabled:!1,travelLat:"",travelLng:""}),[S,I]=s.useState("Loading settings..."),[N,M]=s.useState(!1),[L,G]=s.useState([]);async function P(){var h,k,z;try{const R=await t.getMyProfile(n.sessionToken);if(x({discreetMode:R.profile.discreetMode===!0,travelEnabled:((h=R.profile.travelMode)==null?void 0:h.enabled)===!0,travelLat:typeof((k=R.profile.travelMode)==null?void 0:k.lat)=="number"?String(R.profile.travelMode.lat):"",travelLng:typeof((z=R.profile.travelMode)==null?void 0:z.lng)=="number"?String(R.profile.travelMode.lng):""}),I("Settings loaded."),n.userType!=="guest")try{const X=await t.listBlocked(n.sessionToken);G(X.blocked)}catch{G([])}else G([])}catch(R){I(_(R))}}async function C(){try{const h=await fetch("/api/config"),k=await h.json();if(!h.ok)throw k;M(k.mediaStorageConfigured===!0)}catch{M(!1)}}s.useEffect(()=>{P(),C()},[n.sessionToken,n.userType]);async function a(){try{const h=await t.getMyProfile(n.sessionToken),k=c.travelLat.trim()?Number(c.travelLat):void 0,z=c.travelLng.trim()?Number(c.travelLng):void 0;await t.upsertMyProfile(n.sessionToken,{displayName:h.profile.displayName,age:h.profile.age,bio:h.profile.bio,stats:h.profile.stats,discreetMode:c.discreetMode,travelMode:{enabled:c.travelEnabled,lat:Number.isFinite(k)?k:void 0,lng:Number.isFinite(z)?z:void 0}}),I("Privacy settings saved.")}catch(h){const k=_(h);I(k),o(k)}}async function b(){if(!navigator.geolocation){const h="Geolocation is unavailable on this device.";I(h),o(h);return}try{const h=await new Promise((R,X)=>{navigator.geolocation.getCurrentPosition(R,X,{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})}),k=Number(h.coords.latitude.toFixed(6)),z=Number(h.coords.longitude.toFixed(6));x(R=>({...R,travelEnabled:!0,travelLat:String(k),travelLng:String(z)}));try{localStorage.setItem("reddoor_travel_center",JSON.stringify({enabled:!0,lat:k,lng:z}))}catch{}try{await t.updatePresence(n.sessionToken,k,z,"online")}catch{}window.dispatchEvent(new CustomEvent("rd:location-updated",{detail:{lat:k,lng:z}})),I("Actual location detected. Save privacy settings to persist it.")}catch(h){const k=_(h);I(k),o(k)}}async function T(){try{const h=c.travelLat.trim()?Number(c.travelLat):void 0,k=c.travelLng.trim()?Number(c.travelLng):void 0,z=await t.seedFakeUsers(12,Number.isFinite(h)?h:void 0,Number.isFinite(k)?k:void 0);I(`Seeded ${z.seededCount} fake users for testing.`)}catch(h){const k=_(h);I(k),o(k)}}async function W(h){try{await t.unblock(n.sessionToken,h);const k=await t.listBlocked(n.sessionToken);G(k.blocked),I("Blocked users updated.")}catch(k){const z=_(k);I(z),o(z)}}return e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:20,fontWeight:700},children:"SETTINGS"}),e.jsx("div",{style:{color:"#b9bec9",fontSize:14},children:S}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:c.discreetMode,onChange:h=>x(k=>({...k,discreetMode:h.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Discreet Mode (hide your profile)"})]}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"checkbox",checked:c.travelEnabled,onChange:h=>x(k=>({...k,travelEnabled:h.target.checked}))}),e.jsx("span",{className:"rd-label",style:{margin:0},children:"Travel Mode"})]}),c.travelEnabled?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx("input",{value:c.travelLat,onChange:h=>x(k=>({...k,travelLat:h.target.value})),style:Z(),placeholder:"Travel lat"}),e.jsx("input",{value:c.travelLng,onChange:h=>x(k=>({...k,travelLng:h.target.value})),style:Z(),placeholder:"Travel lng"})]}):null,e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsx("button",{type:"button",style:pe(!1),onClick:()=>void a(),children:"SAVE PRIVACY"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void b(),children:"DETECT ACTUAL LOCATION"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void T(),children:"SEED FAKE USERS"}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>u==null?void 0:u(),children:"LOGOUT"})]})]})}),e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"MEDIA STORAGE"}),e.jsx("div",{style:{color:N?"#26d5ff":"#ff8a95",fontSize:14},children:N?"Configured: uploads enabled.":"Not configured: set S3_BUCKET, S3_REGION, S3_ACCESS_KEY_ID, S3_SECRET_ACCESS_KEY."}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void C(),children:"REFRESH STORAGE STATUS"})]})}),n.userType!=="guest"?e.jsx("div",{style:Ee(),children:e.jsxs("div",{style:{display:"grid",gap:8},children:[e.jsx("div",{style:{fontSize:18,fontWeight:700},children:"BLOCKED USERS"}),L.length===0?e.jsx("div",{style:{color:"#b9bec9",fontSize:13},children:"No blocked users."}):L.map(h=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:8,alignItems:"center"},children:[e.jsx("div",{style:{color:"#ced3dc",fontSize:14},children:h}),e.jsx("button",{type:"button",style:D(!1),onClick:()=>void W(h),children:"UNBLOCK"})]},h))]})}):null]})}function Wn({api:t,session:n,setSession:o,settings:u,activeTab:c,setActiveTab:x,discoverFilter:S,busy:I,setBusy:N,setLastError:M,onUnreadCountChange:L,hideModeCard:G,onLogout:P}){const C=Tn(),[a,b]=s.useState(null),T=e.jsx(Mn,{api:t,session:n,settings:u,discoverFilter:S,busy:I,setBusy:N,setLastError:M,isMobile:C,onOpenThreadRequested:h=>{b({key:Ie(h),nonce:Date.now()}),x("threads")},onUnreadCountChange:L}),W=e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx(On,{api:t,session:n,setLastError:M}),e.jsx(Kn,{api:t,session:n,setLastError:M,onLogout:P})]});return e.jsxs("div",{style:{display:"grid",gap:12},children:[null,e.jsx("div",{style:{display:c==="discover"?"block":"none"},children:T}),c==="threads"?e.jsx(Nn,{api:t,session:n,setLastError:M,openThreadRequest:a,onThreadRequestConsumed:()=>b(null),isMobile:C}):null,c==="public"?e.jsx(Pn,{api:t,session:n,isMobile:C,setLastError:M}):null,c==="profile"||c==="settings"?W:null,c==="submissions"?e.jsx(En,{api:t,session:n,setLastError:M}):null,c==="promoted"?e.jsx(Fn,{api:t,session:n,setLastError:M}):null]})}export{Wn as Router};
